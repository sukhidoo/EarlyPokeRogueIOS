var rg=Object.defineProperty;var u=(y,e)=>rg(y,"name",{value:e,configurable:!0});import{g as s,i as g,B as I,S as ge,a as os,f as de,p as Is,b as rf,r as Ot,N as rt,c as Ka,P as is,d as sa,e as Ee,t as of,h as at,j as lf,k as mh,l as ia,m as qe,n as Ds,o as li,q as Or,s as js,u as hi,v as hf,w as An,x as og,y as Be,z as lg,A as _i,C as hg,D as cg,E as ci,F as cf,R as ug,G as ap,H as dg,I as uf,J as Jt,K as $n,L as pg,M as rp,O as yh,Q as fg,T as Ui,U as It,V as df,W as Qa,X as gg,Y as na,Z as mg,_ as yg,$ as Tg,a0 as Cg,a1 as ds,a2 as Sg,a3 as pf,a4 as bg,a5 as ff,a6 as Eg,a7 as Ig,a8 as vg,a9 as op,aa as Og,ab as xg,ac as _g,ad as Za,ae as Ag}from"./index-C8_KmSui.js";import{M as _t,U as _,a as me,b as D,T as O,P as Yi,g as Wi,c as pt,d as Oe,e as ts,f as Qs,h as ve,C as be,i as we,j as Wt,k as Sn,l as wg,m as Ls,B as Ce,n as Xn,o as Mg,p as Ai,q as Vt,O as ne,A as gi,r as Qt,L as kg,H as xr,s as gf,t as _r,u as Ne,S as qn,v as Ng,w as mi,x as Pg,W as es,G as fe,D as V,y as Ys,z as wt,E as bn,F as Ze,I as dt,J as ft,K as qt,N as za,Q as mf,R as Xe,V as Re,X as xt,Y as oi,Z as yf,_ as Tf,$ as $i,a0 as Xi,a1 as qi,a2 as Rt,a3 as vt,a4 as gt,a5 as fs,a6 as Qi,a7 as Th,a8 as Cf,a9 as aa,aa as $s,ab as Zs,ac as Ae,ad as At,ae as Ch,af as yi,ag as Ti,ah as ra,ai as Dg,aj as ui,ak as Sf,al as Zi,am as Sh,an as tt,ao as gs,ap as Bg,aq as Ar,ar as ms,as as bh,at as lp,au as hp,av as Xs,aw as Ja,ax as bf,ay as Lg,az as Rg,aA as rs,aB as ke,aC as Nt,aD as Fe,aE as Fg,aF as Gs,aG as Os,aH as et,aI as Ni,aJ as Ug,aK as Dt,aL as Vg,aM as Ef,aN as Te,aO as oa,aP as wr,aQ as If,aR as wn,aS as Hg,aT as cp,aU as vf,aV as up,aW as dp,aX as Mr,aY as pp,aZ as la,a_ as Kt,a$ as ha,b0 as Of,b1 as xf,b2 as Yg,b3 as Wg,b4 as Gg,b5 as Kg,b6 as di,b7 as zg,b8 as ls,b9 as Gt,ba as er,bb as ct,bc as Vi,bd as tr,be as Zt,bf as fp,bg as jg,bh as $g,bi as Cs,bj as Xg,bk as qg,bl as Qn,bm as Qg,bn as Zg,bo as Jg,bp as _f,bq as Ji,br as kr,bs as sr,bt as Ss,bu as Tt,bv as Ws,bw as Xt,bx as Pi,by as ei,bz as gp,bA as em,bB as Gi,bC as pi,bD as Hi,bE as en,bF as Af,bG as Ci,bH as Eh,bI as Nr,bJ as wf,bK as Ht,bL as St,bM as tm,bN as Ps,bO as mp,bP as sm,bQ as Ge,bR as yp,bS as im,bT as Mf,bU as xs,bV as nm,bW as bs,bX as Si,bY as Ke,bZ as ir,b_ as ja,b$ as Bs,c0 as am,c1 as rm,c2 as bt,c3 as om,c4 as lm,c5 as hm,c6 as tn,c7 as kf,c8 as cm,c9 as Nf,ca as um,cb as ot,cc as dm,cd as Pt,ce as st,cf as pm,cg as fm,ch as Tp,ci as Us,cj as Cp,ck as Js,cl as gm,cm as He,cn as ut,co as as,cp as ns,cq as mm,cr as Zn,cs as $a,ct as Ft,cu as ym,cv as Tm,cw as Cm,cx as Sm,cy as bm,cz as Em,cA as mt,cB as Ih,cC as Pf,cD as Df,cE as Xa,cF as Im,cG as Bf,cH as Lf,cI as Rf,cJ as vm,cK as nr,cL as Om,cM as Di,cN as ar,cO as Ff,cP as Es,cQ as xm,cR as qa,cS as Sp,cT as _m,cU as Am,cV as Uf,cW as rr,cX as Pr,cY as Vf,cZ as wm,c_ as ps,c$ as $e,d0 as or,d1 as vh,d2 as Oh,d3 as Hf,d4 as Mm,d5 as km,d6 as Nm,d7 as bp,d8 as ai,d9 as Mn,da as ri,db as kn,dc as Pm,dd as Dm,de as Bi,df as Bm,dg as Lm,dh as Rm,di as Fm,dj as Um,dk as Vm,dl as lr,dm as Ep,dn as Hm,dp as Yf,dq as Ym,dr as Wm,ds as Wf,dt as Gm,du as Km,dv as zm,dw as jm,dx as $m,dy as Xm,dz as qm,dA as Qm,dB as Zm,dC as Jm,dD as ey,dE as ty,dF as sy,dG as Gf,dH as ti,dI as Kf,dJ as iy,dK as ny,dL as ay,dM as ry,dN as oy,dO as zf,dP as ly,dQ as Ip,dR as Nn,dS as hy,dT as cy,dU as uy,dV as dy,dW as hr,dX as jf,dY as vp,dZ as py,d_ as fy,d$ as gy,e0 as my,e1 as yy,e2 as $f,e3 as Ty,e4 as Pn,e5 as Cy,e6 as Op,e7 as Sy,e8 as by,e9 as Xf,ea as Ey,eb as Iy,ec as vy,ed as Oy,ee as xy,ef as _y,eg as Ay,eh as wy,ei as My,ej as ky,ek as Ny,el as Py,em as cr,en as xp,eo as Dy,ep as By,eq as Ly,er as Ry,es as Fy,et as Uy,eu as Vy,ev as Hy,ew as Yy,ex as Wy,ey as Gy,ez as Ky,eA as zy,eB as _p,eC as ur,eD as Dn,eE as jy,eF as $y,eG as Ap,eH as Xy,eI as wp,eJ as qy,eK as Qy,eL as Zy,eM as Jy,eN as eT,eO as tT,eP as sT,eQ as iT,eR as Mp,eS as dr,eT as nT,eU as aT,eV as Bn,eW as rT,eX as oT,eY as lT,eZ as hT,e_ as cT,e$ as uT,f0 as dT,f1 as pT,f2 as kp,f3 as fT,f4 as gT,f5 as mT,f6 as yT,f7 as TT,f8 as CT,f9 as ST,fa as _s,fb as Np,fc as bT,fd as ET,fe as Pp}from"./loading-scene-DWxFK_8p.js";const pr=!1,Et=!1,Ph=class Ph extends _t{constructor(){super(_.MESSAGE),this.wordWrapWidth=1780}setup(){const e=this.getUi();this.textTimer=null,this.textCallbackTimer=null,this.bg=s.add.sprite(0,0,"bg",s.windowType),this.bg.setName("sprite-battle-msg-bg"),this.bg.setOrigin(0,1),e.add(this.bg),this.commandWindow=me(202,0,118,48),this.commandWindow.setName("window-command"),this.commandWindow.setOrigin(0,1),this.commandWindow.setVisible(!1),e.add(this.commandWindow),this.movesWindowContainer=s.add.container(0,0),this.movesWindowContainer.setName("moves-bg"),this.movesWindowContainer.setVisible(!1);const t=me(0,0,243,48);t.setName("moves-window"),t.setOrigin(0,1);const i=me(240,0,80,48,!1,!1,-1,132);i.setName("move-details-window"),i.setOrigin(0,1),this.movesWindowContainer.add([t,i]),e.add(this.movesWindowContainer);const n=s.add.container(12,-39);e.add(n);const a=D(0,0,"",O.MESSAGE,{maxLines:2,wordWrap:{width:this.wordWrapWidth}});n.add(a),this.message=a,this.nameBoxContainer=s.add.container(0,-16),this.nameBoxContainer.setVisible(!1),this.nameBox=s.add.nineslice(0,0,"namebox",s.windowType,72,16,8,8,5,5),this.nameBox.setOrigin(0,0),this.nameText=D(8,0,"Rival",O.MESSAGE,{maxLines:1}),this.nameBoxContainer.add(this.nameBox),this.nameBoxContainer.add(this.nameText),n.add(this.nameBoxContainer),this.initPromptSprite(n);const r=s.add.container(0,0);r.setVisible(!1),e.add(r),this.levelUpStatsContainer=r;const o=D(s.game.canvas.width/6-73,-94,"",O.WINDOW,{maxLines:6});o.setLineSpacing(g.resolvedLanguage==="ja"?25:5);let l="";for(const f of Yi)l+=`${g.t(Wi(f))}
`;o.text=l,o.x-=o.displayWidth;const h=me(s.game.canvas.width/6,-100,80+o.displayWidth,100);h.setOrigin(1,0),r.add(h),r.add(o);const c=D(s.game.canvas.width/6-50,-94,`+
+
+
+
+
+`,O.WINDOW,{maxLines:6});c.setLineSpacing(g.resolvedLanguage==="ja"?25:5),r.add(c),this.levelUpStatsIncrContent=c;const d=pt(s.game.canvas.width/6-7,-94,"",O.WINDOW,{maxLines:6,lineSpacing:5});d.setLineSpacing(g.resolvedLanguage==="ja"?25:5),d.setOrigin(1,0),d.setAlign("right"),r.add(d),this.levelUpStatsValuesContent=d}show(e){return super.show(e),this.commandWindow.setVisible(!1),this.movesWindowContainer.setVisible(!1),this.message.setWordWrapWidth(this.wordWrapWidth),!0}processInput(e){const t=this.getUi();if(this.awaitingActionInput&&(e===I.CANCEL||e===I.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}clear(){super.clear()}showText(e,t,i,n,a,r){this.hideNameText(),super.showText(e,t,i,n,a,r)}showDialogue(e,t,i,n,a,r,o){t&&this.showNameText(t),super.showDialogue(e,t,i,n,a,r,o)}promptLevelUpStats(e,t,i){return new Promise(n=>{if(!s.showLevelUpStats)return n();const a=s.getPlayerParty()[e].stats;let r="";for(const o of Yi)r+=`${i?a[o]:a[o]-t[o]}
`;this.levelUpStatsValuesContent.text=r,this.levelUpStatsIncrContent.setVisible(!i),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{if(!i)return this.promptLevelUpStats(e,[],!0).then(()=>n());this.levelUpStatsContainer.setVisible(!1),n()}})}promptIvs(e,t){return new Promise(i=>{s.executeWithSeedOffset(()=>{let n="";for(const a of Yi)n+=`${this.getIvDescriptor(t[a],a,e)}
`;this.levelUpStatsValuesContent.text=n,this.levelUpStatsIncrContent.setVisible(!1),this.levelUpStatsContainer.setVisible(!0),this.awaitingActionInput=!0,this.onActionInput=()=>{this.levelUpStatsContainer.setVisible(!1),i()}},e)})}getIvDescriptor(e,t,i){const n=s.getPokemonById(i).species.getRootSpeciesId(),a=s.gameData.dexData[n].ivs,r=s.uiTheme,o=u((l,h,c)=>{let d;return h?c===31?d=O.PERFECT_IV:d=O.SUMMARY_GREEN:d=O.WINDOW,`[color=${Oe(d,!1,r)}][shadow=${Oe(d,!0,r)}]${l}[/shadow][/color]`},"coloredText");return e>30?o(g.t("battleMessageUiHandler:ivBest"),e>a[t],e):e===30?o(g.t("battleMessageUiHandler:ivFantastic"),e>a[t],e):e>20?o(g.t("battleMessageUiHandler:ivVeryGood"),e>a[t],e):e>10?o(g.t("battleMessageUiHandler:ivPrettyGood"),e>a[t],e):e>0?o(g.t("battleMessageUiHandler:ivDecent"),e>a[t],e):o(g.t("battleMessageUiHandler:ivNoGood"),e>a[t],e)}showNameText(e){this.nameBoxContainer.setVisible(!0),this.nameText.setText(e),this.nameBox.width=this.nameText.displayWidth+16}hideNameText(){this.nameBoxContainer.setVisible(!1)}};u(Ph,"BattleMessageUiHandler");let Dr=Ph;const Dh=class Dh extends ts{constructor(){super(_.COMMAND),this.fieldIndex=0,this.cursor2=0}setup(){const e=this.getUi(),t=[g.t("commandUiHandler:fight"),g.t("commandUiHandler:ball"),g.t("commandUiHandler:pokemon"),g.t("commandUiHandler:run")];this.commandsContainer=s.add.container(217,-38.7),this.commandsContainer.setName("commands"),this.commandsContainer.setVisible(!1),e.add(this.commandsContainer),this.teraButton=s.add.sprite(-32,15,"button_tera"),this.teraButton.setName("terrastallize-button"),this.teraButton.setScale(1.3),this.teraButton.setFrame("fire"),this.teraButton.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0,teraColor:Qs(ve.FIRE),isTerastallized:!1}),this.commandsContainer.add(this.teraButton);for(let i=0;i<t.length;i++){const n=D(i%2===0?0:55.8,i<2?0:16,t[i],O.WINDOW);n.setName(t[i]),this.commandsContainer.add(n)}}show(e){super.show(e),this.fieldIndex=e.length?e[0]:0,this.commandsContainer.setVisible(!0);let t;const i=s.phaseManager.getCurrentPhase();i!=null&&i.is("CommandPhase")?t=i:t=s.phaseManager.getStandbyPhase(),this.canTera()?(this.teraButton.setVisible(!0),this.teraButton.setFrame(ve[s.getField()[this.fieldIndex].getTeraType()].toLowerCase())):(this.teraButton.setVisible(!1),this.getCursor()===be.TERA&&this.setCursor(be.FIGHT)),this.toggleTeraButton();const n=this.getUi().getMessageHandler();return n.bg.setVisible(!0),n.commandWindow.setVisible(!0),n.movesWindowContainer.setVisible(!1),n.message.setWordWrapWidth(this.canTera()?910:1110),n.showText(g.t("commandUiHandler:actionMessage",{pokemonName:we(t.getPokemon())}),0),this.getCursor()===be.POKEMON?this.setCursor(be.FIGHT):this.setCursor(this.getCursor()),!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();if(e===I.CANCEL||e===I.ACTION)if(e===I.ACTION)switch(n){case be.FIGHT:t.setMode(_.FIGHT,s.phaseManager.getCurrentPhase().getFieldIndex()),i=!0;break;case be.BALL:t.setModeWithoutClear(_.BALL),i=!0;break;case be.POKEMON:t.setMode(_.PARTY,Wt.SWITCH,s.phaseManager.getCurrentPhase().getPokemon().getFieldIndex(),null,Sn.FilterNonFainted),i=!0;break;case be.RUN:s.phaseManager.getCurrentPhase().handleCommand(be.RUN,0),i=!0;break;case be.TERA:t.setMode(_.FIGHT,s.phaseManager.getCurrentPhase().getFieldIndex(),be.TERA),i=!0;break}else s.phaseManager.getCurrentPhase().cancel();else switch(e){case I.UP:(n===be.POKEMON||n===be.RUN)&&(i=this.setCursor(n-2));break;case I.DOWN:(n===be.FIGHT||n===be.BALL)&&(i=this.setCursor(n+2));break;case I.LEFT:n===be.BALL||n===be.RUN?i=this.setCursor(n-1):(n===be.FIGHT||n===be.POKEMON)&&this.canTera()&&(i=this.setCursor(be.TERA),this.toggleTeraButton());break;case I.RIGHT:n===be.FIGHT||n===be.POKEMON?i=this.setCursor(n+1):n===be.TERA&&(i=this.setCursor(be.FIGHT),this.toggleTeraButton());break}return i&&t.playSelect(),i}canTera(){var r;const e=!!s.getModifiers(wg).length,t=s.getField()[this.fieldIndex],i=t.isMega()||t.isMax()||t.hasSpecies(ge.NECROZMA,"ultra"),n=s.arena.playerTerasUsed,a=((r=s.currentBattle.preTurnCommands[0])==null?void 0:r.command)===be.TERA&&this.fieldIndex>0?1:0;return e&&!i&&n+a<1}toggleTeraButton(){this.teraButton.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0,teraColor:Qs(s.getField()[this.fieldIndex].getTeraType()),isTerastallized:this.getCursor()===be.TERA})}getCursor(){return this.fieldIndex?this.cursor2:this.cursor}setCursor(e){const t=this.getCursor()!==e;return t&&(this.fieldIndex?this.cursor2=e:this.cursor=e),this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.commandsContainer.add(this.cursorObj)),e===be.TERA?this.cursorObj.setVisible(!1):(this.cursorObj.setPosition(-5+(e%2===1?56:0),8+(e>=2?16:0)),this.cursorObj.setVisible(!0)),t}clear(){super.clear(),this.getUi().getMessageHandler().commandWindow.setVisible(!1),this.commandsContainer.setVisible(!1),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Dh,"CommandUiHandler");let Br=Dh;const Ki=class Ki extends ts{constructor(){super(_.FIGHT),this.fieldIndex=0,this.fromCommand=be.FIGHT,this.cursor2=0}setup(){const e=this.getUi();this.movesContainer=s.add.container(18,-38.7),this.movesContainer.setName(Ki.MOVES_CONTAINER_NAME),e.add(this.movesContainer),this.moveInfoContainer=s.add.container(1,0),this.moveInfoContainer.setName("move-info"),e.add(this.moveInfoContainer),this.typeIcon=s.add.sprite(s.scaledCanvas.width-57,-36,os("types"),"unknown"),this.typeIcon.setVisible(!1),this.moveInfoContainer.add(this.typeIcon),this.moveCategoryIcon=s.add.sprite(s.scaledCanvas.width-25,-36,"categories","physical"),this.moveCategoryIcon.setVisible(!1),this.moveInfoContainer.add(this.moveCategoryIcon),this.ppLabel=D(s.scaledCanvas.width-70,-26,"PP",O.MOVE_INFO_CONTENT),this.ppLabel.setOrigin(0,.5),this.ppLabel.setVisible(!1),this.ppLabel.setText(g.t("fightUiHandler:pp")),this.moveInfoContainer.add(this.ppLabel),this.ppText=D(s.scaledCanvas.width-12,-26,"--/--",O.MOVE_INFO_CONTENT),this.ppText.setOrigin(1,.5),this.ppText.setVisible(!1),this.moveInfoContainer.add(this.ppText),this.powerLabel=D(s.scaledCanvas.width-70,-18,"POWER",O.MOVE_INFO_CONTENT),this.powerLabel.setOrigin(0,.5),this.powerLabel.setVisible(!1),this.powerLabel.setText(g.t("fightUiHandler:power")),this.moveInfoContainer.add(this.powerLabel),this.powerText=D(s.scaledCanvas.width-12,-18,"---",O.MOVE_INFO_CONTENT),this.powerText.setOrigin(1,.5),this.powerText.setVisible(!1),this.moveInfoContainer.add(this.powerText),this.accuracyLabel=D(s.scaledCanvas.width-70,-10,"ACC",O.MOVE_INFO_CONTENT),this.accuracyLabel.setOrigin(0,.5),this.accuracyLabel.setVisible(!1),this.accuracyLabel.setText(g.t("fightUiHandler:accuracy")),this.moveInfoContainer.add(this.accuracyLabel),this.accuracyText=D(s.scaledCanvas.width-12,-10,"---",O.MOVE_INFO_CONTENT),this.accuracyText.setOrigin(1,.5),this.accuracyText.setVisible(!1),this.moveInfoContainer.add(this.accuracyText);const t=1;this.moveInfoOverlay=new Ls({delayVisibility:!0,scale:t,onSide:!0,right:!0,x:0,y:-Ls.getHeight(t,!0),width:s.game.canvas.width/6+4,hideEffectBox:!0,hideBg:!0}),e.add(this.moveInfoOverlay),s.addInfoToggle(this.moveInfoOverlay),s.addInfoToggle(this)}show(e){super.show(e),this.fieldIndex=e.length?e[0]:0,this.fromCommand=e.length>1?e[1]:be.FIGHT;const t=this.getUi().getMessageHandler();return t.bg.setVisible(!1),t.commandWindow.setVisible(!1),t.movesWindowContainer.setVisible(!0),s.phaseManager.getCurrentPhase().getPokemon().tempSummonData.turnCount<=1?this.setCursor(0):this.setCursor(this.getCursor()),this.displayMoves(),this.toggleInfo(!1),this.active=!0,!0}processInput(e){const t=this.getUi();let i=!1;const n=this.getCursor();if(e===I.CANCEL||e===I.ACTION)if(e===I.ACTION)s.phaseManager.getCurrentPhase().handleCommand(this.fromCommand,n,!1)?i=!0:t.playError();else{const{battleType:a,mysteryEncounter:r}=s.currentBattle;(a!==Ce.MYSTERY_ENCOUNTER||!(r!=null&&r.skipToFightInput))&&(t.setMode(_.COMMAND,this.fieldIndex),i=!0)}else switch(e){case I.UP:n>=2&&(i=this.setCursor(n-2));break;case I.DOWN:n<2&&(i=this.setCursor(n+2));break;case I.LEFT:n%2===1&&(i=this.setCursor(n-1));break;case I.RIGHT:n%2===0&&(i=this.setCursor(n+1));break}return i&&t.playSelect(),i}toggleInfo(e){var t,i;e&&(this.movesContainer.setVisible(!1),(t=this.cursorObj)==null||t.setVisible(!1)),s.tweens.add({targets:[this.movesContainer,this.cursorObj],duration:de(125),ease:"Sine.easeInOut",alpha:e?0:1}),e||(this.movesContainer.setVisible(!0),(i=this.cursorObj)==null||i.setVisible(!0))}isActive(){return this.active}getCursor(){return this.fieldIndex?this.cursor2:this.cursor}setCursor(e){const t=this.getUi();this.moveInfoOverlay.clear();const i=this.getCursor()!==e;if(i&&(this.fieldIndex?this.cursor2=e:this.cursor=e),!this.cursorObj){const o=this.fromCommand===be.TERA;this.cursorObj=s.add.image(0,0,o?"cursor_tera":"cursor"),this.cursorObj.setScale(o?.7:1),t.add(this.cursorObj)}const n=s.phaseManager.getCurrentPhase().getPokemon(),a=n.getMoveset(),r=e<a.length;if(r){const o=a[e],l=n.getMoveType(o.getMove()),h=os("types");this.typeIcon.setTexture(h,ve[l].toLowerCase()).setScale(.8);const c=o.getMove().category;this.moveCategoryIcon.setTexture("categories",Xn[c].toLowerCase()).setScale(1);const d=o.getMove().power,f=o.getMove().accuracy,p=o.getMovePp(),T=p-o.ppUsed,m=Is(T,2,"  "),C=Is(p,2,"  ");this.ppText.setText(`${m}/${C}`),this.powerText.setText(`${d>=0?d:"---"}`),this.accuracyText.setText(`${f>=0?f:"---"}`);const b=T/p;let S=O.MOVE_PP_FULL;b>.25&&b<=.5?S=O.MOVE_PP_HALF_FULL:b>0&&b<=.25?S=O.MOVE_PP_NEAR_EMPTY:b===0&&(S=O.MOVE_PP_EMPTY),this.ppText.setColor(this.getTextColor(S,!1)),this.ppText.setShadowColor(this.getTextColor(S,!0)),this.moveInfoOverlay.show(o.getMove()),n.getOpponents().forEach(x=>{x.updateEffectiveness(this.getEffectivenessText(n,x,o))})}return this.typeIcon.setVisible(r),this.ppLabel.setVisible(r),this.ppText.setVisible(r),this.powerLabel.setVisible(r),this.powerText.setVisible(r),this.accuracyLabel.setVisible(r),this.accuracyText.setVisible(r),this.moveCategoryIcon.setVisible(r),this.cursorObj.setPosition(13+(e%2===1?114:0),-31+(e>=2?15:0)),i}getEffectivenessText(e,t,i){const n=t.getMoveEffectiveness(e,i.getMove(),!t.waveData.abilityRevealed,void 0,void 0,!0);if(n!==void 0)return`${n}x`}displayMoves(){const e=s.phaseManager.getCurrentPhase().getPokemon(),t=e.getMoveset();for(let i=0;i<4;i++){const n=D(i%2===0?0:114,i<2?0:16,"-",O.WINDOW);if(n.setName("text-empty-move"),i<t.length){const a=t[i];n.setText(a.getName()),n.setName(a.getName()),n.setColor(this.getMoveColor(e,a)??n.style.color)}this.movesContainer.add(n)}}getMoveColor(e,t){if(!s.typeHints)return;const i=e.getOpponents();return i.length<=0?void 0:i.map(a=>a.getMoveEffectiveness(e,t.getMove(),!a.waveData.abilityRevealed,void 0,void 0,!0)).sort((a,r)=>r-a).map(a=>Mg(a??0))[0]}clear(){super.clear();const e=this.getUi().getMessageHandler();this.clearMoves(),this.typeIcon.setVisible(!1),this.ppLabel.setVisible(!1),this.ppText.setVisible(!1),this.powerLabel.setVisible(!1),this.powerText.setVisible(!1),this.accuracyLabel.setVisible(!1),this.accuracyText.setVisible(!1),this.moveCategoryIcon.setVisible(!1),this.moveInfoOverlay.clear(),e.bg.setVisible(!0),this.eraseCursor(),this.active=!1}clearMoves(){this.movesContainer.removeAll(!0),s.phaseManager.getCurrentPhase().getPokemon().getOpponents().forEach(t=>{t.updateEffectiveness()})}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Ki,"FightUiHandler"),Ki.MOVES_CONTAINER_NAME="moves";let Lr=Ki;const IT="↑",vT="↓",Bh=class Bh extends ts{constructor(e){super(e),this.scrollCursor=0,this.fullCursor=0,this.scale=.1666666667,this.unskippedIndices=[],this.defaultTextStyle=O.WINDOW}getWindowHeight(){var e,t;return(Math.min((((e=this.config)==null?void 0:e.options)||[]).length,((t=this.config)==null?void 0:t.maxOptions)||99)+1)*96*this.scale}setup(){const e=this.getUi();this.optionSelectContainer=s.add.container(s.game.canvas.width/6-1,-48),this.optionSelectContainer.setName(`option-select-${this.mode?_[this.mode]:"UNKNOWN"}`),this.optionSelectContainer.setVisible(!1),e.add(this.optionSelectContainer),this.optionSelectBg=me(0,0,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setName("option-select-bg"),this.optionSelectBg.setOrigin(1,1),this.optionSelectContainer.add(this.optionSelectBg),this.optionSelectTextContainer=s.add.container(0,0),this.optionSelectContainer.add(this.optionSelectTextContainer),this.optionSelectIcons=[],this.scale=Ai(O.WINDOW,s.uiTheme).scale,this.setCursor(0)}setupOptions(){var a,r,o,l,h,c,d;const e=((a=this.config)==null?void 0:a.options)??[],t=e;if(this.unskippedIndices=this.getUnskippedIndices(e),this.optionSelectText)if(this.optionSelectText instanceof rf)try{this.optionSelectText.destroy()}catch(f){console.error("Error while destroying optionSelectText:",f)}else console.warn("optionSelectText is not an instance of BBCodeText.");(r=this.optionSelectIcons)!=null&&r.length&&(this.optionSelectIcons.map(f=>f.destroy()),this.optionSelectIcons.splice(0,this.optionSelectIcons.length));const i=(o=this.config)!=null&&o.options&&((l=this.config)==null?void 0:l.options.length)>((h=this.config)==null?void 0:h.maxOptions)?this.getOptionsWithScroll():t,n=s.ui.getMode()===_.AUTO_COMPLETE?i:t;this.optionSelectText=pt(0,0,n.map(f=>f.item?`[shadow=${Oe(f.style??this.defaultTextStyle,!0,s.uiTheme)}][color=${Oe(f.style??O.WINDOW,!1,s.uiTheme)}]    ${f.label}[/color][/shadow]`:`[shadow=${Oe(f.style??this.defaultTextStyle,!0,s.uiTheme)}][color=${Oe(f.style??O.WINDOW,!1,s.uiTheme)}]${f.label}[/color][/shadow]`).join(`
`),O.WINDOW,{maxLines:t.length,lineSpacing:12}),this.optionSelectText.setOrigin(0,0),this.optionSelectText.setName("text-option-select"),this.optionSelectTextContainer.add(this.optionSelectText),this.optionSelectContainer.setPosition(s.game.canvas.width/6-1-(((c=this.config)==null?void 0:c.xOffset)||0),-48+(((d=this.config)==null?void 0:d.yOffset)||0)),this.optionSelectBg.width=Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth()),this.optionSelectBg.height=this.getWindowHeight(),this.optionSelectTextContainer.setPosition(this.optionSelectBg.x-this.optionSelectBg.width+12+24*this.scale,this.optionSelectBg.y-this.optionSelectBg.height+2+42*this.scale),this.textContent=i.map(f=>f.item?`[shadow=${Oe(f.style??this.defaultTextStyle,!0,s.uiTheme)}][color=${Oe(f.style??O.WINDOW,!1,s.uiTheme)}]    ${f.label}[/color][/shadow]`:`[shadow=${Oe(f.style??this.defaultTextStyle,!0,s.uiTheme)}][color=${Oe(f.style??O.WINDOW,!1,s.uiTheme)}]${f.label}[/color][/shadow]`).join(`
`),this.optionSelectText.setText(this.textContent),t.forEach((f,p)=>{if(f.item){const T=s.add.sprite(0,0,"items",f.item);if(T.setScale(3*this.scale),this.optionSelectIcons.push(T),this.optionSelectTextContainer.add(T),T.setPositionRelative(this.optionSelectText,36*this.scale,7+p*(114*this.scale-3)),f.item==="candy"){const m=s.add.sprite(0,0,"items","candy_overlay");m.setScale(3*this.scale),this.optionSelectIcons.push(m),this.optionSelectTextContainer.add(m),m.setPositionRelative(this.optionSelectText,36*this.scale,7+p*(114*this.scale-3)),f.itemArgs&&(T.setTint(Vt(Ot(f.itemArgs[0]))),m.setTint(Vt(Ot(f.itemArgs[1]))))}}})}show(e){var t,i,n,a,r;return!e.length||!e[0].hasOwnProperty("options")||!e[0].options.length?!1:(super.show(e),this.config=e[0],this.setupOptions(),s.ui.bringToTop(this.optionSelectContainer),this.optionSelectContainer.setVisible(!0),this.scrollCursor=0,this.fullCursor=0,this.setCursor(0),this.config.delay&&(this.blockInput=!0,this.optionSelectTextContainer.setAlpha(.5),(t=this.cursorObj)==null||t.setAlpha(.8),s.time.delayedCall(de(this.config.delay),()=>this.unblockInput())),(i=this.config)!=null&&i.supportHover&&((r=(a=(n=this.config)==null?void 0:n.options[this.unskippedIndices[this.fullCursor]])==null?void 0:a.onHover)==null||r.call(a)),!0)}processInput(e){var a,r,o,l,h,c,d,f;const t=this.getUi();let i=!1,n=!0;if(e===I.ACTION||e===I.CANCEL){if(this.blockInput)return t.playError(),!1;if(i=!0,e===I.CANCEL)if((a=this.config)!=null&&a.maxOptions&&this.config.options.length>this.config.maxOptions)this.setCursor(this.unskippedIndices.length-1);else if(!((r=this.config)!=null&&r.noCancel))this.setCursor(this.unskippedIndices.length-1);else return!1;const p=(o=this.config)==null?void 0:o.options[this.unskippedIndices[this.fullCursor]];p!=null&&p.handler()?(p.keepOpen||this.clear(),n=!p.overrideSound):t.playError()}else if(e===I.SUBMIT&&t.getMode()===_.AUTO_COMPLETE){i=!0;const p=(l=this.config)==null?void 0:l.options[this.unskippedIndices[this.fullCursor]];p!=null&&p.handler()?(p.keepOpen||this.clear(),n=!p.overrideSound):t.playError()}else{switch(e){case I.UP:this.fullCursor===0?i=this.setCursor(this.unskippedIndices.length-1):this.fullCursor&&(i=this.setCursor(this.fullCursor-1));break;case I.DOWN:this.fullCursor<this.unskippedIndices.length-1?i=this.setCursor(this.fullCursor+1):i=this.setCursor(0);break}(h=this.config)!=null&&h.supportHover&&((f=(d=(c=this.config)==null?void 0:c.options[this.unskippedIndices[this.fullCursor]])==null?void 0:d.onHover)==null||f.call(d))}return i&&n&&t.playSelect(),i}unblockInput(){var e;this.blockInput&&(this.blockInput=!1,this.optionSelectTextContainer.setAlpha(1),(e=this.cursorObj)==null||e.setAlpha(1))}getOptionsWithScroll(){var a;if(!this.config)return[];const e=this.config.options.slice(0);if(!this.config.maxOptions||this.config.options.length<this.config.maxOptions)return e;const t=e.length,i=this.scrollCursor,n=Math.min(t,i+(!i||this.scrollCursor+(this.config.maxOptions-1)>=t?this.config.maxOptions-1:this.config.maxOptions-2));return(a=this.config)!=null&&a.maxOptions&&e.length>this.config.maxOptions&&(e.splice(n,t),e.splice(0,i),i&&e.unshift({label:IT,handler:u(()=>!0,"handler"),style:this.defaultTextStyle}),n<t&&e.push({label:vT,handler:u(()=>!0,"handler"),style:this.defaultTextStyle})),e}getUnskippedIndices(e){return e.map((i,n)=>i.skip?null:n).filter(i=>i!==null)}setCursor(e){var i;const t=this.fullCursor!==e;if(t&&((i=this.config)!=null&&i.maxOptions)&&this.config.options.length>this.config.maxOptions)if(e===this.unskippedIndices.length-1)this.fullCursor=e,this.cursor=this.config.maxOptions-(this.config.options.length-this.unskippedIndices[e]),this.scrollCursor=this.config.options.length-this.config.maxOptions+1;else if(e===0)this.fullCursor=e,this.cursor=this.unskippedIndices[e],this.scrollCursor=0;else if(e&&e>this.fullCursor){const a=this.unskippedIndices[e]-this.unskippedIndices[this.fullCursor],r=this.unskippedIndices[e+1]-this.unskippedIndices[e]-1;this.cursor+a+r>=this.config.maxOptions-1?(this.fullCursor=e,this.cursor=this.config.maxOptions-2-r,this.scrollCursor=this.unskippedIndices[this.fullCursor]-this.cursor+1):(this.fullCursor=e,this.cursor=this.unskippedIndices[e]-this.scrollCursor+(this.scrollCursor?1:0))}else{const a=this.unskippedIndices[e]-this.unskippedIndices[e-1];this.cursor-a<1?(this.fullCursor=e,this.cursor=1,this.scrollCursor=this.unskippedIndices[this.fullCursor]-this.cursor+1):(this.fullCursor=e,this.cursor=this.unskippedIndices[e]-this.scrollCursor+(this.scrollCursor?1:0))}else this.fullCursor=e,this.cursor=this.unskippedIndices[e];return this.setupOptions(),this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.optionSelectContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.optionSelectBg,12,102*this.scale+this.cursor*(114*this.scale-3)),t}clear(){super.clear(),this.config=null,this.optionSelectContainer.setVisible(!1),this.fullCursor=0,this.scrollCursor=0,this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Bh,"AbstractOptionSelectUiHandler");let sn=Bh;const Jn=Object.freeze({DEFAULT_YES:1,DEFAULT_NO:2}),zi=class zi extends sn{constructor(){super(_.CONFIRM)}getWindowWidth(){return zi.windowWidth}show(e){if(e.length===5&&e[0]instanceof Function&&e[1]instanceof Function&&e[2]instanceof Function&&e[3]instanceof Function&&e[4]==="fullParty"){const t={options:[{label:g.t("partyUiHandler:SUMMARY"),handler:u(()=>(e[0](),!0),"handler")},{label:g.t("partyUiHandler:POKEDEX"),handler:u(()=>(e[1](),!0),"handler")},{label:g.t("menu:yes"),handler:u(()=>(e[2](),!0),"handler")},{label:g.t("menu:no"),handler:u(()=>(e[3](),!0),"handler")}],delay:e.length>=9&&e[8]!==null?e[8]:0};super.show([t]),this.switchCheck=e.length>=6&&e[5]!==null&&e[5];const i=e.length>=7&&e[6]!==null?e[6]:0,n=e.length>=8&&e[7]!==null?e[7]:0;return this.optionSelectContainer.setPosition(s.game.canvas.width/6-1+i,-48+n),this.setCursor(this.switchCheck?this.switchCheckCursor:0),!0}if(e.length>=2&&e[0]instanceof Function&&e[1]instanceof Function){const t={options:[{label:g.t("menu:yes"),handler:u(()=>(e[0](),!0),"handler")},{label:g.t("menu:no"),handler:u(()=>(e[1](),!0),"handler")}],delay:e.length>=6&&e[5]!==null?e[5]:0,noCancel:e.length>=7&&e[6]!==null?e[6]:!1};super.show([t]),this.switchCheck=e.length>=3&&e[2]!==null&&e[2];const i=e.length>=4&&e[3]!==null?e[3]:0,n=e.length>=5&&e[4]!==null?e[4]:0;switch(this.optionSelectContainer.setPosition(s.game.canvas.width/6-1+i,-48+n),this.confirmUiMode=e.length>=6?e[5]:Jn.DEFAULT_YES,this.confirmUiMode){case Jn.DEFAULT_YES:this.setCursor(this.switchCheck?this.switchCheckCursor:0);break;case Jn.DEFAULT_NO:this.setCursor(this.switchCheck?this.switchCheckCursor:1);break}return!0}return!1}processInput(e){var t;return e===I.CANCEL&&this.blockInput&&!((t=this.config)!=null&&t.noCancel)&&this.unblockInput(),super.processInput(e)}setCursor(e){const t=super.setCursor(e);return t&&this.switchCheck&&(this.switchCheckCursor=this.cursor),t}};u(zi,"ConfirmUiHandler"),zi.windowWidth=48;let ca=zi;var zt=(y=>(y.Intro="INTRO",y.Access_Menu="ACCESS_MENU",y.Menu="MENU",y.Starter_Select="STARTER_SELECT",y.Pokedex="POKEDEX",y.Pokerus="POKERUS",y.Stat_Change="STAT_CHANGE",y.Select_Item="SELECT_ITEM",y.Egg_Gacha="EGG_GACHA",y))(zt||{});const OT={INTRO:u(()=>new Promise(y=>{s.ui.showText(g.t("tutorial:intro"),null,()=>y(),null,!0)}),"INTRO"),ACCESS_MENU:u(()=>new Promise(y=>{if(s.enableTouchControls)return y();s.showFieldOverlay(1e3).then(()=>s.ui.showText(g.t("tutorial:accessMenu"),null,()=>s.hideFieldOverlay(1e3).then(()=>y()),null,!0))}),"ACCESS_MENU"),MENU:u(()=>new Promise(y=>{s.gameData.saveTutorialFlag("ACCESS_MENU",!0),s.ui.showText(g.t("tutorial:menu"),null,()=>s.ui.showText("",null,()=>y()),null,!0)}),"MENU"),STARTER_SELECT:u(()=>new Promise(y=>{s.ui.showText(g.t("tutorial:starterSelect"),null,()=>s.ui.showText("",null,()=>y()),null,!0)}),"STARTER_SELECT"),POKERUS:u(()=>new Promise(y=>{s.ui.showText(g.t("tutorial:pokerus"),null,()=>s.ui.showText("",null,()=>y()),null,!0)}),"POKERUS"),STAT_CHANGE:u(()=>new Promise(y=>{s.showFieldOverlay(1e3).then(()=>s.ui.showText(g.t("tutorial:statChange"),null,()=>s.ui.showText("",null,()=>s.hideFieldOverlay(1e3).then(()=>y())),null,!0))}),"STAT_CHANGE"),SELECT_ITEM:u(()=>new Promise(y=>{s.ui.setModeWithoutClear(_.MESSAGE).then(()=>{s.ui.showText(g.t("tutorial:selectItem"),null,()=>s.ui.showText("",null,()=>s.ui.setModeWithoutClear(_.MODIFIER_SELECT).then(()=>y())),null,!0)})}),"SELECT_ITEM"),EGG_GACHA:u(()=>new Promise(y=>{s.ui.showText(g.t("tutorial:eggGacha"),null,()=>s.ui.showText("",null,()=>y()),null,!0)}),"EGG_GACHA")};async function Rs(y){if(!s.enableTutorials&&!ne.BYPASS_TUTORIAL_SKIP_OVERRIDE||s.gameData.getTutorialFlags()[y]&&!ne.BYPASS_TUTORIAL_SKIP_OVERRIDE)return!1;const e=s.ui.getHandler(),t=s.disableMenu;return s.disableMenu=!0,e instanceof gi&&(e.tutorialActive=!0),await xT(e),await OT[y](),await _T(e),s.disableMenu=t,s.gameData.saveTutorialFlag(y,!0),e instanceof gi&&(e.tutorialActive=!1),!0}u(Rs,"handleTutorial");async function xT(y){if(y instanceof gi&&y.tutorialOverlay)s.tweens.add({targets:y.tutorialOverlay,alpha:.5,duration:750,ease:"Sine.easeOut",onComplete:u(()=>!0,"onComplete")});else return!0}u(xT,"showTutorialOverlay");async function _T(y){if(y instanceof gi&&y.tutorialOverlay)s.tweens.add({targets:y.tutorialOverlay,alpha:0,duration:500,ease:"Sine.easeOut",onComplete:u(()=>!0,"onComplete")});else return!0}u(_T,"hideTutorialOverlay");const Ns=7,fr=12,gr=24,Ts=-62,Lh=class Lh extends gi{constructor(){super(_.CONFIRM),this.moveInfoOverlayActive=!1,this.rowCursor=0,this.options=[],this.shopOptionsRows=[]}setup(){const e=this.getUi();this.modifierContainer=s.add.container(0,0),e.add(this.modifierContainer);const i=document.createElement("canvas").getContext("2d"),n=Ai(O.PARTY,s.uiTheme).styleOptions;i&&(i.font=n.fontSize+"px "+n.fontFamily,this.transferButtonWidth=i.measureText(g.t("modifierSelectUiHandler:transfer")).width,this.checkButtonWidth=i.measureText(g.t("modifierSelectUiHandler:checkTeam")).width),this.transferButtonContainer=s.add.container((s.game.canvas.width-this.checkButtonWidth)/6-21,Ts),this.transferButtonContainer.setName("transfer-btn"),this.transferButtonContainer.setVisible(!1),e.add(this.transferButtonContainer);const a=D(-4,-2,g.t("modifierSelectUiHandler:transfer"),O.PARTY);a.setName("text-transfer-btn"),a.setOrigin(1,0),this.transferButtonContainer.add(a),this.checkButtonContainer=s.add.container(s.game.canvas.width/6-1,Ts),this.checkButtonContainer.setName("use-btn"),this.checkButtonContainer.setVisible(!1),e.add(this.checkButtonContainer);const r=D(-4,-2,g.t("modifierSelectUiHandler:checkTeam"),O.PARTY);r.setName("text-use-btn"),r.setOrigin(1,0),this.checkButtonContainer.add(r),this.rerollButtonContainer=s.add.container(16,Ts),this.rerollButtonContainer.setName("reroll-brn"),this.rerollButtonContainer.setVisible(!1),e.add(this.rerollButtonContainer);const o=D(-4,-2,g.t("modifierSelectUiHandler:reroll"),O.PARTY);o.setName("text-reroll-btn"),o.setOrigin(0,0),this.rerollButtonContainer.add(o),this.rerollCostText=D(0,0,"",O.MONEY),this.rerollCostText.setName("text-reroll-cost"),this.rerollCostText.setOrigin(0,0),this.rerollCostText.setPositionRelative(o,o.displayWidth+5,1),this.rerollButtonContainer.add(this.rerollCostText),this.lockRarityButtonContainer=s.add.container(16,Ts),this.lockRarityButtonContainer.setVisible(!1),e.add(this.lockRarityButtonContainer),this.lockRarityButtonText=D(-4,-2,g.t("modifierSelectUiHandler:lockRarities"),O.PARTY),this.lockRarityButtonText.setOrigin(0,0),this.lockRarityButtonContainer.add(this.lockRarityButtonText),this.continueButtonContainer=s.add.container(s.game.canvas.width/12,-(s.game.canvas.height/12)),this.continueButtonContainer.setVisible(!1),e.add(this.continueButtonContainer);const l=D(-24,5,g.t("modifierSelectUiHandler:continueNextWaveButton"),O.MESSAGE);l.setName("text-continue-btn"),this.continueButtonContainer.add(l);const h=1;this.moveInfoOverlay=new Ls({delayVisibility:!0,scale:h,onSide:!0,right:!0,x:1,y:-Ls.getHeight(h,!0)-1,width:s.game.canvas.width/6-2}),e.add(this.moveInfoOverlay),s.addInfoToggle(this.moveInfoOverlay)}show(e){if(s.disableMenu=!1,this.active)return e.length>=3&&(this.awaitingActionInput=!0,this.onActionInput=e[2]),this.moveInfoOverlay.active=this.moveInfoOverlayActive,!1;if(e.length!==4||!Array.isArray(e[1])||!(e[2]instanceof Function))return!1;super.show(e),this.getUi().clearText(),this.player=e[0];const t=this.player&&!!s.findModifiers(f=>f instanceof Qt&&f.isTransferable).length,i=!!s.findModifier(f=>f instanceof kg);this.transferButtonContainer.setVisible(!1),this.transferButtonContainer.setAlpha(0),this.checkButtonContainer.setVisible(!1),this.checkButtonContainer.setAlpha(0),this.rerollButtonContainer.setVisible(!1),this.rerollButtonContainer.setAlpha(0),this.lockRarityButtonContainer.setVisible(!1),this.lockRarityButtonContainer.setAlpha(0),this.continueButtonContainer.setVisible(!1),this.continueButtonContainer.setAlpha(0),this.rerollButtonContainer.setPositionRelative(this.lockRarityButtonContainer,0,i?-12:0),this.rerollCost=e[3],this.updateRerollCostText();const n=e[1],a=s.gameMode.hasNoShop,r=new rt(s.getWaveMoneyAmount(1));s.applyModifier(xr,!0,r);const o=a?[]:gf(s.currentBattle.waveIndex,r.value),l=o.length>Ns?-fr:-gr;for(let f=0;f<n.length;f++){const p=s.game.canvas.width/6/(n.length+2),T=new ua(p*(f+1)+p*.5,-s.game.canvas.height/12+l,n[f]);T.setScale(.5),s.add.existing(T),this.modifierContainer.add(T),this.options.push(T)}const h=this.continueButtonContainer.getAt(0);h.y=l-5,h.setVisible(this.options.length===0);for(let f=0;f<o.length;f++){const p=f<Ns?0:1,T=f<Ns?f:f-Ns,m=o.slice(p?Ns:0,p?void 0:Ns),C=s.game.canvas.width/6/(m.length+2),b=new ua(C*(T+1)+C*.5,-s.game.canvas.height/12-s.game.canvas.height/32-(42-(28*p-1)),o[f]);b.setScale(.375),s.add.existing(b),this.modifierContainer.add(b),p>=this.shopOptionsRows.length&&this.shopOptionsRows.push([]),this.shopOptionsRows[p].push(b)}const c=n.map(f=>f.upgradeCount).reduce((f,p)=>Math.max(p,f),0);s.getModifierBar().updateModifiers(s.modifiers,!0),s.showShopOverlay(750*s.gameSpeed),s.updateAndShowText(750),s.updateBiomeWaveText(),s.updateMoneyText();let d=0;return s.tweens.addCounter({ease:"Sine.easeIn",duration:1250,onUpdate:u(f=>{const p=f.getValue(),T=Math.floor(p*n.length);if(T>d&&T<=n.length){const m=this.options[d];m==null||m.show(Math.floor((1-p)*1250)*.325+2e3*c,-(c-n[d].upgradeCount)),d++}},"onUpdate")}),s.time.delayedCall(1e3+c*2e3,()=>{for(const f of this.shopOptionsRows.flat())f.show(0,0)}),s.time.delayedCall(4e3+c*2e3,()=>{t&&(this.transferButtonContainer.setAlpha(0),this.transferButtonContainer.setVisible(!0),s.tweens.add({targets:this.transferButtonContainer,alpha:1,duration:250})),this.rerollButtonContainer.setAlpha(0),this.checkButtonContainer.setAlpha(0),this.lockRarityButtonContainer.setAlpha(0),this.continueButtonContainer.setAlpha(0),this.rerollButtonContainer.setVisible(!0),this.checkButtonContainer.setVisible(!0),this.continueButtonContainer.setVisible(this.rerollCost<0),this.lockRarityButtonContainer.setVisible(i),s.tweens.add({targets:[this.checkButtonContainer,this.continueButtonContainer],alpha:1,duration:250}),s.tweens.add({targets:[this.rerollButtonContainer,this.lockRarityButtonContainer],alpha:this.rerollCost<0?.5:1,duration:250});const f=u(()=>{s.shopCursorTarget===qn.CHECK_TEAM?(this.setRowCursor(0),this.setCursor(2)):s.shopCursorTarget===qn.SHOP&&s.gameMode.hasNoShop?(this.setRowCursor(qn.REWARDS),this.setCursor(0)):(this.setRowCursor(s.shopCursorTarget),this.setCursor(0))},"updateCursorTarget");f(),Rs(zt.Select_Item).then(p=>{p&&f(),this.awaitingActionInput=!0,this.onActionInput=e[2]})}),!0}processInput(e){const t=this.getUi();if(!this.awaitingActionInput)return!1;let i=!1;if(e===I.ACTION){if(i=!0,this.onActionInput){const n=this.onActionInput;this.awaitingActionInput=!1,this.onActionInput=null,n(this.rowCursor,this.cursor)?(this.moveInfoOverlayActive=this.moveInfoOverlay.active,this.moveInfoOverlay.setVisible(!1),this.moveInfoOverlay.active=!1):(this.awaitingActionInput=!0,this.onActionInput=n)}}else if(e===I.CANCEL){if(this.player&&(i=!0,this.onActionInput)){const n=this.onActionInput;this.awaitingActionInput=!1,this.onActionInput=null,n(-1),this.moveInfoOverlayActive=this.moveInfoOverlay.active,this.moveInfoOverlay.setVisible(!1),this.moveInfoOverlay.active=!1}}else switch(e){case I.UP:this.rowCursor===0&&this.cursor===3?i=this.setCursor(0):this.rowCursor<this.shopOptionsRows.length+1?i=this.setRowCursor(this.rowCursor+1):i=this.setRowCursor(0);break;case I.DOWN:this.rowCursor?i=this.setRowCursor(this.rowCursor-1):this.lockRarityButtonContainer.visible&&this.cursor===0?i=this.setCursor(3):i=this.setRowCursor(this.shopOptionsRows.length+1);break;case I.LEFT:if(this.rowCursor)this.cursor?i=this.setCursor(this.cursor-1):this.rowCursor===1&&this.options.length===0?i=!1:i=this.setCursor(this.getRowItems(this.rowCursor)-1);else switch(this.cursor){case 0:i=this.setCursor(2);break;case 1:this.lockRarityButtonContainer.visible?i=this.setCursor(3):i=this.rerollButtonContainer.visible&&this.setCursor(0);break;case 2:this.transferButtonContainer.visible?i=this.setCursor(1):this.rerollButtonContainer.visible?i=this.setCursor(0):i=!1;break;case 3:this.lockRarityButtonContainer.visible?i=this.setCursor(2):i=!1}break;case I.RIGHT:if(this.rowCursor)this.cursor<this.getRowItems(this.rowCursor)-1?i=this.setCursor(this.cursor+1):this.rowCursor===1&&this.options.length===0?i=this.setRowCursor(0):i=this.setCursor(0);else switch(this.cursor){case 0:this.transferButtonContainer.visible?i=this.setCursor(1):i=this.setCursor(2);break;case 1:i=this.setCursor(2);break;case 2:i=this.setCursor(0);break;case 3:this.transferButtonContainer.visible?i=this.setCursor(1):i=this.setCursor(2);break}break}return i&&t.playSelect(),i}setCursor(e){const t=this.getUi(),i=super.setCursor(e);this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.modifierContainer.add(this.cursorObj));const n=this.rowCursor===1?this.options:this.shopOptionsRows[this.shopOptionsRows.length-(this.rowCursor-1)];if(this.cursorObj.setScale(this.rowCursor===1?2:this.rowCursor>=2?1.5:1),this.moveInfoOverlay.clear(),this.rowCursor){if(this.rowCursor===1&&n.length===0)return this.cursorObj.setScale(1.25),this.cursorObj.setPosition(s.game.canvas.width/18+23,-s.game.canvas.height/12-(this.shopOptionsRows.length>1?fr-2:gr-2)),t.showText(g.t("modifierSelectUiHandler:continueNextWaveDescription")),i;const a=s.game.canvas.width/6/(n.length+2);this.rowCursor<2?this.cursorObj.setPosition(a*(e+1)+a*.5-20,-s.game.canvas.height/12-(this.shopOptionsRows.length>1?fr-2:gr-2)):this.cursorObj.setPosition(a*(e+1)+a*.5-16,-s.game.canvas.height/12-s.game.canvas.height/32-(-14+28*(this.rowCursor-(this.shopOptionsRows.length-1))));const r=n[this.cursor].modifierTypeOption.type;r&&t.showText(r.getDescription()),r instanceof _r&&this.moveInfoOverlay.show(Ne[r.moveId])}else e===0?(this.cursorObj.setPosition(6,this.lockRarityButtonContainer.visible?Ts-8:Ts+4),t.showText(g.t("modifierSelectUiHandler:rerollDesc"))):e===1?(this.cursorObj.setPosition((s.game.canvas.width-this.transferButtonWidth-this.checkButtonWidth)/6-30,Ts+4),t.showText(g.t("modifierSelectUiHandler:transferDesc"))):e===2?(this.cursorObj.setPosition((s.game.canvas.width-this.checkButtonWidth)/6-10,Ts+4),t.showText(g.t("modifierSelectUiHandler:checkTeamDesc"))):(this.cursorObj.setPosition(6,Ts+4),t.showText(g.t("modifierSelectUiHandler:lockRaritiesDesc")));return i}setRowCursor(e){const t=this.rowCursor;if(e!==t){this.rowCursor=e;let i=Math.round(this.cursor/Math.max(this.getRowItems(t)-1,1)*(this.getRowItems(e)-1));return e===1&&this.options.length===0&&(i=0),e===0&&(this.options.length===0&&(i=1),i===0&&!this.rerollButtonContainer.visible&&(i=1),i===1&&!this.transferButtonContainer.visible&&(i=2)),e===0&&t>1&&i===0&&this.lockRarityButtonContainer.visible&&(i=3),e===this.shopOptionsRows.length+1&&t===0&&this.cursor===3&&(i=0),this.cursor=-1,this.setCursor(i),!0}return!1}getRowItems(e){switch(e){case 0:return 3;case 1:return this.options.length;default:return this.shopOptionsRows[this.shopOptionsRows.length-(e-1)].length}}setRerollCost(e){this.rerollCost=e}updateCostText(){const e=this.shopOptionsRows.flat();for(const t of e)t.updateCostText();this.updateRerollCostText()}updateRerollCostText(){if(this.rerollCost<0){this.rerollCostText.setVisible(!1);return}this.rerollCostText.setVisible(!0);const t=s.money>=this.rerollCost,i=Ka(s.moneyFormat,this.rerollCost);this.rerollCostText.setText(g.t("modifierSelectUiHandler:rerollCost",{formattedMoney:i})),this.rerollCostText.setColor(this.getTextColor(t?O.MONEY:O.PARTY_RED)),this.rerollCostText.setShadowColor(this.getTextColor(t?O.MONEY:O.PARTY_RED,!0))}updateLockRaritiesText(){const e=s.lockModifierTiers?O.SUMMARY_BLUE:O.PARTY;this.lockRarityButtonText.setColor(this.getTextColor(e)),this.lockRarityButtonText.setShadowColor(this.getTextColor(e,!0))}clear(){super.clear(),this.moveInfoOverlay.clear(),this.moveInfoOverlayActive=!1,this.awaitingActionInput=!1,this.onActionInput=null,this.getUi().clearText(),this.eraseCursor(),this.cursor=0,this.rowCursor=0,s.hideShopOverlay(750*s.gameSpeed),s.hideLuckText(250),s.getModifierBar().updateModifiers(s.modifiers);const e=this.options.concat(this.shopOptionsRows.flat());this.options.splice(0,this.options.length),this.shopOptionsRows.splice(0,this.shopOptionsRows.length),s.tweens.add({targets:e,scale:.01,duration:250,ease:"Cubic.easeIn",onComplete:u(()=>e.forEach(t=>t.destroy()),"onComplete")}),[this.rerollButtonContainer,this.checkButtonContainer,this.transferButtonContainer,this.lockRarityButtonContainer,this.continueButtonContainer].forEach(t=>{t.visible&&s.tweens.add({targets:t,alpha:0,duration:250,ease:"Cubic.easeIn",onComplete:u(()=>{this.options.length?t.setAlpha(1):t.setVisible(!1)},"onComplete")})})}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Lh,"ModifierSelectUiHandler");let Rr=Lh;const Rh=class Rh extends is.GameObjects.Container{constructor(e,t,i){super(s,e,t),this.modifierTypeOption=i,this.setup()}setup(){var t,i,n;if(!this.modifierTypeOption.cost){const a=u(()=>{const r=s.add.sprite(0,-182,"pb",this.getPbAtlasKey(-this.modifierTypeOption.upgradeCount));return r.setScale(2),r},"getPb");this.pb=a(),this.add(this.pb),this.pbTint=a(),this.pbTint.setVisible(!1),this.add(this.pbTint)}this.itemContainer=s.add.container(0,0),this.itemContainer.setScale(.5),this.itemContainer.setAlpha(0),this.add(this.itemContainer);const e=u(()=>{var r;return s.add.sprite(0,0,"items",(r=this.modifierTypeOption.type)==null?void 0:r.iconImage)},"getItem");this.item=e(),this.itemContainer.add(this.item),this.modifierTypeOption.cost||(this.itemTint=e(),this.itemTint.setTintFill(is.Display.Color.GetColor(255,192,255)),this.itemContainer.add(this.itemTint)),this.itemText=D(0,35,(t=this.modifierTypeOption.type)==null?void 0:t.name,O.PARTY,{align:"center"}),this.itemText.setOrigin(.5,0),this.itemText.setAlpha(0),this.itemText.setTint((i=this.modifierTypeOption.type)!=null&&i.tier?Ng((n=this.modifierTypeOption.type)==null?void 0:n.tier):void 0),this.add(this.itemText),this.modifierTypeOption.cost&&(this.itemCostText=D(0,45,"",O.MONEY,{align:"center"}),this.itemCostText.setOrigin(.5,0),this.itemCostText.setAlpha(0),this.add(this.itemCostText),this.updateCostText())}show(e,t){if(!this.modifierTypeOption.cost){s.tweens.add({targets:this.pb,y:0,duration:1250,ease:"Bounce.Out"});let i=1,n=0,a=!1;s.tweens.addCounter({from:1,to:0,duration:1250,ease:"Bounce.Out",onUpdate:u(r=>{if(!s)return;const o=r.getValue();!a&&o>i?(s.playSound("se/pb_bounce_1",{volume:1/++n}),a=!0):a&&o<i&&(a=!1),i=o},"onUpdate")});for(let r=0;r<this.modifierTypeOption.upgradeCount;r++){const o=r;s.time.delayedCall(e-2e3*(this.modifierTypeOption.upgradeCount-(o+1+t)),()=>{s.playSound("se/upgrade",{rate:1+.25*o}),this.pbTint.setPosition(this.pb.x,this.pb.y),this.pbTint.setTintFill(16777215),this.pbTint.setAlpha(0),this.pbTint.setVisible(!0),s.tweens.add({targets:this.pbTint,alpha:1,duration:1e3,ease:"Sine.easeIn",onComplete:u(()=>{this.pb.setTexture("pb",this.getPbAtlasKey(-this.modifierTypeOption.upgradeCount+(o+1))),s.tweens.add({targets:this.pbTint,alpha:0,duration:750,ease:"Sine.easeOut",onComplete:u(()=>{this.pbTint.setVisible(!1)},"onComplete")})},"onComplete")})})}}s.time.delayedCall(e+2e3,()=>{s&&(this.modifierTypeOption.cost||(this.pb.setTexture("pb",`${this.getPbAtlasKey(0)}_open`),s.playSound("se/pb_rel"),s.tweens.add({targets:this.pb,duration:500,delay:250,ease:"Sine.easeIn",alpha:0,onComplete:u(()=>this.pb.destroy(),"onComplete")})),s.tweens.add({targets:this.itemContainer,duration:500,ease:"Elastic.Out",scale:2,alpha:1}),this.modifierTypeOption.cost||s.tweens.add({targets:this.itemTint,alpha:0,duration:500,ease:"Sine.easeIn",onComplete:u(()=>this.itemTint.destroy(),"onComplete")}),s.tweens.add({targets:this.itemText,duration:500,alpha:1,y:25,ease:"Cubic.easeInOut"}),this.itemCostText&&s.tweens.add({targets:this.itemCostText,duration:500,alpha:1,y:35,ease:"Cubic.easeInOut"}))})}getPbAtlasKey(e=0){var t;return mi(((t=this.modifierTypeOption.type)==null?void 0:t.tier)+e)}updateCostText(){const e=ne.WAIVE_ROLL_FEE_OVERRIDE?0:this.modifierTypeOption.cost,t=e<=s.money?O.MONEY:O.PARTY_RED,i=Ka(s.moneyFormat,e);this.itemCostText.setText(g.t("modifierSelectUiHandler:itemCost",{formattedMoney:i})),this.itemCostText.setColor(Oe(t,!1,s.uiTheme)),this.itemCostText.setShadowColor(Oe(t,!0,s.uiTheme))}};u(Rh,"ModifierOption");let ua=Rh;const Fh=class Fh extends ts{constructor(){super(_.BALL),this.scale=.1666666667}setup(){const e=this.getUi();this.scale=Ai(O.WINDOW,s.uiTheme).scale;let t="";for(let a=0;a<Object.keys(s.pokeballCounts).length;a++)t+=`${Pg(a)}
`;t+=g.t("commandUiHandler:ballCancel");const i=D(0,0,t,O.WINDOW,{align:"right",maxLines:6}),n=i.displayWidth;this.pokeballSelectContainer=s.add.container(s.game.canvas.width/6-51-Math.max(64,n),-49),this.pokeballSelectContainer.setVisible(!1),e.add(this.pokeballSelectContainer),this.pokeballSelectBg=me(0,0,50+Math.max(64,n),32+480*this.scale),this.pokeballSelectBg.setOrigin(0,1),this.pokeballSelectContainer.add(this.pokeballSelectBg),this.pokeballSelectContainer.add(i),i.setOrigin(0,0),i.setPositionRelative(this.pokeballSelectBg,42,9),i.setLineSpacing(this.scale*72),this.countsText=D(0,0,"",O.WINDOW,{maxLines:5}),this.countsText.setPositionRelative(this.pokeballSelectBg,18,9),this.countsText.setLineSpacing(this.scale*72),this.pokeballSelectContainer.add(this.countsText),this.setCursor(0)}show(e){return super.show(e),this.updateCounts(),this.pokeballSelectContainer.setVisible(!0),this.setCursor(this.cursor),!0}processInput(e){const t=this.getUi();let i=!1;const n=Object.keys(s.pokeballCounts).length;if(e===I.ACTION||e===I.CANCEL){const a=s.phaseManager.getCurrentPhase();i=!0,e===I.ACTION&&this.cursor<n?s.pokeballCounts[this.cursor]?a.handleCommand(be.BALL,this.cursor)&&(s.ui.setMode(_.COMMAND,a.getFieldIndex()),s.ui.setMode(_.MESSAGE),i=!0):t.playError():(t.setMode(_.COMMAND,a.getFieldIndex()),i=!0)}else switch(e){case I.UP:i=this.setCursor(this.cursor?this.cursor-1:n);break;case I.DOWN:i=this.setCursor(this.cursor<n?this.cursor+1:0);break}return i&&t.playSelect(),i}updateCounts(){this.countsText.setText(Object.values(s.pokeballCounts).map(e=>`x${e}`).join(`
`))}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.pokeballSelectContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.pokeballSelectBg,12,15+(6+this.cursor*96)*this.scale),t}clear(){super.clear(),this.pokeballSelectContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Fh,"BallUiHandler");let Fr=Fh;const hs=24,si=[[0,-1],[.825,-.5],[.825,.5],[-.825,-.5],[-.825,.5],[0,1]],AT=-3,Ln=1,Dp=[0,Ln,-Ln,Ln,-Ln,AT],wT=[0,5,0,5,0,0],ii=[0,1,2,5,4,3],Rn=new Array(12).fill(null).map(()=>0),Uh=class Uh extends Phaser.GameObjects.Container{constructor(e,t,i){super(s,e,t),this.showDiff=!!i,this.setup()}setup(){this.setName("stats");const e=new Array(6).fill(null).flatMap((a,r)=>[hs*si[ii[r]][0],hs*si[ii[r]][1]]),t=s.add.polygon(48,44,e,14213360,.625);t.setOrigin(0,0);const i=s.add.polygon(t.x,t.y,e).setStrokeStyle(1,4735056);i.setOrigin(0,0);const n=[[0,-1,0,1],[-.825,-.5,.825,.5],[.825,-.5,-.825,.5]].map(a=>{const r=new Phaser.GameObjects.Line(s,t.x,t.y,hs*a[0],hs*a[1],hs*a[2],hs*a[3],16777215).setLineWidth(.5);return r.setOrigin(0,0),r});this.ivChart=s.add.polygon(t.x,t.y,Rn,10016928,.75),this.ivChart.setOrigin(0,0),this.add(t),n.map(a=>this.add(a)),this.add(this.ivChart),this.add(i),this.ivStatValueTexts=[];for(const a of Yi){const r=D(t.x+hs*si[a][0]*1.325+(this.showDiff?0:Dp[a]),t.y+hs*si[a][1]*1.325-4+(this.showDiff?0:wT[a]),g.t(Wi(a)),O.TOOLTIP_CONTENT);r.setOrigin(.5),this.ivStatValueTexts[a]=pt(r.x-(this.showDiff?0:Dp[a]),r.y+8,"0",O.TOOLTIP_CONTENT),this.ivStatValueTexts[a].setOrigin(.5),this.add(r),this.add(this.ivStatValueTexts[a])}}updateIvs(e,t){if(e){const i=new Array(6).fill(null).flatMap((h,c)=>[e[ii[c]]/31*hs*si[ii[c]][0],e[ii[c]]/31*hs*si[ii[c]][1]]),n=this.statsIvsCache||Rn,a=Oe(O.SUMMARY_GOLD,!1,s.uiTheme);this.statsIvsCache=i.slice(0),this.ivStatValueTexts.map((h,c)=>{let d="";e[c]===31?d+=`[color=${a}][shadow]${e[c].toString()}[/shadow][/color]`:d=e[c].toString(),this.showDiff&&t&&(t[c]<e[c]?d+=` ([color=${Oe(O.SUMMARY_BLUE,!1,s.uiTheme)}][shadow=${Oe(O.SUMMARY_BLUE,!0,s.uiTheme)}]+${e[c]-t[c]}[/shadow][/color])`:d+=" (-)"),h.setText(`[shadow]${d}[/shadow]`)});const r=e.every(h=>h===31)?Number.parseInt(a.substr(1),16):10016928,o=this.ivChart.fillColor,l=o!==r?[Phaser.Display.Color.IntegerToColor(o),Phaser.Display.Color.IntegerToColor(r)]:null;s.tweens.addCounter({from:0,to:1,duration:1e3,ease:"Cubic.easeOut",onUpdate:u(h=>{const c=h.getValue(),d=i.map((f,p)=>f*c+n[p]*(1-c));l&&this.ivChart.setFillStyle(Phaser.Display.Color.ValueToColor(Phaser.Display.Color.Interpolate.ColorWithColor(l[0],l[1],1,c)).color,.75),this.ivChart.setTo(d)},"onUpdate")})}else this.statsIvsCache=Rn,this.ivChart.setTo(Rn)}};u(Uh,"StatsContainer");let nn=Uh;var re=(y=>(y.Button_Up="BUTTON_UP",y.Alt_Button_Up="ALT_BUTTON_UP",y.Button_Down="BUTTON_DOWN",y.Alt_Button_Down="ALT_BUTTON_DOWN",y.Button_Left="BUTTON_LEFT",y.Alt_Button_Left="ALT_BUTTON_LEFT",y.Button_Right="BUTTON_RIGHT",y.Alt_Button_Right="ALT_BUTTON_RIGHT",y.Button_Action="BUTTON_ACTION",y.Alt_Button_Action="ALT_BUTTON_ACTION",y.Button_Cancel="BUTTON_CANCEL",y.Alt_Button_Cancel="ALT_BUTTON_CANCEL",y.Button_Menu="BUTTON_MENU",y.Alt_Button_Menu="ALT_BUTTON_MENU",y.Button_Stats="BUTTON_STATS",y.Alt_Button_Stats="ALT_BUTTON_STATS",y.Button_Cycle_Form="BUTTON_CYCLE_FORM",y.Alt_Button_Cycle_Form="ALT_BUTTON_CYCLE_FORM",y.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",y.Alt_Button_Cycle_Shiny="ALT_BUTTON_CYCLE_SHINY",y.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",y.Alt_Button_Cycle_Gender="ALT_BUTTON_CYCLE_GENDER",y.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",y.Alt_Button_Cycle_Ability="ALT_BUTTON_CYCLE_ABILITY",y.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",y.Alt_Button_Cycle_Nature="ALT_BUTTON_CYCLE_NATURE",y.Button_Cycle_Tera="BUTTON_CYCLE_TERA",y.Alt_Button_Cycle_Tera="ALT_BUTTON_CYCLE_TERA",y.Button_Speed_Up="BUTTON_SPEED_UP",y.Alt_Button_Speed_Up="ALT_BUTTON_SPEED_UP",y.Button_Slow_Down="BUTTON_SLOW_DOWN",y.Alt_Button_Slow_Down="ALT_BUTTON_SLOW_DOWN",y.Button_Submit="BUTTON_SUBMIT",y.Alt_Button_Submit="ALT_BUTTON_SUBMIT",y))(re||{});const Le=g.t("settings:pressToBind"),MT={BUTTON_UP:[`KEY ${I.UP.toString()}`,Le],BUTTON_DOWN:[`KEY ${I.DOWN.toString()}`,Le],ALT_BUTTON_UP:[`KEY ${I.UP.toString()}`,Le],BUTTON_LEFT:[`KEY ${I.LEFT.toString()}`,Le],BUTTON_RIGHT:[`KEY ${I.RIGHT.toString()}`,Le],BUTTON_ACTION:[`KEY ${I.ACTION.toString()}`,Le],BUTTON_MENU:[`KEY ${I.MENU.toString()}`,Le],BUTTON_SUBMIT:[`KEY ${I.SUBMIT.toString()}`,Le],ALT_BUTTON_DOWN:[`KEY ${I.DOWN.toString()}`,Le],ALT_BUTTON_LEFT:[`KEY ${I.LEFT.toString()}`,Le],ALT_BUTTON_RIGHT:[`KEY ${I.RIGHT.toString()}`,Le],ALT_BUTTON_ACTION:[`KEY ${I.ACTION.toString()}`,Le],BUTTON_CANCEL:[`KEY ${I.CANCEL.toString()}`,Le],ALT_BUTTON_CANCEL:[`KEY ${I.CANCEL.toString()}`,Le],ALT_BUTTON_MENU:[`KEY ${I.MENU.toString()}`,Le],BUTTON_STATS:[`KEY ${I.STATS.toString()}`,Le],ALT_BUTTON_STATS:[`KEY ${I.STATS.toString()}`,Le],BUTTON_CYCLE_FORM:[`KEY ${I.CYCLE_FORM.toString()}`,Le],ALT_BUTTON_CYCLE_FORM:[`KEY ${I.CYCLE_FORM.toString()}`,Le],BUTTON_CYCLE_SHINY:[`KEY ${I.CYCLE_SHINY.toString()}`,Le],ALT_BUTTON_CYCLE_SHINY:[`KEY ${I.CYCLE_SHINY.toString()}`,Le],BUTTON_CYCLE_GENDER:[`KEY ${I.CYCLE_GENDER.toString()}`,Le],ALT_BUTTON_CYCLE_GENDER:[`KEY ${I.CYCLE_GENDER.toString()}`,Le],BUTTON_CYCLE_ABILITY:[`KEY ${I.CYCLE_ABILITY.toString()}`,Le],ALT_BUTTON_CYCLE_ABILITY:[`KEY ${I.CYCLE_ABILITY.toString()}`,Le],BUTTON_CYCLE_NATURE:[`KEY ${I.CYCLE_NATURE.toString()}`,Le],ALT_BUTTON_CYCLE_NATURE:[`KEY ${I.CYCLE_NATURE.toString()}`,Le],BUTTON_CYCLE_TERA:[`KEY ${I.CYCLE_TERA.toString()}`,Le],ALT_BUTTON_CYCLE_TERA:[`KEY ${I.CYCLE_TERA.toString()}`,Le],BUTTON_SPEED_UP:[`KEY ${I.SPEED_UP.toString()}`,Le],ALT_BUTTON_SPEED_UP:[`KEY ${I.SPEED_UP.toString()}`,Le],BUTTON_SLOW_DOWN:[`KEY ${I.SLOW_DOWN.toString()}`,Le],ALT_BUTTON_SLOW_DOWN:[`KEY ${I.SLOW_DOWN.toString()}`,Le],ALT_BUTTON_SUBMIT:[`KEY ${I.SUBMIT.toString()}`,Le]},kT={BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_MENU:0,BUTTON_SUBMIT:0,ALT_BUTTON_UP:0,ALT_BUTTON_DOWN:0,ALT_BUTTON_LEFT:0,ALT_BUTTON_RIGHT:0,ALT_BUTTON_ACTION:0,BUTTON_CANCEL:0,ALT_BUTTON_CANCEL:0,ALT_BUTTON_MENU:0,BUTTON_STATS:0,ALT_BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,ALT_BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,ALT_BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,ALT_BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,ALT_BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,ALT_BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,ALT_BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,ALT_BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,ALT_BUTTON_SLOW_DOWN:0,ALT_BUTTON_SUBMIT:0},NT=["BUTTON_SUBMIT","BUTTON_MENU","BUTTON_ACTION","BUTTON_CANCEL","BUTTON_UP","BUTTON_DOWN","BUTTON_LEFT","BUTTON_RIGHT"];function qf(y,e){switch(y){case"BUTTON_UP":case"BUTTON_DOWN":case"BUTTON_LEFT":case"BUTTON_RIGHT":case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"ALT_BUTTON_UP":case"ALT_BUTTON_DOWN":case"ALT_BUTTON_LEFT":case"ALT_BUTTON_RIGHT":case"ALT_BUTTON_ACTION":case"ALT_BUTTON_CANCEL":case"ALT_BUTTON_MENU":case"ALT_BUTTON_STATS":case"ALT_BUTTON_CYCLE_SHINY":case"ALT_BUTTON_CYCLE_FORM":case"ALT_BUTTON_CYCLE_GENDER":case"ALT_BUTTON_CYCLE_ABILITY":case"ALT_BUTTON_CYCLE_NATURE":case"ALT_BUTTON_CYCLE_TERA":case"ALT_BUTTON_SPEED_UP":case"ALT_BUTTON_SLOW_DOWN":case"ALT_BUTTON_SUBMIT":if(e&&s.ui){const t=u((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(_.KEYBOARD_BINDING,{target:y,cancelHandler:t})}break}return!0}u(qf,"setSettingKeyboard");var yt=(y=>(y[y.UNLOCKED=1]="UNLOCKED",y[y.ENABLED=2]="ENABLED",y))(yt||{}),_e=(y=>(y[y.GAMEPAD=0]="GAMEPAD",y[y.KEYBOARD=1]="KEYBOARD",y))(_e||{});const Vh=class Vh extends Phaser.GameObjects.Container{constructor(e,t,i,n,a){super(s,e,t),this.maxRows=a,this.totalRows=a,this.currentRow=0;const r=2;i=Math.max(i,4),this.bg=s.add.nineslice(0,0,"scroll_bar",void 0,i,n,r,r,r,r),this.bg.setOrigin(0,0),this.add(this.bg),this.handleBody=s.add.rectangle(1,1,i-2,4,11184810),this.handleBody.setOrigin(0,0),this.add(this.handleBody),this.handleBottom=s.add.nineslice(1,1,"scroll_bar_handle",void 0,i-2,2,2,0,0,0),this.handleBottom.setOrigin(0,0),this.add(this.handleBottom)}setScrollCursor(e){this.currentRow=e,this.updateHandlePosition()}setTotalRows(e){this.totalRows=e,this.handleBody.height=(this.bg.displayHeight-1-this.handleBottom.displayHeight)*this.maxRows/this.totalRows,this.updateHandlePosition(),this.setVisible(this.totalRows>this.maxRows)}updateHandlePosition(){this.handleBody.y=1+(this.bg.displayHeight-1-this.handleBottom.displayHeight)/this.totalRows*this.currentRow,this.handleBottom.y=this.handleBody.y+this.handleBody.displayHeight}};u(Vh,"ScrollBar");let ys=Vh;var ee=(y=>(y[y.ON=0]="ON",y[y.OFF=1]="OFF",y[y.EXCLUDE=2]="EXCLUDE",y[y.UNLOCKABLE=3]="UNLOCKABLE",y[y.ONE=4]="ONE",y[y.TWO=5]="TWO",y))(ee||{}),Mt=(y=>(y[y.SINGLE=0]="SINGLE",y[y.MULTI=1]="MULTI",y[y.HYBRID=2]="HYBRID",y[y.RADIAL=3]="RADIAL",y))(Mt||{}),We=(y=>(y[y.NUMBER=0]="NUMBER",y[y.COST=1]="COST",y[y.CANDY=2]="CANDY",y[y.IV=3]="IV",y[y.NAME=4]="NAME",y[y.CAUGHT=5]="CAUGHT",y[y.HATCHED=6]="HATCHED",y))(We||{});const Hh=class Hh{constructor(e,t,i=1){this.text=e||"",this.sprite=t,this.state=i}};u(Hh,"DropDownLabel");let ie=Hh;const Yh=class Yh extends Phaser.GameObjects.Container{constructor(e,t){super(s),this.state=0,this.dir=-1,this.onColor=3390463,this.offColor=2565927,this.excludeColor=16733525,this.unlockableColor=16776960,this.oneColor=3390463,this.twoColor=3390463,this.val=e,Array.isArray(t)?this.labels=t:this.labels=t?[t]:[new ie("")],this.currentLabelIndex=0;const i=this.labels[this.currentLabelIndex];this.state=i.state,this.text=D(0,0,i.text||"",O.TOOLTIP_CONTENT),this.text.setOrigin(0,.5),this.add(this.text);for(let n=0;n<this.labels.length;n++){const a=this.labels[n].sprite;a&&(this.add(a),a.setOrigin(0,.5),n!==this.currentLabelIndex&&a.setVisible(!1))}}setupToggleIcon(e,t){e===0?(this.toggle=s.add.sprite(0,0,"cursor"),this.toggle.setScale(.5),this.toggle.setOrigin(0,.5),this.toggle.setRotation(Math.PI/180*-90)):(this.toggle=s.add.sprite(0,0,"candy"),this.toggle.setScale(.3),this.toggle.setOrigin(0,.5)),this.add(this.toggle),this.toggle.setVisible(t),this.updateToggleIconColor()}updateToggleIconColor(){switch(this.state){case 0:this.toggle.setTint(this.onColor);break;case 1:this.toggle.setTint(this.offColor);break;case 2:this.toggle.setTint(this.excludeColor);break;case 3:this.toggle.setTint(this.unlockableColor);break;case 4:this.toggle.setTint(this.oneColor);break;case 5:this.toggle.setTint(this.twoColor);break}}toggleOptionState(){if(this.labels.length>1)return this.setCurrentLabel((this.currentLabelIndex+1)%this.labels.length);const e=this.state===0?1:0;return this.setOptionState(e)}setOptionState(e){const t=this.labels.findIndex(i=>i.state===e);return t!==-1&&t!==this.currentLabelIndex?this.setCurrentLabel(t):(this.state=e,this.updateToggleIconColor(),e)}setCurrentLabel(e){const t=this.labels[this.currentLabelIndex],i=this.labels[e];return i?(this.currentLabelIndex=e,this.state=i.state,this.updateToggleIconColor(),t.sprite&&(this.text.x-=t.sprite.displayWidth+2,t.sprite.setVisible(!1)),i.sprite&&(this.text.x+=i.sprite.displayWidth+2,i.sprite.setVisible(!0)),this.text.setText(i.text),this.state):this.state}setDirection(e){this.dir=e,this.toggle.flipX=this.dir===1}toggleDirection(){this.setDirection(this.dir*-1)}setLabelPosition(e,t){let i=e;for(let n=0;n<this.labels.length;n++){const a=this.labels[n];a.sprite&&(a.sprite.x=e,a.sprite.y=t,n===this.currentLabelIndex&&(i+=a.sprite.displayWidth+2))}this.text&&(this.text.x=i,this.text.y=t)}setTogglePosition(e,t){this.toggle&&(this.toggle.x=e,this.toggle.y=t)}getCurrentLabelX(){var e;return this.labels[this.currentLabelIndex].sprite?(e=this.labels[this.currentLabelIndex].sprite)==null?void 0:e.x:this.text.x}getWidth(){let e=0;const t=this.text.text;for(const i of this.labels){this.text.setText(i.text);const n=i.sprite?i.sprite.displayWidth+2:0;e=Math.max(e,this.text.displayWidth+n)}return this.text.setText(t),e}};u(Yh,"DropDownOption");let Se=Yh;const Wh=class Wh extends Phaser.GameObjects.Container{constructor(e,t,i,n,a=1,r=2){super(s,e-7-5,t),this.dropDownType=1,this.cursor=0,this.lastCursor=-1,this.defaultCursor=0,this.lastDir=-1,this.totalOptions=0,this.maxOptions=0,this.shownOptions=0,this.tooManyOptions=!1,this.firstShown=0,this.optionHeight=0,this.optionSpacing=0,this.optionPaddingX=4,this.optionPaddingY=6,this.optionWidth=100,this.cursorOffset=0,this.optionWidth=100,this.optionHeight=7,this.optionSpacing=r,this.optionPaddingX=4,this.optionPaddingY=6,this.cursorOffset=7,this.options=i,this.dropDownType=a,this.onChange=n,this.cursorObj=s.add.image(this.optionPaddingX+3,0,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setOrigin(0,.5),this.cursorObj.setVisible(!1),(this.dropDownType===1||this.dropDownType===2)&&this.options.unshift(new Se("ALL",new ie(g.t("filterBar:all"),void 0,this.checkForAllOn()?0:1))),this.maxOptions=19,this.totalOptions=this.options.length,this.tooManyOptions=this.totalOptions>this.maxOptions,this.shownOptions=this.tooManyOptions?this.maxOptions:this.totalOptions,this.defaultSettings=this.getSettings(),i.forEach((h,c)=>{const d=a!==0||h.state===0;h.setupToggleIcon(a,d),h.width=this.optionWidth,h.y=c*this.optionHeight+c*r+this.optionPaddingY;const f=7+this.optionPaddingX+3,p=this.optionHeight/2;h.setLabelPosition(f+8,p),a===0?h.setTogglePosition(f+3,p+1):h.setTogglePosition(f,p),c>=this.shownOptions&&(h.visible=!1),this.firstShown=0}),this.window=me(0,0,this.optionWidth,i[this.shownOptions-1].y+this.optionHeight+this.optionPaddingY,!1,!1,void 0,void 0,es.XTHIN),this.add(this.window),this.add(i),this.add(this.cursorObj),this.setVisible(!1),this.tooManyOptions&&(this.dropDownScrollBar=new ys(this.window.width-3,5,5,this.window.height-10,1),this.add(this.dropDownScrollBar),this.dropDownScrollBar.setTotalRows(this.totalOptions),this.dropDownScrollBar.setScrollCursor(0))}getWidth(){return this.window?this.window.width:this.width}toggleVisibility(){this.setVisible(!this.visible)}setVisible(e){return super.setVisible(e),e&&this.autoSize(),this}resetCursor(){return this.dropDownType===2&&this.checkForAllOff()?this.setCursor(this.lastCursor):this.setCursor(this.defaultCursor)}setCursor(e){return this.tooManyOptions&&this.setLabels(e),this.cursor=e,e<0?(e=0,this.cursorObj.setVisible(!1),!1):e>=this.options.length?(e=this.options.length-1,this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),!1):(this.cursorObj.y=this.options[e].y+3.5,this.cursorObj.setVisible(!0),this.dropDownType===2&&(this.lastCursor=e,this.onChange()),!0)}setLabels(e){e===0&&this.lastCursor===this.totalOptions-1?this.firstShown=0:e===this.totalOptions-1&&this.lastCursor===0?this.firstShown=this.totalOptions-this.shownOptions:e-this.firstShown>=this.shownOptions&&e>this.lastCursor?this.firstShown+=1:e<this.firstShown&&e<this.lastCursor&&(this.firstShown-=1),this.options.forEach((t,i)=>{t.y=(i-this.firstShown)*(this.optionHeight+this.optionSpacing)+this.optionPaddingY;const n=this.cursorOffset+this.optionPaddingX+3,a=this.optionHeight/2;t.setLabelPosition(n+8,a),this.dropDownType===0?t.setTogglePosition(n+3,a+1):t.setTogglePosition(n,a),i<this.firstShown||i>=this.firstShown+this.shownOptions?t.visible=!1:t.visible=!0}),this.dropDownScrollBar.setScrollCursor(e)}toggleOptionState(e=this.cursor){const t=this.options[e];if(this.dropDownType===1||this.dropDownType===2){const i=t.toggleOptionState();e===0?this.setAllOptions(i):i===0&&this.checkForAllOn()?this.options[0].setOptionState(0):this.options[0].setOptionState(1)}else this.dropDownType===0?t.state===1?(this.options.forEach(i=>{i.setOptionState(1),i.setDirection(-1),i.toggle.setVisible(!1)}),t.setOptionState(0),t.setDirection(this.lastDir),t.toggle.setVisible(!0)):(t.toggleDirection(),this.lastDir=this.options[this.cursor].dir):this.dropDownType===3&&t.toggleOptionState();this.onChange()}checkForAllOn(){return this.options.every((e,t)=>t===0||e.state===0)}checkForAllOff(){return this.options.every((e,t)=>t===0||e.state===1)}getVals(){if(this.dropDownType===1)return this.options.filter((e,t)=>t>0&&e.state===0).map(e=>e.val);if(this.dropDownType===2){const e=this.options.filter((t,i)=>i>0&&t.state===0).map(t=>t.val);return e.length>0?e:this.cursor===0?this.options.filter((t,i)=>i>0).map(t=>t.val):[this.options[this.cursor].val]}return this.dropDownType===3?this.options.map(e=>({val:e.val,state:e.state})):this.options.filter(e=>e.state===0).map(e=>({val:e.val,dir:e.dir}))}getSettings(){const e=[];for(let t=0;t<this.options.length;t++)e.push({val:this.options[t].val,state:this.options[t].state,cursor:this.cursor===t,dir:this.options[t].dir});return e}hasDefaultValues(){const e=this.getSettings(),t=u(i=>e.length===this.defaultSettings.length&&e.every((n,a)=>i.every(r=>n[r]===this.defaultSettings[a][r])),"compareValues");switch(this.dropDownType){case 1:case 3:return t(["val","state"]);case 2:return t(["val","state","cursor"]);case 0:return t(["val","state","dir"]);default:return!1}}resetToDefault(){if(this.defaultSettings.length>0){this.setCursor(this.defaultCursor),this.lastDir=-1;for(let e=0;e<this.options.length;e++)this.dropDownType===0?this.defaultSettings[e].state===1?(this.options[e].setOptionState(1),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!1)):(this.options[e].setOptionState(0),this.options[e].setDirection(-1),this.options[e].toggle.setVisible(!0)):this.defaultSettings[e]&&this.options[e].setOptionState(this.defaultSettings[e].state);this.onChange()}}setAllOptions(e){if(this.dropDownType!==0)for(const t of this.options)t.setOptionState(e)}selectAllOptions(){this.setAllOptions(0)}unselectAllOptions(){this.setAllOptions(1)}autoSize(){let e=0,t=0;for(let i=0;i<this.options.length;i++){const n=this.options[i].getWidth();n>e&&(e=n,t=this.options[i].getCurrentLabelX()??0)}this.window.width=e+t-this.window.x+9,this.tooManyOptions&&(this.window.width+=6,this.dropDownScrollBar.x=this.window.width-9),this.x+this.window.width>this.parentContainer.width&&(this.x=this.parentContainer.width-this.window.width)}};u(Wh,"DropDown");let kt=Wh;const Gh=class Gh extends Phaser.GameObjects.Container{constructor(e){super(s,0,0),this.shinyIcons=[],this.cost=0,this.species=e;const t=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),i=s.gameData.getSpeciesDexAttrProps(e,t),n=s.add.image(2,5,"passive_bg");n.setOrigin(0,0),n.setScale(.75),n.setVisible(!1),this.add(n),this.starterPassiveBgs=n,this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(i.female,i.formIndex,i.shiny,i.variant),this.icon.setTint(0),this.add(this.icon);for(let d=0;d<3;d++){const f=s.add.image(d*-3+12,2,"shiny_star_small");f.setScale(.5),f.setOrigin(0,0),f.setVisible(!1),this.shinyIcons.push(f)}this.add(this.shinyIcons);const a=D(1,2,"0",O.WINDOW,{fontSize:"32px"});a.setShadowOffset(2,2),a.setOrigin(0,0),a.setVisible(!1),this.add(a),this.label=a;const r=s.add.image(12,7,"ha_capsule");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.hiddenAbilityIcon=r;const o=s.add.image(0,7,"favorite");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.favoriteIcon=o;const l=s.add.image(0,12,"champion_ribbon");l.setOrigin(0,0),l.setScale(.5),l.setVisible(!1),this.add(l),this.classicWinIcon=l;const h=s.add.image(12,12,"candy");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeIcon=h;const c=s.add.image(12,12,"candy_overlay");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.candyUpgradeOverlayIcon=c}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};u(Gh,"StarterContainer");let Ur=Gh;const Kh=class Kh extends Phaser.GameObjects.Container{constructor(e,t,i,n,a=6,r=6,o=8){super(s,e,t),this.labels=[],this.dropDowns=[],this.columns=[],this.numFilters=0,this.openDropDown=!1,this.lastCursor=-1,this.width=i,this.height=n,this.leftPaddingX=a,this.rightPaddingX=r,this.cursorOffset=o,this.window=me(0,0,i,n,!1,!1,void 0,void 0,es.THIN),this.cursorObj=s.add.image(1,1,"cursor").setScale(.5).setVisible(!1).setOrigin(0),this.add([this.window,this.cursorObj])}addFilter(e,t,i){if(this.columns.includes(e))return!1;this.columns.push(e);const n=D(0,3,t,O.TOOLTIP_CONTENT);return this.labels.push(n),this.add(n),this.dropDowns.push(i),this.add(i),this.calcFilterPositions(),this.numFilters++,!0}getFilter(e){return this.dropDowns[this.columns.indexOf(e)]}getColumn(e){return this.columns[e]}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.dropDowns[e].hasDefaultValues()?this.labels[e].setColor(Oe(O.TOOLTIP_CONTENT,!1,s.uiTheme)):this.labels[e].setColor(Oe(O.STATS_LABEL,!1,s.uiTheme))}calcFilterPositions(){let e=this.leftPaddingX+this.rightPaddingX+this.cursorOffset;this.labels.forEach(i=>{e+=i.displayWidth+this.cursorOffset});const t=(this.width-e)/(this.labels.length-1);for(let i=0;i<this.labels.length;i++){if(i===0)this.labels[i].x=this.leftPaddingX+this.cursorOffset;else{const n=this.labels[i-1].x+this.labels[i-1].displayWidth;this.labels[i].x=n+t+this.cursorOffset}this.dropDowns[i].x=this.labels[i].x-this.cursorOffset-this.leftPaddingX,this.dropDowns[i].y=this.height}}offsetHybridFilters(){for(let e=0;e<this.dropDowns.length;e++)this.dropDowns[e].dropDownType===Mt.HYBRID&&(this.dropDowns[e].autoSize(),this.dropDowns[e].x=-this.dropDowns[e].getWidth(),this.dropDowns[e].y=0)}setCursor(e){this.lastCursor>-1&&this.dropDowns[this.lastCursor].visible&&(this.dropDowns[this.lastCursor].setVisible(!1),this.dropDowns[e].setVisible(!0),this.dropDowns[e].resetCursor()),this.cursorObj.setPosition(this.labels[e].x-this.cursorOffset+2,6),this.lastCursor=e}toggleDropDown(e){this.dropDowns[e].toggleVisibility(),this.openDropDown=this.dropDowns[e].visible,this.dropDowns[e].resetCursor()}hideDropDowns(){this.dropDowns.forEach(e=>{e.setVisible(!1)}),this.openDropDown=!1}incDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===this.dropDowns[this.lastCursor].options.length-1?this.dropDowns[this.lastCursor].setCursor(0):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor+1)}decDropDownCursor(){return this.dropDowns[this.lastCursor].cursor===0?this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].options.length-1):this.dropDowns[this.lastCursor].setCursor(this.dropDowns[this.lastCursor].cursor-1)}toggleOptionState(){this.dropDowns[this.lastCursor].toggleOptionState()}getVals(e){return this.getFilter(e).getVals()}resetSelection(e){this.dropDowns[e].resetToDefault(),this.updateFilterLabels()}setValsToDefault(){for(const e of this.dropDowns)e.resetToDefault()}getNearestFilter(e){const t=e.x+e.icon.displayWidth/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].x+this.labels[a].displayWidth/3));r<n&&(i=a,n=r)}return i}};u(Kh,"FilterBar");let da=Kh;var xe=(y=>(y[y.GEN=0]="GEN",y[y.TYPES=1]="TYPES",y[y.BIOME=2]="BIOME",y[y.CAUGHT=3]="CAUGHT",y[y.UNLOCKS=4]="UNLOCKS",y[y.MISC=5]="MISC",y[y.SORT=6]="SORT",y))(xe||{});const Bp={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"54px",instructionTextSize:"35px",starterInfoXPos:35},"es-ES":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},"es-MX":{starterInfoTextSize:"50px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:38},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},"pt-BR":{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoYOffset:.5,starterInfoXPos:33},zh:{starterInfoTextSize:"56px",instructionTextSize:"36px",starterInfoXPos:26},ko:{starterInfoTextSize:"60px",instructionTextSize:"38px",starterInfoYOffset:-.5,starterInfoXPos:30},ja:{starterInfoTextSize:"62px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:33},ca:{starterInfoTextSize:"48px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:29},da:{starterInfoTextSize:"56px",instructionTextSize:"38px"},tr:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ro:{starterInfoTextSize:"56px",instructionTextSize:"38px"},ru:{starterInfoTextSize:"46px",instructionTextSize:"38px",starterInfoYOffset:.5,starterInfoXPos:26}},Lp=2,mr=17,Fn=109,cs=285,ea=38,Un=34,an=107,Rp=20;function Vr(y,e=0){const n=y%9*18,a=13+(Math.floor(y/9)-e)*17;return{x:n,y:a}}u(Vr,"calcStarterPosition$1");function xh(y){const e=an/7,t=ea+e/2;return Math.round(t+e*y)}u(xh,"calcStarterIconY");function Fp(y,e=6){let t=an,i=0;for(let n=0;n<e;n++){const a=Math.abs(y-(xh(n)-13));a<t&&(i=n,t=a)}return i}u(Fp,"findClosestStarterIndex");function Up(y,e){const t=xh(y)-13;let i=an,n=0;for(let a=0;a<e;a++){const r=Math.abs(t-Vr(a*9).y);r<i&&(n=a,i=r)}return n}u(Up,"findClosestStarterRow");const zh=class zh extends _t{constructor(){super(_.STARTER_SELECT),this.starterContainers=[],this.filteredStarterContainers=[],this.validStarterContainers=[],this.starterIconsCursorXOffset=-3,this.starterIconsCursorYOffset=1,this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=ve.UNKNOWN,this.filterBarCursor=0,this.allSpecies=[],this.speciesLoaded=new Map,this.starterSpecies=[],this.pokerusSpecies=[],this.starterAttr=[],this.starterAbilityIndexes=[],this.starterNatures=[],this.starterTeras=[],this.starterMovesets=[],this.instructionRowX=0,this.instructionRowY=0,this.instructionRowTextOffset=9,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.blockInput=!1,this.updateStarters=()=>{this.scrollCursor=0,this.filteredStarterContainers=[],this.validStarterContainers=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.starterCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),s.gameMode.modeId===fe.CHALLENGE?this.starterContainers.forEach(t=>{var a;const i=t.species;let n=!1;if(((a=i.forms)==null?void 0:a.length)>0)for(let r=0;r<i.forms.length;r++){if(!i.forms[r].isStarterSelectable)continue;const o=BigInt(Math.pow(2,r))*V.DEFAULT_FORM,l=Ys(t.species,s.gameData.getSpeciesDexAttrProps(i,o),!0);n=n||l}else n=Ys(t.species,s.gameData.getSpeciesDexAttrProps(i,s.gameData.getSpeciesDefaultDexAttr(t.species,!1,!0)),!0);n?this.validStarterContainers.push(t):t.setVisible(!1)}):this.validStarterContainers=this.starterContainers;for(let t=0;t<this.validStarterContainers.length;t++){const i=this.validStarterContainers[t],n=i.icon,a=this.getCurrentDexProps(i.species.speciesId),r=s.gameData.getSpeciesDexAttrProps(i.species,a);n.setTexture(i.species.getIconAtlasKey(r.formIndex,r.shiny,r.variant),i.species.getIconId(r.female,r.formIndex,r.shiny,r.variant)),i.checkIconId(r.female,r.formIndex,r.shiny,r.variant)}this.validStarterContainers.forEach(t=>{var ce,$;t.setVisible(!1),t.cost=s.gameData.getSpeciesStarterValue(t.species.speciesId);const i=((ce=s.gameData.dexData[t.species.speciesId])==null?void 0:ce.caughtAttr)||BigInt(0),n=s.gameData.starterData[t.species.speciesId],a=wt.hasOwnProperty(t.species.speciesId),r=this.filterBar.getVals(xe.GEN).includes(t.species.generation),o=this.filterBar.getVals(xe.TYPES).some(Y=>t.species.isOfType(Y-1)),l=!!(i&V.NON_SHINY),h=!!(i&V.SHINY),c=h&&!!(i&V.DEFAULT_VARIANT),d=h&&!!(i&V.VARIANT_2),f=h&&!!(i&V.VARIANT_3),p=!l&&!c&&!d&&!f,T=this.filterBar.getVals(xe.CAUGHT).some(Y=>{if(Y==="SHINY3")return f;if(Y==="SHINY2")return d&&!f;if(Y==="SHINY")return c&&!d&&!f;if(Y==="NORMAL")return l&&!c&&!d&&!f;if(Y==="UNCAUGHT")return p}),m=n.passiveAttr>0,C=this.isPassiveAvailable(t.species.speciesId)&&!m,b=this.filterBar.getVals(xe.UNLOCKS).some(Y=>{if(Y.val==="PASSIVE"&&Y.state===ee.ON)return m;if(Y.val==="PASSIVE"&&Y.state===ee.EXCLUDE)return a&&!m;if(Y.val==="PASSIVE"&&Y.state===ee.UNLOCKABLE)return C;if(Y.val==="PASSIVE"&&Y.state===ee.OFF)return!0}),S=n.valueReduction===1,x=n.valueReduction===2,A=this.isValueReductionAvailable(t.species.speciesId),w=this.filterBar.getVals(xe.UNLOCKS).some(Y=>{if(Y.val==="COST_REDUCTION"&&Y.state===ee.ON)return S||x;if(Y.val==="COST_REDUCTION"&&Y.state===ee.ONE)return S;if(Y.val==="COST_REDUCTION"&&Y.state===ee.TWO)return x;if(Y.val==="COST_REDUCTION"&&Y.state===ee.EXCLUDE)return a&&!(S||x);if(Y.val==="COST_REDUCTION"&&Y.state===ee.UNLOCKABLE)return A;if(Y.val==="COST_REDUCTION"&&Y.state===ee.OFF)return!0}),k=(($=this.starterPreferences[t.species.speciesId])==null?void 0:$.favorite)??!1,B=this.filterBar.getVals(xe.MISC).some(Y=>{if(Y.val==="FAVORITE"&&Y.state===ee.ON)return k;if(Y.val==="FAVORITE"&&Y.state===ee.EXCLUDE)return!k;if(Y.val==="FAVORITE"&&Y.state===ee.OFF)return!0}),X=n.classicWinCount>0,L=n.classicWinCount===0,Q=n.classicWinCount===void 0,te=this.filterBar.getVals(xe.MISC).some(Y=>{if(Y.val==="WIN"&&Y.state===ee.ON)return X;if(Y.val==="WIN"&&Y.state===ee.EXCLUDE)return L||Q;if(Y.val==="WIN"&&Y.state===ee.OFF)return!0}),P=t.species.abilityHidden!==t.species.ability1&&t.species.abilityHidden!==bn.NONE,H=n.abilityAttr&Ze.ABILITY_HIDDEN,v=this.filterBar.getVals(xe.MISC).some(Y=>{if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.ON)return H;if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.EXCLUDE)return P&&!H;if(Y.val==="HIDDEN_ABILITY"&&Y.state===ee.OFF)return!0}),F=this.isSameSpeciesEggAvailable(t.species.speciesId),pe=this.filterBar.getVals(xe.MISC).some(Y=>{if(Y.val==="EGG"&&Y.state===ee.ON)return F;if(Y.val==="EGG"&&Y.state===ee.EXCLUDE)return a&&!F;if(Y.val==="EGG"&&Y.state===ee.OFF)return!0}),z=this.filterBar.getVals(xe.MISC).some(Y=>{if(Y.val==="POKERUS"&&Y.state===ee.ON)return this.pokerusSpecies.includes(t.species);if(Y.val==="POKERUS"&&Y.state===ee.EXCLUDE)return!this.pokerusSpecies.includes(t.species);if(Y.val==="POKERUS"&&Y.state===ee.OFF)return!0});r&&o&&T&&b&&w&&B&&te&&v&&pe&&z&&this.filteredStarterContainers.push(t)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredStarterContainers.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(xe.SORT)[0];this.filteredStarterContainers.sort((t,i)=>{switch(e.val){case We.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case We.COST:return(t.cost-i.cost)*-e.dir;case We.CANDY:{const n=s.gameData.starterData[t.species.speciesId].candyCount,a=s.gameData.starterData[i.species.speciesId].candyCount;return(n-a)*-e.dir}case We.IV:{const n=s.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[t.species.speciesId].ivs.length,a=s.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case We.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case We.CAUGHT:return(s.gameData.dexData[t.species.speciesId].caughtCount-s.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case We.HATCHED:return(s.gameData.dexData[t.species.speciesId].hatchedCount-s.gameData.dexData[i.species.speciesId].hatchedCount)*-e.dir}return 0}),this.updateScroll()},this.updateScroll=()=>{const i=this.scrollCursor*9,n=Math.min(this.filteredStarterContainers.length-1,i+9*9-1);this.starterSelectScrollBar.setScrollCursor(this.scrollCursor);let a=0;this.filteredStarterContainers.forEach((r,o)=>{var d;const l=Vr(o,this.scrollCursor);if(r.setPosition(l.x,l.y),o<i||o>n){r.setVisible(!1),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(l.x-1,l.y+1),this.pokerusCursorObjs[a].setVisible(!1),a++),this.starterSpecies.includes(r.species)&&(this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(l.x-1,l.y+1),this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setVisible(!1));return}r.setVisible(!0),this.pokerusSpecies.includes(r.species)&&(this.pokerusCursorObjs[a].setPosition(l.x-1,l.y+1),this.pokerusCursorObjs[a].setVisible(!0),a++),this.starterSpecies.includes(r.species)&&(this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setPosition(l.x-1,l.y+1),this.starterCursorObjs[this.starterSpecies.indexOf(r.species)].setVisible(!0));const h=r.species.speciesId;this.updateStarterValueLabel(r),r.label.setVisible(!0);const c=h&&s.gameData.dexData[h].caughtAttr&V.SHINY?[V.DEFAULT_VARIANT,V.VARIANT_2,V.VARIANT_3].filter(f=>!!(s.gameData.dexData[h].caughtAttr&f)):[];for(let f=0;f<3;f++){const p=c.length>f;r.shinyIcons[f].setVisible(p),p&&r.shinyIcons[f].setTint(dt(c[f]===V.DEFAULT_VARIANT?0:c[f]===V.VARIANT_2?1:2))}r.starterPassiveBgs.setVisible(!!s.gameData.starterData[h].passiveAttr),r.hiddenAbilityIcon.setVisible(!!s.gameData.dexData[h].caughtAttr&&!!(s.gameData.starterData[h].abilityAttr&4)),r.classicWinIcon.setVisible(s.gameData.starterData[h].classicWinCount>0),r.favoriteIcon.setVisible(((d=this.starterPreferences[h])==null?void 0:d.favorite)??!1),s.candyUpgradeDisplay===0?(ft[h]||(ft[h]=["ffffff","ffffff"]),r.candyUpgradeIcon.setTint(Vt(Ot(ft[h][0]))),r.candyUpgradeOverlayIcon.setTint(Vt(Ot(ft[h][1]))),this.setUpgradeIcon(r)):s.candyUpgradeDisplay===1&&(r.candyUpgradeIcon.setVisible(!1),r.candyUpgradeOverlayIcon.setVisible(!1))})}}setup(){const e=this.getUi(),t=g.resolvedLanguage??"en",i=Object.keys(Bp).find(R=>t.includes(R))??"en",n=Bp[i];this.starterSelectContainer=s.add.container(0,-s.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=s.add.image(0,0,"starter_select_bg");r.setOrigin(0,0),this.starterSelectContainer.add(r),this.shinyOverlay=s.add.image(6,6,"summary_overlay_shiny"),this.shinyOverlay.setOrigin(0,0),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay);const o=me(Fn,mr+1,175,161),l=s.add.image(Fn+1,mr+2,"starter_container_bg");l.setOrigin(0,0),this.starterSelectContainer.add(l),this.starterSelectContainer.add(me(cs,ea-Rp,Un,Rp,!0)),this.starterSelectContainer.add(me(cs,ea,Un,an)),this.starterSelectContainer.add(me(cs,ea+an,Un,Un,!0)),this.starterSelectContainer.add(o),this.filterBarContainer=s.add.container(0,0),this.filterBar=new da(Math.min(Fn,cs),1,210,mr);const h=[new Se(1,new ie(g.t("starterSelectUiHandler:gen1"))),new Se(2,new ie(g.t("starterSelectUiHandler:gen2"))),new Se(3,new ie(g.t("starterSelectUiHandler:gen3"))),new Se(4,new ie(g.t("starterSelectUiHandler:gen4"))),new Se(5,new ie(g.t("starterSelectUiHandler:gen5"))),new Se(6,new ie(g.t("starterSelectUiHandler:gen6"))),new Se(7,new ie(g.t("starterSelectUiHandler:gen7"))),new Se(8,new ie(g.t("starterSelectUiHandler:gen8"))),new Se(9,new ie(g.t("starterSelectUiHandler:gen9")))],c=new kt(0,0,h,this.updateStarters,Mt.HYBRID);this.filterBar.addFilter(xe.GEN,g.t("filterBar:genFilter"),c);const d=Object.keys(ve).filter(R=>Number.isNaN(Number(R))),f=[];d.forEach((R,he)=>{if(he===0||he===19)return;const ae=s.add.sprite(0,0,os("types"));ae.setScale(.5),ae.setFrame(R.toLowerCase()),f.push(new Se(he,new ie("",ae)))}),this.filterBar.addFilter(xe.TYPES,g.t("filterBar:typeFilter"),new kt(0,0,f,this.updateStarters,Mt.HYBRID,.5));const p=s.add.sprite(0,0,"shiny_icons");p.setOrigin(.15,.2),p.setScale(.6),p.setFrame(qt(0)),p.setTint(dt(0));const T=s.add.sprite(0,0,"shiny_icons");T.setOrigin(.15,.2),T.setScale(.6),T.setFrame(qt(1)),T.setTint(dt(1));const m=s.add.sprite(0,0,"shiny_icons");m.setOrigin(.15,.2),m.setScale(.6),m.setFrame(qt(2)),m.setTint(dt(2));const C=[new Se("SHINY3",new ie("",m)),new Se("SHINY2",new ie("",T)),new Se("SHINY",new ie("",p)),new Se("NORMAL",new ie(g.t("filterBar:normal"))),new Se("UNCAUGHT",new ie(g.t("filterBar:uncaught")))];this.filterBar.addFilter(xe.CAUGHT,g.t("filterBar:caughtFilter"),new kt(0,0,C,this.updateStarters,Mt.HYBRID));const b=[new ie(g.t("filterBar:passive"),void 0,ee.OFF),new ie(g.t("filterBar:passiveUnlocked"),void 0,ee.ON),new ie(g.t("filterBar:passiveUnlockable"),void 0,ee.UNLOCKABLE),new ie(g.t("filterBar:passiveLocked"),void 0,ee.EXCLUDE)],S=[new ie(g.t("filterBar:costReduction"),void 0,ee.OFF),new ie(g.t("filterBar:costReductionUnlocked"),void 0,ee.ON),new ie(g.t("filterBar:costReductionUnlockedOne"),void 0,ee.ONE),new ie(g.t("filterBar:costReductionUnlockedTwo"),void 0,ee.TWO),new ie(g.t("filterBar:costReductionUnlockable"),void 0,ee.UNLOCKABLE),new ie(g.t("filterBar:costReductionLocked"),void 0,ee.EXCLUDE)],x=[new Se("PASSIVE",b),new Se("COST_REDUCTION",S)];this.filterBar.addFilter(xe.UNLOCKS,g.t("filterBar:unlocksFilter"),new kt(0,0,x,this.updateStarters,Mt.RADIAL));const A=[new ie(g.t("filterBar:favorite"),void 0,ee.OFF),new ie(g.t("filterBar:isFavorite"),void 0,ee.ON),new ie(g.t("filterBar:notFavorite"),void 0,ee.EXCLUDE)],w=[new ie(g.t("filterBar:ribbon"),void 0,ee.OFF),new ie(g.t("filterBar:hasWon"),void 0,ee.ON),new ie(g.t("filterBar:hasNotWon"),void 0,ee.EXCLUDE)],k=[new ie(g.t("filterBar:hiddenAbility"),void 0,ee.OFF),new ie(g.t("filterBar:hasHiddenAbility"),void 0,ee.ON),new ie(g.t("filterBar:noHiddenAbility"),void 0,ee.EXCLUDE)],B=[new ie(g.t("filterBar:egg"),void 0,ee.OFF),new ie(g.t("filterBar:eggPurchasable"),void 0,ee.ON)],X=[new ie(g.t("filterBar:pokerus"),void 0,ee.OFF),new ie(g.t("filterBar:hasPokerus"),void 0,ee.ON)],L=[new Se("FAVORITE",A),new Se("WIN",w),new Se("HIDDEN_ABILITY",k),new Se("EGG",B),new Se("POKERUS",X)];this.filterBar.addFilter(xe.MISC,g.t("filterBar:miscFilter"),new kt(0,0,L,this.updateStarters,Mt.RADIAL));const Q=[new Se(We.NUMBER,new ie(g.t("filterBar:sortByNumber"),void 0,ee.ON)),new Se(We.COST,new ie(g.t("filterBar:sortByCost"))),new Se(We.CANDY,new ie(g.t("filterBar:sortByCandies"))),new Se(We.IV,new ie(g.t("filterBar:sortByIVs"))),new Se(We.NAME,new ie(g.t("filterBar:sortByName"))),new Se(We.CAUGHT,new ie(g.t("filterBar:sortByNumCaught"))),new Se(We.HATCHED,new ie(g.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(xe.SORT,g.t("filterBar:sortFilter"),new kt(0,0,Q,this.updateStarters,Mt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),s.uiTheme||o.setVisible(!1),this.iconAnimHandler=new za,this.iconAnimHandler.setup(),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.pokemonNumberText=D(17,1,"0000",O.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=D(6,112,"",O.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=D(8,106,g.t("starterSelectUiHandler:growthRate"),O.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=D(34,106,"",O.SUMMARY_PINK,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=D(96,112,"",O.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=D(6,127,g.t("starterSelectUiHandler:uncaught"),O.SUMMARY_ALT,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const te=(n==null?void 0:n.starterInfoXPos)||31,P=(n==null?void 0:n.starterInfoYOffset)||0,H=(n==null?void 0:n.starterInfoTextSize)||56;this.pokemonAbilityLabelText=D(6,127+P,g.t("starterSelectUiHandler:ability"),O.SUMMARY_ALT,{fontSize:H}),this.pokemonAbilityLabelText.setOrigin(0,0),this.pokemonAbilityLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonAbilityLabelText),this.pokemonAbilityText=D(te,127+P,"",O.SUMMARY_ALT,{fontSize:H}),this.pokemonAbilityText.setOrigin(0,0),this.pokemonAbilityText.setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonAbilityText),this.pokemonPassiveLabelText=D(6,136+P,g.t("starterSelectUiHandler:passive"),O.SUMMARY_ALT,{fontSize:H}),this.pokemonPassiveLabelText.setOrigin(0,0),this.pokemonPassiveLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveLabelText),this.pokemonPassiveText=D(te,136+P,"",O.SUMMARY_ALT,{fontSize:H}),this.pokemonPassiveText.setOrigin(0,0),this.pokemonPassiveText.setInteractive(new Phaser.Geom.Rectangle(0,0,250,55),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonPassiveText),this.pokemonPassiveDisabledIcon=s.add.sprite(te,137+P,"icon_stop"),this.pokemonPassiveDisabledIcon.setOrigin(0,.5),this.pokemonPassiveDisabledIcon.setScale(.35),this.pokemonPassiveDisabledIcon.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveDisabledIcon),this.pokemonPassiveLockedIcon=s.add.sprite(te,137+P,"icon_lock"),this.pokemonPassiveLockedIcon.setOrigin(0,.5),this.pokemonPassiveLockedIcon.setScale(.42,.38),this.pokemonPassiveLockedIcon.setVisible(!1),this.starterSelectContainer.add(this.pokemonPassiveLockedIcon),this.pokemonNatureLabelText=D(6,145+P,g.t("starterSelectUiHandler:nature"),O.SUMMARY_ALT,{fontSize:H}),this.pokemonNatureLabelText.setOrigin(0,0),this.pokemonNatureLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonNatureLabelText),this.pokemonNatureText=pt(te,145+P,"",O.SUMMARY_ALT,{fontSize:H}),this.pokemonNatureText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNatureText),this.pokemonMoveContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[],this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.valueLimitLabel=D(cs+17,150,"0/10",O.TOOLTIP_CONTENT),this.valueLimitLabel.setOrigin(.5,0),this.starterSelectContainer.add(this.valueLimitLabel);const v=D(cs+17,162,g.t("common:start"),O.TOOLTIP_CONTENT);v.setOrigin(.5,0),this.starterSelectContainer.add(v),this.startCursorObj=s.add.nineslice(cs+4,160,"select_cursor",void 0,26,15,6,6,6,6),this.startCursorObj.setVisible(!1),this.startCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.startCursorObj);const F=D(cs+17,23,g.t("starterSelectUiHandler:randomize"),O.TOOLTIP_CONTENT);F.setOrigin(.5,0),this.starterSelectContainer.add(F),this.randomCursorObj=s.add.nineslice(cs+4,21,"select_cursor",void 0,26,15,6,6,6,6),this.randomCursorObj.setVisible(!1),this.randomCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.randomCursorObj);const pe=[],z=s.add.container(Fn+6,9);this.starterSelectScrollBar=new ys(161,12,5,o.height-6,9),z.add(this.starterSelectScrollBar),this.pokerusCursorObjs=new Array(mf).fill(null).map(()=>{const R=s.add.image(0,0,"select_cursor_pokerus");return R.setVisible(!1),R.setOrigin(0,0),z.add(R),R}),this.starterCursorObjs=new Array(6).fill(null).map(()=>{const R=s.add.image(0,0,"select_cursor_highlight");return R.setVisible(!1),R.setOrigin(0,0),z.add(R),R}),this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.starterIconsCursorObj=s.add.image(289,64,"select_gen_cursor"),this.starterIconsCursorObj.setName("starter-icons-cursor"),this.starterIconsCursorObj.setVisible(!1),this.starterIconsCursorObj.setOrigin(0,0),this.starterSelectContainer.add(this.starterIconsCursorObj),z.add(this.cursorObj);for(const R of Xe){if(!Re.hasOwnProperty(R.speciesId)||!R.isObtainable())continue;pe.push(R.speciesId),this.speciesLoaded.set(R.speciesId,!1),this.allSpecies.push(R);const he=new Ur(R).setVisible(!1);this.iconAnimHandler.addOrUpdate(he.icon,xt.NONE),this.starterContainers.push(he),z.add(he)}this.starterSelectContainer.add(z),this.starterIcons=new Array(6).fill(null).map((R,he)=>{const ae=s.add.sprite(cs+7,xh(he),"pokemon_icons_0");return ae.setScale(.5),ae.setOrigin(0,0),ae.setFrame("unknown"),this.starterSelectContainer.add(ae),this.iconAnimHandler.addOrUpdate(ae,xt.PASSIVE),ae}),this.type1Icon=s.add.sprite(8,98,os("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(26,98,os("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=D(8,89,g.t("common:luckIndicator"),O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=D(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",O.WINDOW,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=s.add.container(4.5,18),this.pokemonCandyIcon=s.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=D(9.5,0,"x0",O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=D(6,42,"Form",O.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCaughtHatchedContainer=s.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const ce=s.add.sprite(1,0,"items","pb");ce.setOrigin(0,0),ce.setScale(.75),this.pokemonCaughtHatchedContainer.add(ce),this.pokemonCaughtCountText=D(24,4,"0",O.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcon=s.add.sprite(14,76,"shiny_icons"),this.pokemonShinyIcon.setOrigin(.15,.2),this.pokemonShinyIcon.setScale(1),this.pokemonCaughtHatchedContainer.add(this.pokemonShinyIcon),this.pokemonHatchedCountText=D(24,19,"0",O.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText),this.pokemonMovesContainer=s.add.container(102,16),this.pokemonMovesContainer.setScale(.375);for(let R=0;R<4;R++){const he=s.add.container(0,14*R),ae=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);ae.setOrigin(1,0);const oe=D(-ae.width/2,0,"-",O.PARTY);oe.setOrigin(.5,0),this.pokemonMoveBgs.push(ae),this.pokemonMoveLabels.push(oe),he.add(ae),he.add(oe),this.pokemonMoveContainers.push(he),this.pokemonMovesContainer.add(he)}this.pokemonAdditionalMoveCountLabel=D(-this.pokemonMoveBgs[0].width/2,56,"(+0)",O.PARTY),this.pokemonAdditionalMoveCountLabel.setOrigin(.5,0),this.pokemonMovesContainer.add(this.pokemonAdditionalMoveCountLabel),this.starterSelectContainer.add(this.pokemonMovesContainer),this.pokemonEggMovesContainer=s.add.container(102,85),this.pokemonEggMovesContainer.setScale(.375);const $=D(-46,0,g.t("starterSelectUiHandler:eggMoves"),O.WINDOW_ALT);$.setOrigin(.5,0),this.pokemonEggMovesContainer.add($);for(let R=0;R<4;R++){const he=s.add.container(0,16+14*R),ae=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);ae.setOrigin(1,0);const oe=D(-ae.width/2,0,"???",O.PARTY);oe.setOrigin(.5,0),this.pokemonEggMoveBgs.push(ae),this.pokemonEggMoveLabels.push(oe),he.add(ae),he.add(oe),this.pokemonEggMoveContainers.push(he),this.pokemonEggMovesContainer.add(he)}this.starterSelectContainer.add(this.pokemonEggMovesContainer),this.teraIcon=s.add.sprite(85,63,"button_tera"),this.teraIcon.setName("terrastallize-icon"),this.teraIcon.setFrame("fire"),this.starterSelectContainer.add(this.teraIcon);const Y=n.instructionTextSize;this.instructionsContainer=s.add.container(4,156),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.shinyIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleShiny"),O.PARTY,{fontSize:Y}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleForm"),O.PARTY,{fontSize:Y}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleGender"),O.PARTY,{fontSize:Y}),this.genderLabel.setName("text-gender-label"),this.abilityIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","E.png"),this.abilityIconElement.setName("sprite-ability-icon-element"),this.abilityIconElement.setScale(.675),this.abilityIconElement.setOrigin(0,0),this.abilityLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleAbility"),O.PARTY,{fontSize:Y}),this.abilityLabel.setName("text-ability-label"),this.natureIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","N.png"),this.natureIconElement.setName("sprite-nature-icon-element"),this.natureIconElement.setScale(.675),this.natureIconElement.setOrigin(0,0),this.natureLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleNature"),O.PARTY,{fontSize:Y}),this.natureLabel.setName("text-nature-label"),this.teraIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.teraIconElement.setName("sprite-tera-icon-element"),this.teraIconElement.setScale(.675),this.teraIconElement.setOrigin(0,0),this.teraLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("starterSelectUiHandler:cycleTera"),O.PARTY,{fontSize:Y}),this.teraLabel.setName("text-tera-label"),this.goFilterIconElement=new Phaser.GameObjects.Sprite(s,this.filterInstructionRowX,this.filterInstructionRowY,"keyboard","C.png"),this.goFilterIconElement.setName("sprite-goFilter-icon-element"),this.goFilterIconElement.setScale(.675),this.goFilterIconElement.setOrigin(0,0),this.goFilterLabel=D(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY,g.t("starterSelectUiHandler:goFilter"),O.PARTY,{fontSize:Y}),this.goFilterLabel.setName("text-goFilter-label"),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=s.add.container(0,s.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=D(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new nn(6,16),s.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer);const W=1;this.moveInfoOverlay=new Ls({scale:W,top:!0,x:1,y:s.game.canvas.height/6-Ls.getHeight(W)-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),s.eventTarget.addEventListener(oi.CANDY_UPGRADE_NOTIFICATION_CHANGED,R=>this.onCandyUpgradeDisplayChanged(R)),this.updateInstructions()}show(e){return this.starterPreferences||(this.starterPreferences=yf()),this.moveInfoOverlay.clear(),this.pokerusSpecies=Tf(),e.length>=1&&e[0]instanceof Function?(super.show(e),this.starterSelectCallback=e[0],this.starterSelectContainer.setVisible(!0),this.allSpecies.forEach((t,i)=>{const n=this.starterContainers[i].icon,a=s.gameData.dexData[t.speciesId];this.starterPreferences[t.speciesId]=this.initStarterPrefs(t),a.caughtAttr?n.clearTint():a.seenAttr&&n.setTint(8421504),this.setUpgradeAnimation(n,t)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setCursor(0),this.tryUpdateValue(0),Rs(zt.Starter_Select),!0):!1}initStarterPrefs(e){var h;const t=this.starterPreferences[e.speciesId],i=s.gameData.dexData[e.speciesId],n=s.gameData.starterData[e.speciesId];if(!t||!i.caughtAttr)return{};const a=i.caughtAttr,r=a&V.SHINY,o=a&V.NON_SHINY;if(t.shiny&&!r?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const c=[r&&a&V.DEFAULT_VARIANT,r&&a&V.VARIANT_2,r&&a&V.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!c[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&((t.female?a&V.FEMALE:a&V.MALE)||(t.female=void 0)),t.ability!==void 0){const c=e.ability2===e.ability1,d=n.abilityAttr,f=d&Ze.ABILITY_1,p=d&Ze.ABILITY_2,T=d&Ze.ABILITY_HIDDEN;[f,c?p&&!f:p,T][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!((h=e.forms[l])!=null&&h.isStarterSelectable)||!(a&s.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&s.gameData.getNaturesForAttr(i.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.resetCaughtDropdown()}resetCaughtDropdown(){const e=this.filterBar.getFilter(xe.CAUGHT);e.resetToDefault();for(let t=0;t<e.options.length;t++)e.options[t].val!=="ALL"&&e.options[t].val!=="UNCAUGHT"&&e.toggleOptionState(t)}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}isPassiveAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=$i(Re[e])&&!(t.passiveAttr&yt.UNLOCKED)}isValueReductionAvailable(e){const t=s.gameData.starterData[e];return t.candyCount>=Xi(Re[e])[t.valueReduction]&&t.valueReduction<Lp}isSameSpeciesEggAvailable(e){return s.gameData.starterData[e].candyCount>=qi(Re[e])}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,paused:i,loop:-1,delay:lf(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:"-=5",duration:de(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:"-=3",duration:de(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!(t!=null&&t.speciesId);if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}onCandyUpgradeDisplayChanged(e){if(e){if(s.candyUpgradeDisplay===0){this.filteredStarterContainers.forEach(i=>{this.setUpgradeIcon(i)});return}this.filteredStarterContainers.forEach((i,n)=>{const a=this.filteredStarterContainers[n].icon;this.setUpgradeAnimation(a,i.species)})}}processInput(e){var m,C,b;if(this.blockInput)return!1;const t=9,i=9,n=this.filteredStarterContainers.length,a=Math.ceil(n/t),r=Math.floor(this.cursor/t),o=this.scrollCursor*t,l=Math.min(this.filteredStarterContainers.length-1,o+i*t-1),h=l-o+1,c=Math.ceil(h/t),d=Math.floor((this.cursor-o)/t),f=this.getUi();let p=!1,T=!1;if(e===I.SUBMIT)this.tryStart(!0)?p=!0:T=!0;else if(e===I.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),p=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBar.getColumn(this.filterBarCursor)).hasDefaultValues()?(this.filterBar.getColumn(this.filterBarCursor)===xe.CAUGHT?this.resetCaughtDropdown():this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),p=!0):this.statsMode?(this.toggleStatsMode(!1),p=!0):this.starterSpecies.length?(this.popStarter(this.starterSpecies.length-1),p=!0,this.updateInstructions()):(this.tryExit(),p=!0);else if(e===I.STATS)this.filterMode||(this.startCursorObj.setVisible(!1),this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=0,this.setFilterMode(!0),this.filterBar.toggleDropDown(this.filterBarCursor));else if(this.startCursorObj.visible)switch(e){case I.ACTION:this.tryStart(!0)?p=!0:T=!0;break;case I.UP:this.startCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=this.starterSpecies.length-1,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.startCursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)),p=!0;break;case I.DOWN:this.startCursorObj.setVisible(!1),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0),p=!0;break;case I.LEFT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(c-1)*9+8),p=!0);break;case I.RIGHT:n>0&&(this.startCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+(c-1)*9),p=!0);break}else if(this.filterMode)switch(e){case I.LEFT:this.filterBarCursor>0?p=this.setCursor(this.filterBarCursor-1):p=this.setCursor(this.filterBar.numFilters-1);break;case I.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?p=this.setCursor(this.filterBarCursor+1):p=this.setCursor(0);break;case I.UP:if(this.filterBar.openDropDown)p=this.filterBar.decDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.starterSpecies.length>0?this.startCursorObj.setVisible(!0):this.randomCursorObj.setVisible(!0),p=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,a-9),this.updateScroll();const S=(this.filterBarCursor+.5)/this.filterBar.numFilters,x=Math.min(8,Math.floor(S*11));n%9>x?this.setCursor(n-n%9+x):this.setCursor(Math.max(n-n%9+x-9,0)),p=!0}break;case I.DOWN:if(this.filterBar.openDropDown)p=this.filterBar.incDropDownCursor();else if(this.filterBarCursor===this.filterBar.numFilters-1)this.setFilterMode(!1),this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0),p=!0;else if(n>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const S=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),x=Math.min(8,Math.floor(S*11));this.setCursor(Math.min(x,n)),p=!0}break;case I.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),p=!0;break}else if(this.randomCursorObj.visible)switch(e){case I.ACTION:if(this.starterSpecies.length>=6){T=!0;break}const S=this.starterSpecies.map(v=>v.generation).reduce((v,F,pe)=>v+s.gameData.getSpeciesStarterValue(this.starterSpecies[pe].speciesId),0),x=this.filteredStarterContainers.filter(v=>{const F=v.species,[pe]=this.isInParty(F),z=s.gameData.getSpeciesStarterValue(F.speciesId),ce=Ys(F,s.gameData.getSpeciesDexAttrProps(F,this.getCurrentDexProps(F.speciesId)),this.isPartyValid()),$=s.gameData.dexData[F.speciesId].caughtAttr;return!pe&&ce&&S+z<=this.getValueLimit()&&$});if(x.length===0){T=!0;break}const w=x[Math.floor(Math.random()*x.length)].species;this.setSpecies(w);const k=this.getCurrentDexProps(w.speciesId),B=s.gameData.getSpeciesDexAttrProps(w,k),X=this.abilityCursor,L=this.natureCursor,Q=this.teraCursor,te=(m=this.starterMoveset)==null?void 0:m.slice(0),P=s.gameData.getSpeciesStarterValue(w.speciesId);Rt(w.speciesId,B.formIndex).loadAssets(B.female,B.formIndex,B.shiny,B.variant,!0).then(()=>{this.tryUpdateValue(P,!0)&&(this.addToParty(w,k,X,L,te,Q,!0),f.playSelect())});break;case I.UP:this.randomCursorObj.setVisible(!1),this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0),p=!0;break;case I.DOWN:this.randomCursorObj.setVisible(!1),this.starterSpecies.length>0?(this.starterIconsCursorIndex=0,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.filterBarCursor=this.filterBar.numFilters-1,this.setFilterMode(!0)),p=!0;break;case I.LEFT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o+8),p=!0);break;case I.RIGHT:n>0&&(this.randomCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(o),p=!0);break}else{let S;const x=s.gameData.starterData[this.lastSpecies.speciesId];let A=this.starterPreferences[this.lastSpecies.speciesId];if(this.starterIconsCursorObj.visible?S=this.filteredStarterContainers[this.filteredStarterContainers.findIndex(w=>w.species===this.lastSpecies)]:S=this.filteredStarterContainers[this.cursor],e===I.ACTION){if(!((C=this.speciesStarterDexEntry)!=null&&C.caughtAttr))T=!0;else if(this.starterSpecies.length<=6){const w=this.getUi();let k=[];const[B,X]=this.isInParty(this.lastSpecies),L=this.isPartyValid(),Q=Ys(this.lastSpecies,s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),L),te=this.starterSpecies.map(z=>z.generation).reduce((z,ce,$)=>z+=s.gameData.getSpeciesStarterValue(this.starterSpecies[$].speciesId),0),P=s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId);if(!B&&Q&&te+P<=this.getValueLimit()&&this.starterSpecies.length<sa?k=[{label:g.t("starterSelectUiHandler:addToParty"),handler:u(()=>{var ce;w.setMode(_.STARTER_SELECT);const z=this.tryUpdateValue(s.gameData.getSpeciesStarterValue(this.lastSpecies.speciesId),!0);if(!B&&Q&&z){const $=this.starterCursorObjs[this.starterSpecies.length];$.setVisible(!0),$.setPosition(this.cursorObj.x,this.cursorObj.y),this.addToParty(this.lastSpecies,this.dexAttrCursor,this.abilityCursor,this.natureCursor,(ce=this.starterMoveset)==null?void 0:ce.slice(0),this.teraCursor),w.playSelect()}else w.playError();return!0},"handler"),overrideSound:!0}]:B&&(k=[{label:g.t("starterSelectUiHandler:removeFromParty"),handler:u(()=>(this.popStarter(X),w.setMode(_.STARTER_SELECT),!0),"handler")}]),k.push({label:g.t("starterSelectUiHandler:toggleIVs"),handler:u(()=>(this.toggleStatsMode(),w.setMode(_.STARTER_SELECT),!0),"handler")}),this.speciesStarterMoves.length>1){const z=u(ce=>{this.blockInput=!0,w.setMode(_.STARTER_SELECT).then(()=>{w.showText(g.t("starterSelectUiHandler:selectMoveSwapOut"),null,()=>{this.moveInfoOverlay.show(Ne[ce[0]]),w.setModeWithoutClear(_.OPTION_SELECT,{options:ce.map(($,Y)=>({label:Ne[$].name,handler:u(()=>(this.blockInput=!0,w.setMode(_.STARTER_SELECT).then(()=>{w.showText(`${g.t("starterSelectUiHandler:selectMoveSwapWith")} ${Ne[$].name}.`,null,()=>{const R=this.speciesStarterMoves.filter(he=>he!==$);this.moveInfoOverlay.show(Ne[R[0]]),w.setModeWithoutClear(_.OPTION_SELECT,{options:R.map(he=>({label:Ne[he].name,handler:u(()=>(this.switchMoveHandler(Y,he,$),z(this.starterMoveset),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.show(Ne[he])},"onHover")})).concat({label:g.t("menu:cancel"),handler:u(()=>(z(this.starterMoveset),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.show(Ne[$])},"onHover")})).concat({label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),w.setMode(_.STARTER_SELECT),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})})},"showSwapOptions");k.push({label:g.t("starterSelectUiHandler:manageMoves"),handler:u(()=>(z(this.starterMoveset),!0),"handler")})}if(this.canCycleNature){const z=u(()=>{this.blockInput=!0,w.setMode(_.STARTER_SELECT).then(()=>{w.showText(g.t("starterSelectUiHandler:selectNature"),null,()=>{var $;const ce=s.gameData.getNaturesForAttr(($=this.speciesStarterDexEntry)==null?void 0:$.natureAttr);w.setModeWithoutClear(_.OPTION_SELECT,{options:ce.map((Y,W)=>({label:Ti(Y,!0,!0,!0,s.uiTheme),handler:u(()=>(A||(A=this.starterPreferences[this.lastSpecies.speciesId]={}),A.nature=Y,this.clearText(),w.setMode(_.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies,{natureIndex:Y}),this.blockInput=!1,!0),"handler")})).concat({label:g.t("menu:cancel"),handler:u(()=>(this.clearText(),w.setMode(_.STARTER_SELECT),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})})},"showNatureOptions");k.push({label:g.t("starterSelectUiHandler:manageNature"),handler:u(()=>(z(),!0),"handler")})}const H=x.passiveAttr;H&yt.UNLOCKED&&(H&yt.ENABLED?k.push({label:g.t("starterSelectUiHandler:disablePassive"),handler:u(()=>(x.passiveAttr^=yt.ENABLED,w.setMode(_.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")}):k.push({label:g.t("starterSelectUiHandler:enablePassive"),handler:u(()=>(x.passiveAttr|=yt.ENABLED,w.setMode(_.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),!0),"handler")})),(A==null?void 0:A.favorite)??!1?k.push({label:g.t("starterSelectUiHandler:removeFromFavorites"),handler:u(()=>(A.favorite=!1,S&&S.favoriteIcon.setVisible(A.favorite),w.setMode(_.STARTER_SELECT),!0),"handler")}):k.push({label:g.t("starterSelectUiHandler:addToFavorites"),handler:u(()=>(A.favorite=!0,S&&S.favoriteIcon.setVisible(A.favorite),w.setMode(_.STARTER_SELECT),!0),"handler")}),k.push({label:g.t("menu:rename"),handler:u(()=>{w.playSelect();let z=A.nickname?String(A.nickname):"";return z=decodeURIComponent(escape(atob(z))),w.setModeWithoutClear(_.RENAME_POKEMON,{buttonActions:[ce=>{w.playSelect(),A.nickname=ce;const $=decodeURIComponent(escape(atob(A.nickname)));$.length>0?this.pokemonNameText.setText($):this.pokemonNameText.setText(this.lastSpecies.name),w.setMode(_.STARTER_SELECT)},()=>{w.setMode(_.STARTER_SELECT)}]},z),!0},"handler")});const F=x.candyCount,pe=u(()=>{const z=[];if(!(H&yt.UNLOCKED)){const Y=$i(Re[this.lastSpecies.speciesId]);z.push({label:`x${Y} ${g.t("starterSelectUiHandler:unlockPassive")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||F>=Y?(x.passiveAttr|=yt.UNLOCKED|yt.ENABLED,ne.FREE_CANDY_UPGRADE_OVERRIDE||(x.candyCount-=Y),this.pokemonCandyCountText.setText(`x${x.candyCount}`),s.gameData.saveSystem().then(W=>{if(!W)return s.reset(!0)}),w.setMode(_.STARTER_SELECT),this.setSpeciesDetails(this.lastSpecies),s.playSound("se/buy"),S&&(this.updateCandyUpgradeDisplay(S),S.starterPassiveBgs.setVisible(!!s.gameData.starterData[this.lastSpecies.speciesId].passiveAttr)),!0):!1,"handler"),item:"candy",itemArgs:ft[this.lastSpecies.speciesId]})}const ce=x.valueReduction;if(ce<Lp){const Y=Xi(Re[this.lastSpecies.speciesId])[ce];z.push({label:`x${Y} ${g.t("starterSelectUiHandler:reduceCost")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||F>=Y?(x.valueReduction++,ne.FREE_CANDY_UPGRADE_OVERRIDE||(x.candyCount-=Y),this.pokemonCandyCountText.setText(`x${x.candyCount}`),s.gameData.saveSystem().then(W=>{if(!W)return s.reset(!0)}),this.tryUpdateValue(0),w.setMode(_.STARTER_SELECT),s.playSound("se/buy"),S&&(this.updateStarterValueLabel(S),this.updateCandyUpgradeDisplay(S)),!0):!1,"handler"),item:"candy",itemArgs:ft[this.lastSpecies.speciesId]})}const $=qi(Re[this.lastSpecies.speciesId]);z.push({label:`x${$} ${g.t("starterSelectUiHandler:sameSpeciesEgg")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||F>=$?s.gameData.eggs.length>=99&&!ne.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(g.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(ne.FREE_CANDY_UPGRADE_OVERRIDE||(x.candyCount-=$),this.pokemonCandyCountText.setText(`x${x.candyCount}`),new ui({species:this.lastSpecies.speciesId,sourceType:Sf.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(W=>{if(!W)return s.reset(!0)}),w.setMode(_.STARTER_SELECT),s.playSound("se/buy"),S&&this.updateCandyUpgradeDisplay(S),!0):!1,"handler"),item:"candy",itemArgs:ft[this.lastSpecies.speciesId]}),z.push({label:g.t("menu:cancel"),handler:u(()=>(w.setMode(_.STARTER_SELECT),!0),"handler")}),w.setModeWithoutClear(_.OPTION_SELECT,{options:z,yOffset:47})},"showUseCandies");k.push({label:g.t("menuUiHandler:POKEDEX"),handler:u(()=>(w.setMode(_.STARTER_SELECT).then(()=>{const z={shiny:A.shiny,variant:A.variant,form:A.form,female:A.female};w.setOverlayMode(_.POKEDEX_PAGE,this.lastSpecies,z)}),!0),"handler")}),vt.hasOwnProperty(this.lastSpecies.speciesId)||k.push({label:g.t("starterSelectUiHandler:useCandies"),handler:u(()=>(w.setMode(_.STARTER_SELECT).then(()=>pe()),!0),"handler")}),k.push({label:g.t("menu:cancel"),handler:u(()=>(w.setMode(_.STARTER_SELECT),!0),"handler")}),w.setModeWithoutClear(_.OPTION_SELECT,{options:k,yOffset:47}),p=!0}}else{const w=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId));switch(e){case I.CYCLE_SHINY:if(this.canCycleShiny)if(A.shiny===!1){const k=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)),B=A.variant?A.variant:k.variant;this.setSpeciesDetails(this.lastSpecies,{shiny:!0,variant:B}),s.playSound("se/sparkle");const X=dt(B);this.pokemonShinyIcon.setFrame(qt(B)),this.pokemonShinyIcon.setTint(X),this.pokemonShinyIcon.setVisible(!0),A.shiny=!0}else{let k=w.variant;do if(k=(k+1)%3,k===0){if(this.speciesStarterDexEntry.caughtAttr&V.DEFAULT_VARIANT)break}else if(k===1){if(this.speciesStarterDexEntry.caughtAttr&V.VARIANT_2)break}else if(this.speciesStarterDexEntry.caughtAttr&V.VARIANT_3)break;while(k!==w.variant);if(A.variant=k,this.speciesStarterDexEntry.caughtAttr&V.NON_SHINY&&k<=w.variant)this.setSpeciesDetails(this.lastSpecies,{shiny:!1,variant:0}),this.pokemonShinyIcon.setVisible(!1),p=!0,A.shiny=!1;else{this.setSpeciesDetails(this.lastSpecies,{variant:k});const B=dt(k);this.pokemonShinyIcon.setFrame(qt(k)),this.pokemonShinyIcon.setTint(B),p=!0}}break;case I.CYCLE_FORM:if(this.canCycleForm){const k=this.lastSpecies.forms.length;let B=w.formIndex;do if(B=(B+1)%k,this.lastSpecies.forms[B].isStarterSelectable&&this.speciesStarterDexEntry.caughtAttr&s.gameData.getFormAttr(B))break;while(B!==w.formIndex);A.form=B,A.tera=this.lastSpecies.forms[B].type1,this.setSpeciesDetails(this.lastSpecies,{formIndex:B,teraType:A.tera}),p=!0}break;case I.CYCLE_GENDER:this.canCycleGender&&(A.female=!w.female,this.setSpeciesDetails(this.lastSpecies,{female:!w.female}),p=!0);break;case I.CYCLE_ABILITY:if(this.canCycleAbility){const k=this.lastSpecies.getAbilityCount(),B=s.gameData.starterData[this.lastSpecies.speciesId].abilityAttr,X=B&Ze.ABILITY_1;let L=this.abilityCursor;do if(L=(L+1)%k,L===0){if(X)break}else if(L===1){this.lastSpecies.ability1===this.lastSpecies.ability2&&X&&(L=(L+1)%k);break}else if(B&Ze.ABILITY_HIDDEN)break;while(L!==this.abilityCursor);A.ability=L;const{visible:Q}=s.ui.getTooltip();if(Q&&this.activeTooltip==="ABILITY"){const te=gt[this.lastSpecies.getAbility(L)];s.ui.editTooltip(`${te.name}`,`${te.description}`)}this.setSpeciesDetails(this.lastSpecies,{abilityIndex:L}),p=!0}break;case I.CYCLE_NATURE:if(this.canCycleNature){const k=s.gameData.getNaturesForAttr((b=this.speciesStarterDexEntry)==null?void 0:b.natureAttr),B=k.indexOf(this.natureCursor),X=k[B<k.length-1?B+1:0];A.nature=X,this.setSpeciesDetails(this.lastSpecies,{natureIndex:X}),p=!0}break;case I.CYCLE_TERA:if(this.canCycleTera){const k=Rt(this.lastSpecies.speciesId,A.form??0);k.type1===this.teraCursor&&!Ee(k.type2)?(A.tera=k.type2,this.setSpeciesDetails(this.lastSpecies,{teraType:k.type2})):(A.tera=k.type1,this.setSpeciesDetails(this.lastSpecies,{teraType:k.type1})),p=!0}break;case I.UP:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===0?(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.randomCursorObj.setVisible(!0)):(this.starterIconsCursorIndex--,this.moveStarterIconsCursor(this.starterIconsCursorIndex)),p=!0):r>0?(this.scrollCursor>0&&r-this.scrollCursor===0&&(this.scrollCursor--,this.updateScroll()),p=this.setCursor(this.cursor-9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),p=!0);break;case I.DOWN:this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex<=this.starterSpecies.length-2?(this.starterIconsCursorIndex++,this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),p=!0):r<a-1?(r-this.scrollCursor===8&&this.scrollCursor++,p=this.setCursor(this.cursor+9),this.updateScroll()):a>1?(this.scrollCursor=0,this.updateScroll(),p=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.filteredStarterContainers[this.cursor]),this.setFilterMode(!0),p=!0);break;case I.LEFT:if(!this.starterIconsCursorObj.visible)this.cursor%9!==0?p=this.setCursor(this.cursor-1):(d===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?p=this.setCursor(this.cursor+Math.min(8,n-this.cursor)):d<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=Fp(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),p=!0);else if(n>0){const k=Up(this.starterIconsCursorIndex,c);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+k*9+8,l)),p=!0}else p=!1;break;case I.RIGHT:if(!this.starterIconsCursorObj.visible)this.cursor%9<(r<a-1?8:(n-1)%9)?p=this.setCursor(this.cursor+1):(d===0?(this.cursorObj.setVisible(!1),this.randomCursorObj.setVisible(!0)):this.starterSpecies.length===0?p=this.setCursor(this.cursor-Math.min(8,this.cursor%9)):d<7?(this.cursorObj.setVisible(!1),this.starterIconsCursorIndex=Fp(this.cursorObj.y-1,this.starterSpecies.length),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):(this.cursorObj.setVisible(!1),this.setSpecies(null),this.startCursorObj.setVisible(!0)),p=!0);else if(n>0){const k=Up(this.starterIconsCursorIndex,c);this.starterIconsCursorObj.setVisible(!1),this.cursorObj.setVisible(!0),this.setCursor(Math.min(o+k*9,l-l%9)),p=!0}else p=!1;break}}}return p?f.playSelect():T&&f.playError(),p||T}isInParty(e){let t=0,i=!1;for(let n=0;n<this.starterSpecies.length;n++)if(this.starterSpecies[n]===e){i=!0,t=n;break}return[i,t]}addToParty(e,t,i,n,a,r,o=!1){const l=s.gameData.getSpeciesDexAttrProps(e,t);this.starterIcons[this.starterSpecies.length].setTexture(e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.starterIcons[this.starterSpecies.length].setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(this.starterIcons[this.starterSpecies.length],e,l.female,l.formIndex,l.shiny,l.variant),this.starterSpecies.push(e),this.starterAttr.push(t),this.starterAbilityIndexes.push(i),this.starterNatures.push(n),this.starterTeras.push(r),this.starterMovesets.push(a),(this.speciesLoaded.get(e.speciesId)||o)&&Rt(e.speciesId,l.formIndex).cry(),this.updateInstructions()}updatePartyIcon(e,t){const i=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId));this.starterIcons[t].setTexture(e.getIconAtlasKey(i.formIndex,i.shiny,i.variant)),this.starterIcons[t].setFrame(e.getIconId(i.female,i.formIndex,i.shiny,i.variant)),this.checkIconId(this.starterIcons[t],e,i.female,i.formIndex,i.shiny,i.variant)}switchMoveHandler(e,t,i){var o,l,h,c,d;const n=this.lastSpecies.speciesId,a=(o=this.starterMoveset)==null?void 0:o.indexOf(t);this.starterMoveset[e]=t,a>-1&&(this.starterMoveset[a]=i);const r=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.dexAttrCursor);if(fs.hasOwnProperty(n)){(!s.gameData.starterData[n].moveset||Array.isArray(s.gameData.starterData[n].moveset))&&(s.gameData.starterData[n].moveset={[r.formIndex]:(l=this.starterMoveset)==null?void 0:l.slice(0)});const f=s.gameData.starterData[n].moveset;f.hasOwnProperty(r.formIndex)||(s.gameData.starterData[n].moveset[r.formIndex]=(h=this.starterMoveset)==null?void 0:h.slice(0)),f.hasOwnProperty(r.formIndex)&&f[r.formIndex][a]!==t&&(s.gameData.starterData[n].moveset[r.formIndex]=(c=this.starterMoveset)==null?void 0:c.slice(0))}else s.gameData.starterData[n].moveset=(d=this.starterMoveset)==null?void 0:d.slice(0);this.setSpeciesDetails(this.lastSpecies,{forSeen:!1}),this.starterMovesets.length&&Array.from({length:this.starterSpecies.length},(f,p)=>{this.starterSpecies[p].speciesId===n&&(this.starterMovesets[p]=this.starterMoveset)})}updateButtonIcon(e,t,i,n){var r;let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Cycle_Gender:a="G.png";break;case re.Button_Cycle_Ability:a="E.png";break;case re.Button_Cycle_Nature:a="N.png";break;case re.Button_Cycle_Tera:a="V.png";break;case re.Button_Stats:a="C.png";break}else a=(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setPosition(this.instructionRowX,this.instructionRowY),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),i.setVisible(!0),n.setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=0,this.instructionRowX+=50)}updateFilterButtonIcon(e,t,i,n){var r;let a;t==="touch"?(t="keyboard",a="C.png"):a=(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(e),i.setTexture(t,a),i.setPosition(this.filterInstructionRowX,this.filterInstructionRowY),n.setPosition(this.filterInstructionRowX+this.instructionRowTextOffset,this.filterInstructionRowY),i.setVisible(!0),n.setVisible(!0),this.filterInstructionsContainer.add([i,n]),this.filterInstructionRowY+=8,this.filterInstructionRowY>=24&&(this.filterInstructionRowY=0,this.filterInstructionRowX+=50)}updateInstructions(){var t;this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[_e.GAMEPAD]).padType:e=s.inputMethod,e&&((t=this.speciesStarterDexEntry)!=null&&t.caughtAttr&&(this.canCycleShiny&&this.updateButtonIcon(re.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleForm&&this.updateButtonIcon(re.Button_Cycle_Form,e,this.formIconElement,this.formLabel),this.canCycleGender&&this.updateButtonIcon(re.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel),this.canCycleAbility&&this.updateButtonIcon(re.Button_Cycle_Ability,e,this.abilityIconElement,this.abilityLabel),this.canCycleNature&&this.updateButtonIcon(re.Button_Cycle_Nature,e,this.natureIconElement,this.natureLabel),this.canCycleTera&&this.updateButtonIcon(re.Button_Cycle_Tera,e,this.teraIconElement,this.teraLabel)),this.filterMode||this.updateFilterButtonIcon(re.Button_Stats,e,this.goFilterIconElement,this.goFilterLabel))}getValueLimit(){const e=new rt(0);switch(s.gameMode.modeId){case fe.ENDLESS:case fe.SPLICED_ENDLESS:e.value=15;break;default:e.value=10}return Qi(Zi.STARTER_POINTS,e),e.value}destroy(){this.starterContainers=[]}setCursor(e){var i,n;let t=!1;if(this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else{e=Math.max(Math.min(this.filteredStarterContainers.length-1,e),0),t=super.setCursor(e);const a=Vr(e,this.scrollCursor);this.cursorObj.setPosition(a.x-1,a.y+1);const r=(i=this.filteredStarterContainers[e])==null?void 0:i.species;if(r){const o=this.getCurrentDexProps(r.speciesId),l=s.gameData.getSpeciesDexAttrProps(r,o),h=(n=this.starterPreferences[r.speciesId])!=null&&n.variant?this.starterPreferences[r.speciesId].variant:l.variant,c=dt(h);this.pokemonShinyIcon.setFrame(qt(h)),this.pokemonShinyIcon.setTint(c),this.setSpecies(r),this.updateInstructions()}}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&(this.setSpecies(null),this.updateInstructions()),!0):!1}moveStarterIconsCursor(e){this.starterIconsCursorObj.x=this.starterIcons[e].x+this.starterIconsCursorXOffset,this.starterIconsCursorObj.y=this.starterIcons[e].y+this.starterIconsCursorYOffset,this.starterSpecies.length>0?(this.starterIconsCursorObj.setVisible(!0),this.setSpecies(this.starterSpecies[e])):(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null))}getFriendship(e){let t=s.gameData.starterData[e].friendship;(!t||t===void 0)&&(t=0);const i=Th(Re[e]);return{currentFriendship:t,friendshipCap:i}}setSpecies(e){var i,n,a,r;this.speciesStarterDexEntry=e?s.gameData.dexData[e.speciesId]:null,this.dexAttrCursor=e?this.getCurrentDexProps(e.speciesId):0n,this.abilityCursor=e?s.gameData.getStarterSpeciesDefaultAbilityIndex(e):0,this.natureCursor=e?s.gameData.getSpeciesDefaultNature(e):0,this.teraCursor=e?e.type1:ve.UNKNOWN,!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.pokemonAbilityText.off("pointerover"),this.pokemonPassiveText.off("pointerover");const t=e?{...this.starterPreferences[e.speciesId]}:null;if(t!=null&&t.nature&&(this.natureCursor=t.nature),t!=null&&t.ability&&!Number.isNaN(t.ability)&&(this.abilityCursor=t.ability),t!=null&&t.tera&&(this.teraCursor=t.tera),this.statsMode&&((i=this.speciesStarterDexEntry)!=null&&i.caughtAttr?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),this.lastSpecies){const o=this.getCurrentDexProps(this.lastSpecies.speciesId),l=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,o),h=this.allSpecies.indexOf(this.lastSpecies),c=this.starterContainers[h].icon;this.checkIconId(c,this.lastSpecies,l.female,l.formIndex,l.shiny,l.variant),this.iconAnimHandler.addOrUpdate(c,xt.NONE);const d=this.starterContainers[h].icon;s.tweens.getTweensOf(d).forEach(f=>f.play())}if(this.lastSpecies=e,e&&((n=this.speciesStarterDexEntry)!=null&&n.seenAttr||(a=this.speciesStarterDexEntry)!=null&&a.caughtAttr)){if(this.pokemonNumberText.setText(Is(e.speciesId,4)),t!=null&&t.nickname){const o=decodeURIComponent(escape(atob(t.nickname)));this.pokemonNameText.setText(o)}else this.pokemonNameText.setText(e.name);if((r=this.speciesStarterDexEntry)!=null&&r.caughtAttr){const o=ft[e.speciesId],l=s.gameData.getDexAttrLuck(this.speciesStarterDexEntry.caughtAttr);this.pokemonLuckText.setVisible(!!l),this.pokemonLuckText.setText(l.toString()),this.pokemonLuckText.setTint(dt(Math.min(l-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible);let h=of(Cf[e.growthRate]);const c=h.replace(" ","_");g.exists("growth:"+c)&&(h=g.t("growth:"+c)),this.pokemonGrowthRateText.setText(h),this.pokemonGrowthRateText.setColor(aa(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(aa(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0),this.pokemonUncaughtText.setVisible(!1),this.pokemonAbilityLabelText.setVisible(!0),this.pokemonPassiveLabelText.setVisible(!0),this.pokemonNatureLabelText.setVisible(!0),this.pokemonCaughtCountText.setText(`${this.speciesStarterDexEntry.caughtCount}`),e.speciesId===ge.MANAPHY||e.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame($s(e)),this.pokemonHatchedCountText.setText(`${this.speciesStarterDexEntry.hatchedCount}`);const d=this.getCurrentDexProps(e.speciesId),f=s.gameData.getSpeciesDexAttrProps(e,d),p=f.variant,T=dt(p);if(this.pokemonShinyIcon.setFrame(qt(p)),this.pokemonShinyIcon.setTint(T),this.pokemonShinyIcon.setVisible(f.shiny),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonFormText.setVisible(!0),vt.hasOwnProperty(e.speciesId))this.pokemonCaughtHatchedContainer.setY(16),this.pokemonShinyIcon.setY(135),this.pokemonShinyIcon.setFrame(qt(p)),[this.pokemonCandyContainer,this.pokemonHatchedIcon,this.pokemonHatchedCountText].map(A=>A.setVisible(!1)),this.pokemonFormText.setY(25);else{this.pokemonCaughtHatchedContainer.setY(25),this.pokemonShinyIcon.setY(117),this.pokemonCandyIcon.setTint(Vt(Ot(o[0]))),this.pokemonCandyOverlayIcon.setTint(Vt(Ot(o[1]))),this.pokemonCandyCountText.setText(`x${s.gameData.starterData[e.speciesId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),this.pokemonFormText.setY(42),this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0);const{currentFriendship:A,friendshipCap:w}=this.getFriendship(this.lastSpecies.speciesId),k=16-16*(A/w);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,k),this.pokemonCandyContainer.on("pointerover",()=>{s.ui.showTooltip("",`${A}/${w}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}const m=this.allSpecies.indexOf(e),C=this.starterContainers[m].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(C).forEach(A=>A.pause()),C.x=-2,C.y=2),this.iconAnimHandler.addOrUpdate(C,xt.PASSIVE);const b=this.starterSpecies.indexOf(e);let S;if(b>-1)S=s.gameData.getSpeciesDexAttrProps(e,this.starterAttr[b]),this.setSpeciesDetails(e,{shiny:S.shiny,formIndex:S.formIndex,female:S.female,variant:S.variant,abilityIndex:this.starterAbilityIndexes[b],natureIndex:this.starterNatures[b],teraType:this.starterTeras[b]});else{const A=this.getCurrentDexProps(e.speciesId),w=(t==null?void 0:t.ability)??s.gameData.getStarterSpeciesDefaultAbilityIndex(e),k=(t==null?void 0:t.nature)||s.gameData.getSpeciesDefaultNature(e);S=s.gameData.getSpeciesDexAttrProps(e,A),t!=null&&t.variant&&!Number.isNaN(t.variant)&&S.shiny&&(S.variant=t.variant),S.formIndex=(t==null?void 0:t.form)??S.formIndex,S.female=(t==null?void 0:t.female)??S.female,this.setSpeciesDetails(e,{shiny:S.shiny,formIndex:S.formIndex,female:S.female,variant:S.variant,abilityIndex:w,natureIndex:k})}const x=Rt(e.speciesId,S.formIndex);this.setTypeIcons(x.type1,x.type2),this.pokemonSprite.clearTint(),this.pokerusSpecies.includes(e)&&Rs(zt.Pokerus)}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!0),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1);const o=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),l=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),h=s.gameData.getSpeciesDefaultNature(e),c=s.gameData.getSpeciesDexAttrProps(e,o);this.setSpeciesDetails(e,{shiny:c.shiny,formIndex:c.formIndex,female:c.female,variant:c.variant,abilityIndex:l,natureIndex:h,forSeen:!0}),this.pokemonSprite.setTint(8421504)}}else this.pokemonNumberText.setText(Is(0,4)),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1),this.pokemonShinyIcon.setVisible(!1),this.pokemonUncaughtText.setVisible(!!e),this.pokemonAbilityLabelText.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonNatureLabelText.setVisible(!1),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.teraIcon.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0,abilityIndex:0,natureIndex:0}),this.pokemonSprite.clearTint()}setSpeciesDetails(e,t={}){var C,b,S,x,A,w;let{shiny:i,formIndex:n,female:a,variant:r,abilityIndex:o,natureIndex:l,teraType:h}=t;const c=t.forSeen??!1,d=e?s.gameData.getSpeciesDexAttrProps(e,this.dexAttrCursor):null,f=this.abilityCursor>-1?this.abilityCursor:s.gameData.getStarterSpeciesDefaultAbilityIndex(e),p=this.natureCursor>-1?this.natureCursor:s.gameData.getSpeciesDefaultNature(e);this.dexAttrCursor=0n,this.abilityCursor=-1,this.natureCursor=-1,this.teraCursor=ve.UNKNOWN;const T=(e==null?void 0:e.genderDiffs)&&!Ee(a)||!Ee(n)||!Ee(i)||!Ee(r);if(this.activeTooltip==="CANDY")if(this.lastSpecies&&this.pokemonCandyContainer.visible){const{currentFriendship:k,friendshipCap:B}=this.getFriendship(this.lastSpecies.speciesId);s.ui.editTooltip("",`${k}/${B}`)}else s.ui.hideTooltip();if((C=e==null?void 0:e.forms)!=null&&C.find(k=>k.formKey==="female")&&(a!==void 0?n=a?1:0:n!==void 0&&(a=n===1)),e){this.dexAttrCursor|=(i!==void 0?!i:!(i=d==null?void 0:d.shiny))?V.NON_SHINY:V.SHINY,this.dexAttrCursor|=(a!==void 0?!a:!(a=d==null?void 0:d.female))?V.MALE:V.FEMALE,this.dexAttrCursor|=(r!==void 0?!r:!(r=d==null?void 0:d.variant))?V.DEFAULT_VARIANT:r===1?V.VARIANT_2:V.VARIANT_3,this.dexAttrCursor|=s.gameData.getFormAttr(n!==void 0?n:n=d.formIndex),this.abilityCursor=o!==void 0?o:o=f,this.natureCursor=l!==void 0?l:l=p,this.teraCursor=Ee(h)?h=e.type1:h;const[k,B]=this.isInParty(e);k&&this.updatePartyIcon(e,B)}if(this.pokemonSprite.setVisible(!1),this.pokemonPassiveLabelText.setVisible(!1),this.pokemonPassiveText.setVisible(!1),this.pokemonPassiveDisabledIcon.setVisible(!1),this.pokemonPassiveLockedIcon.setVisible(!1),this.teraIcon.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),this.starterMoveset=null,this.speciesStarterMoves=[],e){const k=s.gameData.dexData[e.speciesId],B=s.gameData.starterData[e.speciesId].abilityAttr,X=((b=s.gameData.dexData[e.speciesId])==null?void 0:b.caughtAttr)||BigInt(0);if(!k.caughtAttr){const L=s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)),Q=s.gameData.getStarterSpeciesDefaultAbilityIndex(e),te=s.gameData.getSpeciesDefaultNature(e);(i===void 0||i!==L.shiny)&&(i=L.shiny),(n===void 0||n!==L.formIndex)&&(n=L.formIndex),(a===void 0||a!==L.female)&&(a=L.female),(r===void 0||r!==L.variant)&&(r=L.variant),(o===void 0||o!==Q)&&(o=Q),(l===void 0||l!==te)&&(l=te)}if(this.shinyOverlay.setVisible(i??!1),this.pokemonNumberText.setColor(this.getTextColor(i?O.SUMMARY_GOLD:O.SUMMARY,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(i?O.SUMMARY_GOLD:O.SUMMARY,!0)),c?(S=this.speciesStarterDexEntry)!=null&&S.seenAttr:(x=this.speciesStarterDexEntry)!=null&&x.caughtAttr){const L=this.starterSpecies.indexOf(e);L>-1&&(this.starterAttr[L]=this.dexAttrCursor,this.starterAbilityIndexes[L]=this.abilityCursor,this.starterNatures[L]=this.natureCursor,this.starterTeras[L]=this.teraCursor);const Q=new at(!1);this.assetLoadCancelled=Q,T?e.loadAssets(a,n,i,r,!0).then(()=>{Q.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setPipelineData("shiny",i),this.pokemonSprite.setPipelineData("variant",r),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setVisible(!this.statsMode))}):this.pokemonSprite.setVisible(!this.statsMode);const te=this.filteredStarterContainers.find(Y=>Y.species.speciesId===e.speciesId);te&&(te.icon.setTexture(e.getIconAtlasKey(n,i,r),e.getIconId(a,n,i,r)),te.checkIconId(a,n,i,r));const P=!!(X&V.NON_SHINY),H=!!(X&V.SHINY),v=[V.DEFAULT_VARIANT,V.VARIANT_2,V.VARIANT_3].filter(Y=>X&Y);this.canCycleShiny=P&&H||H&&v.length>1;const F=!!(X&V.MALE),pe=!!(X&V.FEMALE);this.canCycleGender=F&&pe;const z=B&Ze.ABILITY_1;let ce=B&Ze.ABILITY_2;const $=B&Ze.ABILITY_HIDDEN;z&&ce&&e.ability1===e.ability2&&(ce=0),this.canCycleAbility=[z,ce,$].filter(Y=>Y).length>1,this.canCycleForm=e.forms.filter(Y=>{var W;return Y.isStarterSelectable||!((W=Zs[e.speciesId])!=null&&W.find(R=>R.formKey))}).map((Y,W)=>k.caughtAttr&s.gameData.getFormAttr(W)).filter(Y=>Y).length>1,this.canCycleNature=s.gameData.getNaturesForAttr(k.natureAttr).length>1,this.canCycleTera=!this.statsMode&&s.gameData.achvUnlocks.hasOwnProperty(Ae.TERASTALLIZE.id)&&!Ee(Rt(e.speciesId,n??0).type2)}if(k.caughtAttr&&e.malePercent!==null){const L=a?At.FEMALE:At.MALE;this.pokemonGenderText.setText(Ch(L)),this.pokemonGenderText.setColor(yi(L)),this.pokemonGenderText.setShadowColor(yi(L,!0))}else this.pokemonGenderText.setText("");if(k.caughtAttr){let L;((A=this.lastSpecies.forms)==null?void 0:A.length)>1?L=gt[this.lastSpecies.forms[n??0].getAbility(o)]:L=gt[this.lastSpecies.getAbility(o)],this.pokemonAbilityText.setText(L.name);const Q=o===(this.lastSpecies.ability2?2:1);this.pokemonAbilityText.setColor(this.getTextColor(Q?O.SUMMARY_GOLD:O.SUMMARY_ALT)),this.pokemonAbilityText.setShadowColor(this.getTextColor(Q?O.SUMMARY_GOLD:O.SUMMARY_ALT,!0));const te=s.gameData.starterData[e.speciesId].passiveAttr,P=gt[this.lastSpecies.getPassiveAbility(n)];if(this.pokemonAbilityText.visible&&(this.activeTooltip==="ABILITY"&&s.ui.editTooltip(`${L.name}`,`${L.description}`),this.pokemonAbilityText.on("pointerover",()=>{s.ui.showTooltip(`${L.name}`,`${L.description}`,!0),this.activeTooltip="ABILITY"}),this.pokemonAbilityText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})),P){const $=!!(te&yt.UNLOCKED),Y=!!(te&yt.ENABLED),W=$&&Y?O.SUMMARY_ALT:O.SUMMARY_GRAY,R=$&&Y?1:.5;this.pokemonPassiveLabelText.setVisible(!0),this.pokemonPassiveLabelText.setColor(this.getTextColor(O.SUMMARY_ALT)),this.pokemonPassiveLabelText.setShadowColor(this.getTextColor(O.SUMMARY_ALT,!0)),this.pokemonPassiveText.setVisible(!0),this.pokemonPassiveText.setText(P.name),this.pokemonPassiveText.setColor(this.getTextColor(W)),this.pokemonPassiveText.setAlpha(R),this.pokemonPassiveText.setShadowColor(this.getTextColor(W,!0)),this.activeTooltip==="PASSIVE"&&s.ui.editTooltip(`${P.name}`,`${P.description}`),this.pokemonPassiveText.visible&&(this.pokemonPassiveText.on("pointerover",()=>{s.ui.showTooltip(`${P.name}`,`${P.description}`,!0),this.activeTooltip="PASSIVE"}),this.pokemonPassiveText.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0}));const he={x:this.pokemonPassiveText.x+this.pokemonPassiveText.displayWidth+1,y:this.pokemonPassiveText.y+this.pokemonPassiveText.displayHeight/2};this.pokemonPassiveDisabledIcon.setVisible($&&!Y),this.pokemonPassiveDisabledIcon.setPosition(he.x,he.y),this.pokemonPassiveLockedIcon.setVisible(!$),this.pokemonPassiveLockedIcon.setPosition(he.x,he.y)}else this.activeTooltip==="PASSIVE"&&s.ui.hideTooltip();this.pokemonNatureText.setText(Ti(l,!0,!0,!1,s.uiTheme));let H;if(fs.hasOwnProperty(e.speciesId)&&n&&fs[e.speciesId].hasOwnProperty(n)?H=fs[e.speciesId][n]:H=ra[e.speciesId],this.speciesStarterMoves.push(...H.filter($=>$[0]>0&&$[0]<=5).map($=>$[1])),wt.hasOwnProperty(e.speciesId))for(let $=0;$<4;$++)s.gameData.starterData[e.speciesId].eggMoves&1<<$&&this.speciesStarterMoves.push(wt[e.speciesId][$]);const v=s.gameData.starterData[e.speciesId].moveset,F=v?Array.isArray(v)?v:v[n]:null,pe=this.speciesStarterMoves.concat(wt.hasOwnProperty(e.speciesId)?wt[e.speciesId].filter(($,Y)=>s.gameData.starterData[e.speciesId].eggMoves&1<<Y):[]);this.starterMoveset=(F||this.speciesStarterMoves.slice(0,4)).filter($=>pe.find(Y=>Y===$)),this.starterMoveset.length<4&&this.starterMoveset.length<pe.length&&this.starterMoveset.push(...pe.filter($=>{var Y;return((Y=this.starterMoveset)==null?void 0:Y.indexOf($))===-1}).slice(0,4-this.starterMoveset.length)),this.starterMoveset=this.starterMoveset.filter(($,Y)=>{var W;return((W=this.starterMoveset)==null?void 0:W.indexOf($))===Y});const z=Rt(e.speciesId,n),ce=e.getFormNameToDisplay(n);this.pokemonFormText.setText(ce),this.setTypeIcons(z.type1,z.type2),this.teraIcon.setFrame(ve[this.teraCursor].toLowerCase()),this.teraIcon.setVisible(!this.statsMode&&s.gameData.achvUnlocks.hasOwnProperty(Ae.TERASTALLIZE.id))}else this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(O.SUMMARY)),this.pokemonNumberText.setShadowColor(this.getTextColor(O.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.pokemonAbilityText.setText(""),this.pokemonPassiveText.setText(""),this.pokemonNatureText.setText(""),this.teraIcon.setVisible(!1),this.setTypeIcons(null,null);this.starterMoveset||(this.starterMoveset=this.speciesStarterMoves.slice(0,4));for(let k=0;k<4;k++){const B=k<this.starterMoveset.length?Ne[this.starterMoveset[k]]:null;this.pokemonMoveBgs[k].setFrame(ve[B?B.type:ve.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[k].setText(B?B.name:"-"),this.pokemonMoveContainers[k].setVisible(!!B)}const m=e&&wt.hasOwnProperty(e.speciesId);for(let k=0;k<4;k++){const B=m?Ne[wt[e.speciesId][k]]:null,X=B&&s.gameData.starterData[e.speciesId].eggMoves&1<<k;this.pokemonEggMoveBgs[k].setFrame(ve[B?B.type:ve.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[k].setText(B&&X?B.name:"???")}this.pokemonEggMovesContainer.setVisible(!!((w=this.speciesStarterDexEntry)!=null&&w.caughtAttr)&&m),this.pokemonAdditionalMoveCountLabel.setText(`(+${Math.max(this.speciesStarterMoves.length-4,0)})`),this.pokemonAdditionalMoveCountLabel.setVisible(this.speciesStarterMoves.length>4),this.tryUpdateValue(),this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(ve[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(ve[t].toLowerCase())):this.type2Icon.setVisible(!1)}popStarter(e){this.starterSpecies.splice(e,1),this.starterAttr.splice(e,1),this.starterAbilityIndexes.splice(e,1),this.starterNatures.splice(e,1),this.starterTeras.splice(e,1),this.starterMovesets.splice(e,1);for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=this.getCurrentDexProps(i.speciesId),a=s.gameData.getSpeciesDexAttrProps(i,n);this.starterIcons[t].setTexture(i.getIconAtlasKey(a.formIndex,a.shiny,a.variant)),this.starterIcons[t].setFrame(i.getIconId(a.female,a.formIndex,a.shiny,a.variant)),this.checkIconId(this.starterIcons[t],i,a.female,a.formIndex,a.shiny,a.variant),t>=e&&(this.starterCursorObjs[t].setPosition(this.starterCursorObjs[t+1].x,this.starterCursorObjs[t+1].y),this.starterCursorObjs[t].setVisible(this.starterCursorObjs[t+1].visible))}this.starterCursorObjs[this.starterSpecies.length].setVisible(!1),this.starterIcons[this.starterSpecies.length].setTexture("pokemon_icons_0"),this.starterIcons[this.starterSpecies.length].setFrame("unknown"),this.starterIconsCursorObj.visible?(this.starterIconsCursorIndex===this.starterSpecies.length&&(this.starterSpecies.length>0?this.starterIconsCursorIndex--:(this.starterIconsCursorObj.setVisible(!1),this.setSpecies(null),this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.moveStarterIconsCursor(this.starterIconsCursorIndex)):this.startCursorObj.visible&&this.starterSpecies.length===0&&(this.startCursorObj.setVisible(!1),this.filteredStarterContainers.length>0?(this.cursorObj.setVisible(!0),this.setCursor(0+this.scrollCursor*9)):(this.filterBarCursor=Math.max(1,this.filterBar.numFilters-1),this.setFilterMode(!0))),this.tryUpdateValue()}updateStarterValueLabel(e){const t=e.species.speciesId,i=Re[t],n=s.gameData.getSpeciesStarterValue(t);e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=O.WINDOW;break;case 1:case .5:r=O.SUMMARY_BLUE;break;default:r=O.SUMMARY_GOLD;break}i-n>0&&(e.label.setColor(this.getTextColor(r)),e.label.setShadowColor(this.getTextColor(r,!0)))}tryUpdateValue(e,t){const n=this.starterSpecies.map(c=>c.generation).reduce((c,d,f)=>c+=s.gameData.getSpeciesStarterValue(this.starterSpecies[f].speciesId),0)+(e||0),a=this.getValueLimit(),r=n>a;let o=n.toString();if(o.startsWith("0.")&&(o=o.slice(1)),this.valueLimitLabel.setText(`${o}/${a}`),this.valueLimitLabel.setColor(this.getTextColor(r?O.SUMMARY_PINK:O.TOOLTIP_CONTENT)),this.valueLimitLabel.setShadowColor(this.getTextColor(r?O.SUMMARY_PINK:O.TOOLTIP_CONTENT,!0)),r)return s.time.delayedCall(de(500),()=>this.tryUpdateValue()),!1;let l=this.isPartyValid();if(t){const c=this.filteredStarterContainers[this.cursor].species,d=Ys(c,s.gameData.getSpeciesDexAttrProps(c,this.getCurrentDexProps(c.speciesId)),!1);l=l||d}const h=a-n;for(let c=0;c<this.allSpecies.length;c++){const d=s.gameData.getSpeciesStarterValue(this.allSpecies[c].speciesId),f=this.starterContainers[c].icon,p=Ys(this.allSpecies[c],s.gameData.getSpeciesDexAttrProps(this.allSpecies[c],this.getCurrentDexProps(this.allSpecies[c].speciesId)),l),T=h>=d&&p,m=this.isInParty(this.allSpecies[c])[0];T||m&&h>=d?f.setAlpha(1):f.setAlpha(.375)}return!0}tryExit(){this.blockInput=!0;const e=this.getUi(),t=u(()=>{e.setMode(_.STARTER_SELECT),this.clearText(),this.blockInput=!1},"cancel");return e.showText(g.t("starterSelectUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(_.CONFIRM,()=>{var i;e.setMode(_.STARTER_SELECT),s.phaseManager.clearPhaseQueue(),s.gameMode.isChallenge?(s.phaseManager.pushNew("SelectChallengePhase"),s.phaseManager.pushNew("EncounterPhase")):s.phaseManager.pushNew("TitlePhase"),this.clearText(),(i=s.phaseManager.getCurrentPhase())==null||i.end()},t,null,null,19)}),!0}tryStart(e=!1){if(!this.starterSpecies.length)return!1;const t=this.getUi(),i=u(()=>{t.setMode(_.STARTER_SELECT),e||this.popStarter(this.starterSpecies.length-1),this.clearText()},"cancel");return this.isPartyValid()?t.showText(g.t("starterSelectUiHandler:confirmStartTeam"),null,()=>{t.setModeWithoutClear(_.CONFIRM,()=>{u(()=>{s.money=s.gameMode.getStartingMoney(),t.setMode(_.STARTER_SELECT);const r=this,o=this.starterSelectCallback;this.starterSelectCallback=null,o==null||o(new Array(this.starterSpecies.length).fill(0).map((l,h)=>{var d;const c=r.starterSpecies[h];return{species:c,dexAttr:r.starterAttr[h],abilityIndex:r.starterAbilityIndexes[h],passive:!(s.gameData.starterData[c.speciesId].passiveAttr^(yt.ENABLED|yt.UNLOCKED)),nature:r.starterNatures[h],teraType:r.starterTeras[h],moveset:r.starterMovesets[h],pokerus:r.pokerusSpecies.includes(c),nickname:(d=r.starterPreferences[c.speciesId])==null?void 0:d.nickname}}))},"startRun")()},i,null,null,19)}):(this.tutorialActive=!0,this.showText(g.t("starterSelectUiHandler:invalidParty"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),void 0,!0)),!0}isPartyValid(){let e=!1;for(let t=0;t<this.starterSpecies.length;t++){const i=this.starterSpecies[t],n=Ys(i,s.gameData.getSpeciesDexAttrProps(i,this.getCurrentDexProps(i.speciesId)),!1);e=e||n}return e}getCurrentDexProps(e){var n,a,r,o,l,h,c;let t=0n;const i=s.gameData.dexData[e].caughtAttr;return(n=this.starterPreferences[e])!=null&&n.female||(i&V.FEMALE)>0n&&(i&V.MALE)===0n?t+=V.FEMALE:t+=V.MALE,(a=this.starterPreferences[e])!=null&&a.shiny||(i&V.SHINY)>0n&&((r=this.starterPreferences[e])==null?void 0:r.shiny)!==!1?(t+=V.SHINY,((o=this.starterPreferences[e])==null?void 0:o.variant)!==void 0?t+=BigInt(Math.pow(2,(l=this.starterPreferences[e])==null?void 0:l.variant))*V.DEFAULT_VARIANT:(i&V.VARIANT_3)>0?t+=V.VARIANT_3:(i&V.VARIANT_2)>0?t+=V.VARIANT_2:t+=V.DEFAULT_VARIANT):(t+=V.NON_SHINY,t+=V.DEFAULT_VARIANT),(h=this.starterPreferences[e])!=null&&h.form?t+=BigInt(Math.pow(2,(c=this.starterPreferences[e])==null?void 0:c.form))*V.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(i)),t}toggleStatsMode(e){var t;if(e===void 0&&(e=!this.statsMode),e)this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1),this.teraIcon.setVisible(!1),this.canCycleTera=!1,this.updateInstructions();else{this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!!((t=this.speciesStarterDexEntry)!=null&&t.caughtAttr)),this.statsContainer.updateIvs(null),this.teraIcon.setVisible(s.gameData.achvUnlocks.hasOwnProperty(Ae.TERASTALLIZE.id));const n=s.gameData.getSpeciesDexAttrProps(this.lastSpecies,this.getCurrentDexProps(this.lastSpecies.speciesId)).formIndex;this.canCycleTera=!this.statsMode&&s.gameData.achvUnlocks.hasOwnProperty(Ae.TERASTALLIZE.id)&&!Ee(Rt(this.lastSpecies.speciesId,n??0).type2),this.updateInstructions()}}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.abilityIconElement.setVisible(!1),this.abilityLabel.setVisible(!1),this.natureIconElement.setVisible(!1),this.natureLabel.setVisible(!1),this.teraIconElement.setVisible(!1),this.teraLabel.setVisible(!1),this.goFilterIconElement.setVisible(!1),this.goFilterLabel.setVisible(!1)}clear(){for(super.clear(),Dg(this.starterPreferences),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1;this.starterSpecies.length;)this.popStarter(this.starterSpecies.length-1);this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}clearStarterPreferences(){this.starterPreferences={}}};u(zh,"StarterSelectUiHandler");let rn=zh;const jh=class jh extends _t{constructor(){super(_.EVOLUTION_SCENE)}setup(){this.canCancel=!1,this.cancelled=!1;const e=this.getUi();this.evolutionContainer=s.add.container(0,-s.game.canvas.height/6);const t=s.add.sprite(0,0,"bg",s.windowType).setOrigin(0,1).setVisible(!1);this.messageBg=t,this.messageContainer=s.add.container(12,-39).setVisible(!1);const i=D(0,0,"",O.MESSAGE,{maxLines:2,wordWrap:{width:1780}});this.messageContainer.add(i),e.add([this.evolutionContainer,this.messageBg,this.messageContainer]),this.message=i,this.initPromptSprite(this.messageContainer)}show(e){return super.show(e),s.ui.bringToTop(this.evolutionContainer),s.ui.bringToTop(this.messageBg.setVisible(!0)),s.ui.bringToTop(this.messageContainer.setVisible(!0)),!0}processInput(e){if(this.canCancel&&!this.cancelled&&e===I.CANCEL)return this.cancelled=!0,!0;const t=this.getUi();if(this.awaitingActionInput&&(e===I.CANCEL||e===I.ACTION)&&this.onActionInput){t.playSelect();const i=this.onActionInput;return this.onActionInput=null,i(),!0}return!1}setCursor(e){return!1}clear(){this.clearText(),this.canCancel=!1,this.cancelled=!1,this.evolutionContainer.removeAll(!0),this.messageContainer.setVisible(!1),this.messageBg.setVisible(!1)}};u(jh,"EvolutionSceneHandler");let pa=jh;const $h=class $h extends ts{constructor(){super(_.TARGET_SELECT),this.isMultipleTargets=!1,this.targetBattleInfoMoveTween=[],this.cursor=-1}setup(){}show(e){if(e.length<3)return!1;super.show(e),this.fieldIndex=e[0],this.move=e[1],this.targetSelectCallback=e[2];const t=s.getPlayerField()[this.fieldIndex],i=Sh(t,this.move);return this.targets=i.targets,this.isMultipleTargets=i.multiple??!1,this.targets.length?(this.enemyModifiers=s.getModifierBar(!0),this.fieldIndex===tt.PLAYER?this.resetCursor(this.cursor0,t):this.fieldIndex===tt.PLAYER_2&&this.resetCursor(this.cursor1,t),!0):!1}resetCursor(e,t){Ee(e)||([tt.PLAYER,tt.PLAYER_2].includes(e)||t.tempSummonData.waveTurnCount===1)&&(e=-1),this.setCursor(this.targets.includes(e)?e:this.targets[0])}processInput(e){const t=this.getUi();let i=!1;if(e===I.ACTION||e===I.CANCEL){const n=this.isMultipleTargets?this.targets:[this.cursor];this.targetSelectCallback(e===I.ACTION?n:[]),i=!0,this.fieldIndex===tt.PLAYER?(Ee(this.cursor0)||this.cursor0!==this.cursor)&&(this.cursor0=this.cursor):this.fieldIndex===tt.PLAYER_2&&(Ee(this.cursor1)||this.cursor1!==this.cursor)&&(this.cursor1=this.cursor)}else if(this.isMultipleTargets)i=!1;else switch(e){case I.UP:this.cursor<tt.ENEMY&&this.targets.findIndex(n=>n>=tt.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n>=tt.ENEMY)));break;case I.DOWN:this.cursor>=tt.ENEMY&&this.targets.findIndex(n=>n<tt.ENEMY)>-1&&(i=this.setCursor(this.targets.find(n=>n<tt.ENEMY)));break;case I.LEFT:this.cursor%2&&this.targets.findIndex(n=>n===this.cursor-1)>-1&&(i=this.setCursor(this.cursor-1));break;case I.RIGHT:!(this.cursor%2)&&this.targets.findIndex(n=>n===this.cursor+1)>-1&&(i=this.setCursor(this.cursor+1));break}return i&&t.playSelect(),i}setCursor(e){const t=s.getField()[e],i=this.targets.map(r=>s.getField()[r]);this.targetsHighlighted=this.isMultipleTargets?i:[t];const n=super.setCursor(e);if(this.targetFlashTween){this.targetFlashTween.stop();for(const r of i)r.setAlpha(r.getTag(gs)?.5:1),this.highlightItems(r.id,1)}if(this.targetFlashTween=s.tweens.add({targets:this.targetsHighlighted,key:{start:1,to:.25},loop:-1,loopDelay:150,duration:de(450),ease:"Sine.easeInOut",yoyo:!0,onUpdate:u(r=>{for(const o of this.targetsHighlighted)o.setAlpha(r.getValue()),this.highlightItems(o.id,r.getValue())},"onUpdate")}),this.targetBattleInfoMoveTween.length>=1){this.targetBattleInfoMoveTween.filter(r=>r!==void 0).forEach(r=>r.stop());for(const r of i)r.getBattleInfo().resetY()}return this.targetsHighlighted.map(r=>r.getBattleInfo()).map(r=>{this.targetBattleInfoMoveTween.push(s.tweens.add({targets:[r],y:{start:r.getBaseY(),to:r.getBaseY()+1},loop:-1,duration:de(250),ease:"Linear",yoyo:!0}))}),n}eraseCursor(){this.targetFlashTween&&(this.targetFlashTween.stop(),this.targetFlashTween=null);for(const e of this.targetsHighlighted)e.setAlpha(e.getTag(gs)?.5:1),this.highlightItems(e.id,1);this.targetBattleInfoMoveTween.length>=1&&(this.targetBattleInfoMoveTween.filter(e=>e!==void 0).forEach(e=>e.stop()),this.targetBattleInfoMoveTween=[]);for(const e of this.targetsHighlighted)e.getBattleInfo().resetY()}highlightItems(e,t){const i=this.enemyModifiers.getAll("name",e.toString());for(const n of i)n.setAlpha(t)}clear(){super.clear(),this.eraseCursor()}};u($h,"TargetSelectUiHandler");let Hr=$h;const Yr="LEFT",Qf="RIGHT",zs=class zs{constructor(){this.selectedMode=_.SETTINGS,this.navigationMenus=new Array,this.modes=[_.SETTINGS,_.SETTINGS_DISPLAY,_.SETTINGS_AUDIO,_.SETTINGS_GAMEPAD,_.SETTINGS_KEYBOARD],this.labels=[g.t("settings:general"),g.t("settings:display"),g.t("settings:audio"),g.t("settings:gamepad"),g.t("settings:keyboard")]}reset(){this.selectedMode=_.SETTINGS,this.updateNavigationMenus()}static getInstance(){return zs.instance||(zs.instance=new zs),zs.instance}navigate(e){const t=this.modes.indexOf(this.selectedMode),i=this.modes.length-1,n=e===Yr?-1:1;t===0&&e===Yr?this.selectedMode=this.modes[i]:t===i&&e===Qf?this.selectedMode=this.modes[0]:this.selectedMode=this.modes[t+n],s.ui.setMode(this.selectedMode),this.updateNavigationMenus()}updateNavigationMenus(){for(const e of this.navigationMenus)e.update()}updateIcons(){for(const e of this.navigationMenus)e.updateIcons()}clearNavigationMenus(){this.navigationMenus.length=0}};u(zs,"NavigationManager");let jt=zs;const Xh=class Xh extends Phaser.GameObjects.Container{constructor(e,t){super(s,e,t),this.headerTitles=new Array,this.setup()}setup(){const e=jt.getInstance(),t=me(0,0,s.game.canvas.width/6-2,24);t.setOrigin(0,0),this.add(t),this.width=t.width,this.height=t.height,this.navigationIcons={};const i=s.add.sprite(8,4,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,8,4),this.navigationIcons.BUTTON_CYCLE_FORM=i;const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(t,t.width-20,4),this.navigationIcons.BUTTON_CYCLE_SHINY=n;let a=i,r=i.width*6;for(const o of e.labels){const l=D(0,0,o,O.SETTINGS_LABEL);l.setOrigin(0,0),l.setPositionRelative(a,6+r/6,0),this.add(l),this.headerTitles.push(l),a=l,r=l.width}this.add(i),this.add(n),e.navigationMenus.push(this),e.updateNavigationMenus()}update(){const e=jt.getInstance(),t=e.modes.indexOf(e.selectedMode);for(const[i,n]of this.headerTitles.entries())Bg(n,i===t?O.SETTINGS_SELECTED:O.SETTINGS_LABEL)}updateIcons(){var t,i;const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const n of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(n)){this.navigationIcons[n].setTexture("keyboard"),this.navigationIcons[n].setFrame(e[n]),this.navigationIcons[n].alpha=1;continue}const a=(t=s.inputController)==null?void 0:t.getIconForLatestInputRecorded(n);if(a){const r=(i=s.inputController)==null?void 0:i.getLastSourceType();this.navigationIcons[n].setTexture(r),this.navigationIcons[n].setFrame(a),this.navigationIcons[n].alpha=1}else this.navigationIcons[n].alpha=0}}navigate(e){const t=jt.getInstance();switch(e){case I.CYCLE_FORM:return t.navigate(Yr),!0;case I.CYCLE_SHINY:return t.navigate(Qf),!0}return!1}};u(Xh,"NavigationMenu");let fa=Xh;const qh=class qh extends _t{constructor(e,t=null){super(t),this.settings=Ar.filter(i=>{var n;return i.type===e&&!((n=i==null?void 0:i.isHidden)!=null&&n.call(i))}),this.reloadRequired=!1,this.rowsToDisplay=8}setup(){const e=this.getUi();this.settingsContainer=s.add.container(1,-(s.game.canvas.height/6)+1),this.settingsContainer.setName(`settings-${this.title}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6-20),Phaser.Geom.Rectangle.Contains),this.navigationIcons={},this.navigationContainer=new fa(0,0),this.optionsBg=me(0,this.navigationContainer.height,s.game.canvas.width/6-2,s.game.canvas.height/6-16-this.navigationContainer.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const t=me(0,s.game.canvas.height/6-this.navigationContainer.height,s.game.canvas.width/6-2,22);t.setOrigin(0,0);const i=s.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(t,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=i;const n=D(0,0,g.t("settings:action"),O.SETTINGS_LABEL);n.setOrigin(0,.15),n.setPositionRelative(i,-n.width/6-2,0);const a=s.add.sprite(0,0,"keyboard");a.setOrigin(0,-.1),a.setPositionRelative(t,n.x-28,4),this.navigationIcons.BUTTON_CANCEL=a;const r=D(0,0,g.t("settings:back"),O.SETTINGS_LABEL);r.setOrigin(0,.15),r.setPositionRelative(a,-r.width/6-2,0),this.optionsContainer=s.add.container(0,0),this.settingLabels=[],this.optionValueLabels=[],this.reloadSettings=this.settings.filter(c=>c==null?void 0:c.requireReload);let o=!1;this.settings.forEach((c,d)=>{let f=c.label;c!=null&&c.requireReload&&(f+="*",o=!0),this.settingLabels[d]=D(8,28+d*16,f,O.SETTINGS_LABEL),this.settingLabels[d].setOrigin(0,0),this.optionsContainer.add(this.settingLabels[d]),this.optionValueLabels.push(c.options.map((S,x)=>{const A=D(0,0,S.label,c.default===x?O.SETTINGS_SELECTED:O.SETTINGS_VALUE);return A.setOrigin(0,0),this.optionsContainer.add(A),A}));const p=this.optionValueLabels[d].map(S=>S.width).reduce((S,x)=>S+=x,0),T=Math.max(78,this.settingLabels[d].displayWidth+8),m=297-T-p/6,C=Math.floor(m/(this.optionValueLabels[d].length-1));let b=0;for(const S of this.optionValueLabels[d])S.setPositionRelative(this.settingLabels[d],T+b,0),b+=S.width/6+C}),this.optionCursors=this.settings.map(c=>c.default),this.scrollBar=new ys(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.scrollBar.setTotalRows(this.settings.length),this.messageBoxContainer=s.add.container(0,s.scaledCanvas.height),this.messageBoxContainer.setName("settings-message-box"),this.messageBoxContainer.setVisible(!1);const l=me(0,-1,s.scaledCanvas.width-2,48);l.setOrigin(0,1),this.messageBoxContainer.add(l);const h=D(8,-40,"",O.WINDOW,{maxLines:2});if(h.setWordWrapWidth(s.game.canvas.width-60),h.setName("settings-message"),h.setOrigin(0,0),this.messageBoxContainer.add(h),this.message=h,this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.scrollBar),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(this.optionsContainer),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(n),o){const c=D(0,0,`*${g.t("settings:requireReload")}`,O.SETTINGS_LABEL).setOrigin(0,.15).setPositionRelative(t,6,0).setY(n.y);this.settingsContainer.add(c)}this.settingsContainer.add(r),this.settingsContainer.add(this.messageBoxContainer),e.add(this.settingsContainer),this.setCursor(0),this.setScrollCursor(0),this.settingsContainer.setVisible(!1)}updateBindings(){var e,t;for(const i of Object.keys(this.navigationIcons)){if(i==="BUTTON_HOME"){this.navigationIcons[i].setTexture("keyboard"),this.navigationIcons[i].setFrame("HOME.png"),this.navigationIcons[i].alpha=1;continue}const n=(e=s.inputController)==null?void 0:e.getIconForLatestInputRecorded(i);if(n){const a=(t=s.inputController)==null?void 0:t.getLastSourceType();this.navigationIcons[i].setTexture(a),this.navigationIcons[i].setFrame(n),this.navigationIcons[i].alpha=1}else this.navigationIcons[i].alpha=0}jt.getInstance().updateIcons()}show(e){super.show(e),this.updateBindings();const t=localStorage.hasOwnProperty(this.localStorageKey)?JSON.parse(localStorage.getItem(this.localStorageKey)):{};return this.settings.forEach((i,n)=>this.setOptionCursor(n,t.hasOwnProperty(i.key)?t[i.key]:this.settings[n].default)),this.settingsContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}processInput(e){const t=this.getUi();let i=!1;if(e===I.CANCEL)i=!0,jt.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor;switch(e){case I.UP:if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const r=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=r&&o}break;case I.DOWN:if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const r=this.setCursor(0),o=this.setScrollCursor(0);i=r&&o}break;case I.LEFT:this.optionCursors[n]&&(i=this.setOptionCursor(n,this.optionCursors[n]-1,!0));break;case I.RIGHT:this.optionCursors[n]<this.optionValueLabels[n].length-1&&(i=this.setOptionCursor(n,this.optionCursors[n]+1,!0));break;case I.CYCLE_FORM:case I.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break;case I.ACTION:const a=this.settings[n];a!=null&&a.activatable&&(i=this.activateSetting(a));break}}return i&&t.playSelect(),i}activateSetting(e){switch(e.key){case ms.Move_Touch_Controls:return s.inputController.moveTouchControlsHandler.enableConfigurationMode(this.getUi()),!0}return!1}setCursor(e){const t=super.setCursor(e);if(!this.cursorObj){const i=s.game.canvas.width/6-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setOptionCursor(e,t,i){e===-1&&(e=this.cursor+this.scrollCursor);const n=this.settings[e],a=this.optionCursors[e],r=this.optionValueLabels[e][a];r.setColor(this.getTextColor(O.SETTINGS_VALUE)),r.setShadowColor(this.getTextColor(O.SETTINGS_VALUE,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];if(o.setColor(this.getTextColor(O.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(O.SETTINGS_SELECTED,!0)),i){const l=u(()=>{s.gameData.saveSetting(n.key,t),n.requireReload&&(this.reloadRequired=!0)},"saveSetting");if(n.options[t].needConfirmation){const h=u(()=>{s.ui.revertMode(),this.showText(""),l()},"confirmUpdateSetting"),c=u(()=>{s.ui.revertMode(),this.showText(""),this.setOptionCursor(e,a,!1)},"cancelUpdateSetting"),d=n.options[t].confirmationMessage??g.t("settings:defaultConfirmMessage");s.ui.showText(d,null,()=>{s.ui.setOverlayMode(_.CONFIRM,h,c,null,null,1,750)})}else l()}return!0}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}updateSettingsScroll(){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.getUi().bgmBar.toggleBgmBar(s.showBgmBar),this.reloadRequired&&(this.reloadRequired=!1,s.reset(!0,!1,!0))}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}showText(e,t,i,n,a,r){this.messageBoxContainer.setVisible(!!(e!=null&&e.length)),super.showText(e,t,i,n,a,r)}};u(qh,"AbstractSettingsUiHandler");let on=qh;const Qh=class Qh extends on{constructor(e=null){super(bh.GENERAL,e),this.title="General",this.localStorageKey="settings"}};u(Qh,"SettingsUiHandler");let ga=Qh;var G=(y=>(y.Controller="CONTROLLER",y.Gamepad_Support="GAMEPAD_SUPPORT",y.Button_Up="BUTTON_UP",y.Button_Down="BUTTON_DOWN",y.Button_Left="BUTTON_LEFT",y.Button_Right="BUTTON_RIGHT",y.Button_Action="BUTTON_ACTION",y.Button_Cancel="BUTTON_CANCEL",y.Button_Menu="BUTTON_MENU",y.Button_Stats="BUTTON_STATS",y.Button_Cycle_Form="BUTTON_CYCLE_FORM",y.Button_Cycle_Shiny="BUTTON_CYCLE_SHINY",y.Button_Cycle_Gender="BUTTON_CYCLE_GENDER",y.Button_Cycle_Ability="BUTTON_CYCLE_ABILITY",y.Button_Cycle_Nature="BUTTON_CYCLE_NATURE",y.Button_Cycle_Tera="BUTTON_CYCLE_TERA",y.Button_Speed_Up="BUTTON_SPEED_UP",y.Button_Slow_Down="BUTTON_SLOW_DOWN",y.Button_Submit="BUTTON_SUBMIT",y))(G||{});const Ct=g.t("settings:pressActionToAssign"),Zf={CONTROLLER:[g.t("settings:controllerDefault"),g.t("settings:controllerChange")],GAMEPAD_SUPPORT:[g.t("settings:gamepadSupportAuto"),g.t("settings:gamepadSupportDisabled")],BUTTON_UP:[`KEY ${I.UP.toString()}`,Ct],BUTTON_DOWN:[`KEY ${I.DOWN.toString()}`,Ct],BUTTON_LEFT:[`KEY ${I.LEFT.toString()}`,Ct],BUTTON_RIGHT:[`KEY ${I.RIGHT.toString()}`,Ct],BUTTON_ACTION:[`KEY ${I.ACTION.toString()}`,Ct],BUTTON_CANCEL:[`KEY ${I.CANCEL.toString()}`,Ct],BUTTON_MENU:[`KEY ${I.MENU.toString()}`,Ct],BUTTON_STATS:[`KEY ${I.STATS.toString()}`,Ct],BUTTON_CYCLE_FORM:[`KEY ${I.CYCLE_FORM.toString()}`,Ct],BUTTON_CYCLE_SHINY:[`KEY ${I.CYCLE_SHINY.toString()}`,Ct],BUTTON_CYCLE_GENDER:[`KEY ${I.CYCLE_GENDER.toString()}`,Ct],BUTTON_CYCLE_ABILITY:[`KEY ${I.CYCLE_ABILITY.toString()}`,Ct],BUTTON_CYCLE_NATURE:[`KEY ${I.CYCLE_NATURE.toString()}`,Ct],BUTTON_CYCLE_TERA:[`KEY ${I.CYCLE_TERA.toString()}`,Ct],BUTTON_SPEED_UP:[`KEY ${I.SPEED_UP.toString()}`,Ct],BUTTON_SLOW_DOWN:[`KEY ${I.SLOW_DOWN.toString()}`,Ct],BUTTON_SUBMIT:[`KEY ${I.SUBMIT.toString()}`,Ct]},Jf={CONTROLLER:0,GAMEPAD_SUPPORT:0,BUTTON_UP:0,BUTTON_DOWN:0,BUTTON_LEFT:0,BUTTON_RIGHT:0,BUTTON_ACTION:0,BUTTON_CANCEL:0,BUTTON_MENU:0,BUTTON_STATS:0,BUTTON_CYCLE_FORM:0,BUTTON_CYCLE_SHINY:0,BUTTON_CYCLE_GENDER:0,BUTTON_CYCLE_ABILITY:0,BUTTON_CYCLE_NATURE:0,BUTTON_CYCLE_TERA:0,BUTTON_SPEED_UP:0,BUTTON_SLOW_DOWN:0,BUTTON_SUBMIT:0},PT=[re.Button_Up,re.Button_Down,re.Button_Left,re.Button_Right];function ta(y,e){switch(y){case"GAMEPAD_SUPPORT":s.inputController.setGamepadSupport(Zf[y][e]!=="Disabled");break;case"BUTTON_ACTION":case"BUTTON_CANCEL":case"BUTTON_MENU":case"BUTTON_STATS":case"BUTTON_CYCLE_SHINY":case"BUTTON_CYCLE_FORM":case"BUTTON_CYCLE_GENDER":case"BUTTON_CYCLE_ABILITY":case"BUTTON_CYCLE_NATURE":case"BUTTON_CYCLE_TERA":case"BUTTON_SPEED_UP":case"BUTTON_SLOW_DOWN":case"BUTTON_SUBMIT":if(e&&s.ui){const t=u((i=!1)=>(s.ui.revertMode(),s.ui.getHandler().updateBindings(),i),"cancelHandler");s.ui.setOverlayMode(_.GAMEPAD_BINDING,{target:y,cancelHandler:t})}break;case"CONTROLLER":if(e){const t=s.inputController.getGamepadsName();if(s.ui&&t){const i=u(()=>(s.ui.revertMode(),s.ui.getHandler().setOptionCursor(Object.values(G).indexOf("CONTROLLER"),0,!0),s.ui.getHandler().updateBindings(),!1),"cancelHandler"),n=u(a=>(s.inputController.setChosenGamepad(a),i(),!0),"changeGamepadHandler");return s.ui.setOverlayMode(_.OPTION_SELECT,{options:[...t.map(a=>({label:mh(a,30),handler:u(()=>n(a),"handler")})),{label:g.t("settings:cancelContollerChoice"),handler:i}]}),!1}}break}return!0}u(ta,"setSettingGamepad");const eg={padID:"Xbox 360 controller (XInput STANDARD GAMEPAD)",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:I.UP,[G.Button_Down]:I.DOWN,[G.Button_Left]:I.LEFT,[G.Button_Right]:I.RIGHT,[G.Button_Action]:I.ACTION,[G.Button_Cancel]:I.CANCEL,[G.Button_Cycle_Nature]:I.CYCLE_NATURE,[G.Button_Cycle_Tera]:I.CYCLE_TERA,[G.Button_Menu]:I.MENU,[G.Button_Stats]:I.STATS,[G.Button_Cycle_Form]:I.CYCLE_FORM,[G.Button_Cycle_Shiny]:I.CYCLE_SHINY,[G.Button_Cycle_Gender]:I.CYCLE_GENDER,[G.Button_Cycle_Ability]:I.CYCLE_ABILITY,[G.Button_Speed_Up]:I.SPEED_UP,[G.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},tg={padID:"Dualshock",padType:"dualshock",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,TOUCH:17},icons:{RC_S:"CROSS.png",RC_E:"CIRCLE.png",RC_W:"SQUARE.png",RC_N:"TRIANGLE.png",START:"START.png",SELECT:"SELECT.png",LB:"L1.png",RB:"R1.png",LT:"L2.png",RT:"R2.png",LS:"L3.png",RS:"R3.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png",TOUCH:"TOUCH.png"},settings:{[G.Button_Up]:I.UP,[G.Button_Down]:I.DOWN,[G.Button_Left]:I.LEFT,[G.Button_Right]:I.RIGHT,[G.Button_Action]:I.ACTION,[G.Button_Cancel]:I.CANCEL,[G.Button_Cycle_Nature]:I.CYCLE_NATURE,[G.Button_Cycle_Tera]:I.CYCLE_TERA,[G.Button_Menu]:I.MENU,[G.Button_Stats]:I.STATS,[G.Button_Cycle_Form]:I.CYCLE_FORM,[G.Button_Cycle_Shiny]:I.CYCLE_SHINY,[G.Button_Cycle_Gender]:I.CYCLE_GENDER,[G.Button_Cycle_Ability]:I.CYCLE_ABILITY,[G.Button_Speed_Up]:I.SPEED_UP,[G.Button_Slow_Down]:I.SLOW_DOWN,[G.Button_Submit]:I.SUBMIT},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down,TOUCH:G.Button_Submit}},sg={padID:"081f-e401",padType:"xbox",deviceMapping:{RC_S:2,RC_E:1,RC_W:3,RC_N:0,START:9,SELECT:8,LB:4,RB:5,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:I.UP,[G.Button_Down]:I.DOWN,[G.Button_Left]:I.LEFT,[G.Button_Right]:I.RIGHT,[G.Button_Action]:I.ACTION,[G.Button_Cancel]:I.CANCEL,[G.Button_Cycle_Nature]:I.CYCLE_NATURE,[G.Button_Cycle_Tera]:I.CYCLE_TERA,[G.Button_Menu]:I.MENU,[G.Button_Stats]:I.STATS,[G.Button_Cycle_Form]:I.CYCLE_FORM,[G.Button_Cycle_Shiny]:I.CYCLE_SHINY,[G.Button_Cycle_Gender]:I.CYCLE_GENDER,[G.Button_Cycle_Ability]:I.CYCLE_ABILITY,[G.Button_Speed_Up]:I.SPEED_UP,[G.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:-1,RT:-1,LS:-1,RS:-1}};function bi(y,e){return Object.keys(y.deviceMapping).find(t=>y.deviceMapping[t]===e)}u(bi,"getKeyWithKeycode");function ig(y,e){const t=bi(y,e);return t?y.custom[t]:null}u(ig,"getSettingNameWithKeycode");function Vn(y,e){const t=ig(y,e);return y.settings[t]}u(Vn,"getButtonWithKeycode");function Ei(y,e){return Object.keys(y.custom).find(t=>y.custom[t]===e)}u(Ei,"getKeyWithSettingName");function Wr(y,e){return y.custom[e]}u(Wr,"getSettingNameWithKey");function DT(y,e){return y.icons[e]}u(DT,"getIconWithKey");function ma(y,e){const t=Ei(y,e);return DT(y,t)}u(ma,"getIconWithSettingName");function BT(y,e,t,i){let n;e==="gamepad"?n=y[t[_e.GAMEPAD]]:n=y[t[_e.KEYBOARD]];const a=ma(n,i);if(!a){const r=i.includes("ALT_");let o;return r?o=i.split("ALT_").splice(1)[0]:o=`ALT_${i}`,ma(n,o)}return a}u(BT,"getIconForLatestInput");function LT(y,e,t){if(!UT(y,bi(y,t))||!VT(y,e))return!1;const i=ig(y,t);if(i){const r=Ei(y,i);r&&(y.custom[r]=-1)}const n=Ei(y,e);n&&(y.custom[n]=-1);const a=bi(y,t);return a&&(y.custom[a]=e),!0}u(LT,"assign");function RT(y,e,t){if(y.padType==="keyboard")return!1;const i=Ei(y,e),n=Wr(y,i),a=bi(y,t),r=Wr(y,a);return i&&(y.custom[i]=r),a&&(y.custom[a]=n),!0}u(RT,"swap");function FT(y,e){const t=Ei(y,e);return y.blacklist.includes(t)?!1:(t&&(y.custom[t]=-1),!0)}u(FT,"deleteBind");function UT(y,e){var i;const t=Wr(y,e);return!((i=y.blacklist)!=null&&i.includes(e))}u(UT,"canIAssignThisKey");function VT(y,e){var i;const t=Ei(y,e);return!((i=y.blacklist)!=null&&i.includes(t))}u(VT,"canIOverrideThisSetting");const Zh=class Zh extends ts{constructor(e=null){super(e),this.layout=new Map,this.rowsToDisplay=8}getLocalStorageSetting(){return localStorage.hasOwnProperty(this.localStoragePropertyName)?JSON.parse(localStorage.getItem(this.localStoragePropertyName)):{}}camelize(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,i)=>i===0?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,"")}setup(){const e=this.getUi();this.navigationIcons={},this.settingsContainer=s.add.container(1,-(s.game.canvas.height/6)+1),this.settingsContainer.setName(`settings-${this.titleSelected}`),this.settingsContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.navigationContainer=new fa(0,0),this.optionsBg=me(0,this.navigationContainer.height,s.game.canvas.width/6-2,s.game.canvas.height/6-16-this.navigationContainer.height-2),this.optionsBg.setOrigin(0,0),this.actionsBg=me(0,s.game.canvas.height/6-this.navigationContainer.height,s.game.canvas.width/6-2,22),this.actionsBg.setOrigin(0,0);const t=s.add.sprite(0,0,"keyboard");t.setOrigin(0,-.1),t.setPositionRelative(this.actionsBg,this.navigationContainer.width-32,4),this.navigationIcons.BUTTON_ACTION=t;const i=D(0,0,g.t("settings:action"),O.SETTINGS_LABEL);i.setOrigin(0,.15),i.setPositionRelative(t,-i.width/6-2,0);const n=s.add.sprite(0,0,"keyboard");n.setOrigin(0,-.1),n.setPositionRelative(this.actionsBg,i.x-28,4),this.navigationIcons.BUTTON_CANCEL=n;const a=D(0,0,g.t("settings:back"),O.SETTINGS_LABEL);a.setOrigin(0,.15),a.setPositionRelative(n,-a.width/6-2,0);const r=s.add.sprite(0,0,"keyboard");r.setOrigin(0,-.1),r.setPositionRelative(this.actionsBg,a.x-28,4),this.navigationIcons.BUTTON_HOME=r;const o=D(0,0,g.t("settings:reset"),O.SETTINGS_LABEL);o.setOrigin(0,.15),o.setPositionRelative(r,-o.width/6-2,0),this.settingsContainer.add(this.optionsBg),this.settingsContainer.add(this.actionsBg),this.settingsContainer.add(this.navigationContainer),this.settingsContainer.add(t),this.settingsContainer.add(n),this.settingsContainer.add(r),this.settingsContainer.add(i),this.settingsContainer.add(a),this.settingsContainer.add(o);for(const l of this.configs){this.layout[l.padType]=new Map;const h=s.add.container(0,0);h.setVisible(!1);const c=Object.keys(l.settings),d=[],f=[],p={},m=[...Object.keys(this.setting).slice(0,this.commonSettingsCount).map(S=>this.setting[S]),...Object.keys(l.settings)],C=Object.values(Object.keys(this.settingDeviceDefaults).filter(S=>m.includes(S)).map(S=>this.settingDeviceDefaults[S]));Object.keys(this.setting).filter(S=>m.includes(this.setting[S])).forEach((S,x)=>{const A=S.replace(/\_/g," "),w=this.settingBlacklisted.includes(this.setting[S]),k=w?O.SETTINGS_LOCKED:O.SETTINGS_LABEL;let B;const X=this.camelize(A.replace("Alt ",""));A.toLowerCase().includes("alt")?B=`${g.t(`settings:${X}`)}${g.t("settings:alt")}`:B=g.t(`settings:${X}`),d[x]=D(8,28+x*16,B,k),d[x].setOrigin(0,0),h.add(d[x]);const L=[];for(const[F,pe]of this.settingDeviceOptions[this.setting[S]].entries()){if(c.includes(this.setting[S])){if(F){const $=D(0,0,w?"":pe,O.WINDOW);$.setOrigin(0,0),h.add($),L.push($);continue}const ce=s.add.sprite(0,0,this.textureOverride?this.textureOverride:l.padType);ce.setOrigin(0,-.15),p[this.setting[S]]=ce,h.add(ce),L.push(ce);continue}const z=D(0,0,pe,this.settingDeviceDefaults[this.setting[S]]===F?O.SETTINGS_SELECTED:O.WINDOW);z.setOrigin(0,0),h.add(z),L.push(z)}f.push(L);const Q=f[x].map(F=>F.width).reduce((F,pe)=>F+=pe,0),te=Math.max(130,d[x].displayWidth+8),P=297-te-Q/6,H=Math.floor(P/(f[x].length-1));let v=0;for(const F of f[x])F.setPositionRelative(d[x],te+v,0),v+=F.width/6+H}),this.layout[l.padType].optionsContainer=h,this.layout[l.padType].inputsIcons=p,this.layout[l.padType].settingLabels=d,this.layout[l.padType].optionValueLabels=f,this.layout[l.padType].optionCursors=C,this.layout[l.padType].keys=m,this.layout[l.padType].bindingSettings=c,this.settingsContainer.add(h)}this.scrollBar=new ys(this.optionsBg.width-9,this.optionsBg.y+5,4,this.optionsBg.height-11,this.rowsToDisplay),this.settingsContainer.add(this.scrollBar),e.add(this.settingsContainer),this.settingsContainer.setVisible(!1)}getActiveConfig(){return s.inputController.getActiveConfig(this.device)}updateBindings(){Object.keys(this.layout).forEach(i=>this.layout[i].optionsContainer.setVisible(!1));const e=this.getActiveConfig();if(!this.setLayout(e))return;const t=this.getLocalStorageSetting();if(this.keys.forEach((i,n)=>{this.setOptionCursor(n,t.hasOwnProperty(i)?t[i]:this.optionCursors[n])}),!!e.custom){for(const i of this.bindingSettings){const n=ma(e,i);n?(this.inputsIcons[i].setFrame(n),this.inputsIcons[i].alpha=1):this.inputsIcons[i].alpha=0}this.setCursor(this.cursor),this.setScrollCursor(this.scrollCursor)}}updateNavigationDisplay(){var t,i;const e={BUTTON_HOME:"HOME.png",BUTTON_DELETE:"DEL.png"};for(const n of Object.keys(this.navigationIcons)){if(Object.keys(e).includes(n)){this.navigationIcons[n].setTexture("keyboard"),this.navigationIcons[n].setFrame(e[n]),this.navigationIcons[n].alpha=1;continue}const a=(t=s.inputController)==null?void 0:t.getIconForLatestInputRecorded(n);if(a){const r=(i=s.inputController)==null?void 0:i.getLastSourceType();this.navigationIcons[n].setTexture(r),this.navigationIcons[n].setFrame(a),this.navigationIcons[n].alpha=1}else this.navigationIcons[n].alpha=0}}show(e){return super.show(e),this.updateNavigationDisplay(),jt.getInstance().updateIcons(),this.updateBindings(),this.settingsContainer.setVisible(!0),this.resetScroll(),this.getUi().moveTo(this.settingsContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}setLayout(e){if(!e)return this.layout.noGamepads.optionsContainer.setVisible(!0),!1;const t=e.padType,i=this.layout[t];return this.keys=i.keys,this.optionsContainer=i.optionsContainer,this.optionsContainer.setVisible(!0),this.settingLabels=i.settingLabels,this.optionValueLabels=i.optionValueLabels,this.optionCursors=i.optionCursors,this.inputsIcons=i.inputsIcons,this.bindingSettings=i.bindingSettings,this.scrollBar.setTotalRows(i.settingLabels.length),this.scrollBar.setScrollCursor(0),!0}processInput(e){const t=this.getUi();let i=!1;if(this.updateNavigationDisplay(),e===I.CANCEL)i=!0,jt.getInstance().reset(),s.ui.revertMode();else{const n=this.cursor+this.scrollCursor,a=this.setting[Object.keys(this.setting)[n]];switch(e){case I.ACTION:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||!a.includes("BUTTON_")?i=!1:i=this.setSetting(a,1);break;case I.UP:if(!this.optionValueLabels)return!1;if(n)this.cursor?i=this.setCursor(this.cursor-1):i=this.setScrollCursor(this.scrollCursor-1);else{const r=this.setCursor(this.rowsToDisplay-1),o=this.setScrollCursor(this.optionValueLabels.length-this.rowsToDisplay);i=r&&o}break;case I.DOWN:if(!this.optionValueLabels)return!1;if(n<this.optionValueLabels.length-1)this.cursor<this.rowsToDisplay-1?i=this.setCursor(this.cursor+1):this.scrollCursor<this.optionValueLabels.length-this.rowsToDisplay&&(i=this.setScrollCursor(this.scrollCursor+1));else{const r=this.setCursor(0),o=this.setScrollCursor(0);i=r&&o}break;case I.LEFT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:this.optionCursors[n]&&(i=this.setOptionCursor(n,this.optionCursors[n]-1,!0));break;case I.RIGHT:if(!this.optionCursors||!this.optionValueLabels)return!1;this.settingBlacklisted.includes(a)||a.includes("BUTTON_")?i=!1:this.optionCursors[n]<this.optionValueLabels[n].length-1&&(i=this.setOptionCursor(n,this.optionCursors[n]+1,!0));break;case I.CYCLE_FORM:case I.CYCLE_SHINY:i=this.navigationContainer.navigate(e);break}}return i&&t.playSelect(),i}resetScroll(){var e;(e=this.cursorObj)==null||e.destroy(),this.cursorObj=null,this.cursor=0,this.setCursor(0),this.setScrollCursor(0),this.updateSettingsScroll()}setCursor(e){const t=super.setCursor(e);if(!this.optionsContainer)return t;if(!this.cursorObj){const i=s.game.canvas.width/6-(this.scrollBar.visible?16:10);this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,i,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.optionsContainer.add(this.cursorObj)}return this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor),this.updateSettingsScroll(),this.setCursor(this.cursor),!0)}setOptionCursor(e,t,i){const n=this.setting[Object.keys(this.setting)[e]],a=this.optionCursors[e];if(!this.bindingSettings.includes(n)&&!n.includes("BUTTON_")){const r=this.optionValueLabels[e][a];r.setColor(this.getTextColor(O.WINDOW)),r.setShadowColor(this.getTextColor(O.WINDOW,!0)),this.optionCursors[e]=t;const o=this.optionValueLabels[e][t];o.setColor(this.getTextColor(O.SETTINGS_SELECTED)),o.setShadowColor(this.getTextColor(O.SETTINGS_SELECTED,!0))}return i&&this.saveSettingToLocalStorage(n,t),!0}updateSettingsScroll(){if(this.optionsContainer){this.optionsContainer.setY(-16*this.scrollCursor);for(let e=0;e<this.settingLabels.length;e++){const t=e>=this.scrollCursor&&e<this.scrollCursor+this.rowsToDisplay;this.settingLabels[e].setVisible(t);for(const i of this.optionValueLabels[e])i.setVisible(t)}}}clear(){super.clear(),this.settingsContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(Zh,"AbstractControlSettingsUiHandler");let ya=Zh;const Jh=class Jh extends ya{constructor(e=null){super(e),this.setSetting=ta,this.titleSelected="Gamepad",this.setting=G,this.settingDeviceDefaults=Jf,this.settingDeviceOptions=Zf,this.configs=[eg,tg,sg],this.commonSettingsCount=2,this.localStoragePropertyName="settingsGamepad",this.settingBlacklisted=PT,this.device=_e.GAMEPAD}setup(){super.setup(),this.layout.noGamepads=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=D(8,28,g.t("settings:gamepadPleasePlug"),O.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e),this.layout.noGamepads.optionsContainer=e,this.layout.noGamepads.label=t}setLayout(e){return e?super.setLayout(e):(this.layout.noGamepads.optionsContainer.setVisible(!0),!1)}updateChosenGamepadDisplay(){this.updateBindings(),this.resetScroll();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Controller)for(const n of Object.keys(this.layout))n!=="noGamepads"&&this.layout[n].optionValueLabels[e][0].setText(mh(s.inputController.selectedDevice[_e.GAMEPAD],20))}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Controller&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};u(Jh,"SettingsGamepadUiHandler");let Ta=Jh;const ec=class ec extends ts{constructor(e=null){super(e),this.leftArrowGap=90,this.arrowSpacing=3}setup(){const e=this.getUi();this.widestTextBox=0,this.challengesContainer=s.add.container(1,-(s.game.canvas.height/6)+1),this.challengesContainer.setName("challenges"),this.challengesContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains);const t=s.add.rectangle(-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,4342338,.8);t.setName("rect-challenge-overlay"),t.setOrigin(0,0),this.challengesContainer.add(t);const i=me(0,0,s.game.canvas.width/6,24);i.setName("window-header-bg"),i.setOrigin(0,0);const n=D(0,0,g.t("challenges:title"),O.SETTINGS_LABEL);n.setName("text-header"),n.setOrigin(0,0),n.setPositionRelative(i,8,4),this.optionsWidth=s.scaledCanvas.width*.6,this.optionsBg=me(0,i.height,this.optionsWidth,s.scaledCanvas.height-i.height-2),this.optionsBg.setName("window-options-bg"),this.optionsBg.setOrigin(0,0);const a=me(0,i.height,s.scaledCanvas.width-this.optionsWidth,s.scaledCanvas.height-i.height-26);a.setName("window-desc-bg"),a.setOrigin(0,0),a.setPositionRelative(this.optionsBg,this.optionsBg.width,0),this.descriptionText=new rf(s,a.x+6,a.y+4,"",{fontFamily:"emerald",fontSize:84,color:lp.ORANGE,padding:{bottom:6},wrap:{mode:"word",width:(a.width-12)*6}}),this.descriptionText.setName("text-desc"),s.add.existing(this.descriptionText),this.descriptionText.setScale(1/6),this.descriptionText.setShadow(4,5,hp.ORANGE),this.descriptionText.setOrigin(0,0),this.startBg=me(0,0,a.width,24),this.startBg.setName("window-start-bg"),this.startBg.setOrigin(0,0),this.startBg.setPositionRelative(a,0,a.height),this.startText=D(0,0,g.t("challenges:noneSelected"),O.SETTINGS_LABEL),this.startText.setName("text-start"),this.startText.setOrigin(0,0),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4),this.startCursor=s.add.nineslice(0,0,"summary_moves_cursor",void 0,a.width-8,16,1,1,1,1),this.startCursor.setName("9s-start-cursor"),this.startCursor.setOrigin(0,0),this.startCursor.setPositionRelative(this.startBg,4,3),this.startCursor.setVisible(!1),this.valuesContainer=s.add.container(0,0),this.valuesContainer.setName("values"),this.challengeLabels=[];for(let r=0;r<9;r++){const o=D(8,28+r*16,"",O.SETTINGS_LABEL);o.setName(`text-challenge-label-${r}`),o.setOrigin(0,0),this.valuesContainer.add(o);const l=s.add.image(0,0,"cursor_reverse");l.setName(`challenge-left-arrow-${r}`),l.setOrigin(0,0),l.setVisible(!1),l.setScale(.75),this.valuesContainer.add(l);const h=s.add.image(0,0,"cursor");h.setName(`challenge-right-arrow-${r}`),h.setOrigin(0,0),h.setScale(.75),h.setVisible(!1),this.valuesContainer.add(h);const c=D(0,28+r*16,"",O.SETTINGS_LABEL);c.setName(`challenge-value-text-${r}`),c.setPositionRelative(o,100,0),this.valuesContainer.add(c),this.challengeLabels[r]={label:o,value:c,leftArrow:l,rightArrow:h}}this.monoTypeValue=s.add.sprite(8,98,os("types")),this.monoTypeValue.setName("challenge-value-monotype-sprite"),this.monoTypeValue.setScale(.86),this.monoTypeValue.setVisible(!1),this.valuesContainer.add(this.monoTypeValue),this.challengesContainer.add(i),this.challengesContainer.add(n),this.challengesContainer.add(this.optionsBg),this.challengesContainer.add(a),this.challengesContainer.add(this.descriptionText),this.challengesContainer.add(this.startBg),this.challengesContainer.add(this.startText),this.challengesContainer.add(this.startCursor),this.challengesContainer.add(this.valuesContainer),e.add(this.challengesContainer),this.setCursor(0),this.setScrollCursor(0),this.challengesContainer.setVisible(!1)}setDescription(e){this.descriptionText.setText(`[color=${lp.ORANGE}][shadow=${hp.ORANGE}]${e}`)}initLabels(){this.setDescription(s.gameMode.challenges[0].getDescription()),this.widestTextBox=0;for(let e=0;e<9;e++)if(e<s.gameMode.challenges.length){this.challengeLabels[e].label.setVisible(!0),this.challengeLabels[e].value.setVisible(!0),this.challengeLabels[e].leftArrow.setVisible(!0),this.challengeLabels[e].rightArrow.setVisible(!0);const t=D(0,0,"",O.SETTINGS_LABEL);for(let i=0;i<=s.gameMode.challenges[e].maxValue;i++)s.gameMode.challenges[e].id!==Xs.SINGLE_TYPE&&(t.setText(s.gameMode.challenges[e].getValue(i)),t.displayWidth>this.widestTextBox&&(this.widestTextBox=t.displayWidth));t.destroy()}}updateText(){this.setDescription(this.getActiveChallenge().getDescription());let e=!1;for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=s.gameMode.challenges[this.scrollCursor+t],n=this.challengeLabels[t];n.label.setText(i.getName()),n.leftArrow.setPositionRelative(n.label,this.leftArrowGap,4.5),n.leftArrow.setVisible(i.value!==0),n.rightArrow.setPositionRelative(n.leftArrow,Math.max(this.monoTypeValue.width,this.widestTextBox)+n.leftArrow.displayWidth+2*this.arrowSpacing,0),n.rightArrow.setVisible(i.value!==i.maxValue),n.rightArrow.x+n.rightArrow.width+this.optionsBg.rightWidth+this.arrowSpacing>this.optionsWidth&&n.rightArrow.setX(this.optionsWidth-this.arrowSpacing-this.optionsBg.rightWidth);const a=Math.round((n.leftArrow.x+n.rightArrow.x+n.leftArrow.displayWidth)/2);i.id===Xs.SINGLE_TYPE?(this.monoTypeValue.setX(a),this.monoTypeValue.setY(n.label.y+8),this.monoTypeValue.setFrame(i.getValue()),this.monoTypeValue.setVisible(!0),n.value.setVisible(!1),e=!0):(n.value.setText(i.getValue()),n.value.setX(a),n.value.setOrigin(.5,0),n.value.setVisible(!0))}e||this.monoTypeValue.setVisible(!1),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.hasSelectedChallenge?(this.startText.setText(g.t("common:start")),this.startText.setAlpha(1),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)):(this.startText.setText(g.t("challenges:noneSelected")),this.startText.setAlpha(.5),this.startText.setPositionRelative(this.startBg,(this.startBg.width-this.startText.displayWidth)/2,4)),this.challengesContainer.update()}show(e){return super.show(e),this.startCursor.setVisible(!1),this.updateChallengeArrows(!1),this.challengesContainer.setVisible(!0),this.hasSelectedChallenge=s.gameMode.challenges.some(t=>t.value!==0),this.setCursor(0),this.initLabels(),this.updateText(),this.getUi().moveTo(this.challengesContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}updateChallengeArrows(e){for(let t=0;t<Math.min(9,s.gameMode.challenges.length);t++){const i=this.challengeLabels[t];e?(i.leftArrow.setTint(8421504),i.rightArrow.setTint(8421504)):(i.leftArrow.clearTint(),i.rightArrow.clearTint())}}processInput(e){var a,r,o,l,h;const t=this.getUi(),i=9;let n=!1;if(e===I.CANCEL)this.startCursor.visible?(this.startCursor.setVisible(!1),(a=this.cursorObj)==null||a.setVisible(!0),this.updateChallengeArrows(this.startCursor.visible)):(s.phaseManager.clearPhaseQueue(),s.phaseManager.pushNew("TitlePhase"),(r=s.phaseManager.getCurrentPhase())==null||r.end()),n=!0;else if(e===I.SUBMIT||e===I.ACTION)this.hasSelectedChallenge?(this.startCursor.visible?(s.phaseManager.unshiftNew("SelectStarterPhase"),(o=s.phaseManager.getCurrentPhase())==null||o.end()):(this.startCursor.setVisible(!0),(l=this.cursorObj)==null||l.setVisible(!1),this.updateChallengeArrows(this.startCursor.visible)),n=!0):n=!1;else if((h=this.cursorObj)!=null&&h.visible&&!this.startCursor.visible)switch(e){case I.UP:if(this.cursor===0)if(this.scrollCursor===0)if(s.gameMode.challenges.length>i){const c=this.setCursor(i-1),d=this.setScrollCursor(s.gameMode.challenges.length-i);n=c&&d}else n=this.setCursor(s.gameMode.challenges.length-1);else n=this.setScrollCursor(this.scrollCursor-1);else n=this.setCursor(this.cursor-1);n&&this.updateText();break;case I.DOWN:if(this.cursor===i-1)if(this.scrollCursor<s.gameMode.challenges.length-i)n=this.setScrollCursor(this.scrollCursor+1);else{const c=this.setCursor(0),d=this.setScrollCursor(0);n=c&&d}else s.gameMode.challenges.length<i&&this.cursor===s.gameMode.challenges.length-1?n=this.setCursor(0):n=this.setCursor(this.cursor+1);n&&this.updateText();break;case I.LEFT:n=this.getActiveChallenge().decreaseValue(),n&&this.updateText();break;case I.RIGHT:n=this.getActiveChallenge().increaseValue(),n&&this.updateText();break}return n&&t.playSelect(),n}setCursor(e){let t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"summary_moves_cursor",void 0,this.optionsWidth-8,16,1,1,1,1),this.cursorObj.setOrigin(0,0),this.valuesContainer.add(this.cursorObj)),t||(t=!this.cursorObj.visible),this.cursorObj.setVisible(!0),this.cursorObj.setPositionRelative(this.optionsBg,4,4+(this.cursor+this.scrollCursor)*16),t}setScrollCursor(e){return e===this.scrollCursor?!1:(this.scrollCursor=e,this.setCursor(this.cursor),!0)}getActiveChallenge(){return s.gameMode.challenges[this.cursor+this.scrollCursor]}clear(){super.clear(),this.challengesContainer.setVisible(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(ec,"GameChallengesUiHandler");let Gr=ec;const tc=class tc extends Phaser.GameObjects.Container{constructor(){super(s,s.game.canvas.width/6,0),this.queue=[],this.playerGender=s.gameData.gender}setup(){this.defaultWidth=200,this.defaultHeight=40,this.bg=s.add.nineslice(0,0,"achv_bar",void 0,this.defaultWidth,this.defaultHeight,41,6,16,4),this.bg.setOrigin(0,0),this.add(this.bg),this.icon=s.add.sprite(4,4,"items"),this.icon.setOrigin(0,0),this.add(this.icon),this.titleText=D(40,3,"",O.MESSAGE,{fontSize:"72px"}),this.titleText.setOrigin(0,0),this.add(this.titleText),this.scoreText=D(150,3,"",O.MESSAGE,{fontSize:"72px"}),this.scoreText.setOrigin(1,0),this.add(this.scoreText),this.descriptionText=D(43,16,"",O.WINDOW_ALT,{fontSize:"72px"}),this.descriptionText.setOrigin(0,0),this.add(this.descriptionText),this.descriptionText.setWordWrapWidth(664),this.descriptionText.setLineSpacing(-5),this.setScale(.5),this.shown=!1}showAchv(e){if(this.shown){this.queue.push(e);return}const t=e.getTier();this.bg.setTexture(`achv_bar${t?`_${t+1}`:""}`),this.icon.setFrame(e.getIconImage()),this.titleText.setText(e.getName(this.playerGender)),this.scoreText.setVisible(e instanceof Ja),e instanceof Ja?this.descriptionText.setText(bf(e.localizationKey)):e instanceof Lg&&this.descriptionText.setText(e.description),e instanceof Ja&&this.scoreText.setText(`+${e.score}pt`),this.bg.width=Math.max(this.defaultWidth,this.icon.displayWidth+this.titleText.displayWidth+this.scoreText.displayWidth+16),this.scoreText.x=this.bg.width-2,this.descriptionText.width=this.bg.width-this.icon.displayWidth-16,this.descriptionText.setWordWrapWidth(this.descriptionText.width*6),this.bg.height=Math.max(this.defaultHeight,this.titleText.displayHeight+this.descriptionText.displayHeight+8),this.icon.y=this.bg.height/2-this.icon.height/2,s.playSound("se/achv"),s.tweens.add({targets:this,x:s.game.canvas.width/6-this.bg.width/2,duration:500,ease:"Sine.easeOut"}),s.time.delayedCall(1e4,()=>this.hide(this.playerGender)),this.setVisible(!0),this.shown=!0}hide(e){this.shown&&s.tweens.add({targets:this,x:s.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:u(()=>{if(this.shown=!1,this.setVisible(!1),this.queue.length){const t=this.queue.shift();t&&this.showAchv(t)}},"onComplete")})}};u(tc,"AchvBar");let Kr=tc;var Ye=(y=>(y[y.SYSTEM=0]="SYSTEM",y[y.SESSION=1]="SESSION",y[y.SETTINGS=2]="SETTINGS",y[y.TUTORIALS=3]="TUTORIALS",y[y.SEEN_DIALOGUES=4]="SEEN_DIALOGUES",y[y.RUN_HISTORY=5]="RUN_HISTORY",y))(Ye||{});const Vp=-150,HT=0,Hp=0,sc=class sc extends Phaser.GameObjects.Container{constructor(){super(s,Vp,Hp)}setup(){this.defaultWidth=230,this.defaultHeight=100,this.bg=s.add.nineslice(-5,-5,"bgm_bar",void 0,this.defaultWidth,this.defaultHeight,0,0,10,10),this.bg.setOrigin(0,0),this.add(this.bg),this.musicText=D(5,5,"",O.BGM_BAR),this.musicText.setOrigin(0,0),this.musicText.setWordWrapWidth(650,!0),this.add(this.musicText),this.setVisible(!1),this.shown=!1}setBgmToBgmBar(e){this.musicText.setText(`${g.t("bgmName:music")}${this.getRealBgmName(e)}`),this.musicText.width=this.bg.width-20,this.musicText.setWordWrapWidth(this.defaultWidth*4),this.bg.width=Math.min(this.defaultWidth,this.musicText.displayWidth+23),this.bg.height=Math.min(this.defaultHeight,this.musicText.displayHeight+20),s.fieldUI.bringToTop(this),this.y=Hp}toggleBgmBar(e){if(this.musicText.text===""){this.setVisible(!1);return}if(!s.showBgmBar){this.setVisible(!1);return}s.tweens.add({targets:this,x:e?HT:Vp,duration:500,ease:"Sine.easeInOut",onComplete:u(()=>{this.setVisible(!0)},"onComplete")})}getRealBgmName(e){return g.t([`bgmName:${e}`,"bgmName:missing_entries"],{name:ia(e)})}};u(sc,"BgmBar");let zr=sc;const ic=class ic extends ts{constructor(e=null){super(e),this.buttonContainers=[],this.buttonBgs=[],this.buttonLabels=[]}getButtonTopMargin(){return 0}setup(){const e=this.getUi();this.modalContainer=s.add.container(0,0),this.modalContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.modalBg=me(0,0,0,0),this.modalContainer.add(this.modalBg),this.titleText=D(0,4,"",O.SETTINGS_LABEL),this.titleText.setOrigin(.5,0),this.modalContainer.add(this.titleText),e.add(this.modalContainer);const t=this.getButtonLabels();for(const i of t)this.addButton(i);this.modalContainer.setVisible(!1)}addButton(e){const t=this.getButtonTopMargin(),i=D(0,8,e,O.TOOLTIP_CONTENT);i.setOrigin(.5,.5);const n=me(0,0,i.getBounds().width+8,16,!1,!1,0,0,es.THIN);n.setOrigin(.5,0),n.setInteractive(new Phaser.Geom.Rectangle(0,0,n.width,n.height),Phaser.Geom.Rectangle.Contains);const a=s.add.container(0,t);this.buttonLabels.push(i),this.buttonBgs.push(n),this.buttonContainers.push(a),a.add(n),a.add(i),this.addInteractionHoverEffect(n),this.modalContainer.add(a)}show(e){if(e.length>=1&&"buttonActions"in e[0]){if(super.show(e),e[0].hasOwnProperty("fadeOut")&&typeof e[0].fadeOut=="function"){const[i,n,a,r]=this.getMargin(),o=s.add.rectangle((this.getWidth()+r+n)/2,(this.getHeight()+i+a)/2,s.game.canvas.width/6,s.game.canvas.height/6,0);o.setOrigin(.5,.5),o.setName("rect-ui-overlay-modal"),o.setAlpha(0),this.modalContainer.add(o),this.modalContainer.moveTo(o,0),s.tweens.add({targets:o,alpha:1,duration:250,ease:"Sine.easeOut",onComplete:e[0].fadeOut})}const t=e[0];this.updateContainer(t),this.modalContainer.setVisible(!0),this.getUi().moveTo(this.modalContainer,this.getUi().length-1);for(let i=0;i<this.buttonBgs.length;i++)i<this.buttonBgs.length&&this.buttonBgs[i].on("pointerdown",n=>{s.tweens.getTweensOf(this.modalContainer).length===0&&t.buttonActions[i]()});return!0}return!1}updateContainer(e){const[t,i,n,a]=this.getMargin(e),[r,o]=[this.getWidth(e),this.getHeight(e)];this.modalContainer.setPosition((s.game.canvas.width/6-(r+(i-a)))/2,(-s.game.canvas.height/6-(o+(n-t)))/2),this.modalBg.setSize(r,o);const l=this.getModalTitle(e);this.titleText.setText(l),this.titleText.setX(r/2),this.titleText.setVisible(!!l);for(let h=0;h<this.buttonContainers.length;h++){const c=r/(this.buttonContainers.length+1);this.buttonContainers[h].setPosition(c*(h+1),this.modalBg.height-(this.buttonBgs[h].height+8))}}processInput(e){return!1}clear(){super.clear(),this.modalContainer.setVisible(!1),this.buttonBgs.map(e=>e.off("pointerdown"))}addInteractionHoverEffect(e){e.on("pointerover",()=>{this.setMouseCursorStyle("pointer"),e.setTint(12303291)}),e.on("pointerout",()=>{this.setMouseCursorStyle("default"),e.clearTint()})}};u(ic,"ModalUiHandler");let Ii=ic;const nc=class nc extends Ii{constructor(e=null){super(e),this.editing=!1,this.inputContainers=[],this.inputs=[],this.formLabels=[]}getHeight(e){return 20*this.getInputFieldConfigs().length+(this.getModalTitle()?26:0)+(e!=null&&e.errorMessage?12:0)+this.getButtonTopMargin()+28}getReadableErrorMessage(e){return(e==null?void 0:e.indexOf("connection refused"))>-1?"Could not connect to the server":e}setup(){super.setup();const e=this.getInputFieldConfigs(),t=!!this.getModalTitle();e.length>=1&&this.updateFields(e,t),this.errorMessage=D(10,(t?31:5)+20*(e.length-1)+16+this.getButtonTopMargin(),"",O.TOOLTIP_CONTENT),this.errorMessage.setColor(this.getTextColor(O.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(O.SUMMARY_PINK,!0)),this.errorMessage.setVisible(!1),this.modalContainer.add(this.errorMessage)}updateFields(e,t){this.inputContainers=[],this.inputs=[],this.formLabels=[],e.forEach((i,n)=>{const a=D(10,(t?31:5)+20*n,i.label,O.TOOLTIP_CONTENT);a.name="formLabel"+n,this.formLabels.push(a),this.modalContainer.add(this.formLabels[this.formLabels.length-1]);const r=s.add.container(70,(t?28:2)+20*n);r.setVisible(!1);const o=me(0,0,80,16,!1,!1,0,0,es.XTHIN),l=i==null?void 0:i.isPassword,h=i==null?void 0:i.isReadOnly,c=Rg(4,-2,440,116,O.TOOLTIP_CONTENT,{type:l?"password":"text",maxLength:l?64:20,readOnly:h});c.setOrigin(0,0),r.add(o),r.add(c),this.inputContainers.push(r),this.modalContainer.add(r),this.inputs.push(c)})}show(e){if(super.show(e)){this.inputContainers.map(i=>i.setVisible(!0));const t=e[0];return this.submitAction=t.buttonActions.length?t.buttonActions[0]:null,this.buttonBgs.length&&(this.buttonBgs[0].off("pointerdown"),this.buttonBgs[0].on("pointerdown",()=>{this.submitAction&&s.tweens.getTweensOf(this.modalContainer).length===0&&this.submitAction()})),this.modalContainer.y+=24,this.modalContainer.setAlpha(0),this.tween=s.tweens.add({targets:this.modalContainer,duration:de(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),!0}return!1}processInput(e){return e===I.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}sanitizeInputs(){for(const e of this.inputs)e.text=e.text.trim()}updateContainer(e){super.updateContainer(e),this.errorMessage.setText(this.getReadableErrorMessage((e==null?void 0:e.errorMessage)||"")),this.errorMessage.setVisible(!!this.errorMessage.text)}clear(){super.clear(),this.modalContainer.setVisible(!1),this.inputContainers.map(e=>e.setVisible(!1)),this.submitAction=null,this.tween&&this.tween.remove()}};u(nc,"FormModalUiHandler");let Fs=nc;const ac=class ac extends Fs{constructor(e=null){super(e),this.buttonGap=10,this.httpUserNotFoundErrorCode=404,this.ERR_REQUIRED_FIELD=t=>t==="username"?`${ia(t)} is required`:`${ia(t)} Id is required`,this.SUCCESS_SERVICE_MODE=(t,i)=>`Username and ${t} successfully ${i.toLowerCase()}ed`}getModalTitle(){return"Admin panel"}getWidth(){return this.adminMode===2?180:160}getMargin(){return[0,0,0,0]}getButtonLabels(){switch(this.adminMode){case 0:return["Link Account","Cancel"];case 1:return["Find account","Cancel"];case 2:return["Back to search","Cancel"];default:return["Activate ADMIN","Cancel"]}}getInputFieldConfigs(){const e=[];switch(this.adminMode){case 0:e.push({label:"Username"}),e.push({label:"Discord ID"});break;case 1:e.push({label:"Username"});break;case 2:const t=this.adminResult??{discordId:"",googleId:""};e.push({label:"Username",isReadOnly:!0}),e.push({label:"Discord ID",isReadOnly:t.discordId!==""}),e.push({label:"Google ID",isReadOnly:t.googleId!==""}),e.push({label:"Last played",isReadOnly:!0}),e.push({label:"Registered",isReadOnly:!0});break}return e}processInput(e){return e===I.SUBMIT&&this.submitAction?(this.submitAction(),!0):!1}show(e){this.config=e[0],this.adminMode=e[1],this.adminResult=e[2]??{username:"",discordId:"",googleId:"",lastLoggedIn:"",registered:""};const t=e[3],i=this.getInputFieldConfigs(),n=!!this.getModalTitle();this.updateFields(i,n),this.updateContainer(this.config);const a=this.getButtonLabels();for(let r=0;r<a.length;r++)this.buttonLabels[r].setText(a[r]);if(this.errorMessage.setPosition(10,(n?31:5)+20*(i.length-1)+16+this.getButtonTopMargin()),t?(this.errorMessage.setColor(this.getTextColor(O.SUMMARY_PINK)),this.errorMessage.setShadowColor(this.getTextColor(O.SUMMARY_PINK,!0))):(this.errorMessage.setColor(this.getTextColor(O.SUMMARY_GREEN)),this.errorMessage.setShadowColor(this.getTextColor(O.SUMMARY_GREEN,!0))),super.show(e)){this.populateFields(this.adminMode,this.adminResult);const r=this.submitAction;return this.submitAction=o=>{this.submitAction=r;const l=this.convertInputsToAdmin(),h=this.areFieldsValid(this.adminMode);if(h.error)return s.ui.setMode(_.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",l,!0);s.ui.setMode(_.LOADING,{buttonActions:[]}),this.adminMode===0?this.adminLinkUnlink(l,"discord","Link").then(c=>c.error?this.showMessage(c.errorType,l,!0):this.showMessage(this.SUCCESS_SERVICE_MODE("discord","link"),l,!1)):this.adminMode===1?this.adminSearch(l).then(c=>{if(c.error)return this.showMessage(c.errorType,l,!0);this.updateAdminPanelInfo(c.adminSearchResult??l)}):this.adminMode===2&&this.updateAdminPanelInfo(l,1)},!0}return!1}showMessage(e,t,i){s.ui.setMode(_.ADMIN,Object.assign(this.config,{errorMessage:e==null?void 0:e.trim()}),this.adminMode,t,i),i?s.ui.playError():s.ui.playSelect()}populateFields(e,t){switch(e){case 0:this.inputs[0].setText(t.username),this.inputs[1].setText(t.discordId);break;case 1:this.inputs[0].setText(t.username);break;case 2:Object.keys(t).forEach((i,n)=>{if(this.inputs[n].setText(t[i]),i==="discordId"||i==="googleId"){const a=this.inputContainers[n].list.find(o=>o.type==="NineSlice"),r=s.add.image(this.inputContainers[n].x+a.width+this.buttonGap,this.inputContainers[n].y+Math.floor(a.height/2),t[i]===""?"link_icon":"unlink_icon");r.setName(`adminBtn_${i}`),r.setOrigin(.5,.5),r.setInteractive(),r.on("pointerdown",()=>{const o=i.toLowerCase().replace("id",""),l=t[i]===""?"Link":"Unlink",h=this.areFieldsValid(this.adminMode,o);if(h.error)return s.ui.setMode(_.LOADING,{buttonActions:[]}),this.showMessage(h.errorMessage??"",t,!0);this.adminLinkUnlink(this.convertInputsToAdmin(),o,l).then(c=>{if(c.error)return s.ui.setMode(_.LOADING,{buttonActions:[]}),this.showMessage(c.errorType,t,!0);s.ui.setMode(_.LOADING,{buttonActions:[]}),this.adminSearch(t).then(d=>d.error?this.showMessage(d.errorType,t,!0):this.showMessage(this.SUCCESS_SERVICE_MODE(o,l),d.adminSearchResult??t,!1))})}),this.addInteractionHoverEffect(r),this.modalContainer.add(r)}});break}}areFieldsValid(e,t){switch(e){case 0:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};if(!this.inputs[1].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("discord")};break;case 1:if(!this.inputs[0].text)return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD("username")};break;case 2:if(!this.inputs[1].text&&t==="discord")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};if(!this.inputs[2].text&&t==="google")return{error:!0,errorMessage:this.ERR_REQUIRED_FIELD(t)};break}return{error:!1}}convertInputsToAdmin(){var e,t,i,n,a,r,o,l,h;return{username:(e=this.inputs[0])!=null&&e.node?this.inputs[0].text:"",discordId:(t=this.inputs[1])!=null&&t.node?(i=this.inputs[1])==null?void 0:i.text:"",googleId:(n=this.inputs[2])!=null&&n.node?(a=this.inputs[2])==null?void 0:a.text:"",lastLoggedIn:(r=this.inputs[3])!=null&&r.node?(o=this.inputs[3])==null?void 0:o.text:"",registered:(l=this.inputs[4])!=null&&l.node?(h=this.inputs[4])==null?void 0:h.text:""}}async adminSearch(e){try{const[t,i]=await qe.admin.searchAccount({username:e.username});return i||!t?{adminSearchResult:e,error:!0,errorType:i}:{adminSearchResult:t,error:!1}}catch(t){return console.error(t),{error:!0,errorType:t}}}async adminLinkUnlink(e,t,i){try{let n=null;return t==="discord"?i==="Link"?n=await qe.admin.linkAccountToDiscord({discordId:e.discordId,username:e.username}):i==="Unlink"?n=await qe.admin.unlinkAccountFromDiscord({discordId:e.discordId,username:e.username}):console.warn("Unknown mode",i,"for service",t):t==="google"?i==="Link"?n=await qe.admin.linkAccountToGoogleId({googleId:e.googleId,username:e.username}):i==="Unlink"?n=await qe.admin.unlinkAccountFromGoogleId({googleId:e.googleId,username:e.username}):console.warn("Unknown mode",i,"for service",t):console.warn("Unknown service",t),n?{adminSearchResult:e,error:!0,errorType:n}:{adminSearchResult:e,error:!1}}catch(n){return console.error(n),{error:!0,errorType:n}}}updateAdminPanelInfo(e,t){t=t??2,s.ui.setMode(_.ADMIN,{buttonActions:[()=>{s.ui.revertMode(),s.ui.revertMode()},()=>{s.ui.revertMode(),s.ui.revertMode()}]},t,e)}clear(){super.clear();const e=["formLabel","adminBtn"],t=[],i=this.modalContainer.list;for(let n=i.length-1;n>=0;n--)(e.some(a=>i[n].name.includes(a))||i[n].type==="Container"&&i[n].list.find(a=>a.type==="rexInputText"))&&t.push(i[n]);for(;t.length>0;)this.modalContainer.remove(t.pop(),!0)}};u(ac,"AdminUiHandler");let jr=ac;var $r=(y=>(y[y.LINK=0]="LINK",y[y.SEARCH=1]="SEARCH",y[y.ADMIN=2]="ADMIN",y))($r||{});function YT(y){switch(y){case 0:return"Link";case 1:return"Search";default:return""}}u(YT,"getAdminModeName");var ks=(y=>(y[y.GAME_SETTINGS=0]="GAME_SETTINGS",y[y.ACHIEVEMENTS=1]="ACHIEVEMENTS",y[y.STATS=2]="STATS",y[y.EGG_LIST=3]="EGG_LIST",y[y.EGG_GACHA=4]="EGG_GACHA",y[y.POKEDEX=5]="POKEDEX",y[y.MANAGE_DATA=6]="MANAGE_DATA",y[y.COMMUNITY=7]="COMMUNITY",y[y.SAVE_AND_QUIT=8]="SAVE_AND_QUIT",y[y.LOG_OUT=9]="LOG_OUT",y))(ks||{});let Yp="https://wiki.pokerogue.net/start";const WT="https://discord.gg/pokerogue",GT="https://github.com/pagefaultgames/pokerogue",KT="https://www.reddit.com/r/pokerogue",zT="https://github.com/sponsors/pagefaultgames",rc=class rc extends _t{constructor(e=null){super(e),this.textPadding=8,this.defaultMessageBoxWidth=220,this.defaultWordWrapWidth=1224,this.scale=.1666666667,this.excludedMenus=()=>[{condition:[_.COMMAND,_.TITLE].includes(e??_.TITLE),options:[4,3]},{condition:Et,options:[9]}],this.menuOptions=Ds(ks).map(t=>Number.parseInt(ks[t])).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t)))}setup(){var i;const e=this.getUi(),t=(i=g.resolvedLanguage)==null?void 0:i.substring(0,2);["de","fr","ko","zh"].includes(t)&&(Yp=`https://wiki.pokerogue.net/${t}:start`),this.bgmBar=new zr,this.bgmBar.setup(),e.bgmBar=this.bgmBar,this.menuContainer=s.add.container(1,-(s.game.canvas.height/6)+1),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.menuOverlay=new Phaser.GameObjects.Rectangle(s,-1,-1,s.scaledCanvas.width,s.scaledCanvas.height,16777215,.3),this.menuOverlay.setName("menu-overlay"),this.menuOverlay.setOrigin(0,0),this.menuContainer.add(this.menuOverlay),this.menuContainer.add(this.bgmBar),this.menuContainer.setVisible(!1)}render(){var r;const e=this.getUi();this.excludedMenus=()=>{var o;return[{condition:!!((o=s.phaseManager.getCurrentPhase())!=null&&o.is("SelectModifierPhase")),options:[4]},{condition:Et,options:[9]}]},this.menuOptions=Ds(ks).map(o=>Number.parseInt(ks[o])).filter(o=>!this.excludedMenus().some(l=>l.condition&&l.options.includes(o))),this.optionSelectText=D(0,0,this.menuOptions.map(o=>`${g.t(`menuUiHandler:${ks[o]}`)}`).join(`
`),O.WINDOW,{maxLines:this.menuOptions.length}),this.optionSelectText.setLineSpacing(12),this.scale=Ai(O.WINDOW,s.uiTheme).scale,this.menuBg=me(s.game.canvas.width/6-(this.optionSelectText.displayWidth+25),0,this.optionSelectText.displayWidth+19+24*this.scale,s.game.canvas.height/6-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPositionRelative(this.menuBg,10+24*this.scale,6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.menuMessageBox=me(0,0,this.defaultMessageBoxWidth,48),this.menuMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.menuMessageBox),this.dialogueMessageBox=me(-this.textPadding,0,s.game.canvas.width/6+this.textPadding*2,49,!1,!1,0,0,es.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const t=D(this.textPadding,this.textPadding,"",O.WINDOW,{maxLines:2});t.setName("menu-message"),t.setOrigin(0,0),this.menuMessageBoxContainer.add(t),this.initTutorialOverlay(this.menuContainer),this.initPromptSprite(this.menuMessageBoxContainer),this.message=t,this.setDialogTestMode(!1),this.menuContainer.add(this.menuMessageBoxContainer);const i=[],n=u((o,l,h)=>{e.revertMode(),e.showText(o,null,()=>{const c={options:new Array(5).fill(null).map((d,f)=>f).filter(l).map(d=>({label:g.t("menuUiHandler:slot",{slotNumber:d+1}),handler:u(()=>(h(d),e.revertMode(),e.showText("",0),!0),"handler")})).concat([{label:g.t("menuUiHandler:cancel"),handler:u(()=>(e.revertMode(),e.showText("",0),!0),"handler")}]),xOffset:98};e.setOverlayMode(_.MENU_OPTION_SELECT,c)})},"confirmSlot");(li||pr)&&i.push({label:g.t("menuUiHandler:importSession"),handler:u(()=>(n(g.t("menuUiHandler:importSlotSelect"),()=>!0,o=>s.gameData.importData(Ye.SESSION,o)),!0),"handler"),keepOpen:!0}),i.push({label:g.t("menuUiHandler:exportSession"),handler:u(()=>{const o=[];return Promise.all(new Array(5).fill(null).map((l,h)=>{const c=h;return s.gameData.getSession(c).then(d=>{d&&o.push(c)})})).then(()=>{n(g.t("menuUiHandler:exportSlotSelect"),l=>o.indexOf(l)>-1,l=>s.gameData.tryExportData(Ye.SESSION,l))}),!0},"handler"),keepOpen:!0}),i.push({label:g.t("menuUiHandler:importRunHistory"),handler:u(()=>(s.gameData.importData(Ye.RUN_HISTORY),!0),"handler"),keepOpen:!0}),i.push({label:g.t("menuUiHandler:exportRunHistory"),handler:u(()=>(s.gameData.tryExportData(Ye.RUN_HISTORY),!0),"handler"),keepOpen:!0}),(li||pr)&&i.push({label:g.t("menuUiHandler:importData"),handler:u(()=>(e.revertMode(),s.gameData.importData(Ye.SYSTEM),!0),"handler"),keepOpen:!0}),i.push({label:g.t("menuUiHandler:exportData"),handler:u(()=>(s.gameData.tryExportData(Ye.SYSTEM),!0),"handler"),keepOpen:!0},{label:g.t("menuUiHandler:consentPreferences"),handler:u(()=>{const o=document.querySelector(".termly-display-preferences"),l=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return o.dispatchEvent(l),o.focus(),!0},"handler"),keepOpen:!0}),(li||pr)&&i.push({label:"Test Dialogue",handler:u(()=>{e.playSelect();const o="",l={};return l.buttonActions=[h=>{e.revertMode(),e.playSelect();const d=decodeURIComponent(escape(atob(h))),f=e.getHandler();f.tutorialActive=!0;const p={},T=d.split(" "),m=T[0],C=/\{\{(\w*)\}\}/g,b=g.t(m).match(C)??[];if(b.length>0)for(let S=0;S<b.length;S++)typeof T[S+1]<"u"&&(p[b[S].replace(/\W/g,"")]=g.t(T[S+1]));this.setDialogTestMode(!0),e.showText(String(g.t(m,p)),null,()=>s.ui.showText("",0,()=>{f.tutorialActive=!1,this.setDialogTestMode(!1)}),null,!0)},()=>{e.revertMode()}],e.setMode(_.TEST_DIALOGUE,l,o),!0},"handler"),keepOpen:!0}),i.push({label:g.t("menuUiHandler:cancel"),handler:u(()=>(s.ui.revertMode(),!0),"handler"),keepOpen:!0}),this.manageDataConfig={xOffset:98,options:i,maxOptions:7};const a=[{label:"Wiki",handler:u(()=>{var o;return(o=window.open(Yp,"_blank"))==null||o.focus(),!0},"handler"),keepOpen:!0},{label:"Discord",handler:u(()=>{var o;return(o=window.open(WT,"_blank"))==null||o.focus(),!0},"handler"),keepOpen:!0},{label:"GitHub",handler:u(()=>{var o;return(o=window.open(GT,"_blank"))==null||o.focus(),!0},"handler"),keepOpen:!0},{label:"Reddit",handler:u(()=>{var o;return(o=window.open(KT,"_blank"))==null||o.focus(),!0},"handler"),keepOpen:!0},{label:g.t("menuUiHandler:donate"),handler:u(()=>{var o;return(o=window.open(zT,"_blank"))==null||o.focus(),!0},"handler"),keepOpen:!0}];(r=ke)!=null&&r.hasAdminRole&&a.push({label:"Admin",handler:u(()=>{const o=[$r.ADMIN],l=[];return Object.values($r).filter(h=>!Number.isNaN(Number(h))&&!o.includes(h)).forEach(h=>{l.push({label:YT(h),handler:u(()=>(e.playSelect(),e.setOverlayMode(_.ADMIN,{buttonActions:[()=>{e.revertMode(),e.revertMode()},()=>{e.revertMode(),e.revertMode()}]},h),!0),"handler")})}),l.push({label:"Cancel",handler:u(()=>(e.revertMode(),!0),"handler")}),s.ui.setOverlayMode(_.OPTION_SELECT,{options:l,delay:0}),!0},"handler"),keepOpen:!0}),a.push({label:g.t("menuUiHandler:cancel"),handler:u(()=>(s.ui.revertMode(),!0),"handler")}),this.communityConfig={xOffset:98,options:a},this.setCursor(0)}show(e){return this.render(),super.show(e),this.menuOptions=Ds(ks).map(t=>Number.parseInt(ks[t])).filter(t=>!this.excludedMenus().some(i=>i.condition&&i.options.includes(t))),this.menuContainer.setVisible(!0),this.setCursor(0),this.getUi().moveTo(this.menuContainer,this.getUi().length-1),this.getUi().hideTooltip(),s.playSound("ui/menu_open"),this.menuContainer.bringToTop(this.tutorialOverlay),this.menuContainer.bringToTop(this.menuMessageBoxContainer),Rs(zt.Menu),this.bgmBar.toggleBgmBar(!0),!0}processInput(e){var a,r;const t=this.getUi();let i=!1,n=!1;if(e===I.ACTION){let o=this.cursor;const l=this.excludedMenus().find(h=>h.condition);if(l!==void 0&&l.options!==void 0&&l.options.length>0){const h=l.options.sort();for(const c of h)if(o>=c)o++;else break}switch(this.showText("",0),o){case 0:t.setOverlayMode(_.SETTINGS),i=!0;break;case 1:t.setOverlayMode(_.ACHIEVEMENTS),i=!0;break;case 2:t.setOverlayMode(_.GAME_STATS),i=!0;break;case 3:s.gameData.eggs.length?(t.revertMode(),t.setOverlayMode(_.EGG_LIST),i=!0):(t.showText(g.t("menuUiHandler:noEggs"),null,()=>t.showText(""),de(1500)),n=!0);break;case 4:t.revertMode(),t.setOverlayMode(_.EGG_GACHA),i=!0;break;case 5:t.revertMode(),t.setOverlayMode(_.POKEDEX),i=!0;break;case 6:this.manageDataConfig.options.some(c=>c.label===g.t("menuUiHandler:linkDiscord")||c.label===g.t("menuUiHandler:unlinkDiscord"))||this.manageDataConfig.options.splice(this.manageDataConfig.options.length-1,0,{label:((a=ke)==null?void 0:a.discordId)===""?g.t("menuUiHandler:linkDiscord"):g.t("menuUiHandler:unlinkDiscord"),handler:u(()=>{var c;if(((c=ke)==null?void 0:c.discordId)===""){const d=Or(js),T=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&state=${d}&prompt=none`;return window.open(T,"_self"),!0}return qe.unlinkDiscord().then(d=>{rs().then(()=>s.reset(!0,!0))}),!0},"handler")},{label:((r=ke)==null?void 0:r.googleId)===""?g.t("menuUiHandler:linkGoogle"):g.t("menuUiHandler:unlinkGoogle"),handler:u(()=>{var c;if(((c=ke)==null?void 0:c.googleId)===""){const d=Or(js),T=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&response_type=code&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&scope=openid&state=${d}`;return window.open(T,"_self"),!0}return qe.unlinkGoogle().then(d=>{rs().then(()=>s.reset(!0,!0))}),!0},"handler")}),t.setOverlayMode(_.MENU_OPTION_SELECT,this.manageDataConfig),i=!0;break;case 7:t.setOverlayMode(_.MENU_OPTION_SELECT,this.communityConfig),i=!0;break;case 8:if(s.currentBattle){i=!0;const c=u(()=>{t.setMode(_.LOADING,{buttonActions:[],fadeOut:u(()=>s.gameData.saveAll(!0,!0,!0,!0).then(()=>{s.reset(!0)}),"fadeOut")})},"doSaveQuit");s.currentBattle.turn>1?t.showText(g.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(_.CONFIRM,c,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):c()}else n=!0;break;case 9:i=!0;const h=u(()=>{t.setMode(_.LOADING,{buttonActions:[],fadeOut:u(()=>qe.account.logout().then(()=>{rs().then(()=>s.reset(!0,!0))}),"fadeOut")})},"doLogout");s.currentBattle?t.showText(g.t("menuUiHandler:losingProgressionWarning"),null,()=>{if(!this.active){this.showText("",0);return}t.setOverlayMode(_.CONFIRM,h,()=>{t.revertMode(),this.showText("",0)},!1,-98)}):h();break}}else if(e===I.CANCEL)i=!0,t.revertMode().then(o=>{o||t.setMode(_.MESSAGE)});else switch(e){case I.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case I.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break}return i?t.playSelect():n&&t.playError(),i||n}setDialogTestMode(e){this.menuMessageBox.setVisible(!e),this.dialogueMessageBox.setVisible(e),this.message.setWordWrapWidth(e?s.ui.getMessageHandler().wordWrapWidth:this.defaultWordWrapWidth),this.message.setX(e?this.textPadding+1:this.textPadding),this.message.setY(e?this.textPadding+.4:this.textPadding)}showText(e,t,i,n,a,r){this.menuMessageBoxContainer.setVisible(!!e),super.showText(e,t,i,n,a,r)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale),t}clear(){super.clear(),this.menuContainer.setVisible(!1),this.bgmBar.toggleBgmBar(!1),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(rc,"MenuUiHandler");let Xr=rc;const us={ACHIEVEMENTS:0,VOUCHERS:1},jT={de:{TextSize:"80px"}},oc=class oc extends _t{constructor(e=null){super(e),this.ROWS=4,this.COLS=17,this.achvsTotal=Object.keys(Ae).length,this.vouchersTotal=Object.keys(Nt).length,this.scrollCursor=0}setup(){var m;const e=this.getUi(),t=s.game.canvas.width/6,i=s.game.canvas.height/6;this.mainContainer=s.add.container(1,-i+1),this.mainContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,t,i),Phaser.Geom.Rectangle.Contains),this.headerBg=me(0,0,t-2,24),this.headerText=D(0,0,"",O.SETTINGS_LABEL).setOrigin(0).setPositionRelative(this.headerBg,8,4),this.headerActionButton=new Phaser.GameObjects.Sprite(s,0,0,"keyboard","ACTION.png").setOrigin(0).setPositionRelative(this.headerBg,236,6),this.headerActionText=D(0,0,"",O.WINDOW,{fontSize:"60px"}).setOrigin(0).setPositionRelative(this.headerBg,264,8);const n=s.gameData.gender??Fe.MALE,a=Fe[n].toLowerCase();this.achvsName=g.t("achv:Achievements.name",{context:a}),this.vouchersName=g.t("voucher:vouchers"),this.iconsBg=me(0,this.headerBg.height,t-2,i-this.headerBg.height-68).setOrigin(0);const r=6;this.scrollBar=new ys(this.iconsBg.width-9,this.iconsBg.y+r,4,this.iconsBg.height-r*2,this.ROWS),this.iconsContainer=s.add.container(5,this.headerBg.height+8),this.icons=[];for(let C=0;C<this.ROWS*this.COLS;C++){const b=C%this.COLS*18,S=Math.floor(C/this.COLS)*18,x=s.add.sprite(b,S,"items","unknown").setOrigin(0).setScale(.5);this.icons.push(x),this.iconsContainer.add(x)}const o=me(0,this.headerBg.height+this.iconsBg.height,174,24);this.titleBg=o,this.titleText=D(0,0,"",O.WINDOW).setOrigin();const l=((m=jT[g.language])==null?void 0:m.TextSize)??this.titleText.style.fontSize;this.titleText.setFontSize(l);const h=o.x+o.width/2,c=o.y+o.height/2;this.titleText.setPosition(h,c),this.scoreContainer=s.add.container(o.x+o.width,o.y);const d=me(0,0,46,24);this.scoreText=D(d.width/2,d.height/2,"",O.WINDOW).setOrigin(),this.scoreContainer.add([d,this.scoreText]);const f=me(this.scoreContainer.x+d.width,o.y,98,24);this.unlockText=D(0,0,"",O.WINDOW).setPositionRelative(f,f.width/2,f.height/2).setOrigin();const p=me(0,o.y+o.height,t-2,42),T=D(0,0,"",O.WINDOW,{maxLines:2}).setWordWrapWidth(1870).setOrigin(0).setPositionRelative(p,8,4);this.message=T,this.mainContainer.add([this.headerBg,this.headerActionButton,this.headerText,this.headerActionText,this.iconsBg,this.scrollBar,this.iconsContainer,o,this.titleText,this.scoreContainer,f,this.unlockText,p,T]),e.add(this.mainContainer),this.currentPage=us.ACHIEVEMENTS,this.mainContainer.setVisible(!1)}show(e){return super.show(e),this.headerBgX=this.headerBg.getTopRight().x,this.updateAchvIcons(),this.mainContainer.setVisible(!0),this.setCursor(0),this.setScrollCursor(0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.getUi().moveTo(this.mainContainer,this.getUi().length-1),this.getUi().hideTooltip(),!0}showAchv(e){const t=s.gameData.gender??Fe.MALE,i=Fe[t].toLowerCase();e.name=g.t(`achv:${e.localizationKey}.name`,{context:i}),e.description=bf(e.localizationKey);const n=s.gameData.achvUnlocks,a=n.hasOwnProperty(e.id),r=!a&&e.secret&&(!e.parentId||!n.hasOwnProperty(e.parentId));this.titleText.setText(a?e.name:"???"),this.showText(r?"":e.description),this.scoreText.setText(`${e.score}pt`),this.unlockText.setText(a?new Date(n[e.id]).toLocaleDateString():g.t("achv:Locked.name"))}showVoucher(e){const t=s.gameData.voucherUnlocks,i=t.hasOwnProperty(e.id);this.titleText.setText(Fg(e.voucherType)),this.showText(e.description),this.unlockText.setText(i?new Date(t[e.id]).toLocaleDateString():g.t("voucher:locked"))}processActionInput(){return this.setScrollCursor(0),this.currentPage===us.ACHIEVEMENTS?(this.currentPage=us.VOUCHERS,this.updateVoucherIcons()):this.currentPage===us.VOUCHERS&&(this.currentPage=us.ACHIEVEMENTS,this.updateAchvIcons()),this.setCursor(0,!0),this.scrollBar.setTotalRows(Math.ceil(this.currentTotal/this.COLS)),this.scrollBar.setScrollCursor(0),this.mainContainer.update(),!0}processUpInput(){if(this.cursor>=this.COLS)return this.setCursor(this.cursor-this.COLS);if(this.scrollCursor)return this.setScrollCursor(this.scrollCursor-1);const e=this.setScrollCursor(Math.ceil(this.currentTotal/this.COLS)-this.ROWS);let t=this.cursor+(this.ROWS-1)*this.COLS;return t>this.currentTotal-this.scrollCursor*this.COLS-1&&(t-=this.COLS),e&&this.setCursor(t)}processDownInput(){const e=Math.floor(this.cursor/this.COLS),t=this.scrollCursor*this.COLS,i=t+1<this.currentTotal;return e>=this.ROWS-1?this.scrollCursor<Math.ceil(this.currentTotal/this.COLS)-this.ROWS&&i?this.setScrollCursor(this.scrollCursor+1):this.setScrollCursor(0)&&this.setCursor(this.cursor%this.COLS):i?this.setCursor(Math.min(this.cursor+this.COLS,this.currentTotal-t-1)):!1}processLeftInput(){const e=this.scrollCursor*this.COLS;return this.cursor%this.COLS===0?this.setCursor(Math.min(this.cursor+this.COLS-1,this.currentTotal-e-1)):this.setCursor(this.cursor-1)}processRightInput(){const e=this.scrollCursor*this.COLS;return(this.cursor+1)%this.COLS===0||this.cursor+e===this.currentTotal-1?this.setCursor(this.cursor-this.cursor%this.COLS):this.setCursor(this.cursor+1)}processInput(e){let t=!1;switch(e){case I.ACTION:t=this.processActionInput();break;case I.CANCEL:t=!0,s.ui.revertMode();break;case I.UP:t=this.processUpInput();break;case I.DOWN:t=this.processDownInput();break;case I.LEFT:t=this.processLeftInput();break;case I.RIGHT:t=this.processRightInput();break}return t&&this.getUi().playSelect(),t}setCursor(e,t){const i=super.setCursor(e);let n=i;if(this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight",void 0,16,16,1,1,1,1).setOrigin(0),this.iconsContainer.add(this.cursorObj),n=!0),this.cursorObj.setPositionRelative(this.icons[this.cursor],0,0),!n&&!t)return i;switch(this.currentPage){case us.ACHIEVEMENTS:t&&(this.titleBg.width=174,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!0)),this.showAchv(Ae[Object.keys(Ae)[e+this.scrollCursor*this.COLS]]);break;case us.VOUCHERS:t&&(this.titleBg.width=220,this.titleText.x=this.titleBg.width/2,this.scoreContainer.setVisible(!1)),this.showVoucher(Nt[Object.keys(Nt)[e+this.scrollCursor*this.COLS]]);break}return i}setScrollCursor(e){if(e===this.scrollCursor)return!1;this.scrollCursor=e,this.scrollBar.setScrollCursor(this.scrollCursor);const t=Math.min(this.cursor,this.currentTotal-this.scrollCursor*this.COLS-1);switch(t!==this.cursor&&this.setCursor(t),this.currentPage){case us.ACHIEVEMENTS:this.updateAchvIcons(),this.showAchv(Ae[Object.keys(Ae)[this.cursor+this.scrollCursor*this.COLS]]);break;case us.VOUCHERS:this.updateVoucherIcons(),this.showVoucher(Nt[Object.keys(Nt)[this.cursor+this.scrollCursor*this.COLS]]);break}return!0}updateIcons(e,t,i,n,a,r){this.headerText.text=i,this.headerActionText.text=n;const o=this.headerBgX-this.headerActionText.displayWidth-8;this.headerActionText.setX(o),this.headerActionButton.setX(o-this.headerActionButton.displayWidth-4);const l=this.scrollCursor*this.COLS,h=this.ROWS*this.COLS,c=e.slice(l,h+l);c.forEach((d,f)=>{const p=this.icons[f],T=t.hasOwnProperty(d.id);let m=!T;if(r){const C=d,b=!T&&C.secret&&(!C.parentId||!t.hasOwnProperty(C.parentId));m&&(m=!b),p.setFrame(b?"unknown":C.iconImage)}else p.setFrame(Gs(d.voucherType));p.setVisible(!0),m?p.setTintFill(0):p.clearTint()}),c.length<this.icons.length&&this.icons.slice(c.length).forEach(d=>d.setVisible(!1)),this.currentTotal=a}updateAchvIcons(){this.updateIcons(Object.values(Ae),s.gameData.achvUnlocks,this.achvsName,this.vouchersName,this.achvsTotal,!0)}updateVoucherIcons(){this.updateIcons(Object.values(Nt),s.gameData.voucherUnlocks,this.vouchersName,this.achvsName,this.vouchersTotal,!1)}clear(){super.clear(),this.currentPage=us.ACHIEVEMENTS,this.mainContainer.setVisible(!1),this.setScrollCursor(0),this.setCursor(0,!0),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}};u(oc,"AchvsUiHandler");let qr=oc;const lc=class lc extends sn{constructor(e=_.OPTION_SELECT){super(e)}getWindowWidth(){return 64}};u(lc,"OptionSelectUiHandler");let ln=lc;const hc=class hc extends ts{constructor(){super(_.EGG_HATCH_SCENE),this.eventTarget=new EventTarget}setup(){this.eggHatchContainer=s.add.container(0,-s.game.canvas.height/6),s.fieldUI.add(this.eggHatchContainer);const e=s.anims.generateFrameNames("egg_lightrays",{start:0,end:3});s.anims.exists("egg_lightrays")||s.anims.create({key:"egg_lightrays",frames:e,frameRate:32})}show(e){return super.show(e),this.getUi().showText("",0),s.setModifiersVisible(!1),!0}processInput(e){if(e===I.ACTION||e===I.CANCEL){const t=s.phaseManager.getCurrentPhase();if(t!=null&&t.is("EggHatchPhase")&&t.trySkip())return!0}return s.ui.getMessageHandler().processInput(e)}setCursor(e){return!1}clear(){super.clear(),this.eggHatchContainer.removeAll(!0),this.getUi().hideTooltip()}};u(hc,"EggHatchSceneHandler");let Qr=hc;const cc=class cc{constructor(e,t,i){this.handler=e,this.ROWS=t,this.COLUMNS=i,this.scrollCursor=0,this.cursor=0,this.totalElements=t*i}withScrollBar(e){return this.scrollBar=e,this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this}withUpdateGridCallBack(e){return this.updateGridCallback=e,this}withUpdateSingleElementCallback(e){return this.updateDetailsCallback=e,this}setTotalElements(e){this.totalElements=e,this.scrollBar&&this.scrollBar.setTotalRows(Math.ceil(this.totalElements/this.COLUMNS)),this.setScrollCursor(0)}getItemOffset(){return this.scrollCursor*this.COLUMNS}processInput(e){let t=!1;const i=Math.min(this.ROWS,Math.ceil(this.totalElements/this.COLUMNS)),n=Math.max(0,Math.ceil(this.totalElements/this.COLUMNS)-i),a=Math.floor(this.cursor/this.COLUMNS),r=this.cursor%this.COLUMNS,o=this.scrollCursor*this.COLUMNS,l=Math.min(this.totalElements-1,this.totalElements-n*this.COLUMNS-1);switch(e){case I.UP:if(a>0)t=this.setCursor(this.cursor-this.COLUMNS);else if(this.scrollCursor>0)t=this.setScrollCursor(this.scrollCursor-1);else{let h=this.cursor+(i-1)*this.COLUMNS;h>l&&(h-=this.COLUMNS),t=this.setScrollCursor(n,h)}break;case I.DOWN:a<i-1?t=this.setCursor(Math.min(this.cursor+this.COLUMNS,this.totalElements-o-1)):this.scrollCursor<n?t=this.setScrollCursor(this.scrollCursor+1):t=this.setScrollCursor(0,this.cursor%this.COLUMNS);break;case I.LEFT:r>0?t=this.setCursor(this.cursor-1):this.scrollCursor===n&&a===i-1?t=this.setCursor(l):t=this.setCursor(this.cursor+this.COLUMNS-1);break;case I.RIGHT:r<this.COLUMNS-1&&this.cursor+o<this.totalElements-1?t=this.setCursor(this.cursor+1):t=this.setCursor(this.cursor-r);break}return t}reset(){this.setScrollCursor(0),this.setCursor(0)}setCursor(e){return this.cursor=e,this.handler.setCursor(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;i&&(this.scrollCursor=e,this.scrollBar&&this.scrollBar.setScrollCursor(e),this.updateGridCallback&&this.updateGridCallback());let n=!1;const a=this.cursor+this.scrollCursor*this.COLUMNS;return t!==void 0?n=this.setCursor(t):a>=this.totalElements?n=this.setCursor(this.totalElements-this.scrollCursor*this.COLUMNS-1):i&&this.updateDetailsCallback&&this.updateDetailsCallback(a),i||n}};u(cc,"ScrollableGridUiHandler");let Ca=cc;const uc=class uc extends _t{constructor(){super(_.EGG_LIST),this.ROWS=9,this.COLUMNS=11}setup(){const e=this.getUi();this.eggListContainer=s.add.container(0,-s.game.canvas.height/6).setVisible(!1),e.add(this.eggListContainer);const t=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,26720).setOrigin(0),i=s.add.image(0,0,"egg_list_bg").setOrigin(0);this.iconAnimHandler=new za,this.iconAnimHandler.setup(),this.eggNameText=D(8,68,"",O.SUMMARY).setOrigin(0),this.eggDateText=D(8,91,"",O.TOOLTIP_CONTENT),this.eggHatchWavesText=D(8,108,"",O.TOOLTIP_CONTENT).setWordWrapWidth(540),this.eggGachaInfoText=D(8,152,"",O.TOOLTIP_CONTENT).setWordWrapWidth(540),this.eggListIconContainer=s.add.container(113,5),this.cursorObj=s.add.image(0,0,"select_cursor").setOrigin(0),this.eggSprite=s.add.sprite(54,37,"egg");const n=new ys(310,5,4,170,this.ROWS);this.scrollGridHandler=new Ca(this,this.ROWS,this.COLUMNS).withScrollBar(n).withUpdateGridCallBack(()=>this.updateEggIcons()).withUpdateSingleElementCallback(r=>this.setEggDetails(r)),this.eggListMessageBoxContainer=s.add.container(0,s.game.canvas.height/6).setVisible(!1);const a=me(1,-1,318,28).setOrigin(0,1);this.eggListMessageBoxContainer.add(a),this.message=D(8,-8,"",O.WINDOW,{maxLines:1}).setActive(!1).setVisible(!1),this.cursor=-1,this.eggListContainer.add([t,i,me(1,85,106,22),me(1,102,106,50,!0),me(1,147,106,32,!0),me(107,1,212,178),this.eggNameText,this.eggDateText,this.eggHatchWavesText,this.eggGachaInfoText,this.eggListIconContainer,this.cursorObj,this.eggSprite,n])}show(e){return super.show(e),this.initEggIcons(),this.getUi().bringToTop(this.eggListContainer),this.eggListContainer.setVisible(!0),this.scrollGridHandler.setTotalElements(s.gameData.eggs.length),this.updateEggIcons(),this.setCursor(0),!0}initEggIcons(){this.eggIcons=[];for(let e=0;e<Math.min(this.ROWS*this.COLUMNS,s.gameData.eggs.length);e++){const t=e%this.COLUMNS*18,i=Math.floor(e/this.COLUMNS)*18,n=s.add.sprite(t-2,i+2,"egg_icons").setScale(.5).setOrigin(0);this.eggListIconContainer.add(n),this.eggIcons.push(n)}}updateEggIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(this.eggIcons.length,s.gameData.eggs.length-e);this.eggIcons.forEach((i,n)=>{if(n!==this.cursor&&this.iconAnimHandler.addOrUpdate(i,xt.NONE),n<t){const a=s.gameData.eggs[n+e];i.setFrame(a.getKey()).setVisible(!0)}else i.setVisible(!1)})}setEggDetails(e){const t=s.gameData.eggs[e];this.eggSprite.setFrame(`egg_${t.getKey()}`),this.eggNameText.setText(`${g.t("egg:egg")} (${t.getEggDescriptor()})`),this.eggDateText.setText(new Date(t.timestamp).toLocaleString(void 0,{weekday:"short",year:"numeric",month:"2-digit",day:"numeric"})),this.eggHatchWavesText.setText(t.getEggHatchWavesMessage()),this.eggGachaInfoText.setText(t.getEggTypeDescriptor())}processInput(e){const t=this.getUi();let i=!1;return e===I.CANCEL?(t.revertMode(),i=!0):i=this.scrollGridHandler.processInput(e),i&&t.playSelect(),i}setCursor(e){let t=!1;const i=this.cursor;if(t=super.setCursor(e),t){const n=this.eggIcons[e];this.cursorObj.setPositionRelative(n,114,5),i>-1&&this.iconAnimHandler.addOrUpdate(this.eggIcons[i],xt.NONE),this.iconAnimHandler.addOrUpdate(n,xt.ACTIVE),this.setEggDetails(e+this.scrollGridHandler.getItemOffset())}return t}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.eggListContainer.setVisible(!1),this.iconAnimHandler.removeAll(),this.eggListIconContainer.removeAll(!0),this.eggIcons=[]}};u(uc,"EggListUiHandler");let Zr=uc;const dc=class dc extends _t{constructor(){super(_.EGG_GACHA),this.scale=.1666666667,this.legendaryExpiration=D(0,0,"",O.WINDOW_ALT),this.gachaContainers=[],this.gachaKnobs=[],this.gachaHatches=[],this.gachaInfoContainers=[],this.voucherCountLabels=[],this.defaultText=g.t("egg:selectMachine")}setup(){this.gachaCursor=0,this.scale=Ai(O.WINDOW,s.uiTheme).scale;const e=this.getUi();this.eggGachaContainer=s.add.container(0,-s.game.canvas.height/6),this.eggGachaContainer.setVisible(!1),e.add(this.eggGachaContainer);const t=s.add.nineslice(0,0,"default_bg",void 0,320,180,0,0,16,0);t.setOrigin(0,0),this.eggGachaContainer.add(t);const i=s.anims.generateFrameNames("gacha_hatch",{suffix:".png",start:1,end:4});s.anims.exists("open")||s.anims.create({key:"open",frames:i,frameRate:12}),s.anims.exists("close")||s.anims.create({key:"close",frames:i.reverse(),frameRate:12}),hi(Os).forEach((T,m)=>{const C=Os[T].toString().toLowerCase(),b=s.add.container(180*m,18),S=s.add.sprite(0,0,`gacha_${C}`);S.setOrigin(0,0);const x=s.add.sprite(115,80,`gacha_underlay_${C}`);x.setOrigin(0,0);const A=s.add.sprite(0,0,"gacha_eggs");A.setOrigin(0,0);const w=s.add.sprite(0,0,"gacha_glass");w.setOrigin(0,0);const k=s.add.container(160,46),B=g.resolvedLanguage??"en";let X=O.WINDOW_ALT,L=4,Q=0,te=-20,P=6;["de","es-ES","es-MX","fr","ko","pt-BR","ru"].includes(B)&&(X=O.SMALLER_WINDOW_ALT,L=2,Q=2);let H=L,v=Q;["de","es-ES","es-MX"].includes(B)&&(te=-25,P=10,H=-6,v=0);const F=D(L,Q,g.t("egg:legendaryUPGacha"),X);switch(F.setOrigin(0,0),k.add(F),T){case Os.LEGENDARY:["de","es-ES"].includes(B)&&(F.setAlign("center"),F.setY(0)),["pt-BR"].includes(B)?F.setX(H-2):F.setX(H),F.setY(v);const ce=s.add.sprite(te,P,"pokemon_icons_0");["pt-BR"].includes(B)&&ce.setX(te-2),ce.setScale(.5),ce.setOrigin(0,.5),k.add(ce);break;case Os.MOVE:["de","es-ES","fr","pt-BR","ru"].includes(B)&&(F.setAlign("center"),F.setY(0)),F.setText(g.t("egg:moveUPGacha")),F.setX(0),F.setOrigin(.5,0);break;case Os.SHINY:["de","fr","ko","ru"].includes(B)&&(F.setAlign("center"),F.setY(0)),F.setText(g.t("egg:shinyUPGacha")),F.setX(0),F.setOrigin(.5,0);break}const pe=s.add.sprite(191,89,"gacha_knob"),z=s.add.sprite(115,73,"gacha_hatch");z.setOrigin(0,0),b.add(A),b.add(x),b.add(S),b.add(w),b.add(pe),b.add(z),b.add(k),w.setAlpha(.5),z.setAlpha(.9),z.on("animationupdate",(ce,$)=>x.setFrame($.textureFrame==="4.png"?"open_hatch":"default")),this.gachaContainers.push(b),this.gachaKnobs.push(pe),this.gachaHatches.push(z),this.gachaInfoContainers.push(k),this.eggGachaContainer.add(b),T===Os.LEGENDARY&&(this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft()).setFontSize("64px").setPositionRelative(S,S.width/2-this.legendaryExpiration.displayWidth/2+.3,S.height/2+12.5),b.add(this.legendaryExpiration)),this.updateGachaInfo(m)}),this.eggGachaOptionsContainer=s.add.container(),this.eggGachaOptionsContainer=s.add.container(s.game.canvas.width/6,148),this.eggGachaContainer.add(this.eggGachaOptionsContainer);let n=0;switch(g.resolvedLanguage){case"ru":n=100;break;default:n=96}this.eggGachaOptionSelectBg=me(0,0,n,16+576*this.scale),this.eggGachaOptionSelectBg.setOrigin(1,1),this.eggGachaOptionsContainer.add(this.eggGachaOptionSelectBg);const a="x1",o=[{multiplier:a,description:`1 ${g.t("egg:pull")}`,icon:Gs(et.REGULAR)},{multiplier:"x10",description:`10 ${g.t("egg:pulls")}`,icon:Gs(et.REGULAR)},{multiplier:a,description:`5 ${g.t("egg:pulls")}`,icon:Gs(et.PLUS)},{multiplier:a,description:`10 ${g.t("egg:pulls")}`,icon:Gs(et.PREMIUM)},{multiplier:a,description:`25 ${g.t("egg:pulls")}`,icon:Gs(et.GOLDEN)}],l=g.resolvedLanguage??"en",h=o.map(T=>{const m=T.description.split(" ");return m[0].length<2&&(m[0]+=["zh","ko"].includes(l.substring(0,2))?" ":"  "),T.multiplier===a&&(m[0]=" "+m[0]),`     ${T.multiplier.padEnd(5)}${m.join(" ")}`}).join(`
`),c=D(0,0,`${h}
${g.t("menu:cancel")}`,O.WINDOW);c.setLineSpacing(28),c.setFontSize("80px"),this.eggGachaOptionsContainer.add(c),c.setPositionRelative(this.eggGachaOptionSelectBg,16,9),o.forEach((T,m)=>{const C=s.add.sprite(0,0,"items",T.icon);C.setScale(3*this.scale),C.setPositionRelative(this.eggGachaOptionSelectBg,20,9+(48+m*96)*this.scale),this.eggGachaOptionsContainer.add(C)}),this.eggGachaContainer.add(this.eggGachaOptionsContainer),new Array(Ds(et).length).fill(null).map((T,m)=>{const C=s.add.container(s.game.canvas.width/6-56*m,0),b=me(0,0,56,22);b.setOrigin(1,0),C.add(b);const S=D(-48,3,"0",O.WINDOW);S.setOrigin(0,0),C.add(S),this.voucherCountLabels.push(S);const x=Gs(m),A=s.add.sprite(-19,2,"items",x);A.setOrigin(0,0),A.setScale(.5),C.add(A),this.eggGachaContainer.add(C)}),this.eggGachaOverlay=s.add.rectangle(0,0,t.displayWidth,t.displayHeight,0),this.eggGachaOverlay.setOrigin(0,0),this.eggGachaOverlay.setAlpha(0),this.eggGachaContainer.add(this.eggGachaOverlay),this.eggGachaSummaryContainer=s.add.container(0,0),this.eggGachaSummaryContainer.setVisible(!1),this.eggGachaContainer.add(this.eggGachaSummaryContainer);const d=s.add.container(0,148),f=me(0,0,320,32);f.setOrigin(0,0),d.add(f),this.eggGachaMessageBox=f;const p=D(8,8,"",O.WINDOW,{maxLines:2});p.setOrigin(0,0),d.add(p),this.message=p,this.initTutorialOverlay(this.eggGachaContainer),this.eggGachaContainer.add(d),this.initPromptSprite(d),this.setCursor(0)}show(e){super.show(e),this.getUi().showText(this.defaultText,0),this.setGachaCursor(1);for(let t=0;t<this.gachaContainers.length;t++)this.updateGachaInfo(t);return this.updateVoucherCounts(),this.getUi().bringToTop(this.eggGachaContainer),this.eggGachaContainer.setVisible(!0),Rs(zt.Egg_Gacha),this.legendaryGachaTimer(),!0}getDelayValue(e){return this.transitioning&&this.transitionCancelled&&(e=Math.ceil(e/5)),de(e)}pull(e=0,t=0,i){ne.EGG_GACHA_PULL_COUNT_OVERRIDE&&!t&&(e=ne.EGG_GACHA_PULL_COUNT_OVERRIDE),this.eggGachaOptionsContainer.setVisible(!1),this.setTransitioning(!0);const n=u(()=>{if(this.transitionCancelled)return this.showSummary(i);const a=s.add.sprite(127,75,"egg",`egg_${i[t].getKey()}`);a.setScale(.5),this.gachaContainers[this.gachaCursor].add(a),this.gachaContainers[this.gachaCursor].moveTo(a,2);const r=u(()=>{s.playSound("se/gacha_running",{loop:!0}),s.time.delayedCall(this.getDelayValue(t?500:1250),()=>{s.playSound("se/gacha_dispense"),s.time.delayedCall(this.getDelayValue(750),()=>{s.sound.stopByKey("se/gacha_running"),s.tweens.add({targets:a,duration:this.getDelayValue(350),y:95,ease:"Bounce.easeOut",onComplete:u(()=>{s.time.delayedCall(this.getDelayValue(125),()=>{s.playSound("se/pb_catch"),this.gachaHatches[this.gachaCursor].play("open"),s.tweens.add({targets:a,duration:this.getDelayValue(350),scale:.75,ease:"Sine.easeIn"}),s.tweens.add({targets:a,y:110,duration:this.getDelayValue(350),ease:"Back.easeOut",onComplete:u(()=>{this.gachaHatches[this.gachaCursor].play("close"),s.tweens.add({targets:a,y:200,duration:this.getDelayValue(350),ease:"Cubic.easeIn",onComplete:u(()=>{++t<e?this.pull(e,t,i):this.showSummary(i)},"onComplete")})},"onComplete")})})},"onComplete")})})})},"doPullAnim");t?r():(s.playSound("se/gacha_dial"),s.tweens.add({targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:90,ease:"Cubic.easeInOut",onComplete:u(()=>{s.tweens.add({targets:this.gachaKnobs[this.gachaCursor],duration:this.getDelayValue(350),angle:0,ease:"Sine.easeInOut"}),s.time.delayedCall(this.getDelayValue(350),r)},"onComplete")}))},"doPull");if(e||(e=1),t||(t=0),!i){i=[];for(let a=1;a<=e;a++){const r={pulled:!0,sourceType:this.gachaCursor};if(a===e){const l=this.getGuaranteedEggTierFromPullCount(e);!i.some(h=>h.tier>=l)&&l!==Ni.COMMON&&(r.tier=l)}const o=new ui(r);i.push(o)}i=hf(i),(s.currentBattle?s.gameData.saveAll(!0,!0,!0):s.gameData.saveSystem()).then(a=>{if(!a)return s.reset(!0);n()});return}n()}getGuaranteedEggTierFromPullCount(e){switch(e){case 10:return Ni.RARE;case 25:return Ni.EPIC;default:return Ni.COMMON}}showSummary(e){const t=this.getDelayValue(750);this.summaryFinished=!1,this.transitionCancelled=!1,this.setTransitioning(!0),this.eggGachaSummaryContainer.setVisible(!0);const i=e.length<20?1:.5;s.tweens.add({targets:this.eggGachaOverlay,alpha:.5,ease:"Sine.easeOut",duration:t,onComplete:u(()=>{const a=Math.ceil(e.length/5),r=Math.min(e.length,5),o=this.eggGachaOverlay.displayHeight-this.eggGachaMessageBox.displayHeight;e.map((h,c)=>{const d=c%5,f=Math.floor(c/5),p=this.eggGachaOverlay.displayWidth/(r+2),T=o/(a+2),m=T/2*(f/Math.max(a-1,1))+T/4,C=s.add.container(p*(d+1)+p*.5,T*(f+1)+m);C.setScale(1e-4);const b=s.add.sprite(0,0,"egg",`egg_${h.getKey()}`);C.add(b);const S=D(0,14,h.getEggDescriptor(),O.PARTY,{align:"center"});return S.setOrigin(.5,0),S.setTint(Ug(h.isManaphyEgg()?Ni.EPIC:h.tier)),C.add(S),this.eggGachaSummaryContainer.addAt(C,0),C}).forEach((h,c)=>{const d=this.transitionCancelled?0:this.getDelayValue(c*100);s.time.delayedCall(d,()=>s.tweens.add({targets:h,duration:this.getDelayValue(350),scale:i,ease:"Sine.easeOut",onComplete:u(()=>{c===e.length-1&&(this.setTransitioning(!1),this.summaryFinished=!0)},"onComplete")}))})},"onComplete")})}hideSummary(){this.setTransitioning(!0),s.tweens.add({targets:[this.eggGachaOverlay,this.eggGachaSummaryContainer],alpha:0,duration:this.getDelayValue(250),ease:"Cubic.easeIn",onComplete:u(()=>{this.eggGachaSummaryContainer.setVisible(!1),this.eggGachaSummaryContainer.setAlpha(1),this.eggGachaSummaryContainer.removeAll(!0),this.setTransitioning(!1),this.summaryFinished=!1,this.eggGachaOptionsContainer.setVisible(!0)},"onComplete")})}updateGachaInfo(e){const t=this.gachaInfoContainers[e];switch(e){case Os.LEGENDARY:const i=Dt(Vg(new Date().getTime()));t.getAt(1).setTexture(i.getIconAtlasKey(),i.getIconId(!1));break}}consumeVouchers(e,t){s.gameData.voucherCounts[e]=Math.max(s.gameData.voucherCounts[e]-t,0),this.updateVoucherCounts()}updateVoucherCounts(){this.voucherCountLabels.forEach((e,t)=>{e.setText(s.gameData.voucherCounts[t].toString())})}showText(e,t,i,n,a,r){e||(e=this.defaultText),(e==null?void 0:e.indexOf(`
`))===-1?(this.eggGachaMessageBox.setSize(320,32),this.eggGachaMessageBox.setY(0),this.message.setY(8)):(this.eggGachaMessageBox.setSize(320,46),this.eggGachaMessageBox.setY(-14),this.message.setY(-6)),super.showText(e,t,i,n,a,r)}showError(e){this.showText(e,void 0,()=>this.showText(this.defaultText),de(1500))}setTransitioning(e){this.transitioning!==e&&(this.transitioning=e,this.transitionCancelled=!1)}processInput(e){const t=this.getUi();let i=!1,n=!1;if(this.transitioning)if(!this.transitionCancelled&&(e===I.ACTION||e===I.CANCEL))this.transitionCancelled=!0,i=!0;else return!1;else if(this.eggGachaSummaryContainer.visible)this.summaryFinished&&(e===I.ACTION||e===I.CANCEL)&&(this.hideSummary(),i=!0);else switch(e){case I.ACTION:switch(this.cursor){case 0:!s.gameData.voucherCounts[et.REGULAR]&&!ne.EGG_FREE_GACHA_PULLS_OVERRIDE?(n=!0,this.showError(g.t("egg:notEnoughVouchers"))):s.gameData.eggs.length<99||ne.UNLIMITED_EGG_COUNT_OVERRIDE?(ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(et.REGULAR,1),this.pull(),i=!0):(n=!0,this.showError(g.t("egg:tooManyEggs")));break;case 2:!s.gameData.voucherCounts[et.PLUS]&&!ne.EGG_FREE_GACHA_PULLS_OVERRIDE?(n=!0,this.showError(g.t("egg:notEnoughVouchers"))):s.gameData.eggs.length<95||ne.UNLIMITED_EGG_COUNT_OVERRIDE?(ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(et.PLUS,1),this.pull(5),i=!0):(n=!0,this.showError(g.t("egg:tooManyEggs")));break;case 1:case 3:this.cursor===1&&s.gameData.voucherCounts[et.REGULAR]<10&&!ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.cursor===3&&!s.gameData.voucherCounts[et.PREMIUM]&&!ne.EGG_FREE_GACHA_PULLS_OVERRIDE?(n=!0,this.showError(g.t("egg:notEnoughVouchers"))):s.gameData.eggs.length<90||ne.UNLIMITED_EGG_COUNT_OVERRIDE?(this.cursor===3?ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(et.PREMIUM,1):ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(et.REGULAR,10),this.pull(10),i=!0):(n=!0,this.showError(g.t("egg:tooManyEggs")));break;case 4:!s.gameData.voucherCounts[et.GOLDEN]&&!ne.EGG_FREE_GACHA_PULLS_OVERRIDE?(n=!0,this.showError(g.t("egg:notEnoughVouchers"))):s.gameData.eggs.length<75||ne.UNLIMITED_EGG_COUNT_OVERRIDE?(ne.EGG_FREE_GACHA_PULLS_OVERRIDE||this.consumeVouchers(et.GOLDEN,1),this.pull(25),i=!0):(n=!0,this.showError(g.t("egg:tooManyEggs")));break;case 5:t.revertMode(),i=!0;break}break;case I.CANCEL:this.getUi().revertMode(),i=!0;break;case I.UP:this.cursor&&(i=this.setCursor(this.cursor-1));break;case I.DOWN:this.cursor<5&&(i=this.setCursor(this.cursor+1));break;case I.LEFT:this.gachaCursor&&(i=this.setGachaCursor(this.gachaCursor-1));break;case I.RIGHT:this.gachaCursor<Ds(Os).length-1&&(i=this.setGachaCursor(this.gachaCursor+1));break}return i?t.playSelect():n&&t.playError(),i||n}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.eggGachaOptionsContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.eggGachaOptionSelectBg,10,9+(48+this.cursor*96)*this.scale),t}setGachaCursor(e){const i=this.gachaCursor!==e;return i&&(this.gachaCursor=e,this.setTransitioning(!0),s.tweens.add({targets:this.gachaContainers,duration:this.eggGachaContainer.visible?500:0,x:u((n,a,r,o)=>180*(o-e),"x"),ease:"Cubic.easeInOut",onComplete:u(()=>this.setTransitioning(!1),"onComplete")})),i}legendaryGachaTimer(){this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null),this.playTimeTimer=s.time.addEvent({loop:!0,delay:de(1e3),callback:u(()=>{this.legendaryExpiration.setText(this.getLegendaryGachaTimeLeft())},"callback")})}getLegendaryGachaTimeLeft(){const e=864e5-Date.now()%864e5,t=`${Math.floor(e/36e5)}`,i=`${Math.floor(e%36e5/6e4)}`,n=`${Math.floor(e%6e4/1e3)}`;return`${t.padStart(2,"0")}:${i.padStart(2,"0")}:${n.padStart(2,"0")}`}clear(){super.clear(),this.setGachaCursor(-1),this.eggGachaContainer.setVisible(!1),this.playTimeTimer&&(this.playTimeTimer.destroy(),this.playTimeTimer=null)}};u(dc,"EggGachaUiHandler");let Jr=dc;const pc=class pc extends Phaser.GameObjects.Container{constructor(e,t={}){super(s,0,0),this.shinyIcons=[],this.cost=0,this.setSpecies(e,t);const i=s.add.image(2,5,"passive_bg");i.setOrigin(0,0),i.setScale(.75),i.setVisible(!1),this.add(i),this.starterPassiveBgs=i;for(let S=0;S<3;S++){const x=s.add.image(S*-3+12,2,"shiny_star_small");x.setScale(.5),x.setOrigin(0,0),x.setVisible(!1),this.shinyIcons.push(x)}this.add(this.shinyIcons);const n=D(1,2,"0",O.WINDOW,{fontSize:"32px"});n.setShadowOffset(2,2),n.setOrigin(0,0),n.setVisible(!1),this.add(n),this.label=n;const a=s.add.image(12,7,"ha_capsule");a.setOrigin(0,0),a.setScale(.5),a.setVisible(!1),this.add(a),this.hiddenAbilityIcon=a;const r=s.add.image(0,7,"favorite");r.setOrigin(0,0),r.setScale(.5),r.setVisible(!1),this.add(r),this.favoriteIcon=r;const o=s.add.image(0,12,"champion_ribbon");o.setOrigin(0,0),o.setScale(.5),o.setVisible(!1),this.add(o),this.classicWinIcon=o;const l=s.add.image(12,12,"candy");l.setOrigin(0,0),l.setScale(.25),l.setVisible(!1),this.add(l),this.candyUpgradeIcon=l;const h=s.add.image(12,12,"candy_overlay");h.setOrigin(0,0),h.setScale(.25),h.setVisible(!1),this.add(h),this.candyUpgradeOverlayIcon=h;const c=s.add.image(0,12,"mystery_egg");c.setOrigin(0,0),c.setScale(.25),c.setVisible(!1),this.add(c),this.eggMove1Icon=c;const d=s.add.image(0,12,"normal_memory");d.setOrigin(0,0),d.setScale(.25),d.setVisible(!1),this.add(d),this.tmMove1Icon=d;const f=s.add.image(7,12,"mystery_egg");f.setOrigin(0,0),f.setScale(.25),f.setVisible(!1),this.add(f),this.eggMove2Icon=f;const p=s.add.image(7,12,"normal_memory");p.setOrigin(0,0),p.setScale(.25),p.setVisible(!1),this.add(p),this.tmMove2Icon=p;const T=s.add.image(3,3,"candy");T.setOrigin(0,0),T.setScale(.25),T.setVisible(!1),this.add(T),this.passive1Icon=T;const m=s.add.image(12,12,"candy_overlay");m.setOrigin(0,0),m.setScale(.25),m.setVisible(!1),this.add(m),this.passive1OverlayIcon=m;const C=s.add.image(12,3,"candy");C.setOrigin(0,0),C.setScale(.25),C.setVisible(!1),this.add(C),this.passive2Icon=C;const b=s.add.image(12,12,"candy_overlay");b.setOrigin(0,0),b.setScale(.25),b.setVisible(!1),this.add(b),this.passive2OverlayIcon=b}setSpecies(e,t={}){this.species=e;const{shiny:i,formIndex:n,female:a,variant:r}=t,o=s.gameData.getSpeciesDefaultDexAttr(e,!1,!0),l=s.gameData.getSpeciesDexAttrProps(e,o);Ee(n)||(l.formIndex=n),Ee(i)||(l.shiny=i),Ee(r)||(l.variant=r),Ee(a)||(l.female=a),this.icon&&(this.remove(this.icon),this.icon.destroy()),this.icon=s.add.sprite(-2,2,e.getIconAtlasKey(l.formIndex,l.shiny,l.variant)),this.icon.setScale(.5),this.icon.setOrigin(0,0),this.icon.setFrame(e.getIconId(l.female,l.formIndex,l.shiny,l.variant)),this.checkIconId(l.female,l.formIndex,l.shiny,l.variant),this.add(this.icon)}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};u(pc,"PokedexMonContainer");let Sa=pc;var nt=(y=>(y[y.NAME=0]="NAME",y[y.MOVE_1=1]="MOVE_1",y[y.MOVE_2=2]="MOVE_2",y[y.ABILITY_1=3]="ABILITY_1",y[y.ABILITY_2=4]="ABILITY_2",y))(nt||{});const fc=class fc extends Phaser.GameObjects.Container{constructor(e,t,i,n,a){super(s,e,t),this.labels=[],this.selections=[],this.rows=[],this.numFilters=0,this.lastCursor=-1,this.textPadding=8,this.defaultWordWrapWidth=1224,this.defaultText="---",this.onChange=a,this.width=i,this.height=n,this.window=me(0,0,i,n,!1,!1,void 0,void 0,es.THIN),this.add(this.window),this.cursorObj=s.add.image(1,1,"cursor"),this.cursorObj.setScale(.5),this.cursorObj.setVisible(!1),this.cursorObj.setOrigin(0,0),this.add(this.cursorObj),this.menuMessageBoxContainer=s.add.container(0,130),this.menuMessageBoxContainer.setName("menu-message-box"),this.menuMessageBoxContainer.setVisible(!1),this.dialogueMessageBox=me(-this.textPadding,0,s.game.canvas.width/6+this.textPadding*2,49,!1,!1,0,0,es.THIN),this.dialogueMessageBox.setOrigin(0,0),this.menuMessageBoxContainer.add(this.dialogueMessageBox);const r=D(this.textPadding,this.textPadding,"",O.WINDOW,{maxLines:2});r.setName("menu-message"),r.setOrigin(0,0),this.menuMessageBoxContainer.add(r),this.message=r}addFilter(e,t){if(this.rows.includes(e))return!1;this.rows.push(e);const r=D(14,3,t,O.TOOLTIP_CONTENT);this.labels.push(r),this.add(r);const o=D(54,3,this.defaultText,O.TOOLTIP_CONTENT);return this.selections.push(o),this.add(o),this.calcFilterPositions(),this.numFilters++,!0}resetSelection(e){this.selections[e].setText(this.defaultText),this.onChange()}setValsToDefault(){for(let e=0;e<this.numFilters;e++)this.resetSelection(e)}startSearch(e,t){t.playSelect();const i="",n={};n.buttonActions=[a=>{t.playSelect();const o=decodeURIComponent(escape(atob(a))),l=t.getHandler();l.tutorialActive=!0,this.selections[e].setText(o===""?this.defaultText:String(g.t(o))),t.revertMode(),this.onChange()},()=>{t.revertMode(),this.onChange}],t.setOverlayMode(_.POKEDEX_SCAN,n,i,e)}setCursor(e){this.cursorObj.setPosition(8,this.labels[e].y+3),this.lastCursor=e}updateFilterLabels(){for(let e=0;e<this.numFilters;e++)this.selections[e].text===this.defaultText?this.labels[e].setColor(Oe(O.TOOLTIP_CONTENT,!1,s.uiTheme)):this.labels[e].setColor(Oe(O.STATS_LABEL,!1,s.uiTheme))}calcFilterPositions(){let t=16;this.labels.forEach(n=>{t+=n.displayHeight});const i=(this.height-t)/(this.labels.length-1);for(let n=0;n<this.labels.length;n++)if(n===0)this.labels[n].y=8,this.selections[n].y=8;else{const a=this.labels[n-1].y+this.labels[n-1].displayHeight;this.labels[n].y=a+i,this.selections[n].y=a+i}}getValue(e){return this.selections[e].getWrappedText()[0]}setValue(e,t){this.selections[e].setText(t),this.onChange()}getNearestFilter(e){const t=e.y+e.icon.displayHeight/2;let i=0,n=1e3;for(let a=0;a<this.labels.length;a++){const r=Math.abs(t-(this.labels[a].y+this.labels[a].displayHeight/3));r<n&&(i=a,n=r)}return i}};u(fc,"FilterText");let eo=fc;const Wp={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},$T=2,Hn=17,Yn=143;function yr(y){const i=y%9*18,n=13+Math.floor(y/9)*17;return{x:i,y:n}}u(yr,"calcStarterPosition");const gc=class gc extends _t{constructor(){super(_.POKEDEX),this.pokemonContainers=[],this.filteredPokemonData=[],this.filterBarCursor=0,this.oldCursor=-1,this.speciesLoaded=new Map,this.pokerusSpecies=[],this.blockInput=!1,this.textPadding=8,this.defaultMessageBoxWidth=220,this.defaultWordWrapWidth=1224,this.scale=.1666666667,this.filterTextCursor=0,this.showDecorations=!1,this.trayContainers=[],this.trayCursor=0,this.showingTray=!1,this.updateStarters=()=>{this.scrollCursor=0,this.filteredPokemonData=[],this.pokerusCursorObjs.forEach(t=>t.setVisible(!1)),this.filterBar.updateFilterLabels(),this.filterText.updateFilterLabels(),this.filteredPokemonData=[],Xe.forEach(t=>{var Mi,On,xn,_n,ki;const i=this.getStarterSpeciesId(t.speciesId),n=this.getCurrentDexProps(t.speciesId),a=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(t,n)),r={species:t,cost:s.gameData.getSpeciesStarterValue(i),props:a},o=(((Mi=s.gameData.dexData[t.speciesId])==null?void 0:Mi.caughtAttr)||BigInt(0))&(((On=s.gameData.dexData[this.getStarterSpeciesId(t.speciesId)])==null?void 0:On.caughtAttr)||BigInt(0))&t.getFullUnlocksData(),l=s.gameData.starterData[i],h=wt.hasOwnProperty(i),c=this.filterText.getValue(nt.NAME),d=t.name===c||c===this.filterText.defaultText,f=ra[t.speciesId].map(Z=>Ne[Z[1]].name),p=((xn=wt[i])==null?void 0:xn.map(Z=>Ne[Z].name))??[],T=((_n=Ef[t.speciesId])==null?void 0:_n.map(Z=>Ne[Array.isArray(Z)?Z[1]:Z].name))??[],m=this.filterText.getValue(nt.MOVE_1),C=this.filterText.getValue(nt.MOVE_2),b=t.forms.some(Z=>this.hasFormLevelMove(Z,m)),S=t.forms.some(Z=>this.hasFormLevelMove(Z,C)),x=f.includes(m)||b,A=p.includes(m),w=T.includes(m),k=f.includes(C)||S,B=p.includes(C),X=T.includes(C),L=x||A||w||m===this.filterText.defaultText,Q=k||B||X||C===this.filterText.defaultText,te=L&&Q;if(A&&!x){const Z=p.findIndex(Lt=>Lt===m);(l.eggMoves&1<<Z)===0?r.eggMove1=!1:r.eggMove1=!0}else w&&!x&&(r.tmMove1=!0);if(B&&!k){const Z=p.findIndex(Lt=>Lt===C);(l.eggMoves&1<<Z)===0?r.eggMove2=!1:r.eggMove2=!0}else X&&!k&&(r.tmMove2=!0);const P=[t.ability1,t.ability2,t.abilityHidden].map(Z=>gt[Z].name),H=[t.getPassiveAbility()];for(const Z of t.forms)H.push(Z.getPassiveAbility());const v=this.filterText.getValue(nt.ABILITY_1),F=t.forms.some(Z=>[Z.ability1,Z.ability2,Z.abilityHidden].map(Lt=>gt[Lt].name).includes(v)),pe=P.includes(v)||F||v===this.filterText.defaultText,z=Object.values(H).some(Z=>gt[Z].name===v),ce=this.filterText.getValue(nt.ABILITY_2),$=t.forms.some(Z=>[Z.ability1,Z.ability2,Z.abilityHidden].map(Lt=>gt[Lt].name).includes(ce)),Y=P.includes(ce)||$||ce===this.filterText.defaultText,W=Object.values(H).some(Z=>gt[Z].name===ce),R=pe&&(W||ce===this.filterText.defaultText)||Y&&(z||v===this.filterText.defaultText);(z||W)&&(z?l.passiveAttr>0?r.passive1=!0:r.passive1=!1:l.passiveAttr>0?r.passive2=!0:r.passive2=!1);const he=this.filterBar.getVals(xe.GEN).includes(t.generation),ae=this.filterBar.getVals(xe.TYPES).some(Z=>t.isOfType(Z-1)),oe=new Map(Object.values(Te).map((Z,Lt)=>typeof Z=="string"?[Lt,Z]:void 0).filter(Z=>Z!==void 0));oe.set(35,"Uncatchable");const Ve=oa[t.speciesId].concat(oa[i]).map(Z=>Te[Z.biome]);Ve.length===0&&Ve.push("Uncatchable");const it=Ve.length===0&&this.filterBar.getVals(xe.BIOME).length===36,Me=this.filterBar.getVals(xe.BIOME).some(Z=>Ve.includes(oe.get(Z)??""))||it,Pe=!!(o&V.NON_SHINY),Qe=!!(o&V.SHINY),Ue=Qe&&!!(o&V.DEFAULT_VARIANT),lt=Qe&&!!(o&V.VARIANT_2),ht=Qe&&!!(o&V.VARIANT_3),E=!Pe&&!Ue&&!lt&&!ht,q=this.filterBar.getVals(xe.CAUGHT).some(Z=>{if(Z==="SHINY3")return ht;if(Z==="SHINY2")return lt&&!ht;if(Z==="SHINY")return Ue&&!lt&&!ht;if(Z==="NORMAL")return Pe&&!Ue&&!lt&&!ht;if(Z==="UNCAUGHT")return E}),K=l.passiveAttr>0,N=this.isPassiveAvailable(t.speciesId)&&!K,M=this.filterBar.getVals(xe.UNLOCKS).some(Z=>{if(Z.val==="PASSIVE"&&Z.state===ee.ON)return K;if(Z.val==="PASSIVE"&&Z.state===ee.EXCLUDE)return h&&!K;if(Z.val==="PASSIVE"&&Z.state===ee.UNLOCKABLE)return N;if(Z.val==="PASSIVE"&&Z.state===ee.OFF)return!0}),U=l.valueReduction===1,J=l.valueReduction===2,se=this.isValueReductionAvailable(t.speciesId),j=this.filterBar.getVals(xe.UNLOCKS).some(Z=>{if(Z.val==="COST_REDUCTION"&&Z.state===ee.ON)return U||J;if(Z.val==="COST_REDUCTION"&&Z.state===ee.ONE)return U;if(Z.val==="COST_REDUCTION"&&Z.state===ee.TWO)return J;if(Z.val==="COST_REDUCTION"&&Z.state===ee.EXCLUDE)return h&&!(U||J);if(Z.val==="COST_REDUCTION"&&Z.state===ee.UNLOCKABLE)return se;if(Z.val==="COST_REDUCTION"&&Z.state===ee.OFF)return!0}),le=this.getStarterSpeciesId(t.speciesId)===t.speciesId,ye=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="STARTER"&&Z.state===ee.ON)return le;if(Z.val==="STARTER"&&Z.state===ee.EXCLUDE)return!le;if(Z.val==="STARTER"&&Z.state===ee.OFF)return!0}),ue=((ki=this.starterPreferences[t.speciesId])==null?void 0:ki.favorite)??!1,Ie=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="FAVORITE"&&Z.state===ee.ON)return ue;if(Z.val==="FAVORITE"&&Z.state===ee.EXCLUDE)return!ue;if(Z.val==="FAVORITE"&&Z.state===ee.OFF)return!0}),ze=l.classicWinCount>0,De=l.classicWinCount===0,Bt=l.classicWinCount===void 0,Vs=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="WIN"&&Z.state===ee.ON)return ze;if(Z.val==="WIN"&&Z.state===ee.EXCLUDE)return De||Bt;if(Z.val==="WIN"&&Z.state===ee.OFF)return!0}),$t=t.abilityHidden!==t.ability1&&t.abilityHidden!==bn.NONE,vs=l.abilityAttr&Ze.ABILITY_HIDDEN,Je=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="HIDDEN_ABILITY"&&Z.state===ee.ON)return vs;if(Z.val==="HIDDEN_ABILITY"&&Z.state===ee.EXCLUDE)return $t&&!vs;if(Z.val==="HIDDEN_ABILITY"&&Z.state===ee.OFF)return!0}),Hs=this.isSameSpeciesEggAvailable(t.speciesId),wi=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="EGG"&&Z.state===ee.ON)return Hs;if(Z.val==="EGG"&&Z.state===ee.EXCLUDE)return h&&!Hs;if(Z.val==="EGG"&&Z.state===ee.OFF)return!0}),ss=this.filterBar.getVals(xe.MISC).some(Z=>{if(Z.val==="POKERUS"&&Z.state===ee.ON)return this.pokerusSpecies.includes(t);if(Z.val==="POKERUS"&&Z.state===ee.EXCLUDE)return!this.pokerusSpecies.includes(t);if(Z.val==="POKERUS"&&Z.state===ee.OFF)return!0});d&&R&&te&&he&&Me&&ae&&q&&M&&j&&ye&&Ie&&Vs&&Je&&wi&&ss&&this.filteredPokemonData.push(r)}),this.starterSelectScrollBar.setTotalRows(Math.max(Math.ceil(this.filteredPokemonData.length/9),1)),this.starterSelectScrollBar.setScrollCursor(0);const e=this.filterBar.getVals(xe.SORT)[0];this.filteredPokemonData.sort((t,i)=>{switch(e.val){case We.NUMBER:return(t.species.speciesId-i.species.speciesId)*-e.dir;case We.COST:return(t.cost-i.cost)*-e.dir;case We.CANDY:{const n=s.gameData.starterData[this.getStarterSpeciesId(t.species.speciesId)].candyCount,a=s.gameData.starterData[this.getStarterSpeciesId(i.species.speciesId)].candyCount;return(n-a)*-e.dir}case We.IV:{const n=s.gameData.dexData[t.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[t.species.speciesId].ivs.length,a=s.gameData.dexData[i.species.speciesId].ivs.reduce((r,o)=>r+o,0)/s.gameData.dexData[i.species.speciesId].ivs.length;return(n-a)*-e.dir}case We.NAME:return t.species.name.localeCompare(i.species.name)*-e.dir;case We.CAUGHT:return(s.gameData.dexData[t.species.speciesId].caughtCount-s.gameData.dexData[i.species.speciesId].caughtCount)*-e.dir;case We.HATCHED:return(s.gameData.dexData[this.getStarterSpeciesId(t.species.speciesId)].hatchedCount-s.gameData.dexData[this.getStarterSpeciesId(i.species.speciesId)].hatchedCount)*-e.dir}return 0}),this.filteredIndices=this.filteredPokemonData.map(t=>t.species.speciesId),this.updateScroll()},this.updateScroll=()=>{const t=this.scrollCursor*9;this.starterSelectScrollBar.setScrollCursor(this.scrollCursor),this.pokerusCursorObjs.forEach(n=>n.setVisible(!1));let i=0;this.pokemonContainers.forEach((n,a)=>{var o;const r=a+t;if(r>=this.filteredPokemonData.length)n.setVisible(!1);else{n.setVisible(!0);const l=this.filteredPokemonData[r],h=l.props;n.setSpecies(l.species,h),n.icon.setTexture(l.species.getIconAtlasKey(h.formIndex,h.shiny,h.variant),n.species.getIconId(h.female,h.formIndex,h.shiny,h.variant)),n.checkIconId(h.female,h.formIndex,h.shiny,h.variant);const d=l.species.speciesId,f=s.gameData.dexData[d],p=f.caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(d)].caughtAttr&l.species.getFullUnlocksData();if(p&l.species.getFullUnlocksData()||s.dexForDevs?n.icon.clearTint():this.isSeen(l.species,f)?n.icon.setTint(8421504):n.icon.setTint(0),[[l.eggMove1,n.eggMove1Icon],[l.eggMove2,n.eggMove2Icon],[l.tmMove1,n.tmMove1Icon],[l.tmMove2,n.tmMove2Icon],[l.passive1,n.passive1Icon],[l.passive2,n.passive2Icon]].forEach(([m,C])=>{m?(C.setVisible(!0),C.clearTint()):m===!1?(C.setVisible(!0),C.setTint(8421504)):C.setVisible(!1)}),this.showDecorations){this.pokerusSpecies.includes(l.species)&&(this.pokerusCursorObjs[i].setPosition(n.x-1,n.y+1),this.pokerusCursorObjs[i].setVisible(!0),i++),this.updateStarterValueLabel(n),n.label.setVisible(!0);const m=d&&p&V.SHINY?[V.DEFAULT_VARIANT,V.VARIANT_2,V.VARIANT_3].filter(C=>!!(p&C)):[];for(let C=0;C<3;C++){const b=m.length>C;n.shinyIcons[C].setVisible(b),b&&n.shinyIcons[C].setTint(dt(m[C]===V.DEFAULT_VARIANT?0:m[C]===V.VARIANT_2?1:2))}n.starterPassiveBgs.setVisible(!!s.gameData.starterData[this.getStarterSpeciesId(d)].passiveAttr),n.hiddenAbilityIcon.setVisible(!!p&&!!(s.gameData.starterData[this.getStarterSpeciesId(d)].abilityAttr&4)),n.classicWinIcon.setVisible(s.gameData.starterData[this.getStarterSpeciesId(d)].classicWinCount>0),n.favoriteIcon.setVisible(((o=this.starterPreferences[d])==null?void 0:o.favorite)??!1),s.candyUpgradeDisplay===0?(ft[this.getStarterSpeciesId(d)]||(ft[this.getStarterSpeciesId(d)]=["ffffff","ffffff"]),n.candyUpgradeIcon.setTint(Vt(Ot(ft[this.getStarterSpeciesId(d)][0]))),n.candyUpgradeOverlayIcon.setTint(Vt(Ot(ft[this.getStarterSpeciesId(d)][1])))):s.candyUpgradeDisplay===1&&(n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1))}else{n.label.setVisible(!1);for(let m=0;m<3;m++)n.shinyIcons[m].setVisible(!1);n.starterPassiveBgs.setVisible(!1),n.hiddenAbilityIcon.setVisible(!1),n.classicWinIcon.setVisible(!1),n.favoriteIcon.setVisible(!1),n.candyUpgradeIcon.setVisible(!1),n.candyUpgradeOverlayIcon.setVisible(!1)}}})}}setup(){const e=this.getUi(),t=g.resolvedLanguage??"en",i=Object.keys(Wp).find(F=>t.includes(F))??"en",n=Wp[i];this.starterSelectContainer=s.add.container(0,-s.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=me(Yn,Hn+1,175,161),o=s.add.image(Yn+1,Hn+2,"starter_container_bg");o.setOrigin(0,0),this.starterSelectContainer.add(o),this.starterSelectContainer.add(r),this.filterTextContainer=s.add.container(0,0),this.filterText=new eo(1,Hn+2,140,100,this.updateStarters),this.filterText.addFilter(nt.NAME,g.t("filterText:nameField")),this.filterText.addFilter(nt.MOVE_1,g.t("filterText:move1Field")),this.filterText.addFilter(nt.MOVE_2,g.t("filterText:move2Field")),this.filterText.addFilter(nt.ABILITY_1,g.t("filterText:ability1Field")),this.filterText.addFilter(nt.ABILITY_2,g.t("filterText:ability2Field")),this.filterTextContainer.add(this.filterText),this.starterSelectContainer.add(this.filterTextContainer),this.filterBarContainer=s.add.container(0,0),this.filterBar=new da(Yn,1,175,Hn,2,0,6);const l=[new Se(1,new ie(g.t("pokedexUiHandler:gen1"))),new Se(2,new ie(g.t("pokedexUiHandler:gen2"))),new Se(3,new ie(g.t("pokedexUiHandler:gen3"))),new Se(4,new ie(g.t("pokedexUiHandler:gen4"))),new Se(5,new ie(g.t("pokedexUiHandler:gen5"))),new Se(6,new ie(g.t("pokedexUiHandler:gen6"))),new Se(7,new ie(g.t("pokedexUiHandler:gen7"))),new Se(8,new ie(g.t("pokedexUiHandler:gen8"))),new Se(9,new ie(g.t("pokedexUiHandler:gen9")))],h=new kt(0,0,l,this.updateStarters,Mt.HYBRID);this.filterBar.addFilter(xe.GEN,g.t("filterBar:genFilter"),h);const c=Object.keys(ve).filter(F=>Number.isNaN(Number(F))),d=[];c.forEach((F,pe)=>{if(pe===0||pe===19)return;const z=s.add.sprite(0,0,os("types"));z.setScale(.5),z.setFrame(F.toLowerCase()),d.push(new Se(pe,new ie("",z)))}),this.filterBar.addFilter(xe.TYPES,g.t("filterBar:typeFilter"),new kt(0,0,d,this.updateStarters,Mt.HYBRID,.5));const f=Object.values(Te).filter(F=>typeof F=="number").map((F,pe)=>new Se(pe,new ie(g.t(`biome:${Te[F].toUpperCase()}`))));f.push(new Se(f.length,new ie(g.t("filterBar:uncatchable"))));const p=new kt(0,0,f,this.updateStarters,Mt.HYBRID);this.filterBar.addFilter(xe.BIOME,g.t("filterBar:biomeFilter"),p);const T=s.add.sprite(0,0,"shiny_icons");T.setOrigin(.15,.2),T.setScale(.6),T.setFrame(qt(0)),T.setTint(dt(0));const m=s.add.sprite(0,0,"shiny_icons");m.setOrigin(.15,.2),m.setScale(.6),m.setFrame(qt(1)),m.setTint(dt(1));const C=s.add.sprite(0,0,"shiny_icons");C.setOrigin(.15,.2),C.setScale(.6),C.setFrame(qt(2)),C.setTint(dt(2));const b=[new Se("SHINY3",new ie("",C)),new Se("SHINY2",new ie("",m)),new Se("SHINY",new ie("",T)),new Se("NORMAL",new ie(g.t("filterBar:normal"))),new Se("UNCAUGHT",new ie(g.t("filterBar:uncaught")))];this.filterBar.addFilter(xe.CAUGHT,g.t("filterBar:caughtFilter"),new kt(0,0,b,this.updateStarters,Mt.HYBRID));const S=[new ie(g.t("filterBar:passive"),void 0,ee.OFF),new ie(g.t("filterBar:passiveUnlocked"),void 0,ee.ON),new ie(g.t("filterBar:passiveUnlockable"),void 0,ee.UNLOCKABLE),new ie(g.t("filterBar:passiveLocked"),void 0,ee.EXCLUDE)],x=[new ie(g.t("filterBar:costReduction"),void 0,ee.OFF),new ie(g.t("filterBar:costReductionUnlocked"),void 0,ee.ON),new ie(g.t("filterBar:costReductionUnlockedOne"),void 0,ee.ONE),new ie(g.t("filterBar:costReductionUnlockedTwo"),void 0,ee.TWO),new ie(g.t("filterBar:costReductionUnlockable"),void 0,ee.UNLOCKABLE),new ie(g.t("filterBar:costReductionLocked"),void 0,ee.EXCLUDE)],A=[new Se("PASSIVE",S),new Se("COST_REDUCTION",x)];this.filterBar.addFilter(xe.UNLOCKS,g.t("filterBar:unlocksFilter"),new kt(0,0,A,this.updateStarters,Mt.RADIAL));const w=[new ie(g.t("filterBar:starter"),void 0,ee.OFF),new ie(g.t("filterBar:isStarter"),void 0,ee.ON),new ie(g.t("filterBar:notStarter"),void 0,ee.EXCLUDE)],k=[new ie(g.t("filterBar:favorite"),void 0,ee.OFF),new ie(g.t("filterBar:isFavorite"),void 0,ee.ON),new ie(g.t("filterBar:notFavorite"),void 0,ee.EXCLUDE)],B=[new ie(g.t("filterBar:ribbon"),void 0,ee.OFF),new ie(g.t("filterBar:hasWon"),void 0,ee.ON),new ie(g.t("filterBar:hasNotWon"),void 0,ee.EXCLUDE)],X=[new ie(g.t("filterBar:hiddenAbility"),void 0,ee.OFF),new ie(g.t("filterBar:hasHiddenAbility"),void 0,ee.ON),new ie(g.t("filterBar:noHiddenAbility"),void 0,ee.EXCLUDE)],L=[new ie(g.t("filterBar:egg"),void 0,ee.OFF),new ie(g.t("filterBar:eggPurchasable"),void 0,ee.ON)],Q=[new ie(g.t("filterBar:pokerus"),void 0,ee.OFF),new ie(g.t("filterBar:hasPokerus"),void 0,ee.ON)],te=[new Se("STARTER",w),new Se("FAVORITE",k),new Se("WIN",B),new Se("HIDDEN_ABILITY",X),new Se("EGG",L),new Se("POKERUS",Q)];this.filterBar.addFilter(xe.MISC,g.t("filterBar:miscFilter"),new kt(0,0,te,this.updateStarters,Mt.RADIAL));const P=[new Se(We.NUMBER,new ie(g.t("filterBar:sortByNumber"),void 0,ee.ON)),new Se(We.COST,new ie(g.t("filterBar:sortByCost"))),new Se(We.CANDY,new ie(g.t("filterBar:sortByCandies"))),new Se(We.IV,new ie(g.t("filterBar:sortByIVs"))),new Se(We.NAME,new ie(g.t("filterBar:sortByName"))),new Se(We.CAUGHT,new ie(g.t("filterBar:sortByNumCaught"))),new Se(We.HATCHED,new ie(g.t("filterBar:sortByNumHatched")))];this.filterBar.addFilter(xe.SORT,g.t("filterBar:sortFilter"),new kt(0,0,P,this.updateStarters,Mt.SINGLE)),this.filterBarContainer.add(this.filterBar),this.starterSelectContainer.add(this.filterBarContainer),this.filterBar.offsetHybridFilters(),s.uiTheme||r.setVisible(!1),this.iconAnimHandler=new za,this.iconAnimHandler.setup(),this.pokemonNumberText=D(6,141,"",O.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=D(6,128,"",O.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonFormText=D(6,121,"",O.PARTY,{fontSize:n.instructionTextSize}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText);const H=s.add.container(Yn+6,9);this.starterSelectScrollBar=new ys(161,12,5,r.height-6,9),H.add(this.starterSelectScrollBar),this.pokerusCursorObjs=new Array(mf).fill(null).map(()=>{const F=s.add.image(0,0,"select_cursor_pokerus");return F.setVisible(!1),F.setOrigin(0,0),H.add(F),F}),this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),H.add(this.cursorObj);for(const F of Xe)this.speciesLoaded.set(F.speciesId,!1);for(let F=0;F<81;F++){const pe=new Sa(Xe[F]).setVisible(!1),z=yr(F);pe.setPosition(z.x,z.y),this.iconAnimHandler.addOrUpdate(pe.icon,xt.NONE),this.pokemonContainers.push(pe),H.add(pe)}this.formTrayContainer=s.add.container(0,0),this.trayBg=me(0,0,0,0),this.trayBg.setOrigin(0,0),this.formTrayContainer.add(this.trayBg),this.trayCursorObj=s.add.image(0,0,"select_cursor"),this.trayCursorObj.setOrigin(0,0),this.formTrayContainer.add(this.trayCursorObj),H.add(this.formTrayContainer),H.bringToTop(this.formTrayContainer),this.formTrayContainer.setVisible(!1),this.starterSelectContainer.add(H),this.pokemonSprite=s.add.sprite(96,143,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.type1Icon=s.add.sprite(10,158,os("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(28,158,os("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.starterSelectMessageBoxContainer=s.add.container(0,s.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox);const v=n.instructionTextSize;this.goFilterIconElement1=new Phaser.GameObjects.Sprite(s,10,2,"keyboard","C.png"),this.goFilterIconElement1.setName("sprite-goFilter1-icon-element"),this.goFilterIconElement1.setScale(.675),this.goFilterIconElement1.setOrigin(0,0),this.goFilterIconElement2=new Phaser.GameObjects.Sprite(s,20,2,"keyboard","V.png"),this.goFilterIconElement2.setName("sprite-goFilter2-icon-element"),this.goFilterIconElement2.setScale(.675),this.goFilterIconElement2.setOrigin(0,0),this.goFilterLabel=D(30,2,g.t("pokedexUiHandler:goFilters"),O.PARTY,{fontSize:v}),this.goFilterLabel.setName("text-goFilter-label"),this.starterSelectContainer.add(this.goFilterIconElement1),this.starterSelectContainer.add(this.goFilterIconElement2),this.starterSelectContainer.add(this.goFilterLabel),this.toggleDecorationsIconElement=new Phaser.GameObjects.Sprite(s,10,10,"keyboard","R.png"),this.toggleDecorationsIconElement.setName("sprite-toggleDecorations-icon-element"),this.toggleDecorationsIconElement.setScale(.675),this.toggleDecorationsIconElement.setOrigin(0,0),this.toggleDecorationsLabel=D(20,10,g.t("pokedexUiHandler:toggleDecorations"),O.PARTY,{fontSize:v}),this.toggleDecorationsLabel.setName("text-toggleDecorations-label"),this.starterSelectContainer.add(this.toggleDecorationsIconElement),this.starterSelectContainer.add(this.toggleDecorationsLabel),this.showFormTrayIconElement=new Phaser.GameObjects.Sprite(s,6,168,"keyboard","F.png"),this.showFormTrayIconElement.setName("sprite-showFormTray-icon-element"),this.showFormTrayIconElement.setScale(.675),this.showFormTrayIconElement.setOrigin(0,0),this.showFormTrayLabel=D(16,168,g.t("pokedexUiHandler:showForms"),O.PARTY,{fontSize:v}),this.showFormTrayLabel.setName("text-showFormTray-label"),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.starterSelectContainer.add(this.showFormTrayIconElement),this.starterSelectContainer.add(this.showFormTrayLabel),this.message=D(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.filterBarContainer),this.initTutorialOverlay(this.starterSelectContainer),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.starterSelectContainer.bringToTop(this.pokemonNameText),this.starterSelectContainer.bringToTop(this.pokemonFormText)}show(e){return this.starterPreferences||(this.starterPreferences=yf()),this.pokerusSpecies=Tf(),e.length>=1&&e[0]==="refresh"?!1:(super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.pokemonContainers.forEach(t=>{const i=t.icon,n=t.species;this.starterPreferences[n.speciesId]=this.initStarterPrefs(n),this.setUpgradeAnimation(i,n)}),this.resetFilters(),this.updateStarters(),this.setFilterMode(!1),this.filterBarCursor=0,this.setFilterTextMode(!1),this.filterTextCursor=0,this.setCursor(0),this.filterTextContainer.setVisible(!0),!0)}initStarterPrefs(e){var h;const t=this.starterPreferences[e.speciesId],i=s.gameData.dexData[e.speciesId],n=s.gameData.starterData[e.speciesId];if(!t||!i.caughtAttr)return{};const a=i.caughtAttr&e.getFullUnlocksData(),r=a&V.SHINY,o=a&V.NON_SHINY;if(t.shiny&&!r?(t.shiny=void 0,t.variant=void 0):t.shiny===!1&&!o&&(t.shiny=void 0),t.variant!==void 0){const c=[r&&a&V.DEFAULT_VARIANT,r&&a&V.VARIANT_2,r&&a&V.VARIANT_3];(Number.isNaN(t.variant)||t.variant<0||!c[t.variant])&&(t.variant=void 0)}if(t.female!==void 0&&((t.female?a&V.FEMALE:a&V.MALE)||(t.female=void 0)),t.ability!==void 0){const c=e.ability2===e.ability1,d=n.abilityAttr,f=d&Ze.ABILITY_1,p=d&Ze.ABILITY_2,T=d&Ze.ABILITY_HIDDEN;[f,c?p&&!f:p,T][t.ability]||(t.ability=void 0)}const l=t.form;return l!==void 0&&(!((h=e.forms[l])!=null&&h.isStarterSelectable)||!(a&s.gameData.getFormAttr(l)))&&(t.form=void 0),t.nature!==void 0&&s.gameData.getNaturesForAttr(i.natureAttr).indexOf(t.nature)<0&&(t.nature=void 0),t}resetFilters(){this.filterBar.setValsToDefault(),this.filterText.setValsToDefault()}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isSeen(e,t){if(t!=null&&t.seenAttr)return!0;const i=s.gameData.dexData[this.getStarterSpeciesId(e.speciesId)];return!!(i!=null&&i.caughtAttr)}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return Re.hasOwnProperty(e)?e:wr[e]}isPassiveAvailable(e){const t=s.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=$i(Re[this.getStarterSpeciesId(e)])&&!(t.passiveAttr&yt.UNLOCKED)}isValueReductionAvailable(e){const t=s.gameData.starterData[this.getStarterSpeciesId(e)];return t.candyCount>=Xi(Re[this.getStarterSpeciesId(e)])[t.valueReduction]&&t.valueReduction<$T}isSameSpeciesEggAvailable(e){return s.gameData.starterData[this.getStarterSpeciesId(e)].candyCount>=qi(Re[this.getStarterSpeciesId(e)])}setUpgradeAnimation(e,t,i=!1){if(s.tweens.killTweensOf(e),s.candyUpgradeDisplay===0||t.speciesId!==t.getRootSpeciesId(!1))return;e.y=2;const n={targets:e,loop:-1,paused:i,delay:lf(0,50)*5,loopDelay:1e3,tweens:[{targets:e,y:-3,duration:de(125),ease:"Cubic.easeOut",yoyo:!0},{targets:e,y:-1,duration:de(150),ease:"Cubic.easeOut",yoyo:!0}]};if(this.isPassiveAvailable(t.speciesId)||s.candyUpgradeNotification===2&&(this.isValueReductionAvailable(t.speciesId)||this.isSameSpeciesEggAvailable(t.speciesId))){const a=s.tweens.chain(n);i||a.play()}}setUpgradeIcon(e){const t=e.species,i=!!(t!=null&&t.speciesId);if(!t||s.candyUpgradeNotification===0||t.speciesId!==t.getRootSpeciesId(!1)){e.candyUpgradeIcon.setVisible(!1),e.candyUpgradeOverlayIcon.setVisible(!1);return}const n=this.isPassiveAvailable(t.speciesId),a=this.isValueReductionAvailable(t.speciesId),r=this.isSameSpeciesEggAvailable(t.speciesId);s.candyUpgradeNotification===1?(e.candyUpgradeIcon.setVisible(i&&n),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible)):s.candyUpgradeNotification===2&&(e.candyUpgradeIcon.setVisible(i&&(n||a||r)),e.candyUpgradeOverlayIcon.setVisible(i&&e.candyUpgradeIcon.visible))}updateCandyUpgradeDisplay(e){this.isUpgradeIconEnabled()&&this.setUpgradeIcon(e),this.isUpgradeAnimationEnabled()&&this.setUpgradeAnimation(e.icon,this.lastSpecies,!0)}processInput(e){if(this.blockInput)return!1;const t=9,i=this.filteredPokemonData.length,n=Math.ceil(i/t),a=this.scrollCursor*t,r=Math.floor((a+this.cursor)/t),o=this.getUi();let l=!1,h=!1;if(e===I.SUBMIT)h=!0;else if(e===I.CANCEL)this.filterMode&&this.filterBar.openDropDown?(this.filterBar.toggleDropDown(this.filterBarCursor),l=!0):this.filterMode&&!this.filterBar.getFilter(this.filterBarCursor).hasDefaultValues()?(this.filterBar.resetSelection(this.filterBarCursor),this.updateStarters(),l=!0):this.filterTextMode&&this.filterText.getValue(this.filterTextCursor)!==this.filterText.defaultText?(this.filterText.resetSelection(this.filterTextCursor),l=!0):this.showingTray?l=this.closeFormTray():(this.tryExit(),l=!0);else if(e===I.STATS)!this.filterMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterText.cursorObj.setVisible(!1),this.filterTextMode=!1,this.filterBarCursor=0,this.setFilterMode(!0)):h=!0;else if(e===I.CYCLE_TERA)!this.filterTextMode&&!this.showingTray?(this.cursorObj.setVisible(!1),this.setSpecies(null),this.filterBar.cursorObj.setVisible(!1),this.filterMode=!1,this.filterTextCursor=0,this.setFilterTextMode(!0)):h=!0;else if(e===I.CYCLE_SHINY)this.showingTray?h=!0:(this.showDecorations=!this.showDecorations,this.updateScroll(),l=!0);else if(this.filterMode)switch(e){case I.LEFT:this.filterBarCursor>0?l=this.setCursor(this.filterBarCursor-1):l=this.setCursor(this.filterBar.numFilters-1);break;case I.RIGHT:this.filterBarCursor<this.filterBar.numFilters-1?l=this.setCursor(this.filterBarCursor+1):l=this.setCursor(0);break;case I.UP:if(this.filterBar.openDropDown)l=this.filterBar.decDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=Math.max(0,n-9),this.updateScroll();const c=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),d=Math.min(8,c<.5?Math.floor(c*8):Math.ceil(c*8));i%9>d?this.setCursor(i-i%9+d-this.scrollCursor*9):this.setCursor(Math.max(i-i%9+d-9-this.scrollCursor*9,0)),l=!0}break;case I.DOWN:if(this.filterBar.openDropDown)l=this.filterBar.incDropDownCursor();else if(i>0){this.setFilterMode(!1),this.scrollCursor=0,this.updateScroll();const c=this.filterBarCursor/Math.max(1,this.filterBar.numFilters-1),d=Math.min(8,c<.5?Math.floor(c*8):Math.ceil(c*8));this.setCursor(Math.min(d,i-1)),l=!0}break;case I.ACTION:this.filterBar.openDropDown?this.filterBar.toggleOptionState():this.filterBar.toggleDropDown(this.filterBarCursor),l=!0;break}else if(this.filterTextMode)switch(e){case I.LEFT:if(i>0){this.setFilterTextMode(!1);const c=this.filterTextCursor;this.setCursor(c<n-1?(c+1)*t-1:i-1),l=!0}break;case I.RIGHT:if(i>0){this.setFilterTextMode(!1);const c=this.filterTextCursor;this.setCursor(c<n?c*t:(n-1)*t),l=!0}break;case I.UP:this.filterTextCursor>0?l=this.setCursor(this.filterTextCursor-1):l=this.setCursor(this.filterText.numFilters-1);break;case I.DOWN:this.filterTextCursor<this.filterText.numFilters-1?l=this.setCursor(this.filterTextCursor+1):l=this.setCursor(0);break;case I.ACTION:this.filterText.startSearch(this.filterTextCursor,this.getUi()),l=!0;break}else if(this.showingTray)if(e===I.ACTION){const c=this.trayForms[this.trayCursor].formIndex;o.setOverlayMode(_.POKEDEX_PAGE,this.lastSpecies,{form:c},this.filteredIndices),l=!0}else{const c=this.trayContainers.length,d=Math.ceil(c/t),f=Math.floor(this.trayCursor/t);switch(e){case I.UP:if(f>0)l=this.setTrayCursor(this.trayCursor-9);else{const p=this.trayCursor;c%9>p?l=this.setTrayCursor(c-c%9+p):l=this.setTrayCursor(Math.max(c-c%9+p-9,0))}break;case I.DOWN:f<d-1?l=this.setTrayCursor(this.trayCursor+9):l=this.setTrayCursor(this.trayCursor%9);break;case I.LEFT:this.trayCursor%9!==0?l=this.setTrayCursor(this.trayCursor-1):l=this.setTrayCursor(f<d-1?(f+1)*t-1:c-1);break;case I.RIGHT:this.trayCursor%9<(f<d-1?8:(c-1)%9)?l=this.setTrayCursor(this.trayCursor+1):l=this.setTrayCursor(f*9);break;case I.CYCLE_FORM:l=this.closeFormTray();break}}else if(e===I.ACTION)o.setOverlayMode(_.POKEDEX_PAGE,this.lastSpecies,null,this.filteredIndices),l=!0;else switch(e){case I.UP:r>0?this.scrollCursor>0&&r-this.scrollCursor===0?(this.scrollCursor--,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor-9):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case I.DOWN:r<n-1&&this.cursor+9<this.filteredPokemonData.length?r-this.scrollCursor===8?(this.scrollCursor++,this.updateScroll(),l=this.setCursor(this.cursor)):l=this.setCursor(this.cursor+9):n>1?(this.scrollCursor=0,this.updateScroll(),l=this.setCursor(this.cursor%9)):(this.filterBarCursor=this.filterBar.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterMode(!0),l=!0);break;case I.LEFT:this.cursor%9!==0?l=this.setCursor(this.cursor-1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case I.RIGHT:this.cursor%9<(r<n-1?8:(i-1)%9)?l=this.setCursor(this.cursor+1):(this.filterTextCursor=this.filterText.getNearestFilter(this.pokemonContainers[this.cursor]),this.setFilterTextMode(!0),l=!0);break;case I.CYCLE_FORM:{const c=this.pokemonContainers[this.cursor].species;this.canShowFormTray&&(l=this.openFormTray(c));break}}return l?o.playSelect():h&&o.playError(),l||h}updateButtonIcon(e,t,i,n){var r;let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Stats:a="C.png";break}else a=(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}updateFilterButtonIcon(e,t,i,n){var r;let a;t==="touch"?(t="keyboard",a="C.png"):a=(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(e),i.setTexture(t,a),i.setVisible(!0),n.setVisible(!0)}getSanitizedProps(e){return{shiny:!1,female:e.female,variant:0,formIndex:e.formIndex}}hasFormLevelMove(e,t){return!fs.hasOwnProperty(e.speciesId)||!fs[e.speciesId].hasOwnProperty(e.formIndex)?!1:fs[e.speciesId][e.formIndex].map(n=>Ne[n[1]].name).includes(t)}setCursor(e){var i;let t=!1;if(this.oldCursor=this.cursor,this.filterMode)t=this.filterBarCursor!==e,this.filterBarCursor=e,this.filterBar.setCursor(e);else if(this.filterTextMode)t=this.filterTextCursor!==e,this.filterTextCursor=e,this.filterText.setCursor(e);else{e=Math.max(Math.min(this.pokemonContainers.length-1,e),0),t=super.setCursor(e);const n=yr(e);this.cursorObj.setPosition(n.x-1,n.y+1);const a=(i=this.pokemonContainers[e])==null?void 0:i.species;if(a)return this.setSpecies(a),!0}return t}setFilterMode(e){return this.cursorObj.setVisible(!e),this.filterBar.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterMode?(this.filterMode=e,this.setCursor(e?this.filterBarCursor:this.cursor),e&&this.setSpecies(null),!0):!1}setFilterTextMode(e){return this.cursorObj.setVisible(!e),this.filterText.cursorObj.setVisible(e),this.pokemonSprite.setVisible(!1),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),e!==this.filterTextMode?(this.filterTextMode=e,this.setCursor(e?this.filterTextCursor:this.cursor),e&&this.setSpecies(null),!0):!1}openFormTray(e){this.trayForms=e.forms.filter(m=>!m.isUnobtainable),this.trayNumIcons=this.trayForms.length,this.trayRows=Math.floor(this.trayNumIcons/9)+(this.trayNumIcons%9===0?0:1),this.trayColumns=Math.min(this.trayNumIcons,9);const t=9,i=this.cursor,n=Math.floor(i/t),a=i-n*9,r=8-n,o=9-a,l=yr(this.cursor),h=this.trayRows<=r-1?0:1,c=this.trayColumns<=o?0:1;this.trayBg.setSize(13+this.trayColumns*17,8+this.trayRows*18),this.formTrayContainer.setX((c?l.x-18*(this.trayColumns-o):l.x)-3),this.formTrayContainer.setY(h?l.y-this.trayBg.height:l.y+17);const d=s.gameData.dexData[e.speciesId],f=this.getCurrentDexProps(e.speciesId),p=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(this.lastSpecies,f));this.trayContainers=[];const T=this.isSeen(e,d);return this.trayForms.map((m,C)=>{const b=d?(d.caughtAttr&e.getFullUnlocksData()&s.gameData.getFormAttr(m.formIndex??0))>0n:!1,S=new Sa(e,{formIndex:m.formIndex,female:p.female,shiny:p.shiny,variant:p.variant});this.iconAnimHandler.addOrUpdate(S.icon,xt.NONE),b||s.dexForDevs?S.icon.clearTint():T?S.icon.setTint(8421504):S.icon.setTint(0),S.setPosition(5+C%9*18,4+Math.floor(C/9)*17),this.formTrayContainer.add(S),this.trayContainers.push(S)}),this.showingTray=!0,this.setTrayCursor(0),this.formTrayContainer.setVisible(!0),this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),!0}closeFormTray(){return this.trayContainers.forEach(e=>{this.formTrayContainer.remove(e,!0)}),this.trayContainers=[],this.formTrayContainer.setVisible(!1),this.showingTray=!1,this.setSpeciesDetails(this.lastSpecies),!0}setTrayCursor(e){if(!this.showingTray)return!1;e=Phaser.Math.Clamp(this.trayContainers.length-1,e,0);const t=this.trayCursor!==e;t&&(this.trayCursor=e),this.trayCursorObj.setPosition(5+e%9*18,4+Math.floor(e/9)*17);const i=this.lastSpecies,n=this.trayForms[e].formIndex;return this.setSpeciesDetails(i,{formIndex:n}),t}getFriendship(e){let t=s.gameData.starterData[this.getStarterSpeciesId(e)].friendship;(!t||t===void 0)&&(t=0);const i=Th(Re[e]);return{currentFriendship:t,friendshipCap:i}}startIconAnimation(e){const i=this.pokemonContainers[e].icon;this.isUpgradeAnimationEnabled()&&(s.tweens.getTweensOf(i).forEach(n=>n.pause()),i.x=-2,i.y=2),this.iconAnimHandler.addOrUpdate(i,xt.PASSIVE)}stopIconAnimation(e){const t=this.pokemonContainers[e];if(t){const i=t.icon,n=this.getCurrentDexProps(t.species.speciesId),a=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(t.species,n));this.checkIconId(i,t.species,a.female,a.formIndex,a.shiny,a.variant),this.iconAnimHandler.addOrUpdate(i,xt.NONE),s.tweens.getTweensOf(i).forEach(r=>r.play())}}setSpecies(e){var t,i,n;if(this.speciesStarterDexEntry=e?s.gameData.dexData[e.speciesId]:null,!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.lastSpecies&&this.stopIconAnimation(this.oldCursor),e&&(this.lastSpecies=e),e&&((t=this.speciesStarterDexEntry)!=null&&t.seenAttr||(i=this.speciesStarterDexEntry)!=null&&i.caughtAttr||s.dexForDevs))if(this.pokemonNumberText.setText(g.t("pokedexUiHandler:pokemonNumber")+Is(e.speciesId,4)),this.pokemonNameText.setText(e.name),(n=this.speciesStarterDexEntry)!=null&&n.caughtAttr||s.dexForDevs){this.startIconAnimation(this.cursor);const a=Rt(e.speciesId,0);this.setTypeIcons(a.type1,a.type2),this.setSpeciesDetails(e,{}),this.pokemonSprite.clearTint(),this.type1Icon.clearTint(),this.type2Icon.clearTint()}else this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.setSpeciesDetails(e),this.pokemonSprite.setTint(8421504);else this.pokemonNumberText.setText(e?g.t("pokedexUiHandler:pokemonNumber")+Is(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonFormText.setText(""),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),e&&(this.pokemonSprite.setTint(0),this.setSpeciesDetails(e,{}))}setSpeciesDetails(e,t={}){var o,l;let{shiny:i,formIndex:n,female:a,variant:r}=t;if((o=e==null?void 0:e.forms)!=null&&o.find(h=>h.formKey==="female")&&(a!==void 0?n=a?1:0:n!==void 0&&(a=n===1)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const h=s.gameData.dexData[e.speciesId],c=h.caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e.speciesId)].caughtAttr&e.getFullUnlocksData();if(c){const T=this.getSanitizedProps(s.gameData.getSpeciesDexAttrProps(e,this.getCurrentDexProps(e.speciesId)));i===void 0&&(i=T.shiny),n===void 0&&(n=T.formIndex),a===void 0&&(a=T.female),r===void 0&&(r=T.variant)}const d=h?(c&s.gameData.getFormAttr(n??0))>0n:!1,f=this.isSeen(e,h),p=new at(!1);if(this.assetLoadCancelled=p,e.loadAssets(a,n,i,r,!0).then(()=>{p.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setPipelineData("shiny",i),this.pokemonSprite.setPipelineData("variant",r),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(a,n,i,r)),this.pokemonSprite.setVisible(!0))}),d||s.dexForDevs?this.pokemonSprite.clearTint():f?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),d||f||s.dexForDevs?If.includes(e.speciesId)&&!n?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(n,!1)):this.pokemonFormText.setText(""),d||f||s.dexForDevs){const T=Rt(e.speciesId,n??0);this.setTypeIcons(T.type1,T.type2)}else this.setTypeIcons(null,null);((l=e==null?void 0:e.forms)==null?void 0:l.filter(T=>!T.isUnobtainable).length)>1?(this.showingTray||(this.showFormTrayIconElement.setVisible(!0),this.showFormTrayLabel.setVisible(!0)),this.canShowFormTray=!0):(this.showFormTrayIconElement.setVisible(!1),this.showFormTrayLabel.setVisible(!1),this.canShowFormTray=!1)}else this.setTypeIcons(null,null)}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(ve[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(ve[t].toLowerCase())):this.type2Icon.setVisible(!1)}updateStarterValueLabel(e){const t=e.species.speciesId,i=Re[t],n=s.gameData.getSpeciesStarterValue(this.getStarterSpeciesId(t));e.cost=n;let a=n.toString();a.startsWith("0.")&&(a=a.slice(1)),e.label.setText(a);let r;switch(i-n){case 0:r=O.WINDOW;break;case 1:case .5:r=O.SUMMARY_BLUE;break;default:r=O.SUMMARY_GOLD;break}i-n>0&&(e.label.setColor(this.getTextColor(r)),e.label.setShadowColor(this.getTextColor(r,!0)))}tryExit(){this.blockInput=!0;const e=this.getUi(),t=u(()=>{e.setMode(_.POKEDEX,"refresh"),this.clearText(),this.blockInput=!1},"cancel");return e.showText(g.t("pokedexUiHandler:confirmExit"),null,()=>{e.setModeWithoutClear(_.CONFIRM,()=>{e.setMode(_.POKEDEX,"refresh"),this.clearText(),this.clear(),e.revertMode()},t,null,null,19)}),!0}getCurrentDexProps(e){var a,r,o,l,h,c,d;let t=0n;const i=Xe.find(f=>f.speciesId===e),n=s.gameData.dexData[e].caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&((i==null?void 0:i.getFullUnlocksData())??0n);return(a=this.starterPreferences[e])!=null&&a.female||(n&V.FEMALE)>0n&&(n&V.MALE)===0n?t+=V.FEMALE:t+=V.MALE,(r=this.starterPreferences[e])!=null&&r.shiny||(n&V.SHINY)>0n&&((o=this.starterPreferences[e])==null?void 0:o.shiny)!==!1?(t+=V.SHINY,((l=this.starterPreferences[e])==null?void 0:l.variant)!==void 0?t+=BigInt(Math.pow(2,(h=this.starterPreferences[e])==null?void 0:h.variant))*V.DEFAULT_VARIANT:(n&V.VARIANT_3)>0?t+=V.VARIANT_3:(n&V.VARIANT_2)>0?t+=V.VARIANT_2:t+=V.DEFAULT_VARIANT):(t+=V.NON_SHINY,t+=V.DEFAULT_VARIANT),(c=this.starterPreferences[e])!=null&&c.form?t+=BigInt(Math.pow(2,(d=this.starterPreferences[e])==null?void 0:d.form))*V.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}destroy(){this.pokemonContainers=[],this.filteredPokemonData=[]}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}clear(){super.clear(),this.cursor=-1,this.oldCursor=-1,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};u(gc,"PokedexUiHandler");let hn=gc;var Tr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Gp;function XT(){return Gp||(Gp=1,function(y,e){(function(t){y.exports=t()})(function(){return u(function t(i,n,a){function r(h,c){if(!n[h]){if(!i[h]){var d=typeof wn=="function"&&wn;if(!c&&d)return d(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[h]={exports:{}};i[h][0].call(p.exports,function(T){var m=i[h][1][T];return r(m||T)},p,p.exports,t,i,n,a)}return n[h].exports}u(r,"u");for(var o=typeof wn=="function"&&wn,l=0;l<a.length;l++)r(a[l]);return r},"s")({1:[function(t,i,n){var a=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var h,c,d,f,p,T,m,C=[],b=0,S=l.length,x=S,A=a.getTypeOf(l)!=="string";b<l.length;)x=S-b,d=A?(h=l[b++],c=b<S?l[b++]:0,b<S?l[b++]:0):(h=l.charCodeAt(b++),c=b<S?l.charCodeAt(b++):0,b<S?l.charCodeAt(b++):0),f=h>>2,p=(3&h)<<4|c>>4,T=1<x?(15&c)<<2|d>>6:64,m=2<x?63&d:64,C.push(o.charAt(f)+o.charAt(p)+o.charAt(T)+o.charAt(m));return C.join("")},n.decode=function(l){var h,c,d,f,p,T,m=0,C=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var S,x=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&x--,l.charAt(l.length-2)===o.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=r.uint8array?new Uint8Array(0|x):new Array(0|x);m<l.length;)h=o.indexOf(l.charAt(m++))<<2|(f=o.indexOf(l.charAt(m++)))>>4,c=(15&f)<<4|(p=o.indexOf(l.charAt(m++)))>>2,d=(3&p)<<6|(T=o.indexOf(l.charAt(m++))),S[C++]=h,p!==64&&(S[C++]=c),T!==64&&(S[C++]=d);return S}},{"./support":30,"./utils":32}],2:[function(t,i,n){var a=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function h(c,d,f,p,T){this.compressedSize=c,this.uncompressedSize=d,this.crc32=f,this.compression=p,this.compressedContent=T}u(h,"o"),h.prototype={getContentWorker:u(function(){var c=new r(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return c.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},"getContentWorker"),getCompressedWorker:u(function(){return new r(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)},"getCompressedWorker")},h.createWorkerFrom=function(c,d,f){return c.pipe(new o).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var a=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:u(function(){return new a("STORE compression")},"compressWorker"),uncompressWorker:u(function(){return new a("STORE decompression")},"uncompressWorker")},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var a=t("./utils"),r=function(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;l[h]=o}return l}();i.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(h,c,d,f){var p=r,T=f+d;h^=-1;for(var m=f;m<T;m++)h=h>>>8^p[255&(h^c[m])];return-1^h}(0|l,o,o.length,0):function(h,c,d,f){var p=r,T=f+d;h^=-1;for(var m=f;m<T;m++)h=h>>>8^p[255&(h^c.charCodeAt(m))];return-1^h}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var a=null;a=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:a}},{lie:37}],7:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),h=a?"uint8array":"array";function c(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}u(c,"h"),n.magic="\b\0",o.inherits(c,l),c.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},n.compressWorker=function(d){return new c("Deflate",d)},n.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function a(p,T){var m,C="";for(m=0;m<T;m++)C+=String.fromCharCode(255&p),p>>>=8;return C}u(a,"A");function r(p,T,m,C,b,S){var x,A,w=p.file,k=p.compression,B=S!==h.utf8encode,X=o.transformTo("string",S(w.name)),L=o.transformTo("string",h.utf8encode(w.name)),Q=w.comment,te=o.transformTo("string",S(Q)),P=o.transformTo("string",h.utf8encode(Q)),H=L.length!==w.name.length,v=P.length!==Q.length,F="",pe="",z="",ce=w.dir,$=w.date,Y={crc32:0,compressedSize:0,uncompressedSize:0};T&&!m||(Y.crc32=p.crc32,Y.compressedSize=p.compressedSize,Y.uncompressedSize=p.uncompressedSize);var W=0;T&&(W|=8),B||!H&&!v||(W|=2048);var R=0,he=0;ce&&(R|=16),b==="UNIX"?(he=798,R|=function(oe,Ve){var it=oe;return oe||(it=Ve?16893:33204),(65535&it)<<16}(w.unixPermissions,ce)):(he=20,R|=function(oe){return 63&(oe||0)}(w.dosPermissions)),x=$.getUTCHours(),x<<=6,x|=$.getUTCMinutes(),x<<=5,x|=$.getUTCSeconds()/2,A=$.getUTCFullYear()-1980,A<<=4,A|=$.getUTCMonth()+1,A<<=5,A|=$.getUTCDate(),H&&(pe=a(1,1)+a(c(X),4)+L,F+="up"+a(pe.length,2)+pe),v&&(z=a(1,1)+a(c(te),4)+P,F+="uc"+a(z.length,2)+z);var ae="";return ae+=`
\0`,ae+=a(W,2),ae+=k.magic,ae+=a(x,2),ae+=a(A,2),ae+=a(Y.crc32,4),ae+=a(Y.compressedSize,4),ae+=a(Y.uncompressedSize,4),ae+=a(X.length,2),ae+=a(F.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ae+X+F,dirRecord:d.CENTRAL_FILE_HEADER+a(he,2)+ae+a(te.length,2)+"\0\0\0\0"+a(R,4)+a(C,4)+X+F+te}}u(r,"n");var o=t("../utils"),l=t("../stream/GenericWorker"),h=t("../utf8"),c=t("../crc32"),d=t("../signature");function f(p,T,m,C){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=T,this.zipPlatform=m,this.encodeFileName=C,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u(f,"s"),o.inherits(f,l),f.prototype.push=function(p){var T=p.meta.percent||0,m=this.entriesCount,C=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(T+100*(m-C-1))/m:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var T=this.streamFiles&&!p.file.dir;if(T){var m=r(p,T,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var T=this.streamFiles&&!p.file.dir,m=r(p,T,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),T)this.push({data:function(C){return d.DATA_DESCRIPTOR+a(C.crc32,4)+a(C.compressedSize,4)+a(C.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,T=0;T<this.dirRecords.length;T++)this.push({data:this.dirRecords[T],meta:{percent:100}});var m=this.bytesWritten-p,C=function(b,S,x,A,w){var k=o.transformTo("string",w(A));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(b,2)+a(b,2)+a(S,4)+a(x,4)+a(k.length,2)+k}(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:C,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var T=this;return p.on("data",function(m){T.processChunk(m)}),p.on("end",function(){T.closedSource(T.previous.streamInfo),T._sources.length?T.prepareNextSource():T.end()}),p.on("error",function(m){T.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var T=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<T.length;m++)try{T[m].error(p)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,T=0;T<p.length;T++)p[T].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var a=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(o,l,h){var c=new r(l.streamFiles,h,l.platform,l.encodeFileName),d=0;try{o.forEach(function(f,p){d++;var T=function(S,x){var A=S||x,w=a[A];if(!w)throw new Error(A+" is not a valid compression method !");return w}(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},C=p.dir,b=p.date;p._compressWorker(T,m).withStreamInfo("file",{name:f,dir:C,date:b,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(c)}),c.entriesCount=d}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new a;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}u(a,"n"),(a.prototype=t("./object")).loadAsync=t("./load"),a.support=t("./support"),a.defaults=t("./defaults"),a.version="3.10.1",a.loadAsync=function(r,o){return new a().loadAsync(r,o)},a.external=t("./external"),i.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var a=t("./utils"),r=t("./external"),o=t("./utf8"),l=t("./zipEntries"),h=t("./stream/Crc32Probe"),c=t("./nodejsUtils");function d(f){return new r.Promise(function(p,T){var m=f.decompressed.getContentWorker().pipe(new h);m.on("error",function(C){T(C)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?T(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}u(d,"f"),i.exports=function(f,p){var T=this;return p=a.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(m){var C=new l(p);return C.load(m),C}).then(function(m){var C=[r.Promise.resolve(m)],b=m.files;if(p.checkCRC32)for(var S=0;S<b.length;S++)C.push(d(b[S]));return r.Promise.all(C)}).then(function(m){for(var C=m.shift(),b=C.files,S=0;S<b.length;S++){var x=b[S],A=x.fileNameStr,w=a.resolve(x.fileNameStr);T.file(w,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:p.createFolders}),x.dir||(T.file(w).unsafeOriginalName=A)}return C.zipComment.length&&(T.comment=C.zipComment),T})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var a=t("../utils"),r=t("../stream/GenericWorker");function o(l,h){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}u(o,"s"),a.inherits(o,r),o.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(c){h.push({data:c,meta:{percent:0}})}).on("error",function(c){h.isPaused?this.generatedError=c:h.error(c)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var a=t("readable-stream").Readable;function r(o,l,h){a.call(this,l),this._helper=o;var c=this;o.on("data",function(d,f){c.push(d)||c._helper.pause(),h&&h(f)}).on("error",function(d){c.emit("error",d)}).on("end",function(){c.push(null)})}u(r,"n"),t("../utils").inherits(r,a),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:u(function(a,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,r);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,r)},"newBufferFrom"),allocBuffer:u(function(a){if(Buffer.alloc)return Buffer.alloc(a);var r=new Buffer(a);return r.fill(0),r},"allocBuffer"),isBuffer:u(function(a){return Buffer.isBuffer(a)},"isBuffer"),isStream:u(function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"},"isStream")}},{}],15:[function(t,i,n){function a(w,k,B){var X,L=o.getTypeOf(k),Q=o.extend(B||{},c);Q.date=Q.date||new Date,Q.compression!==null&&(Q.compression=Q.compression.toUpperCase()),typeof Q.unixPermissions=="string"&&(Q.unixPermissions=parseInt(Q.unixPermissions,8)),Q.unixPermissions&&16384&Q.unixPermissions&&(Q.dir=!0),Q.dosPermissions&&16&Q.dosPermissions&&(Q.dir=!0),Q.dir&&(w=b(w)),Q.createFolders&&(X=C(w))&&S.call(this,X,!0);var te=L==="string"&&Q.binary===!1&&Q.base64===!1;B&&B.binary!==void 0||(Q.binary=!te),(k instanceof d&&k.uncompressedSize===0||Q.dir||!k||k.length===0)&&(Q.base64=!1,Q.binary=!0,k="",Q.compression="STORE",L="string");var P=null;P=k instanceof d||k instanceof l?k:T.isNode&&T.isStream(k)?new m(w,k):o.prepareContent(w,k,Q.binary,Q.optimizedBinaryString,Q.base64);var H=new f(w,P,Q);this.files[w]=H}u(a,"s");var r=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),c=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),p=t("./generate"),T=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),C=u(function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var k=w.lastIndexOf("/");return 0<k?w.substring(0,k):""},"_"),b=u(function(w){return w.slice(-1)!=="/"&&(w+="/"),w},"g"),S=u(function(w,k){return k=k!==void 0?k:c.createFolders,w=b(w),this.files[w]||a.call(this,w,null,{dir:!0,createFolders:k}),this.files[w]},"b");function x(w){return Object.prototype.toString.call(w)==="[object RegExp]"}u(x,"h");var A={load:u(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"load"),forEach:u(function(w){var k,B,X;for(k in this.files)X=this.files[k],(B=k.slice(this.root.length,k.length))&&k.slice(0,this.root.length)===this.root&&w(B,X)},"forEach"),filter:u(function(w){var k=[];return this.forEach(function(B,X){w(B,X)&&k.push(X)}),k},"filter"),file:u(function(w,k,B){if(arguments.length!==1)return w=this.root+w,a.call(this,w,k,B),this;if(x(w)){var X=w;return this.filter(function(Q,te){return!te.dir&&X.test(Q)})}var L=this.files[this.root+w];return L&&!L.dir?L:null},"file"),folder:u(function(w){if(!w)return this;if(x(w))return this.filter(function(L,Q){return Q.dir&&w.test(L)});var k=this.root+w,B=S.call(this,k),X=this.clone();return X.root=B.name,X},"folder"),remove:u(function(w){w=this.root+w;var k=this.files[w];if(k||(w.slice(-1)!=="/"&&(w+="/"),k=this.files[w]),k&&!k.dir)delete this.files[w];else for(var B=this.filter(function(L,Q){return Q.name.slice(0,w.length)===w}),X=0;X<B.length;X++)delete this.files[B[X].name];return this},"remove"),generate:u(function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},"generate"),generateInternalStream:u(function(w){var k,B={};try{if((B=o.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");o.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var X=B.comment||this.comment||"";k=p.generateWorker(this,B,X)}catch(L){(k=new l("error")).error(L)}return new h(k,B.type||"string",B.mimeType)},"generateInternalStream"),generateAsync:u(function(w,k){return this.generateInternalStream(w).accumulate(k)},"generateAsync"),generateNodeStream:u(function(w,k){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(k)},"generateNodeStream")};i.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}u(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===c&&this.data[f+3]===d)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),h=o.charCodeAt(1),c=o.charCodeAt(2),d=o.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&c===f[2]&&d===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var a=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}u(r,"i"),r.prototype={checkOffset:u(function(o){this.checkIndex(this.index+o)},"checkOffset"),checkIndex:u(function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},"checkIndex"),setIndex:u(function(o){this.checkIndex(o),this.index=o},"setIndex"),skip:u(function(o){this.setIndex(this.index+o)},"skip"),byteAt:u(function(){},"byteAt"),readInt:u(function(o){var l,h=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=o,h},"readInt"),readString:u(function(o){return a.transformTo("string",this.readData(o))},"readString"),readData:u(function(){},"readData"),lastIndexOfSignature:u(function(){},"lastIndexOfSignature"),readAndCheckSignature:u(function(){},"readAndCheckSignature"),readDate:u(function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))},"readDate")},i.exports=r},{"../utils":32}],19:[function(t,i,n){var a=t("./Uint8ArrayReader");function r(o){a.call(this,o)}u(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var a=t("./DataReader");function r(o){a.call(this,o)}u(r,"i"),t("../utils").inherits(r,a),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var a=t("./ArrayReader");function r(o){a.call(this,o)}u(r,"i"),t("../utils").inherits(r,a),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var a=t("../utils"),r=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),h=t("./NodeBufferReader"),c=t("./Uint8ArrayReader");i.exports=function(d){var f=a.getTypeOf(d);return a.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new h(d):r.uint8array?new c(a.transformTo("uint8array",d)):new o(a.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var a=t("./GenericWorker"),r=t("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}u(o,"s"),r.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var a=t("./GenericWorker"),r=t("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}u(o,"s"),t("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}u(o,"s"),a.inherits(o,r),o.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}r.prototype.processChunk.call(this,l)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var a=t("../utils"),r=t("./GenericWorker");function o(l){r.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){h.dataIsReady=!0,h.data=c,h.max=c&&c.length||0,h.type=a.getTypeOf(c),h.isPaused||h._tickAndRepeat()},function(c){h.error(c)})}u(o,"s"),a.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function a(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}u(a,"n"),a.prototype={push:u(function(r){this.emit("data",r)},"push"),end:u(function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},"end"),error:u(function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},"error"),on:u(function(r,o){return this._listeners[r].push(o),this},"on"),cleanUp:u(function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},"cleanUp"),emit:u(function(r,o){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,o)},"emit"),pipe:u(function(r){return r.registerPrevious(this)},"pipe"),registerPrevious:u(function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(l){o.processChunk(l)}),r.on("end",function(){o.end()}),r.on("error",function(l){o.error(l)}),this},"registerPrevious"),pause:u(function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},"pause"),resume:u(function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},"resume"),flush:u(function(){},"flush"),processChunk:u(function(r){this.push(r)},"processChunk"),withStreamInfo:u(function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},"withStreamInfo"),mergeStreamInfo:u(function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},"mergeStreamInfo"),lock:u(function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},"lock"),toString:u(function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r},"toString")},i.exports=a},{}],29:[function(t,i,n){var a=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),h=t("../support"),c=t("../external"),d=null;if(h.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(T,m){return new c.Promise(function(C,b){var S=[],x=T._internalType,A=T._outputType,w=T._mimeType;T.on("data",function(k,B){S.push(k),m&&m(B)}).on("error",function(k){S=[],b(k)}).on("end",function(){try{var k=function(B,X,L){switch(B){case"blob":return a.newBlob(a.transformTo("arraybuffer",X),L);case"base64":return l.encode(X);default:return a.transformTo(B,X)}}(A,function(B,X){var L,Q=0,te=null,P=0;for(L=0;L<X.length;L++)P+=X[L].length;switch(B){case"string":return X.join("");case"array":return Array.prototype.concat.apply([],X);case"uint8array":for(te=new Uint8Array(P),L=0;L<X.length;L++)te.set(X[L],Q),Q+=X[L].length;return te;case"nodebuffer":return Buffer.concat(X);default:throw new Error("concat : unsupported type '"+B+"'")}}(x,S),w);C(k)}catch(B){b(B)}S=[]}).resume()})}u(f,"l");function p(T,m,C){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=C,a.checkSupport(b),this._worker=T.pipe(new r(b)),T.lock()}catch(S){this._worker=new o("error"),this._worker.error(S)}}u(p,"f"),p.prototype={accumulate:u(function(T){return f(this,T)},"accumulate"),on:u(function(T,m){var C=this;return T==="data"?this._worker.on(T,function(b){m.call(C,b.data,b.meta)}):this._worker.on(T,function(){a.delay(m,arguments,C)}),this},"on"),resume:u(function(){return a.delay(this._worker.resume,[],this._worker),this},"resume"),pause:u(function(){return this._worker.pause(),this},"pause"),toNodejsStream:u(function(T){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},T)},"toNodejsStream")},i.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var a=new ArrayBuffer(0);try{n.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(a),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var a=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),h=new Array(256),c=0;c<256;c++)h[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;h[254]=h[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}u(d,"a");function f(){l.call(this,"utf-8 encode")}u(f,"l"),n.utf8encode=function(p){return r.nodebuffer?o.newBufferFrom(p,"utf-8"):function(T){var m,C,b,S,x,A=T.length,w=0;for(S=0;S<A;S++)(64512&(C=T.charCodeAt(S)))==55296&&S+1<A&&(64512&(b=T.charCodeAt(S+1)))==56320&&(C=65536+(C-55296<<10)+(b-56320),S++),w+=C<128?1:C<2048?2:C<65536?3:4;for(m=r.uint8array?new Uint8Array(w):new Array(w),S=x=0;x<w;S++)(64512&(C=T.charCodeAt(S)))==55296&&S+1<A&&(64512&(b=T.charCodeAt(S+1)))==56320&&(C=65536+(C-55296<<10)+(b-56320),S++),C<128?m[x++]=C:(C<2048?m[x++]=192|C>>>6:(C<65536?m[x++]=224|C>>>12:(m[x++]=240|C>>>18,m[x++]=128|C>>>12&63),m[x++]=128|C>>>6&63),m[x++]=128|63&C);return m}(p)},n.utf8decode=function(p){return r.nodebuffer?a.transformTo("nodebuffer",p).toString("utf-8"):function(T){var m,C,b,S,x=T.length,A=new Array(2*x);for(m=C=0;m<x;)if((b=T[m++])<128)A[C++]=b;else if(4<(S=h[b]))A[C++]=65533,m+=S-1;else{for(b&=S===2?31:S===3?15:7;1<S&&m<x;)b=b<<6|63&T[m++],S--;1<S?A[C++]=65533:b<65536?A[C++]=b:(b-=65536,A[C++]=55296|b>>10&1023,A[C++]=56320|1023&b)}return A.length!==C&&(A.subarray?A=A.subarray(0,C):A.length=C),a.applyFromCharCode(A)}(p=a.transformTo(r.uint8array?"uint8array":"array",p))},a.inherits(d,l),d.prototype.processChunk=function(p){var T=a.transformTo(r.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var m=T;(T=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),T.set(m,this.leftOver.length)}else T=this.leftOver.concat(T);this.leftOver=null}var C=function(S,x){var A;for((x=x||S.length)>S.length&&(x=S.length),A=x-1;0<=A&&(192&S[A])==128;)A--;return A<0||A===0?x:A+h[S[A]]>x?A:x}(T),b=T;C!==T.length&&(r.uint8array?(b=T.subarray(0,C),this.leftOver=T.subarray(C,T.length)):(b=T.slice(0,C),this.leftOver=T.slice(C,T.length))),this.push({data:n.utf8decode(b),meta:p.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=d,a.inherits(f,l),f.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var a=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function h(m){return m}u(h,"n");function c(m,C){for(var b=0;b<m.length;++b)C[b]=255&m.charCodeAt(b);return C}u(c,"l"),t("setimmediate"),n.newBlob=function(m,C){n.checkSupport("blob");try{return new Blob([m],{type:C})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(C)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:u(function(m,C,b){var S=[],x=0,A=m.length;if(A<=b)return String.fromCharCode.apply(null,m);for(;x<A;)C==="array"||C==="nodebuffer"?S.push(String.fromCharCode.apply(null,m.slice(x,Math.min(x+b,A)))):S.push(String.fromCharCode.apply(null,m.subarray(x,Math.min(x+b,A)))),x+=b;return S.join("")},"stringifyByChunk"),stringifyByChar:u(function(m){for(var C="",b=0;b<m.length;b++)C+=String.fromCharCode(m[b]);return C},"stringifyByChar"),applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var C=65536,b=n.getTypeOf(m),S=!0;if(b==="uint8array"?S=d.applyCanBeUsed.uint8array:b==="nodebuffer"&&(S=d.applyCanBeUsed.nodebuffer),S)for(;1<C;)try{return d.stringifyByChunk(m,b,C)}catch{C=Math.floor(C/2)}return d.stringifyByChar(m)}u(f,"s");function p(m,C){for(var b=0;b<m.length;b++)C[b]=m[b];return C}u(p,"f"),n.applyFromCharCode=f;var T={};T.string={string:h,array:u(function(m){return c(m,new Array(m.length))},"array"),arraybuffer:u(function(m){return T.string.uint8array(m).buffer},"arraybuffer"),uint8array:u(function(m){return c(m,new Uint8Array(m.length))},"uint8array"),nodebuffer:u(function(m){return c(m,o.allocBuffer(m.length))},"nodebuffer")},T.array={string:f,array:h,arraybuffer:u(function(m){return new Uint8Array(m).buffer},"arraybuffer"),uint8array:u(function(m){return new Uint8Array(m)},"uint8array"),nodebuffer:u(function(m){return o.newBufferFrom(m)},"nodebuffer")},T.arraybuffer={string:u(function(m){return f(new Uint8Array(m))},"string"),array:u(function(m){return p(new Uint8Array(m),new Array(m.byteLength))},"array"),arraybuffer:h,uint8array:u(function(m){return new Uint8Array(m)},"uint8array"),nodebuffer:u(function(m){return o.newBufferFrom(new Uint8Array(m))},"nodebuffer")},T.uint8array={string:f,array:u(function(m){return p(m,new Array(m.length))},"array"),arraybuffer:u(function(m){return m.buffer},"arraybuffer"),uint8array:h,nodebuffer:u(function(m){return o.newBufferFrom(m)},"nodebuffer")},T.nodebuffer={string:f,array:u(function(m){return p(m,new Array(m.length))},"array"),arraybuffer:u(function(m){return T.nodebuffer.uint8array(m).buffer},"arraybuffer"),uint8array:u(function(m){return p(m,new Uint8Array(m.length))},"uint8array"),nodebuffer:h},n.transformTo=function(m,C){if(C=C||"",!m)return C;n.checkSupport(m);var b=n.getTypeOf(C);return T[b][m](C)},n.resolve=function(m){for(var C=m.split("/"),b=[],S=0;S<C.length;S++){var x=C[S];x==="."||x===""&&S!==0&&S!==C.length-1||(x===".."?b.pop():b.push(x))}return b.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(m)?"nodebuffer":a.uint8array&&m instanceof Uint8Array?"uint8array":a.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!a[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var C,b,S="";for(b=0;b<(m||"").length;b++)S+="\\x"+((C=m.charCodeAt(b))<16?"0":"")+C.toString(16).toUpperCase();return S},n.delay=function(m,C,b){setImmediate(function(){m.apply(b||null,C||[])})},n.inherits=function(m,C){function b(){}u(b,"r"),b.prototype=C.prototype,m.prototype=new b},n.extend=function(){var m,C,b={};for(m=0;m<arguments.length;m++)for(C in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],C)&&b[C]===void 0&&(b[C]=arguments[m][C]);return b},n.prepareContent=function(m,C,b,S,x){return l.Promise.resolve(C).then(function(A){return a.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,k){var B=new FileReader;B.onload=function(X){w(X.target.result)},B.onerror=function(X){k(X.target.error)},B.readAsArrayBuffer(A)}):A}).then(function(A){var w=n.getTypeOf(A);return w?(w==="arraybuffer"?A=n.transformTo("uint8array",A):w==="string"&&(x?A=r.decode(A):b&&S!==!0&&(A=function(k){return c(k,a.uint8array?new Uint8Array(k.length):new Array(k.length))}(A))),A):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),l=t("./zipEntry"),h=t("./support");function c(d){this.files=[],this.loadOptions=d}u(c,"h"),c.prototype={checkSignature:u(function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(d)+")")}},"checkSignature"),isSignature:u(function(d,f){var p=this.reader.index;this.reader.setIndex(d);var T=this.reader.readString(4)===f;return this.reader.setIndex(p),T},"isSignature"),readBlockEndOfCentral:u(function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",p=r.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(p)},"readBlockEndOfCentral"),readBlockZip64EndOfCentral:u(function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,p,T=this.zip64EndOfCentralSize-44;0<T;)d=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:p}},"readBlockZip64EndOfCentral"),readBlockZip64EndOfCentralLocator:u(function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},"readBlockZip64EndOfCentralLocator"),readLocalFiles:u(function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},"readLocalFiles"),readCentralDir:u(function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},"readCentralDir"),readEndOfCentral:u(function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var T=f-p;if(0<T)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=T);else if(T<0)throw new Error("Corrupted zip: missing "+Math.abs(T)+" bytes.")},"readEndOfCentral"),prepareReader:u(function(d){this.reader=a(d)},"prepareReader"),load:u(function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()},"load")},i.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var a=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),h=t("./utf8"),c=t("./compressions"),d=t("./support");function f(p,T){this.options=p,this.loadOptions=T}u(f,"l"),f.prototype={isEncrypted:u(function(){return(1&this.bitFlag)==1},"isEncrypted"),useUTF8:u(function(){return(2048&this.bitFlag)==2048},"useUTF8"),readLocalPart:u(function(p){var T,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((T=function(C){for(var b in c)if(Object.prototype.hasOwnProperty.call(c,b)&&c[b].magic===C)return c[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,T,p.readData(this.compressedSize))},"readLocalPart"),readCentralPart:u(function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var T=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(T),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},"readCentralPart"),processAttributes:u(function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},"processAttributes"),parseZIP64ExtraField:u(function(){if(this.extraFields[1]){var p=a(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},"parseZIP64ExtraField"),readExtraFields:u(function(p){var T,m,C,b=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<b;)T=p.readInt(2),m=p.readInt(2),C=p.readData(m),this.extraFields[T]={id:T,length:m,value:C};p.setIndex(b)},"readExtraFields"),handleUTF8:u(function(){var p=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var T=this.findExtraFieldUnicodePath();if(T!==null)this.fileNameStr=T;else{var m=r.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var C=this.findExtraFieldUnicodeComment();if(C!==null)this.fileCommentStr=C;else{var b=r.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},"handleUTF8"),findExtraFieldUnicodePath:u(function(){var p=this.extraFields[28789];if(p){var T=a(p.value);return T.readInt(1)!==1||l(this.fileName)!==T.readInt(4)?null:h.utf8decode(T.readData(p.length-5))}return null},"findExtraFieldUnicodePath"),findExtraFieldUnicodeComment:u(function(){var p=this.extraFields[25461];if(p){var T=a(p.value);return T.readInt(1)!==1||l(this.fileComment)!==T.readInt(4)?null:h.utf8decode(T.readData(p.length-5))}return null},"findExtraFieldUnicodeComment")},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function a(T,m,C){this.name=T,this.dir=C.dir,this.date=C.date,this.comment=C.comment,this.unixPermissions=C.unixPermissions,this.dosPermissions=C.dosPermissions,this._data=m,this._dataBinary=C.binary,this.options={compression:C.compression,compressionOptions:C.compressionOptions}}u(a,"n");var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),h=t("./compressedObject"),c=t("./stream/GenericWorker");a.prototype={internalStream:u(function(T){var m=null,C="string";try{if(!T)throw new Error("No output type specified.");var b=(C=T.toLowerCase())==="string"||C==="text";C!=="binarystring"&&C!=="text"||(C="string"),m=this._decompressWorker();var S=!this._dataBinary;S&&!b&&(m=m.pipe(new l.Utf8EncodeWorker)),!S&&b&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(x){(m=new c("error")).error(x)}return new r(m,C,"")},"internalStream"),async:u(function(T,m){return this.internalStream(T).accumulate(m)},"async"),nodeStream:u(function(T,m){return this.internalStream(T||"nodebuffer").toNodejsStream(m)},"nodeStream"),_compressWorker:u(function(T,m){if(this._data instanceof h&&this._data.compression.magic===T.magic)return this._data.getCompressedWorker();var C=this._decompressWorker();return this._dataBinary||(C=C.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(C,T,m)},"_compressWorker"),_decompressWorker:u(function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof c?this._data:new o(this._data)},"_decompressWorker")};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)a.prototype[d[p]]=f;i.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(a){var r,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var h=0,c=new l(T),d=a.document.createTextNode("");c.observe(d,{characterData:!0}),r=u(function(){d.data=h=++h%2},"r")}else if(a.setImmediate||a.MessageChannel===void 0)r="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var m=a.document.createElement("script");m.onreadystatechange=function(){T(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},a.document.documentElement.appendChild(m)}:function(){setTimeout(T,0)};else{var f=new a.MessageChannel;f.port1.onmessage=T,r=u(function(){f.port2.postMessage(0)},"r")}var p=[];function T(){var m,C;o=!0;for(var b=p.length;b;){for(C=p,p=[],m=-1;++m<b;)C[m]();b=p.length}o=!1}u(T,"u"),i.exports=function(m){p.push(m)!==1||o||r()}}).call(this,typeof An<"u"?An:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var a=t("immediate");function r(){}u(r,"u");var o={},l=["REJECTED"],h=["FULFILLED"],c=["PENDING"];function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,b!==r&&m(this,b)}u(d,"o");function f(b,S,x){this.promise=b,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}u(f,"h");function p(b,S,x){a(function(){var A;try{A=S(x)}catch(w){return o.reject(b,w)}A===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,A)})}u(p,"f");function T(b){var S=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof S=="function")return function(){S.apply(b,arguments)}}u(T,"c");function m(b,S){var x=!1;function A(B){x||(x=!0,o.reject(b,B))}u(A,"n");function w(B){x||(x=!0,o.resolve(b,B))}u(w,"i");var k=C(function(){S(w,A)});k.status==="error"&&A(k.value)}u(m,"d");function C(b,S){var x={};try{x.value=b(S),x.status="success"}catch(A){x.status="error",x.value=A}return x}u(C,"p"),(i.exports=d).prototype.finally=function(b){if(typeof b!="function")return this;var S=this.constructor;return this.then(function(x){return S.resolve(b()).then(function(){return x})},function(x){return S.resolve(b()).then(function(){throw x})})},d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,S){if(typeof b!="function"&&this.state===h||typeof S!="function"&&this.state===l)return this;var x=new this.constructor(r);return this.state!==c?p(x,this.state===h?b:S,this.outcome):this.queue.push(new f(x,b,S)),x},f.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},f.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},f.prototype.callRejected=function(b){o.reject(this.promise,b)},f.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)},o.resolve=function(b,S){var x=C(T,S);if(x.status==="error")return o.reject(b,x.value);var A=x.value;if(A)m(b,A);else{b.state=h,b.outcome=S;for(var w=-1,k=b.queue.length;++w<k;)b.queue[w].callFulfilled(S)}return b},o.reject=function(b,S){b.state=l,b.outcome=S;for(var x=-1,A=b.queue.length;++x<A;)b.queue[x].callRejected(S);return b},d.resolve=function(b){return b instanceof this?b:o.resolve(new this(r),b)},d.reject=function(b){var S=new this(r);return o.reject(S,b)},d.all=function(b){var S=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,A=!1;if(!x)return this.resolve([]);for(var w=new Array(x),k=0,B=-1,X=new this(r);++B<x;)L(b[B],B);return X;function L(Q,te){S.resolve(Q).then(function(P){w[te]=P,++k!==x||A||(A=!0,o.resolve(X,w))},function(P){A||(A=!0,o.reject(X,P))})}},d.race=function(b){var S=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=b.length,A=!1;if(!x)return this.resolve([]);for(var w=-1,k=new this(r);++w<x;)B=b[w],S.resolve(B).then(function(X){A||(A=!0,o.resolve(k,X))},function(X){A||(A=!0,o.reject(k,X))});var B;return k}},{immediate:36}],38:[function(t,i,n){var a={};(0,t("./lib/utils/common").assign)(a,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var a=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),h=t("./zlib/zstream"),c=Object.prototype.toString,d=0,f=-1,p=0,T=8;function m(b){if(!(this instanceof m))return new m(b);this.options=r.assign({level:f,method:T,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},b||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var x=a.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(x!==d)throw new Error(l[x]);if(S.header&&a.deflateSetHeader(this.strm,S.header),S.dictionary){var A;if(A=typeof S.dictionary=="string"?o.string2buf(S.dictionary):c.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(x=a.deflateSetDictionary(this.strm,A))!==d)throw new Error(l[x]);this._dict_set=!0}}u(m,"p");function C(b,S){var x=new m(S);if(x.push(b,!0),x.err)throw x.msg||l[x.err];return x.result}u(C,"n"),m.prototype.push=function(b,S){var x,A,w=this.strm,k=this.options.chunkSize;if(this.ended)return!1;A=S===~~S?S:S===!0?4:0,typeof b=="string"?w.input=o.string2buf(b):c.call(b)==="[object ArrayBuffer]"?w.input=new Uint8Array(b):w.input=b,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(k),w.next_out=0,w.avail_out=k),(x=a.deflate(w,A))!==1&&x!==d)return this.onEnd(x),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(w.output,w.next_out))):this.onData(r.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&x!==1);return A===4?(x=a.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===d):A!==2||(this.onEnd(d),!(w.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},n.Deflate=m,n.deflate=C,n.deflateRaw=function(b,S){return(S=S||{}).raw=!0,C(b,S)},n.gzip=function(b,S){return(S=S||{}).gzip=!0,C(b,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var a=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),h=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},m||{});var C=this.options;C.raw&&0<=C.windowBits&&C.windowBits<16&&(C.windowBits=-C.windowBits,C.windowBits===0&&(C.windowBits=-15)),!(0<=C.windowBits&&C.windowBits<16)||m&&m.windowBits||(C.windowBits+=32),15<C.windowBits&&C.windowBits<48&&(15&C.windowBits)==0&&(C.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var b=a.inflateInit2(this.strm,C.windowBits);if(b!==l.Z_OK)throw new Error(h[b]);this.header=new d,a.inflateGetHeader(this.strm,this.header)}u(p,"a");function T(m,C){var b=new p(C);if(b.push(m,!0),b.err)throw b.msg||h[b.err];return b.result}u(T,"o"),p.prototype.push=function(m,C){var b,S,x,A,w,k,B=this.strm,X=this.options.chunkSize,L=this.options.dictionary,Q=!1;if(this.ended)return!1;S=C===~~C?C:C===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?B.input=o.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?B.input=new Uint8Array(m):B.input=m,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new r.Buf8(X),B.next_out=0,B.avail_out=X),(b=a.inflate(B,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&L&&(k=typeof L=="string"?o.string2buf(L):f.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,b=a.inflateSetDictionary(this.strm,k)),b===l.Z_BUF_ERROR&&Q===!0&&(b=l.Z_OK,Q=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&b!==l.Z_STREAM_END&&(B.avail_in!==0||S!==l.Z_FINISH&&S!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=o.utf8border(B.output,B.next_out),A=B.next_out-x,w=o.buf2string(B.output,x),B.next_out=A,B.avail_out=X-A,A&&r.arraySet(B.output,B.output,x,A,0),this.onData(w)):this.onData(r.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(Q=!0)}while((0<B.avail_in||B.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(S=l.Z_FINISH),S===l.Z_FINISH?(b=a.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):S!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(B.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=p,n.inflate=T,n.inflateRaw=function(m,C){return(C=C||{}).raw=!0,T(m,C)},n.ungzip=T},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var c=h.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(l[d]=c[d])}}return l},n.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var r={arraySet:u(function(l,h,c,d,f){if(h.subarray&&l.subarray)l.set(h.subarray(c,c+d),f);else for(var p=0;p<d;p++)l[f+p]=h[c+p]},"arraySet"),flattenChunks:u(function(l){var h,c,d,f,p,T;for(h=d=0,c=l.length;h<c;h++)d+=l[h].length;for(T=new Uint8Array(d),h=f=0,c=l.length;h<c;h++)p=l[h],T.set(p,f),f+=p.length;return T},"flattenChunks")},o={arraySet:u(function(l,h,c,d,f){for(var p=0;p<d;p++)l[f+p]=h[c+p]},"arraySet"),flattenChunks:u(function(l){return[].concat.apply([],l)},"flattenChunks")};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(a)},{}],42:[function(t,i,n){var a=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(d,f){if(f<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,a.shrinkBuf(d,f));for(var p="",T=0;T<f;T++)p+=String.fromCharCode(d[T]);return p}u(c,"l"),l[254]=l[254]=1,n.string2buf=function(d){var f,p,T,m,C,b=d.length,S=0;for(m=0;m<b;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<b&&(64512&(T=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(T-56320),m++),S+=p<128?1:p<2048?2:p<65536?3:4;for(f=new a.Buf8(S),m=C=0;C<S;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<b&&(64512&(T=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(T-56320),m++),p<128?f[C++]=p:(p<2048?f[C++]=192|p>>>6:(p<65536?f[C++]=224|p>>>12:(f[C++]=240|p>>>18,f[C++]=128|p>>>12&63),f[C++]=128|p>>>6&63),f[C++]=128|63&p);return f},n.buf2binstring=function(d){return c(d,d.length)},n.binstring2buf=function(d){for(var f=new a.Buf8(d.length),p=0,T=f.length;p<T;p++)f[p]=d.charCodeAt(p);return f},n.buf2string=function(d,f){var p,T,m,C,b=f||d.length,S=new Array(2*b);for(p=T=0;p<b;)if((m=d[p++])<128)S[T++]=m;else if(4<(C=l[m]))S[T++]=65533,p+=C-1;else{for(m&=C===2?31:C===3?15:7;1<C&&p<b;)m=m<<6|63&d[p++],C--;1<C?S[T++]=65533:m<65536?S[T++]=m:(m-=65536,S[T++]=55296|m>>10&1023,S[T++]=56320|1023&m)}return c(S,T)},n.utf8border=function(d,f){var p;for((f=f||d.length)>d.length&&(f=d.length),p=f-1;0<=p&&(192&d[p])==128;)p--;return p<0||p===0?f:p+l[d[p]]>f?p:f}},{"./common":41}],43:[function(t,i,n){i.exports=function(a,r,o,l){for(var h=65535&a|0,c=a>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;c=c+(h=h+r[l++]|0)|0,--d;);h%=65521,c%=65521}return h|c<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var a=function(){for(var r,o=[],l=0;l<256;l++){r=l;for(var h=0;h<8;h++)r=1&r?3988292384^r>>>1:r>>>1;o[l]=r}return o}();i.exports=function(r,o,l,h){var c=a,d=h+l;r^=-1;for(var f=h;f<d;f++)r=r>>>8^c[255&(r^o[f])];return-1^r}},{}],46:[function(t,i,n){var a,r=t("../utils/common"),o=t("./trees"),l=t("./adler32"),h=t("./crc32"),c=t("./messages"),d=0,f=4,p=0,T=-2,m=-1,C=4,b=2,S=8,x=9,A=286,w=30,k=19,B=2*A+1,X=15,L=3,Q=258,te=Q+L+1,P=42,H=113,v=1,F=2,pe=3,z=4;function ce(E,q){return E.msg=c[q],q}u(ce,"R");function $(E){return(E<<1)-(4<E?9:0)}u($,"T");function Y(E){for(var q=E.length;0<=--q;)E[q]=0}u(Y,"D");function W(E){var q=E.state,K=q.pending;K>E.avail_out&&(K=E.avail_out),K!==0&&(r.arraySet(E.output,q.pending_buf,q.pending_out,K,E.next_out),E.next_out+=K,q.pending_out+=K,E.total_out+=K,E.avail_out-=K,q.pending-=K,q.pending===0&&(q.pending_out=0))}u(W,"F");function R(E,q){o._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,q),E.block_start=E.strstart,W(E.strm)}u(R,"N");function he(E,q){E.pending_buf[E.pending++]=q}u(he,"U");function ae(E,q){E.pending_buf[E.pending++]=q>>>8&255,E.pending_buf[E.pending++]=255&q}u(ae,"P");function oe(E,q){var K,N,M=E.max_chain_length,U=E.strstart,J=E.prev_length,se=E.nice_match,j=E.strstart>E.w_size-te?E.strstart-(E.w_size-te):0,le=E.window,ye=E.w_mask,ue=E.prev,Ie=E.strstart+Q,ze=le[U+J-1],De=le[U+J];E.prev_length>=E.good_match&&(M>>=2),se>E.lookahead&&(se=E.lookahead);do if(le[(K=q)+J]===De&&le[K+J-1]===ze&&le[K]===le[U]&&le[++K]===le[U+1]){U+=2,K++;do;while(le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&le[++U]===le[++K]&&U<Ie);if(N=Q-(Ie-U),U=Ie-Q,J<N){if(E.match_start=q,se<=(J=N))break;ze=le[U+J-1],De=le[U+J]}}while((q=ue[q&ye])>j&&--M!=0);return J<=E.lookahead?J:E.lookahead}u(oe,"L");function Ve(E){var q,K,N,M,U,J,se,j,le,ye,ue=E.w_size;do{if(M=E.window_size-E.lookahead-E.strstart,E.strstart>=ue+(ue-te)){for(r.arraySet(E.window,E.window,ue,ue,0),E.match_start-=ue,E.strstart-=ue,E.block_start-=ue,q=K=E.hash_size;N=E.head[--q],E.head[q]=ue<=N?N-ue:0,--K;);for(q=K=ue;N=E.prev[--q],E.prev[q]=ue<=N?N-ue:0,--K;);M+=ue}if(E.strm.avail_in===0)break;if(J=E.strm,se=E.window,j=E.strstart+E.lookahead,le=M,ye=void 0,ye=J.avail_in,le<ye&&(ye=le),K=ye===0?0:(J.avail_in-=ye,r.arraySet(se,J.input,J.next_in,ye,j),J.state.wrap===1?J.adler=l(J.adler,se,ye,j):J.state.wrap===2&&(J.adler=h(J.adler,se,ye,j)),J.next_in+=ye,J.total_in+=ye,ye),E.lookahead+=K,E.lookahead+E.insert>=L)for(U=E.strstart-E.insert,E.ins_h=E.window[U],E.ins_h=(E.ins_h<<E.hash_shift^E.window[U+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[U+L-1])&E.hash_mask,E.prev[U&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=U,U++,E.insert--,!(E.lookahead+E.insert<L)););}while(E.lookahead<te&&E.strm.avail_in!==0)}u(Ve,"j");function it(E,q){for(var K,N;;){if(E.lookahead<te){if(Ve(E),E.lookahead<te&&q===d)return v;if(E.lookahead===0)break}if(K=0,E.lookahead>=L&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,K=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),K!==0&&E.strstart-K<=E.w_size-te&&(E.match_length=oe(E,K)),E.match_length>=L)if(N=o._tr_tally(E,E.strstart-E.match_start,E.match_length-L),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=L){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,K=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else N=o._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(N&&(R(E,!1),E.strm.avail_out===0))return v}return E.insert=E.strstart<L-1?E.strstart:L-1,q===f?(R(E,!0),E.strm.avail_out===0?pe:z):E.last_lit&&(R(E,!1),E.strm.avail_out===0)?v:F}u(it,"Z");function Me(E,q){for(var K,N,M;;){if(E.lookahead<te){if(Ve(E),E.lookahead<te&&q===d)return v;if(E.lookahead===0)break}if(K=0,E.lookahead>=L&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,K=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=L-1,K!==0&&E.prev_length<E.max_lazy_match&&E.strstart-K<=E.w_size-te&&(E.match_length=oe(E,K),E.match_length<=5&&(E.strategy===1||E.match_length===L&&4096<E.strstart-E.match_start)&&(E.match_length=L-1)),E.prev_length>=L&&E.match_length<=E.prev_length){for(M=E.strstart+E.lookahead-L,N=o._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-L),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=M&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+L-1])&E.hash_mask,K=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=L-1,E.strstart++,N&&(R(E,!1),E.strm.avail_out===0))return v}else if(E.match_available){if((N=o._tr_tally(E,0,E.window[E.strstart-1]))&&R(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return v}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(N=o._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<L-1?E.strstart:L-1,q===f?(R(E,!0),E.strm.avail_out===0?pe:z):E.last_lit&&(R(E,!1),E.strm.avail_out===0)?v:F}u(Me,"W");function Pe(E,q,K,N,M){this.good_length=E,this.max_lazy=q,this.nice_length=K,this.max_chain=N,this.func=M}u(Pe,"M");function Qe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*B),this.dyn_dtree=new r.Buf16(2*(2*w+1)),this.bl_tree=new r.Buf16(2*(2*k+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(X+1),this.heap=new r.Buf16(2*A+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*A+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}u(Qe,"H");function Ue(E){var q;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=b,(q=E.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?P:H,E.adler=q.wrap===2?0:1,q.last_flush=d,o._tr_init(q),p):ce(E,T)}u(Ue,"G");function lt(E){var q=Ue(E);return q===p&&function(K){K.window_size=2*K.w_size,Y(K.head),K.max_lazy_match=a[K.level].max_lazy,K.good_match=a[K.level].good_length,K.nice_match=a[K.level].nice_length,K.max_chain_length=a[K.level].max_chain,K.strstart=0,K.block_start=0,K.lookahead=0,K.insert=0,K.match_length=K.prev_length=L-1,K.match_available=0,K.ins_h=0}(E.state),q}u(lt,"K");function ht(E,q,K,N,M,U){if(!E)return T;var J=1;if(q===m&&(q=6),N<0?(J=0,N=-N):15<N&&(J=2,N-=16),M<1||x<M||K!==S||N<8||15<N||q<0||9<q||U<0||C<U)return ce(E,T);N===8&&(N=9);var se=new Qe;return(E.state=se).strm=E,se.wrap=J,se.gzhead=null,se.w_bits=N,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=M+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+L-1)/L),se.window=new r.Buf8(2*se.w_size),se.head=new r.Buf16(se.hash_size),se.prev=new r.Buf16(se.w_size),se.lit_bufsize=1<<M+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new r.Buf8(se.pending_buf_size),se.d_buf=1*se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=q,se.strategy=U,se.method=K,lt(E)}u(ht,"Y"),a=[new Pe(0,0,0,0,function(E,q){var K=65535;for(K>E.pending_buf_size-5&&(K=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Ve(E),E.lookahead===0&&q===d)return v;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var N=E.block_start+K;if((E.strstart===0||E.strstart>=N)&&(E.lookahead=E.strstart-N,E.strstart=N,R(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-te&&(R(E,!1),E.strm.avail_out===0))return v}return E.insert=0,q===f?(R(E,!0),E.strm.avail_out===0?pe:z):(E.strstart>E.block_start&&(R(E,!1),E.strm.avail_out),v)}),new Pe(4,4,8,4,it),new Pe(4,5,16,8,it),new Pe(4,6,32,32,it),new Pe(4,4,16,16,Me),new Pe(8,16,32,32,Me),new Pe(8,16,128,128,Me),new Pe(8,32,128,256,Me),new Pe(32,128,258,1024,Me),new Pe(32,258,258,4096,Me)],n.deflateInit=function(E,q){return ht(E,q,S,15,8,0)},n.deflateInit2=ht,n.deflateReset=lt,n.deflateResetKeep=Ue,n.deflateSetHeader=function(E,q){return E&&E.state?E.state.wrap!==2?T:(E.state.gzhead=q,p):T},n.deflate=function(E,q){var K,N,M,U;if(!E||!E.state||5<q||q<0)return E?ce(E,T):T;if(N=E.state,!E.output||!E.input&&E.avail_in!==0||N.status===666&&q!==f)return ce(E,E.avail_out===0?-5:T);if(N.strm=E,K=N.last_flush,N.last_flush=q,N.status===P)if(N.wrap===2)E.adler=0,he(N,31),he(N,139),he(N,8),N.gzhead?(he(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),he(N,255&N.gzhead.time),he(N,N.gzhead.time>>8&255),he(N,N.gzhead.time>>16&255),he(N,N.gzhead.time>>24&255),he(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),he(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(he(N,255&N.gzhead.extra.length),he(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(E.adler=h(E.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(he(N,0),he(N,0),he(N,0),he(N,0),he(N,0),he(N,N.level===9?2:2<=N.strategy||N.level<2?4:0),he(N,3),N.status=H);else{var J=S+(N.w_bits-8<<4)<<8;J|=(2<=N.strategy||N.level<2?0:N.level<6?1:N.level===6?2:3)<<6,N.strstart!==0&&(J|=32),J+=31-J%31,N.status=H,ae(N,J),N.strstart!==0&&(ae(N,E.adler>>>16),ae(N,65535&E.adler)),E.adler=1}if(N.status===69)if(N.gzhead.extra){for(M=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),W(E),M=N.pending,N.pending!==N.pending_buf_size));)he(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(N.status===73)if(N.gzhead.name){M=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),W(E),M=N.pending,N.pending===N.pending_buf_size)){U=1;break}U=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,he(N,U)}while(U!==0);N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),U===0&&(N.gzindex=0,N.status=91)}else N.status=91;if(N.status===91)if(N.gzhead.comment){M=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),W(E),M=N.pending,N.pending===N.pending_buf_size)){U=1;break}U=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,he(N,U)}while(U!==0);N.gzhead.hcrc&&N.pending>M&&(E.adler=h(E.adler,N.pending_buf,N.pending-M,M)),U===0&&(N.status=103)}else N.status=103;if(N.status===103&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&W(E),N.pending+2<=N.pending_buf_size&&(he(N,255&E.adler),he(N,E.adler>>8&255),E.adler=0,N.status=H)):N.status=H),N.pending!==0){if(W(E),E.avail_out===0)return N.last_flush=-1,p}else if(E.avail_in===0&&$(q)<=$(K)&&q!==f)return ce(E,-5);if(N.status===666&&E.avail_in!==0)return ce(E,-5);if(E.avail_in!==0||N.lookahead!==0||q!==d&&N.status!==666){var se=N.strategy===2?function(j,le){for(var ye;;){if(j.lookahead===0&&(Ve(j),j.lookahead===0)){if(le===d)return v;break}if(j.match_length=0,ye=o._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++,ye&&(R(j,!1),j.strm.avail_out===0))return v}return j.insert=0,le===f?(R(j,!0),j.strm.avail_out===0?pe:z):j.last_lit&&(R(j,!1),j.strm.avail_out===0)?v:F}(N,q):N.strategy===3?function(j,le){for(var ye,ue,Ie,ze,De=j.window;;){if(j.lookahead<=Q){if(Ve(j),j.lookahead<=Q&&le===d)return v;if(j.lookahead===0)break}if(j.match_length=0,j.lookahead>=L&&0<j.strstart&&(ue=De[Ie=j.strstart-1])===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]){ze=j.strstart+Q;do;while(ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&ue===De[++Ie]&&Ie<ze);j.match_length=Q-(ze-Ie),j.match_length>j.lookahead&&(j.match_length=j.lookahead)}if(j.match_length>=L?(ye=o._tr_tally(j,1,j.match_length-L),j.lookahead-=j.match_length,j.strstart+=j.match_length,j.match_length=0):(ye=o._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++),ye&&(R(j,!1),j.strm.avail_out===0))return v}return j.insert=0,le===f?(R(j,!0),j.strm.avail_out===0?pe:z):j.last_lit&&(R(j,!1),j.strm.avail_out===0)?v:F}(N,q):a[N.level].func(N,q);if(se!==pe&&se!==z||(N.status=666),se===v||se===pe)return E.avail_out===0&&(N.last_flush=-1),p;if(se===F&&(q===1?o._tr_align(N):q!==5&&(o._tr_stored_block(N,0,0,!1),q===3&&(Y(N.head),N.lookahead===0&&(N.strstart=0,N.block_start=0,N.insert=0))),W(E),E.avail_out===0))return N.last_flush=-1,p}return q!==f?p:N.wrap<=0?1:(N.wrap===2?(he(N,255&E.adler),he(N,E.adler>>8&255),he(N,E.adler>>16&255),he(N,E.adler>>24&255),he(N,255&E.total_in),he(N,E.total_in>>8&255),he(N,E.total_in>>16&255),he(N,E.total_in>>24&255)):(ae(N,E.adler>>>16),ae(N,65535&E.adler)),W(E),0<N.wrap&&(N.wrap=-N.wrap),N.pending!==0?p:1)},n.deflateEnd=function(E){var q;return E&&E.state?(q=E.state.status)!==P&&q!==69&&q!==73&&q!==91&&q!==103&&q!==H&&q!==666?ce(E,T):(E.state=null,q===H?ce(E,-3):p):T},n.deflateSetDictionary=function(E,q){var K,N,M,U,J,se,j,le,ye=q.length;if(!E||!E.state||(U=(K=E.state).wrap)===2||U===1&&K.status!==P||K.lookahead)return T;for(U===1&&(E.adler=l(E.adler,q,ye,0)),K.wrap=0,ye>=K.w_size&&(U===0&&(Y(K.head),K.strstart=0,K.block_start=0,K.insert=0),le=new r.Buf8(K.w_size),r.arraySet(le,q,ye-K.w_size,K.w_size,0),q=le,ye=K.w_size),J=E.avail_in,se=E.next_in,j=E.input,E.avail_in=ye,E.next_in=0,E.input=q,Ve(K);K.lookahead>=L;){for(N=K.strstart,M=K.lookahead-(L-1);K.ins_h=(K.ins_h<<K.hash_shift^K.window[N+L-1])&K.hash_mask,K.prev[N&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=N,N++,--M;);K.strstart=N,K.lookahead=L-1,Ve(K)}return K.strstart+=K.lookahead,K.block_start=K.strstart,K.insert=K.lookahead,K.lookahead=0,K.match_length=K.prev_length=L-1,K.match_available=0,E.next_in=se,E.input=j,E.avail_in=J,K.wrap=U,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(a,r){var o,l,h,c,d,f,p,T,m,C,b,S,x,A,w,k,B,X,L,Q,te,P,H,v,F;o=a.state,l=a.next_in,v=a.input,h=l+(a.avail_in-5),c=a.next_out,F=a.output,d=c-(r-a.avail_out),f=c+(a.avail_out-257),p=o.dmax,T=o.wsize,m=o.whave,C=o.wnext,b=o.window,S=o.hold,x=o.bits,A=o.lencode,w=o.distcode,k=(1<<o.lenbits)-1,B=(1<<o.distbits)-1;e:do{x<15&&(S+=v[l++]<<x,x+=8,S+=v[l++]<<x,x+=8),X=A[S&k];t:for(;;){if(S>>>=L=X>>>24,x-=L,(L=X>>>16&255)===0)F[c++]=65535&X;else{if(!(16&L)){if((64&L)==0){X=A[(65535&X)+(S&(1<<L)-1)];continue t}if(32&L){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}Q=65535&X,(L&=15)&&(x<L&&(S+=v[l++]<<x,x+=8),Q+=S&(1<<L)-1,S>>>=L,x-=L),x<15&&(S+=v[l++]<<x,x+=8,S+=v[l++]<<x,x+=8),X=w[S&B];s:for(;;){if(S>>>=L=X>>>24,x-=L,!(16&(L=X>>>16&255))){if((64&L)==0){X=w[(65535&X)+(S&(1<<L)-1)];continue s}a.msg="invalid distance code",o.mode=30;break e}if(te=65535&X,x<(L&=15)&&(S+=v[l++]<<x,(x+=8)<L&&(S+=v[l++]<<x,x+=8)),p<(te+=S&(1<<L)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(S>>>=L,x-=L,(L=c-d)<te){if(m<(L=te-L)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(H=b,(P=0)===C){if(P+=T-L,L<Q){for(Q-=L;F[c++]=b[P++],--L;);P=c-te,H=F}}else if(C<L){if(P+=T+C-L,(L-=C)<Q){for(Q-=L;F[c++]=b[P++],--L;);if(P=0,C<Q){for(Q-=L=C;F[c++]=b[P++],--L;);P=c-te,H=F}}}else if(P+=C-L,L<Q){for(Q-=L;F[c++]=b[P++],--L;);P=c-te,H=F}for(;2<Q;)F[c++]=H[P++],F[c++]=H[P++],F[c++]=H[P++],Q-=3;Q&&(F[c++]=H[P++],1<Q&&(F[c++]=H[P++]))}else{for(P=c-te;F[c++]=F[P++],F[c++]=F[P++],F[c++]=F[P++],2<(Q-=3););Q&&(F[c++]=F[P++],1<Q&&(F[c++]=F[P++]))}break}}break}}while(l<h&&c<f);l-=Q=x>>3,S&=(1<<(x-=Q<<3))-1,a.next_in=l,a.next_out=c,a.avail_in=l<h?h-l+5:5-(l-h),a.avail_out=c<f?f-c+257:257-(c-f),o.hold=S,o.bits=x}},{}],49:[function(t,i,n){var a=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),l=t("./inffast"),h=t("./inftrees"),c=1,d=2,f=0,p=-2,T=1,m=852,C=592;function b(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}u(b,"L");function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}u(S,"s");function x(P){var H;return P&&P.state?(H=P.state,P.total_in=P.total_out=H.total=0,P.msg="",H.wrap&&(P.adler=1&H.wrap),H.mode=T,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new a.Buf32(m),H.distcode=H.distdyn=new a.Buf32(C),H.sane=1,H.back=-1,f):p}u(x,"a");function A(P){var H;return P&&P.state?((H=P.state).wsize=0,H.whave=0,H.wnext=0,x(P)):p}u(A,"o");function w(P,H){var v,F;return P&&P.state?(F=P.state,H<0?(v=0,H=-H):(v=1+(H>>4),H<48&&(H&=15)),H&&(H<8||15<H)?p:(F.window!==null&&F.wbits!==H&&(F.window=null),F.wrap=v,F.wbits=H,A(P))):p}u(w,"h");function k(P,H){var v,F;return P?(F=new S,(P.state=F).window=null,(v=w(P,H))!==f&&(P.state=null),v):p}u(k,"u");var B,X,L=!0;function Q(P){if(L){var H;for(B=new a.Buf32(512),X=new a.Buf32(32),H=0;H<144;)P.lens[H++]=8;for(;H<256;)P.lens[H++]=9;for(;H<280;)P.lens[H++]=7;for(;H<288;)P.lens[H++]=8;for(h(c,P.lens,0,288,B,0,P.work,{bits:9}),H=0;H<32;)P.lens[H++]=5;h(d,P.lens,0,32,X,0,P.work,{bits:5}),L=!1}P.lencode=B,P.lenbits=9,P.distcode=X,P.distbits=5}u(Q,"j");function te(P,H,v,F){var pe,z=P.state;return z.window===null&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new a.Buf8(z.wsize)),F>=z.wsize?(a.arraySet(z.window,H,v-z.wsize,z.wsize,0),z.wnext=0,z.whave=z.wsize):(F<(pe=z.wsize-z.wnext)&&(pe=F),a.arraySet(z.window,H,v-F,pe,z.wnext),(F-=pe)?(a.arraySet(z.window,H,v-F,F,0),z.wnext=F,z.whave=z.wsize):(z.wnext+=pe,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=pe))),0}u(te,"Z"),n.inflateReset=A,n.inflateReset2=w,n.inflateResetKeep=x,n.inflateInit=function(P){return k(P,15)},n.inflateInit2=k,n.inflate=function(P,H){var v,F,pe,z,ce,$,Y,W,R,he,ae,oe,Ve,it,Me,Pe,Qe,Ue,lt,ht,E,q,K,N,M=0,U=new a.Buf8(4),J=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return p;(v=P.state).mode===12&&(v.mode=13),ce=P.next_out,pe=P.output,Y=P.avail_out,z=P.next_in,F=P.input,$=P.avail_in,W=v.hold,R=v.bits,he=$,ae=Y,q=f;e:for(;;)switch(v.mode){case T:if(v.wrap===0){v.mode=13;break}for(;R<16;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(2&v.wrap&&W===35615){U[v.check=0]=255&W,U[1]=W>>>8&255,v.check=o(v.check,U,2,0),R=W=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&W)<<8)+(W>>8))%31){P.msg="incorrect header check",v.mode=30;break}if((15&W)!=8){P.msg="unknown compression method",v.mode=30;break}if(R-=4,E=8+(15&(W>>>=4)),v.wbits===0)v.wbits=E;else if(E>v.wbits){P.msg="invalid window size",v.mode=30;break}v.dmax=1<<E,P.adler=v.check=1,v.mode=512&W?10:12,R=W=0;break;case 2:for(;R<16;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(v.flags=W,(255&v.flags)!=8){P.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){P.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=W>>8&1),512&v.flags&&(U[0]=255&W,U[1]=W>>>8&255,v.check=o(v.check,U,2,0)),R=W=0,v.mode=3;case 3:for(;R<32;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.head&&(v.head.time=W),512&v.flags&&(U[0]=255&W,U[1]=W>>>8&255,U[2]=W>>>16&255,U[3]=W>>>24&255,v.check=o(v.check,U,4,0)),R=W=0,v.mode=4;case 4:for(;R<16;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.head&&(v.head.xflags=255&W,v.head.os=W>>8),512&v.flags&&(U[0]=255&W,U[1]=W>>>8&255,v.check=o(v.check,U,2,0)),R=W=0,v.mode=5;case 5:if(1024&v.flags){for(;R<16;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.length=W,v.head&&(v.head.extra_len=W),512&v.flags&&(U[0]=255&W,U[1]=W>>>8&255,v.check=o(v.check,U,2,0)),R=W=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&($<(oe=v.length)&&(oe=$),oe&&(v.head&&(E=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),a.arraySet(v.head.extra,F,z,oe,E)),512&v.flags&&(v.check=o(v.check,F,oe,z)),$-=oe,z+=oe,v.length-=oe),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if($===0)break e;for(oe=0;E=F[z+oe++],v.head&&E&&v.length<65536&&(v.head.name+=String.fromCharCode(E)),E&&oe<$;);if(512&v.flags&&(v.check=o(v.check,F,oe,z)),$-=oe,z+=oe,E)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if($===0)break e;for(oe=0;E=F[z+oe++],v.head&&E&&v.length<65536&&(v.head.comment+=String.fromCharCode(E)),E&&oe<$;);if(512&v.flags&&(v.check=o(v.check,F,oe,z)),$-=oe,z+=oe,E)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;R<16;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(W!==(65535&v.check)){P.msg="header crc mismatch",v.mode=30;break}R=W=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),P.adler=v.check=0,v.mode=12;break;case 10:for(;R<32;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}P.adler=v.check=b(W),R=W=0,v.mode=11;case 11:if(v.havedict===0)return P.next_out=ce,P.avail_out=Y,P.next_in=z,P.avail_in=$,v.hold=W,v.bits=R,2;P.adler=v.check=1,v.mode=12;case 12:if(H===5||H===6)break e;case 13:if(v.last){W>>>=7&R,R-=7&R,v.mode=27;break}for(;R<3;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}switch(v.last=1&W,R-=1,3&(W>>>=1)){case 0:v.mode=14;break;case 1:if(Q(v),v.mode=20,H!==6)break;W>>>=2,R-=2;break e;case 2:v.mode=17;break;case 3:P.msg="invalid block type",v.mode=30}W>>>=2,R-=2;break;case 14:for(W>>>=7&R,R-=7&R;R<32;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if((65535&W)!=(W>>>16^65535)){P.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&W,R=W=0,v.mode=15,H===6)break e;case 15:v.mode=16;case 16:if(oe=v.length){if($<oe&&(oe=$),Y<oe&&(oe=Y),oe===0)break e;a.arraySet(pe,F,z,oe,ce),$-=oe,z+=oe,Y-=oe,ce+=oe,v.length-=oe;break}v.mode=12;break;case 17:for(;R<14;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(v.nlen=257+(31&W),W>>>=5,R-=5,v.ndist=1+(31&W),W>>>=5,R-=5,v.ncode=4+(15&W),W>>>=4,R-=4,286<v.nlen||30<v.ndist){P.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;R<3;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.lens[J[v.have++]]=7&W,W>>>=3,R-=3}for(;v.have<19;)v.lens[J[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,K={bits:v.lenbits},q=h(0,v.lens,0,19,v.lencode,0,v.work,K),v.lenbits=K.bits,q){P.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;Pe=(M=v.lencode[W&(1<<v.lenbits)-1])>>>16&255,Qe=65535&M,!((Me=M>>>24)<=R);){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(Qe<16)W>>>=Me,R-=Me,v.lens[v.have++]=Qe;else{if(Qe===16){for(N=Me+2;R<N;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(W>>>=Me,R-=Me,v.have===0){P.msg="invalid bit length repeat",v.mode=30;break}E=v.lens[v.have-1],oe=3+(3&W),W>>>=2,R-=2}else if(Qe===17){for(N=Me+3;R<N;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}R-=Me,E=0,oe=3+(7&(W>>>=Me)),W>>>=3,R-=3}else{for(N=Me+7;R<N;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}R-=Me,E=0,oe=11+(127&(W>>>=Me)),W>>>=7,R-=7}if(v.have+oe>v.nlen+v.ndist){P.msg="invalid bit length repeat",v.mode=30;break}for(;oe--;)v.lens[v.have++]=E}}if(v.mode===30)break;if(v.lens[256]===0){P.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,K={bits:v.lenbits},q=h(c,v.lens,0,v.nlen,v.lencode,0,v.work,K),v.lenbits=K.bits,q){P.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,K={bits:v.distbits},q=h(d,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,K),v.distbits=K.bits,q){P.msg="invalid distances set",v.mode=30;break}if(v.mode=20,H===6)break e;case 20:v.mode=21;case 21:if(6<=$&&258<=Y){P.next_out=ce,P.avail_out=Y,P.next_in=z,P.avail_in=$,v.hold=W,v.bits=R,l(P,ae),ce=P.next_out,pe=P.output,Y=P.avail_out,z=P.next_in,F=P.input,$=P.avail_in,W=v.hold,R=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;Pe=(M=v.lencode[W&(1<<v.lenbits)-1])>>>16&255,Qe=65535&M,!((Me=M>>>24)<=R);){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(Pe&&(240&Pe)==0){for(Ue=Me,lt=Pe,ht=Qe;Pe=(M=v.lencode[ht+((W&(1<<Ue+lt)-1)>>Ue)])>>>16&255,Qe=65535&M,!(Ue+(Me=M>>>24)<=R);){if($===0)break e;$--,W+=F[z++]<<R,R+=8}W>>>=Ue,R-=Ue,v.back+=Ue}if(W>>>=Me,R-=Me,v.back+=Me,v.length=Qe,Pe===0){v.mode=26;break}if(32&Pe){v.back=-1,v.mode=12;break}if(64&Pe){P.msg="invalid literal/length code",v.mode=30;break}v.extra=15&Pe,v.mode=22;case 22:if(v.extra){for(N=v.extra;R<N;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.length+=W&(1<<v.extra)-1,W>>>=v.extra,R-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;Pe=(M=v.distcode[W&(1<<v.distbits)-1])>>>16&255,Qe=65535&M,!((Me=M>>>24)<=R);){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if((240&Pe)==0){for(Ue=Me,lt=Pe,ht=Qe;Pe=(M=v.distcode[ht+((W&(1<<Ue+lt)-1)>>Ue)])>>>16&255,Qe=65535&M,!(Ue+(Me=M>>>24)<=R);){if($===0)break e;$--,W+=F[z++]<<R,R+=8}W>>>=Ue,R-=Ue,v.back+=Ue}if(W>>>=Me,R-=Me,v.back+=Me,64&Pe){P.msg="invalid distance code",v.mode=30;break}v.offset=Qe,v.extra=15&Pe,v.mode=24;case 24:if(v.extra){for(N=v.extra;R<N;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}v.offset+=W&(1<<v.extra)-1,W>>>=v.extra,R-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){P.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(Y===0)break e;if(oe=ae-Y,v.offset>oe){if((oe=v.offset-oe)>v.whave&&v.sane){P.msg="invalid distance too far back",v.mode=30;break}Ve=oe>v.wnext?(oe-=v.wnext,v.wsize-oe):v.wnext-oe,oe>v.length&&(oe=v.length),it=v.window}else it=pe,Ve=ce-v.offset,oe=v.length;for(Y<oe&&(oe=Y),Y-=oe,v.length-=oe;pe[ce++]=it[Ve++],--oe;);v.length===0&&(v.mode=21);break;case 26:if(Y===0)break e;pe[ce++]=v.length,Y--,v.mode=21;break;case 27:if(v.wrap){for(;R<32;){if($===0)break e;$--,W|=F[z++]<<R,R+=8}if(ae-=Y,P.total_out+=ae,v.total+=ae,ae&&(P.adler=v.check=v.flags?o(v.check,pe,ae,ce-ae):r(v.check,pe,ae,ce-ae)),ae=Y,(v.flags?W:b(W))!==v.check){P.msg="incorrect data check",v.mode=30;break}R=W=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;R<32;){if($===0)break e;$--,W+=F[z++]<<R,R+=8}if(W!==(4294967295&v.total)){P.msg="incorrect length check",v.mode=30;break}R=W=0}v.mode=29;case 29:q=1;break e;case 30:q=-3;break e;case 31:return-4;case 32:default:return p}return P.next_out=ce,P.avail_out=Y,P.next_in=z,P.avail_in=$,v.hold=W,v.bits=R,(v.wsize||ae!==P.avail_out&&v.mode<30&&(v.mode<27||H!==4))&&te(P,P.output,P.next_out,ae-P.avail_out)?(v.mode=31,-4):(he-=P.avail_in,ae-=P.avail_out,P.total_in+=he,P.total_out+=ae,v.total+=ae,v.wrap&&ae&&(P.adler=v.check=v.flags?o(v.check,pe,ae,P.next_out-ae):r(v.check,pe,ae,P.next_out-ae)),P.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(he==0&&ae===0||H===4)&&q===f&&(q=-5),q)},n.inflateEnd=function(P){if(!P||!P.state)return p;var H=P.state;return H.window&&(H.window=null),P.state=null,f},n.inflateGetHeader=function(P,H){var v;return P&&P.state?(2&(v=P.state).wrap)==0?p:((v.head=H).done=!1,f):p},n.inflateSetDictionary=function(P,H){var v,F=H.length;return P&&P.state?(v=P.state).wrap!==0&&v.mode!==11?p:v.mode===11&&r(1,H,F,0)!==v.check?-3:te(P,H,F,F)?(v.mode=31,-4):(v.havedict=1,f):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var a=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(c,d,f,p,T,m,C,b){var S,x,A,w,k,B,X,L,Q,te=b.bits,P=0,H=0,v=0,F=0,pe=0,z=0,ce=0,$=0,Y=0,W=0,R=null,he=0,ae=new a.Buf16(16),oe=new a.Buf16(16),Ve=null,it=0;for(P=0;P<=15;P++)ae[P]=0;for(H=0;H<p;H++)ae[d[f+H]]++;for(pe=te,F=15;1<=F&&ae[F]===0;F--);if(F<pe&&(pe=F),F===0)return T[m++]=20971520,T[m++]=20971520,b.bits=1,0;for(v=1;v<F&&ae[v]===0;v++);for(pe<v&&(pe=v),P=$=1;P<=15;P++)if($<<=1,($-=ae[P])<0)return-1;if(0<$&&(c===0||F!==1))return-1;for(oe[1]=0,P=1;P<15;P++)oe[P+1]=oe[P]+ae[P];for(H=0;H<p;H++)d[f+H]!==0&&(C[oe[d[f+H]]++]=H);if(B=c===0?(R=Ve=C,19):c===1?(R=r,he-=257,Ve=o,it-=257,256):(R=l,Ve=h,-1),P=v,k=m,ce=H=W=0,A=-1,w=(Y=1<<(z=pe))-1,c===1&&852<Y||c===2&&592<Y)return 1;for(;;){for(X=P-ce,Q=C[H]<B?(L=0,C[H]):C[H]>B?(L=Ve[it+C[H]],R[he+C[H]]):(L=96,0),S=1<<P-ce,v=x=1<<z;T[k+(W>>ce)+(x-=S)]=X<<24|L<<16|Q|0,x!==0;);for(S=1<<P-1;W&S;)S>>=1;if(S!==0?(W&=S-1,W+=S):W=0,H++,--ae[P]==0){if(P===F)break;P=d[f+C[H]]}if(pe<P&&(W&w)!==A){for(ce===0&&(ce=pe),k+=v,$=1<<(z=P-ce);z+ce<F&&!(($-=ae[z+ce])<=0);)z++,$<<=1;if(Y+=1<<z,c===1&&852<Y||c===2&&592<Y)return 1;T[A=W&w]=pe<<24|z<<16|k-m|0}}return W!==0&&(T[k+W]=P-ce<<24|64<<16|0),b.bits=pe,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var a=t("../utils/common"),r=0,o=1;function l(M){for(var U=M.length;0<=--U;)M[U]=0}u(l,"n");var h=0,c=29,d=256,f=d+1+c,p=30,T=19,m=2*f+1,C=15,b=16,S=7,x=256,A=16,w=17,k=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],te=new Array(2*(f+2));l(te);var P=new Array(2*p);l(P);var H=new Array(512);l(H);var v=new Array(256);l(v);var F=new Array(c);l(F);var pe,z,ce,$=new Array(p);function Y(M,U,J,se,j){this.static_tree=M,this.extra_bits=U,this.extra_base=J,this.elems=se,this.max_length=j,this.has_stree=M&&M.length}u(Y,"D");function W(M,U){this.dyn_tree=M,this.max_code=0,this.stat_desc=U}u(W,"F");function R(M){return M<256?H[M]:H[256+(M>>>7)]}u(R,"N");function he(M,U){M.pending_buf[M.pending++]=255&U,M.pending_buf[M.pending++]=U>>>8&255}u(he,"U");function ae(M,U,J){M.bi_valid>b-J?(M.bi_buf|=U<<M.bi_valid&65535,he(M,M.bi_buf),M.bi_buf=U>>b-M.bi_valid,M.bi_valid+=J-b):(M.bi_buf|=U<<M.bi_valid&65535,M.bi_valid+=J)}u(ae,"P");function oe(M,U,J){ae(M,J[2*U],J[2*U+1])}u(oe,"L");function Ve(M,U){for(var J=0;J|=1&M,M>>>=1,J<<=1,0<--U;);return J>>>1}u(Ve,"j");function it(M,U,J){var se,j,le=new Array(C+1),ye=0;for(se=1;se<=C;se++)le[se]=ye=ye+J[se-1]<<1;for(j=0;j<=U;j++){var ue=M[2*j+1];ue!==0&&(M[2*j]=Ve(le[ue]++,ue))}}u(it,"Z");function Me(M){var U;for(U=0;U<f;U++)M.dyn_ltree[2*U]=0;for(U=0;U<p;U++)M.dyn_dtree[2*U]=0;for(U=0;U<T;U++)M.bl_tree[2*U]=0;M.dyn_ltree[2*x]=1,M.opt_len=M.static_len=0,M.last_lit=M.matches=0}u(Me,"W");function Pe(M){8<M.bi_valid?he(M,M.bi_buf):0<M.bi_valid&&(M.pending_buf[M.pending++]=M.bi_buf),M.bi_buf=0,M.bi_valid=0}u(Pe,"M");function Qe(M,U,J,se){var j=2*U,le=2*J;return M[j]<M[le]||M[j]===M[le]&&se[U]<=se[J]}u(Qe,"H");function Ue(M,U,J){for(var se=M.heap[J],j=J<<1;j<=M.heap_len&&(j<M.heap_len&&Qe(U,M.heap[j+1],M.heap[j],M.depth)&&j++,!Qe(U,se,M.heap[j],M.depth));)M.heap[J]=M.heap[j],J=j,j<<=1;M.heap[J]=se}u(Ue,"G");function lt(M,U,J){var se,j,le,ye,ue=0;if(M.last_lit!==0)for(;se=M.pending_buf[M.d_buf+2*ue]<<8|M.pending_buf[M.d_buf+2*ue+1],j=M.pending_buf[M.l_buf+ue],ue++,se===0?oe(M,j,U):(oe(M,(le=v[j])+d+1,U),(ye=B[le])!==0&&ae(M,j-=F[le],ye),oe(M,le=R(--se),J),(ye=X[le])!==0&&ae(M,se-=$[le],ye)),ue<M.last_lit;);oe(M,x,U)}u(lt,"K");function ht(M,U){var J,se,j,le=U.dyn_tree,ye=U.stat_desc.static_tree,ue=U.stat_desc.has_stree,Ie=U.stat_desc.elems,ze=-1;for(M.heap_len=0,M.heap_max=m,J=0;J<Ie;J++)le[2*J]!==0?(M.heap[++M.heap_len]=ze=J,M.depth[J]=0):le[2*J+1]=0;for(;M.heap_len<2;)le[2*(j=M.heap[++M.heap_len]=ze<2?++ze:0)]=1,M.depth[j]=0,M.opt_len--,ue&&(M.static_len-=ye[2*j+1]);for(U.max_code=ze,J=M.heap_len>>1;1<=J;J--)Ue(M,le,J);for(j=Ie;J=M.heap[1],M.heap[1]=M.heap[M.heap_len--],Ue(M,le,1),se=M.heap[1],M.heap[--M.heap_max]=J,M.heap[--M.heap_max]=se,le[2*j]=le[2*J]+le[2*se],M.depth[j]=(M.depth[J]>=M.depth[se]?M.depth[J]:M.depth[se])+1,le[2*J+1]=le[2*se+1]=j,M.heap[1]=j++,Ue(M,le,1),2<=M.heap_len;);M.heap[--M.heap_max]=M.heap[1],function(De,Bt){var Vs,$t,vs,Je,Hs,wi,ss=Bt.dyn_tree,Mi=Bt.max_code,On=Bt.stat_desc.static_tree,xn=Bt.stat_desc.has_stree,_n=Bt.stat_desc.extra_bits,ki=Bt.stat_desc.extra_base,Z=Bt.stat_desc.max_length,Lt=0;for(Je=0;Je<=C;Je++)De.bl_count[Je]=0;for(ss[2*De.heap[De.heap_max]+1]=0,Vs=De.heap_max+1;Vs<m;Vs++)Z<(Je=ss[2*ss[2*($t=De.heap[Vs])+1]+1]+1)&&(Je=Z,Lt++),ss[2*$t+1]=Je,Mi<$t||(De.bl_count[Je]++,Hs=0,ki<=$t&&(Hs=_n[$t-ki]),wi=ss[2*$t],De.opt_len+=wi*(Je+Hs),xn&&(De.static_len+=wi*(On[2*$t+1]+Hs)));if(Lt!==0){do{for(Je=Z-1;De.bl_count[Je]===0;)Je--;De.bl_count[Je]--,De.bl_count[Je+1]+=2,De.bl_count[Z]--,Lt-=2}while(0<Lt);for(Je=Z;Je!==0;Je--)for($t=De.bl_count[Je];$t!==0;)Mi<(vs=De.heap[--Vs])||(ss[2*vs+1]!==Je&&(De.opt_len+=(Je-ss[2*vs+1])*ss[2*vs],ss[2*vs+1]=Je),$t--)}}(M,U),it(le,ze,M.bl_count)}u(ht,"Y");function E(M,U,J){var se,j,le=-1,ye=U[1],ue=0,Ie=7,ze=4;for(ye===0&&(Ie=138,ze=3),U[2*(J+1)+1]=65535,se=0;se<=J;se++)j=ye,ye=U[2*(se+1)+1],++ue<Ie&&j===ye||(ue<ze?M.bl_tree[2*j]+=ue:j!==0?(j!==le&&M.bl_tree[2*j]++,M.bl_tree[2*A]++):ue<=10?M.bl_tree[2*w]++:M.bl_tree[2*k]++,le=j,ze=(ue=0)===ye?(Ie=138,3):j===ye?(Ie=6,3):(Ie=7,4))}u(E,"X");function q(M,U,J){var se,j,le=-1,ye=U[1],ue=0,Ie=7,ze=4;for(ye===0&&(Ie=138,ze=3),se=0;se<=J;se++)if(j=ye,ye=U[2*(se+1)+1],!(++ue<Ie&&j===ye)){if(ue<ze)for(;oe(M,j,M.bl_tree),--ue!=0;);else j!==0?(j!==le&&(oe(M,j,M.bl_tree),ue--),oe(M,A,M.bl_tree),ae(M,ue-3,2)):ue<=10?(oe(M,w,M.bl_tree),ae(M,ue-3,3)):(oe(M,k,M.bl_tree),ae(M,ue-11,7));le=j,ze=(ue=0)===ye?(Ie=138,3):j===ye?(Ie=6,3):(Ie=7,4)}}u(q,"V"),l($);var K=!1;function N(M,U,J,se){ae(M,(h<<1)+(se?1:0),3),function(j,le,ye,ue){Pe(j),he(j,ye),he(j,~ye),a.arraySet(j.pending_buf,j.window,le,ye,j.pending),j.pending+=ye}(M,U,J)}u(N,"J"),n._tr_init=function(M){K||(function(){var U,J,se,j,le,ye=new Array(C+1);for(j=se=0;j<c-1;j++)for(F[j]=se,U=0;U<1<<B[j];U++)v[se++]=j;for(v[se-1]=j,j=le=0;j<16;j++)for($[j]=le,U=0;U<1<<X[j];U++)H[le++]=j;for(le>>=7;j<p;j++)for($[j]=le<<7,U=0;U<1<<X[j]-7;U++)H[256+le++]=j;for(J=0;J<=C;J++)ye[J]=0;for(U=0;U<=143;)te[2*U+1]=8,U++,ye[8]++;for(;U<=255;)te[2*U+1]=9,U++,ye[9]++;for(;U<=279;)te[2*U+1]=7,U++,ye[7]++;for(;U<=287;)te[2*U+1]=8,U++,ye[8]++;for(it(te,f+1,ye),U=0;U<p;U++)P[2*U+1]=5,P[2*U]=Ve(U,5);pe=new Y(te,B,d+1,f,C),z=new Y(P,X,0,p,C),ce=new Y(new Array(0),L,0,T,S)}(),K=!0),M.l_desc=new W(M.dyn_ltree,pe),M.d_desc=new W(M.dyn_dtree,z),M.bl_desc=new W(M.bl_tree,ce),M.bi_buf=0,M.bi_valid=0,Me(M)},n._tr_stored_block=N,n._tr_flush_block=function(M,U,J,se){var j,le,ye=0;0<M.level?(M.strm.data_type===2&&(M.strm.data_type=function(ue){var Ie,ze=4093624447;for(Ie=0;Ie<=31;Ie++,ze>>>=1)if(1&ze&&ue.dyn_ltree[2*Ie]!==0)return r;if(ue.dyn_ltree[18]!==0||ue.dyn_ltree[20]!==0||ue.dyn_ltree[26]!==0)return o;for(Ie=32;Ie<d;Ie++)if(ue.dyn_ltree[2*Ie]!==0)return o;return r}(M)),ht(M,M.l_desc),ht(M,M.d_desc),ye=function(ue){var Ie;for(E(ue,ue.dyn_ltree,ue.l_desc.max_code),E(ue,ue.dyn_dtree,ue.d_desc.max_code),ht(ue,ue.bl_desc),Ie=T-1;3<=Ie&&ue.bl_tree[2*Q[Ie]+1]===0;Ie--);return ue.opt_len+=3*(Ie+1)+5+5+4,Ie}(M),j=M.opt_len+3+7>>>3,(le=M.static_len+3+7>>>3)<=j&&(j=le)):j=le=J+5,J+4<=j&&U!==-1?N(M,U,J,se):M.strategy===4||le===j?(ae(M,2+(se?1:0),3),lt(M,te,P)):(ae(M,4+(se?1:0),3),function(ue,Ie,ze,De){var Bt;for(ae(ue,Ie-257,5),ae(ue,ze-1,5),ae(ue,De-4,4),Bt=0;Bt<De;Bt++)ae(ue,ue.bl_tree[2*Q[Bt]+1],3);q(ue,ue.dyn_ltree,Ie-1),q(ue,ue.dyn_dtree,ze-1)}(M,M.l_desc.max_code+1,M.d_desc.max_code+1,ye+1),lt(M,M.dyn_ltree,M.dyn_dtree)),Me(M),se&&Pe(M)},n._tr_tally=function(M,U,J){return M.pending_buf[M.d_buf+2*M.last_lit]=U>>>8&255,M.pending_buf[M.d_buf+2*M.last_lit+1]=255&U,M.pending_buf[M.l_buf+M.last_lit]=255&J,M.last_lit++,U===0?M.dyn_ltree[2*J]++:(M.matches++,U--,M.dyn_ltree[2*(v[J]+d+1)]++,M.dyn_dtree[2*R(U)]++),M.last_lit===M.lit_bufsize-1},n._tr_align=function(M){ae(M,2,3),oe(M,x,te),function(U){U.bi_valid===16?(he(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):8<=U.bi_valid&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)}(M)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(a){(function(r,o){if(!r.setImmediate){var l,h,c,d,f=1,p={},T=!1,m=r.document,C=Object.getPrototypeOf&&Object.getPrototypeOf(r);C=C&&C.setTimeout?C:r,l={}.toString.call(r.process)==="[object process]"?function(A){process.nextTick(function(){S(A)})}:function(){if(r.postMessage&&!r.importScripts){var A=!0,w=r.onmessage;return r.onmessage=function(){A=!1},r.postMessage("","*"),r.onmessage=w,A}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",x,!1):r.attachEvent("onmessage",x),function(A){r.postMessage(d+A,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(A){S(A.data)},function(A){c.port2.postMessage(A)}):m&&"onreadystatechange"in m.createElement("script")?(h=m.documentElement,function(A){var w=m.createElement("script");w.onreadystatechange=function(){S(A),w.onreadystatechange=null,h.removeChild(w),w=null},h.appendChild(w)}):function(A){setTimeout(S,0,A)},C.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var w=new Array(arguments.length-1),k=0;k<w.length;k++)w[k]=arguments[k+1];var B={callback:A,args:w};return p[f]=B,l(f),f++},C.clearImmediate=b}function b(A){delete p[A]}u(b,"f");function S(A){if(T)setTimeout(S,0,A);else{var w=p[A];if(w){T=!0;try{(function(k){var B=k.callback,X=k.args;switch(X.length){case 0:B();break;case 1:B(X[0]);break;case 2:B(X[0],X[1]);break;case 3:B(X[0],X[1],X[2]);break;default:B.apply(o,X)}})(w)}finally{b(A),T=!1}}}}u(S,"c");function x(A){A.source===r&&typeof A.data=="string"&&A.data.indexOf(d)===0&&S(+A.data.slice(d.length))}u(x,"d")})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof An<"u"?An:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(Tr)),Tr.exports}u(XT,"requireJszip_min");var qT=XT();const QT=og(qT),mc=class mc extends Fs{constructor(e=null){super(e),this.ERR_USERNAME="invalid username",this.ERR_PASSWORD="invalid password",this.ERR_ACCOUNT_EXIST="account doesn't exist",this.ERR_PASSWORD_MATCH="password doesn't match",this.ERR_NO_SAVES="No save files found",this.ERR_TOO_MANY_SAVES="Too many save files found"}setup(){super.setup(),this.buildExternalPartyContainer(),this.buildInfoContainer()}buildExternalPartyContainer(){this.externalPartyContainer=s.add.container(0,0),this.externalPartyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/12,s.game.canvas.height/12),Phaser.Geom.Rectangle.Contains),this.externalPartyTitle=D(0,4,"",O.SETTINGS_LABEL),this.externalPartyTitle.setOrigin(.5,0),this.externalPartyBg=me(0,0,0,0),this.externalPartyContainer.add(this.externalPartyBg),this.externalPartyContainer.add(this.externalPartyTitle),this.googleImage=this.buildInteractableImage("google","google-icon"),this.discordImage=this.buildInteractableImage("discord","discord-icon"),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.getUi().add(this.externalPartyContainer),this.externalPartyContainer.add(this.googleImage),this.externalPartyContainer.add(this.discordImage),this.externalPartyContainer.setVisible(!1)}buildInfoContainer(){this.infoContainer=s.add.container(0,0),this.usernameInfoImage=this.buildInteractableImage("settings_icon","username-info-icon",{x:20,scale:.5}),this.saveDownloadImage=this.buildInteractableImage("saving_icon","save-download-icon",{x:0,scale:.75}),this.infoContainer.add(this.usernameInfoImage),this.infoContainer.add(this.saveDownloadImage),this.getUi().add(this.infoContainer),this.infoContainer.setVisible(!1),this.infoContainer.disableInteractive()}getModalTitle(e){return g.t("menu:login")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[g.t("menu:login"),g.t("menu:register")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case this.ERR_USERNAME:return g.t("menu:invalidLoginUsername");case this.ERR_PASSWORD:return g.t("menu:invalidLoginPassword");case this.ERR_ACCOUNT_EXIST:return g.t("menu:accountNonExistent");case this.ERR_PASSWORD_MATCH:return g.t("menu:unmatchingPassword");case this.ERR_NO_SAVES:return"P01: "+g.t("menu:noSaves");case this.ERR_TOO_MANY_SAVES:return"P02: "+g.t("menu:tooManySaves")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:g.t("menu:username")}),e.push({label:g.t("menu:password"),isPassword:!0}),e}show(e){if(super.show(e)){const t=e[0];this.processExternalProvider(t);const i=this.submitAction;return this.submitAction=n=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(_.LOADING,{buttonActions:[]});const a=u(l=>{s.ui.setMode(_.LOGIN_FORM,Object.assign(t,{errorMessage:l==null?void 0:l.trim()})),s.ui.playError()},"onFail");if(!this.inputs[0].text)return a(g.t("menu:emptyUsername"));const[r,o]=this.inputs;qe.account.login({username:r.text,password:o.text}).then(l=>{!l&&i?i():a(l)})}},!0}return!1}clear(){super.clear(),this.externalPartyContainer.setVisible(!1),this.infoContainer.setVisible(!1),this.setMouseCursorStyle("default"),[this.discordImage,this.googleImage,this.usernameInfoImage,this.saveDownloadImage].forEach(e=>e.off("pointerdown"))}processExternalProvider(e){this.externalPartyTitle.setText(g.t("menu:orUse")??""),this.externalPartyTitle.setX(20+this.externalPartyTitle.text.length),this.externalPartyTitle.setVisible(!0),this.externalPartyContainer.setPositionRelative(this.modalContainer,175,0),this.externalPartyContainer.setVisible(!0),this.externalPartyBg.setSize(this.externalPartyTitle.text.length+50,this.modalBg.height),this.getUi().moveTo(this.externalPartyContainer,this.getUi().length-1),this.googleImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-60),this.discordImage.setPosition(this.externalPartyBg.width/3.1,this.externalPartyBg.height-40),this.infoContainer.setPosition(5,-76),this.infoContainer.setVisible(!0),this.getUi().moveTo(this.infoContainer,this.getUi().length-1),this.usernameInfoImage.setPositionRelative(this.infoContainer,0,0),this.saveDownloadImage.setPositionRelative(this.infoContainer,20,0),this.discordImage.on("pointerdown",()=>{const a=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(a,"_self")}),this.googleImage.on("pointerdown",()=>{const a=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&response_type=code&scope=openid`;window.open(a,"_self")});const t=u(i=>{s.ui.setMode(_.LOADING,{buttonActions:[]}),s.ui.setModeForceTransition(_.LOGIN_FORM,Object.assign(e,{errorMessage:i==null?void 0:i.trim()})),s.ui.playError()},"onFail");this.usernameInfoImage.on("pointerdown",()=>{if(s.tweens.getTweensOf(this.infoContainer).length===0){const i=Object.keys(localStorage),n="data_",a=i.filter(r=>r.indexOf(n)>=0);if(a.length>0&&a.length<=2){const r=[];for(let o=0;o<a.length;o++)r.push({label:a[o].replace(n,""),handler:u(()=>(s.ui.revertMode(),this.infoContainer.disableInteractive(),!0),"handler")});s.ui.setOverlayMode(_.OPTION_SELECT,{options:r,delay:1e3}),this.infoContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width,s.game.canvas.height),Phaser.Geom.Rectangle.Contains)}else return a.length>2?t(this.ERR_TOO_MANY_SAVES):t(this.ERR_NO_SAVES)}}),this.saveDownloadImage.on("pointerdown",()=>{const i=Object.keys(localStorage),n="data_",a="sessionData",r=i.filter(l=>l.indexOf(n)>=0),o=i.filter(l=>l.indexOf(a)>=0);if(r.length>0||o.length>0){const l=new QT;for(let h=0;h<r.length;h++)l.file(r[h]+".prsv",localStorage.getItem(r[h]));for(let h=0;h<o.length;h++)l.file(o[h]+".prsv",localStorage.getItem(o[h]));l.generateAsync({type:"blob"}).then(h=>{const c=URL.createObjectURL(h),d=document.createElement("a");d.href=c,d.download="pokerogue_saves.zip",d.click(),URL.revokeObjectURL(c)})}else return t(this.ERR_NO_SAVES)}),this.externalPartyContainer.setAlpha(0),s.tweens.add({targets:this.externalPartyContainer,duration:de(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1}),this.infoContainer.setAlpha(0),s.tweens.add({targets:this.infoContainer,duration:de(1e3),ease:"Sine.easeInOut",y:"-=24",alpha:1})}buildInteractableImage(e,t,i={}){const{scale:n=.07,x:a=0,y:r=0,origin:o={x:0,y:0}}=i,l=s.add.image(a,r,e);return l.setName(t),l.setOrigin(o.x,o.y),l.setScale(n),l.setInteractive(),this.addInteractionHoverEffect(l),l}};u(mc,"LoginFormUiHandler");let to=mc;const Cr={"es-ES":{inputFieldFontSize:"50px",errorMessageFontSize:"40px"}},yc=class yc extends Fs{getModalTitle(e){return g.t("menu:register")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonTopMargin(){return 8}getButtonLabels(e){return[g.t("menu:register"),g.t("menu:backToLogin")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");switch(t>0&&(e=e.slice(0,t)),e){case"invalid username":return g.t("menu:invalidRegisterUsername");case"invalid password":return g.t("menu:invalidRegisterPassword");case"failed to add account record":return g.t("menu:usernameAlreadyUsed")}return super.getReadableErrorMessage(e)}getInputFieldConfigs(){const e=[];return e.push({label:g.t("menu:username")}),e.push({label:g.t("menu:password"),isPassword:!0}),e.push({label:g.t("menu:confirmPassword"),isPassword:!0}),e}setup(){var i;super.setup(),this.modalContainer.list.forEach(n=>{var a;if(n instanceof Phaser.GameObjects.Text&&n!==this.titleText){const r=(a=Cr[g.resolvedLanguage])==null?void 0:a.inputFieldFontSize;r&&n.setFontSize(r)}});const e=((i=Cr[g.resolvedLanguage])==null?void 0:i.warningMessageFontSize)??"42px",t=D(10,87,g.t("menu:registrationAgeWarning"),O.TOOLTIP_CONTENT,{fontSize:e});this.modalContainer.add(t)}show(e){if(super.show(e)){const t=e[0],i=this.submitAction;return this.submitAction=n=>{if(s.tweens.getTweensOf(this.modalContainer).length===0){this.submitAction=i,this.sanitizeInputs(),s.ui.setMode(_.LOADING,{buttonActions:[]});const a=u(l=>{var c;s.ui.setMode(_.REGISTRATION_FORM,Object.assign(t,{errorMessage:l==null?void 0:l.trim()})),s.ui.playError();const h=(c=Cr[g.resolvedLanguage])==null?void 0:c.errorMessageFontSize;h&&this.errorMessage.setFontSize(h)},"onFail");if(!this.inputs[0].text)return a(g.t("menu:emptyUsername"));if(!this.inputs[1].text)return a(this.getReadableErrorMessage("invalid password"));if(this.inputs[1].text!==this.inputs[2].text)return a(g.t("menu:passwordNotMatchingConfirmPassword"));const[r,o]=this.inputs;qe.account.register({username:r.text,password:o.text}).then(l=>{l?a(l):qe.account.login({username:r.text,password:o.text}).then(h=>{h?a(h):i==null||i()})})}},!0}return!1}};u(yc,"RegistrationFormUiHandler");let so=yc;const Tc=class Tc extends Ii{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 80}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=D(this.getWidth()/2,this.getHeight()/2,g.t("menu:loading"),O.WINDOW);e.setOrigin(.5,.5),this.modalContainer.add(e)}};u(Tc,"LoadingModalUiHandler");let io=Tc;function ZT(){return new Promise((y,e)=>{qe.daily.getSeed().then(t=>{y(t)})})}u(ZT,"fetchDailyRunSeed");function JT(y){const e=[];return s.executeWithSeedOffset(()=>{const t=s.gameMode.getStartingLevel();if(/\d{18}$/.test(y)){for(let n=0;n<3;n++){const a=6+n*6,r=Rt(Number.parseInt(y.slice(a,a+4)),Number.parseInt(y.slice(a+4,a+6)));e.push(Kp(r,t))}return}const i=[];i.push(Math.min(Math.round(3.5+Math.abs(lg(1))),8)),i.push(Be(9-i[0],1)),i.push(10-(i[0]+i[1]));for(let n=0;n<i.length;n++){const a=i[n],r=Object.keys(Re).map(h=>Number.parseInt(h)).filter(h=>Re[h]===a),o=Dt(_i(r)),l=Dt(o.getTrainerSpeciesForLevel(t,!0,Hg.STRONGER));e.push(Kp(l,t))}},0,y),e}u(JT,"getDailyRunStarters");function Kp(y,e){const t=y instanceof cp?y:Dt(y.speciesId),i=y instanceof cp?void 0:y.formIndex,n=new vf(t,e,void 0,i,void 0,void 0,void 0,void 0,void 0,void 0),a={species:t,dexAttr:n.getDexAttr(),abilityIndex:n.abilityIndex,passive:!1,nature:n.getNature(),pokerus:n.pokerus};return n.destroy(),a}u(Kp,"getDailyRunStarter");const eC={[Te.CAVE]:3,[Te.LAKE]:3,[Te.PLAINS]:3,[Te.SNOWY_FOREST]:3,[Te.SWAMP]:3,[Te.TALL_GRASS]:3,[Te.ABYSS]:2,[Te.RUINS]:2,[Te.BADLANDS]:2,[Te.BEACH]:2,[Te.CONSTRUCTION_SITE]:2,[Te.DESERT]:2,[Te.DOJO]:2,[Te.FACTORY]:2,[Te.FAIRY_CAVE]:2,[Te.FOREST]:2,[Te.GRASS]:2,[Te.MEADOW]:2,[Te.MOUNTAIN]:2,[Te.SEA]:2,[Te.SEABED]:2,[Te.SLUM]:2,[Te.TEMPLE]:2,[Te.VOLCANO]:2,[Te.GRAVEYARD]:1,[Te.ICE_CAVE]:1,[Te.ISLAND]:1,[Te.JUNGLE]:1,[Te.LABORATORY]:1,[Te.METROPOLIS]:1,[Te.POWER_PLANT]:1,[Te.SPACE]:1,[Te.WASTELAND]:1,[Te.TOWN]:0,[Te.END]:0};function tC(){const y=hi(Te).filter(n=>n!==Te.TOWN&&n!==Te.END);let e=0;const t=[];for(const n of y)e+=eC[n],t.push(e);const i=Be(e);for(let n=0;n<y.length;n++)if(i<t[n])return y[n];return y[Be(y.length)]}u(tC,"getDailyStartingBiome");const Cc=class Cc{constructor(e,t,i){this.modeId=e,this.challenges=[],Object.assign(this,t),this.isChallenge&&(this.challenges=dp.map(n=>Mr(n))),this.battleConfig=i||{}}setChallengeValue(e,t){this.isChallenge||(this.isChallenge=!0,this.challenges=dp.map(i=>Mr(i))),this.challenges.filter(i=>i.id===e).map(i=>i.value=t)}hasChallenge(e){return this.challenges.some(t=>t.id===e&&t.value!==0)}isFreshStartChallenge(){return this.hasChallenge(Xs.FRESH_START)}getStartingLevel(){if(ne.STARTING_LEVEL_OVERRIDE)return ne.STARTING_LEVEL_OVERRIDE;switch(this.modeId){case fe.DAILY:return 20;default:return 5}}getStartingMoney(){return ne.STARTING_MONEY_OVERRIDE||1e3}getStartingBiome(){if(!Ee(ne.STARTING_BIOME_OVERRIDE))return ne.STARTING_BIOME_OVERRIDE;switch(this.modeId){case fe.DAILY:return tC();default:return Te.TOWN}}getWaveForDifficulty(e,t=!1){switch(this.modeId){case fe.DAILY:return e+30+(t?0:Math.floor(e/5));default:return e}}isWaveTrainer(e,t){if(this.isDaily)return e%10===5||!(e%10)&&e>10&&!this.isWaveFinal(e);if(e%30===(s.offsetGym?0:20)&&!this.isWaveFinal(e))return!0;if(e%10!==1&&e%10){const i=t.getTrainerChance();let n=!0;if(i){const a=Math.floor(e/10)*10;for(let r=Math.max(e-3,a+2);r<=Math.min(e+3,a+9);r++)if(r!==e){if(r%30===(s.offsetGym?0:20)||this.isFixedBattle(r)){n=!1;break}if(r<e&&(s.executeWithSeedOffset(()=>{const o=t.getTrainerChance();Be(o)||(n=!1)},r),!n))break}}return!!(n&&i&&!Be(i))}return!1}isTrainerBoss(e,t,i){switch(this.modeId){case fe.DAILY:return e>10&&e<50&&!(e%10);default:return e%30===(i?0:20)&&(t!==Te.END||this.isClassic||this.isWaveFinal(e))}}getOverrideSpecies(e){if(this.isDaily&&this.isWaveFinal(e)){const t=Xe.filter(i=>(i.subLegendary||i.legendary||i.mythical)&&i.baseTotal>=600&&i.speciesId!==ge.ETERNATUS&&i.speciesId!==ge.ARCEUS);return _i(t)}return null}isWaveFinal(e,t=this.modeId){switch(t){case fe.CLASSIC:case fe.CHALLENGE:return e===200;case fe.ENDLESS:case fe.SPLICED_ENDLESS:return!(e%250);case fe.DAILY:return e===50}}isBoss(e){return e%10===0}isBattleClassicFinalBoss(e){return(this.modeId===fe.CLASSIC||this.modeId===fe.CHALLENGE)&&this.isWaveFinal(e)}isEndlessBoss(e){return e%50===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isEndlessMinorBoss(e){return e%250===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isEndlessMajorBoss(e){return e%1e3===0&&(this.modeId===fe.ENDLESS||this.modeId===fe.SPLICED_ENDLESS)}isFixedBattle(e){const t=new pp;return this.battleConfig.hasOwnProperty(e)||Qi(Zi.FIXED_BATTLES,e,t)}getFixedBattle(e){const t=new pp;return Qi(Zi.FIXED_BATTLES,e,t)?t:this.battleConfig[e]}getClearScoreBonus(){switch(this.modeId){case fe.CLASSIC:case fe.CHALLENGE:return 5e3;case fe.DAILY:return 2500;default:return 0}}getEnemyModifierChance(e){switch(this.modeId){case fe.CLASSIC:case fe.CHALLENGE:case fe.DAILY:return e?6:18;case fe.ENDLESS:case fe.SPLICED_ENDLESS:return e?4:12}}getName(){switch(this.modeId){case fe.CLASSIC:return g.t("gameMode:classic");case fe.ENDLESS:return g.t("gameMode:endless");case fe.SPLICED_ENDLESS:return g.t("gameMode:endlessSpliced");case fe.DAILY:return g.t("gameMode:dailyRun");case fe.CHALLENGE:return g.t("gameMode:challenge")}}getMysteryEncounterLegalWaves(){switch(this.modeId){case fe.CLASSIC:return cg;case fe.CHALLENGE:return hg;default:return[0,0]}}static getModeName(e){switch(e){case fe.CLASSIC:return g.t("gameMode:classic");case fe.ENDLESS:return g.t("gameMode:endless");case fe.SPLICED_ENDLESS:return g.t("gameMode:endlessSpliced");case fe.DAILY:return g.t("gameMode:dailyRun");case fe.CHALLENGE:return g.t("gameMode:challenge")}}};u(Cc,"GameMode");let Ut=Cc;function ba(y){switch(y){case fe.CLASSIC:return new Ut(fe.CLASSIC,{isClassic:!0,hasTrainers:!0,hasMysteryEncounters:!0},up);case fe.ENDLESS:return new Ut(fe.ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0});case fe.SPLICED_ENDLESS:return new Ut(fe.SPLICED_ENDLESS,{isEndless:!0,hasShortBiomes:!0,hasRandomBosses:!0,isSplicedOnly:!0});case fe.DAILY:return new Ut(fe.DAILY,{isDaily:!0,hasTrainers:!0,hasNoShop:!0});case fe.CHALLENGE:return new Ut(fe.CHALLENGE,{isClassic:!0,hasTrainers:!0,isChallenge:!0,hasMysteryEncounters:!0},up)}}u(ba,"getGameMode");var _h=(y=>(y[y.RUN_HISTORY=0]="RUN_HISTORY",y[y.SESSION_PREVIEW=1]="SESSION_PREVIEW",y))(_h||{});const Sc=class Sc extends ts{constructor(){super(_.RUN_INFO)}async setup(){this.runContainer=s.add.container(1,-(s.game.canvas.height/6)+1),this.modifiersModule=la,this.runContainer.setVisible(!1),s.loadImage("encounter_exclaim","mystery-encounters")}show(e){super.show(e);const t=s.add.rectangle(0,0,s.game.canvas.width,s.game.canvas.height,26720);t.setOrigin(0,0),this.runContainer.add(t);const i=e[0];this.runDisplayMode=e[1],this.runDisplayMode===0?(this.runInfo=s.gameData.parseSessionData(JSON.stringify(i.entry)),this.isVictory=i.isVictory??!1):this.runDisplayMode===1&&(this.runInfo=e[0]),this.pageMode=0,this.addHeader(),this.statsBgWidth=(s.game.canvas.width/6-2)/3,this.runResultContainer=s.add.container(0,24);const n=me(0,0,this.statsBgWidth-11,65);n.setOrigin(0,0),n.setName("Run_Result_Window"),this.runResultContainer.add(n),this.runDisplayMode===0?this.parseRunResult():this.runDisplayMode===1&&this.parseRunStatus(),this.runInfoContainer=s.add.container(0,89);const a=me(0,0,this.statsBgWidth-11,90),r=a.getBottomRight();return this.runInfoContainer.add(a),this.parseRunInfo(r.x,r.y),this.partyContainer=s.add.container(this.statsBgWidth-10,23),this.parsePartyInfo(),this.showParty(!0),this.runContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.getUi().bringToTop(this.runContainer),this.runContainer.setVisible(!0),this.isVictory&&(this.createHallofFame(),this.getUi().bringToTop(this.hallofFameContainer)),this.setCursor(0),this.getUi().add(this.runContainer),this.getUi().hideTooltip(),!0}addHeader(){var i;const e=me(0,0,s.game.canvas.width/6-2,24);if(e.setOrigin(0,0),this.runContainer.add(e),this.runInfo.modifiers.length!==0){const n=e.getTopRight(),a=s.add.container(0,0),r=D(8,0,g.t("runHistory:viewHeldItems"),O.WINDOW,{fontSize:"34px"}),o=this.getUi().getGamepadType();let l;o==="touch"?l=new Phaser.GameObjects.Sprite(s,0,2,"keyboard","E.png"):l=new Phaser.GameObjects.Sprite(s,0,2,o,(i=s.inputController)==null?void 0:i.getIconForLatestInputRecorded(re.Button_Cycle_Ability)),a.add([r,l]),a.setPosition(n.x-r.displayWidth-l.displayWidth-8,10),this.runContainer.add(a)}const t=D(0,0,g.t("runHistory:runInfo"),O.SETTINGS_LABEL);t.setOrigin(0,0),t.setPositionRelative(e,8,4),this.runContainer.add(t)}async parseRunResult(){var r,o;const e=s.gameData.gender??Fe.UNSET,t=Fe[e],i=this.isVictory?O.PERFECT_IV:O.SUMMARY_RED,n=this.isVictory?g.t("runHistory:victory"):g.t("runHistory:defeated",{context:t}),a=D(6,5,`${n} - ${g.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,i,{fontSize:"65px",lineSpacing:.1});if(this.isVictory){const l=s.add.container(0,0),h=D(8,0,g.t("runHistory:viewHallOfFame"),O.WINDOW,{fontSize:"65px"}),c=D(8,12,g.t("runHistory:viewEndingSplash"),O.WINDOW,{fontSize:"65px"}),d=this.getUi().getGamepadType();let f,p;d==="touch"?(f=new Phaser.GameObjects.Sprite(s,0,4,"keyboard","R.png"),p=new Phaser.GameObjects.Sprite(s,0,16,"keyboard","F.png")):(f=new Phaser.GameObjects.Sprite(s,0,4,d,(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(re.Button_Cycle_Shiny)),p=new Phaser.GameObjects.Sprite(s,0,16,d,(o=s.inputController)==null?void 0:o.getIconForLatestInputRecorded(re.Button_Cycle_Form))),l.add([h,f]),l.add([c,p]),l.setPosition(12,25),this.runResultContainer.add(l)}if(this.runResultContainer.add(a),!this.isVictory){const l=s.add.container(0,0);if(this.runInfo.battleType===Ce.WILD||this.runInfo.battleType===Ce.MYSTERY_ENCOUNTER&&!this.runInfo.trainer)switch(this.runInfo.enemyParty.length){case 1:this.parseWildSingleDefeat(l);break;case 2:this.parseWildDoubleDefeat(l);break}else(this.runInfo.battleType===Ce.TRAINER||this.runInfo.battleType===Ce.MYSTERY_ENCOUNTER&&this.runInfo.trainer)&&this.parseTrainerDefeat(l);this.runResultContainer.add(l)}this.runContainer.add(this.runResultContainer)}parseRunStatus(){const e=s.add.container(0,0);if(this.runResultContainer.add(e),this.runInfo.battleType===Ce.WILD)this.runInfo.enemyParty.length===1?this.parseWildSingleDefeat(e):this.runInfo.enemyParty.length===2&&this.parseWildDoubleDefeat(e);else if(this.runInfo.battleType===Ce.TRAINER){this.showTrainerSprites(e);const o=3;this.runInfo.enemyParty.forEach((T,m)=>{const C=s.add.sprite(0,0,"pb");C.setFrame(mi(T.pokeball)),C.setScale(.5),C.setPosition(58+m%o*8,m<=2?18:25),e.add(C)});const l=this.runInfo.trainer.toTrainer(),h=375;let c="";this.runInfo.trainer.trainerType>=h?c=l.variant===Kt.FEMALE?g.t("trainerNames:rival_female"):g.t("trainerNames:rival"):c=l.getName(0,!0);const d=g.t(l.variant!==Kt.DOUBLE?"battle:trainerAppeared":"battle:trainerAppearedDouble",{trainerName:c}).replace(/\n/g," "),f=s.add.container(0,0),p=D(0,0,d,O.WINDOW,{fontSize:"35px",wordWrap:{width:200}});f.add(p),f.setPosition(55,32),this.runResultContainer.add(f)}else if(this.runInfo.battleType===Ce.MYSTERY_ENCOUNTER){const o=s.add.sprite(0,0,"encounter_exclaim");o.setPosition(34,26),o.setScale(.65);const l=s.add.sprite(56,-106,"pkmn__sub");l.setScale(.65),l.setPosition(34,46);const h=g.t(s.getMysteryEncounter(this.runInfo.mysteryEncounterType,!0).localizationKey+":title"),c=s.add.container(0,0),d=D(0,0,h,O.WINDOW,{fontSize:"45px",wordWrap:{width:160}});c.add(d),c.setPosition(47,37),this.runResultContainer.add([o,l,c])}const t=this.runResultContainer.getByName("Run_Result_Window"),i=t.getTopCenter().x,n=t.getBottomCenter().y,a=D(i,5,`${g.t("saveSlotSelectUiHandler:wave")} ${this.runInfo.waveIndex}`,O.WINDOW,{fontSize:"60px",lineSpacing:.1});a.setOrigin(.5,0);const r=D(i,n-5,`${ha(this.runInfo.arena.biome)}`,O.WINDOW,{fontSize:"60px"});r.setOrigin(.5,1),this.runResultContainer.add([a,r]),this.runContainer.add(this.runResultContainer)}parseWildSingleDefeat(e){const t=s.add.container(0,0),i=this.runInfo.enemyParty[0],n=i.boss;i.boss=!1,i.player=!0;const a=i.toPokemon(),r=s.addPokemonIcon(a,0,0,0,0),o=n?O.PARTY_RED:O.PARTY,l=D(36,26,`${g.t("saveSlotSelectUiHandler:lv")}${ci(a.level,1e3)}`,o,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),t.add(r),t.add(l),e.add(t),e.setPosition(27,12),a.destroy()}parseWildDoubleDefeat(e){this.runInfo.enemyParty.forEach((t,i)=>{const n=s.add.container(0,0),a=t.boss;t.boss=!1,t.player=!0;const r=t.toPokemon(),o=s.addPokemonIcon(r,0,0,0,0),l=D(36,26,`${g.t("saveSlotSelectUiHandler:lv")}${ci(r.level,1e3)}`,a?O.PARTY_RED:O.PARTY,{fontSize:"44px",color:"#f8f8f8"});l.setShadow(0,0,void 0),l.setStroke("#424242",14),l.setOrigin(1,0),n.add(o),n.add(l),n.setPosition(i*35,0),e.add(n),r.destroy()}),e.setPosition(8,14)}showTrainerSprites(e){const t=this.runInfo.trainer.toTrainer();t.config.loadAssets(this.runInfo.trainer.variant).then(()=>{const i=t.config.getSpriteKey(this.runInfo.trainer.variant===Kt.FEMALE,!1),n=s.add.sprite(0,5,i);if(this.runInfo.trainer.variant===Kt.DOUBLE&&!t.config.doubleOnly){const a=s.add.container(5,8);n.setPosition(-3,-3);const r=t.config.getSpriteKey(!0,!0),o=s.add.sprite(5,-3,r);this.runDisplayMode===0?(o.setScale(.2),n.setScale(.2),a.add(n),a.add(o),a.setPosition(12,38)):(n.setScale(.55),n.setPosition(-9,-3),o.setScale(.55),a.add([n,o]),a.setPosition(28,34)),e.add(a)}else{const a=this.runDisplayMode===0?.35:.55,r=this.runDisplayMode===0?[12,28]:[30,32];n.setScale(a,a),n.setPosition(r[0],r[1]),e.add(n)}})}parseTrainerDefeat(e){this.showTrainerSprites(e);const t=s.add.container(0,0);this.runInfo.enemyParty.forEach((i,n)=>{const a=Math.floor(n/3),r=s.add.container(0,0);r.setScale(.6);const o=i.boss;i.boss=!1,i.player=!0;const l=i.toPokemon(),h=s.addPokemonIcon(l,0,0,0,0);h.setPosition(39*(n%3)+5,35*a);const c=D(43*(n%3),27*(a+1),`${g.t("saveSlotSelectUiHandler:lv")}${ci(l.level,1e3)}`,o?O.PARTY_RED:O.PARTY,{fontSize:"54px"});c.setShadow(0,0,void 0),c.setStroke("#424242",14),c.setOrigin(0,0),r.add(h),r.add(c),t.add(r),l.destroy()}),t.setPosition(25,15),e.add(t)}async parseRunInfo(e,t){const i=pt(7,0,"",O.WINDOW,{fontSize:"50px",lineSpacing:3});switch(i.setPosition(7,5),i.appendText(g.t("runHistory:mode")+": ",!1),this.runInfo.gameMode){case fe.DAILY:i.appendText(`${g.t("gameMode:dailyRun")}`,!1);break;case fe.SPLICED_ENDLESS:i.appendText(`${g.t("gameMode:endlessSpliced")}`,!1);break;case fe.CHALLENGE:i.appendText(`${g.t("gameMode:challenge")}`,!1),i.appendText(`${g.t("runHistory:challengeRules")}: `),i.setWrapMode(1),i.setWrapWidth(500);const p=this.challengeParser();if(p)for(let T=0;T<p.length;T++)T>0&&i.appendText(" + ",!1),i.appendText(p[T],!1);break;case fe.ENDLESS:i.appendText(`${g.t("gameMode:endless")}`,!1);break;case fe.CLASSIC:i.appendText(`${g.t("gameMode:classic")}`,!1);break}(this.runInfo.gameMode===fe.ENDLESS||this.runInfo.gameMode===fe.SPLICED_ENDLESS)&&this.runInfo.waveIndex===s.gameData.gameStats.highestEndlessWave&&(i.appendText(` [${g.t("runHistory:personalBest")}]`),i.setTint(16772956,4718441,7039999,16738665));const n=s.add.container(0,0),a=g.resolvedLanguage==="ja"?12:3,r=pt(7,0,"",O.WINDOW,{fontSize:"50px",lineSpacing:a}),o=cf(this.runInfo.playTime);r.appendText(`${g.t("runHistory:runLength")}: ${o}`,!1);const l=Ka(s.moneyFormat,this.runInfo.money),h=Oe(O.MONEY_WINDOW,!1,s.uiTheme);r.appendText(`[color=${h}]${g.t("battleScene:moneyOwned",{formattedMoney:l})}[/color]`),r.setPosition(7,70),n.add(r);const c=pt(0,0,"",O.WINDOW,{fontSize:"55px"}),d=Phaser.Math.Clamp(this.runInfo.party.map(p=>p.toPokemon().getLuck()).reduce((p,T)=>p+=T,0),0,14);let f=g.t("runHistory:luck")+": "+Of(d);if(d<14?f="[color=#"+xf(d).toString(16)+"]"+f+"[/color]":c.setTint(16772956,4718441,7039999,16738665),c.appendText("[align=right]"+f+"[/align]",!1),c.setPosition(e-c.displayWidth-5,t-13),n.add(c),this.runInfo.modifiers.length){let p=0;const T=s.add.container(8,this.runInfo.gameMode===fe.CHALLENGE?20:15);T.setScale(.45);for(const m of this.runInfo.modifiers){const C=m.toModifier(this.modifiersModule[m.className]);if(C instanceof Qt)continue;const b=C==null?void 0:C.getIcon(!1);if(b){const S=Math.floor(p/7);b.setPosition(24*(p%7),20+35*S),T.add(b)}if(++p===20){const S=D(45,90,"+",O.WINDOW);S.setPositionRelative(T,70,45),this.runInfoContainer.add(S);break}}this.runInfoContainer.add(T)}this.runInfoContainer.add(i),this.runInfoContainer.add(n),this.runContainer.add(this.runInfoContainer)}challengeParser(){const e=[];for(let t=0;t<this.runInfo.challenges.length;t++)if(this.runInfo.challenges[t].value!==0)switch(this.runInfo.challenges[t].id){case Xs.SINGLE_GENERATION:e.push(g.t(`runHistory:challengeMonoGen${this.runInfo.challenges[t].value}`));break;case Xs.SINGLE_TYPE:const i=ve[this.runInfo.challenges[t].value-1],n=`[color=${Yg[i]}]`,a=`[shadow=${Wg[i]}]`,r=n+a+g.t(`pokemonInfo:Type.${i}`)+"[/color][/shadow]";e.push(r);break;case Xs.INVERSE_BATTLE:e.push(g.t("challenges:inverseBattle.shortName"));break;default:const o=Xs[this.runInfo.challenges[t].id].split("_").map((l,h)=>h?`${l[0]}${l.slice(1).toLowerCase()}`:l.toLowerCase()).join("");e.push(g.t(`challenges:${o}.name`));break}return e}parsePartyInfo(){const e=this.runInfo.party,t=g.resolvedLanguage??"en",i=(s.game.canvas.height/6-23)/6;e.forEach((n,a)=>{var ht;const r=new ug(s,0,14,this.statsBgWidth*2+10,i-2,3),o=n.toPokemon(),l=s.add.container(this.statsBgWidth+5,(i-.5)*a),h=o.getTypes(),c=Qs(h[0]),d=new Phaser.Display.Color(c[0],c[1],c[2]),f=d.clone().darken(45);r.setFillStyle(f.color);const p=s.add.container(0,0),T=s.addPokemonIcon(o,0,0,0,0);T.setScale(.75),T.setPosition(-99,1);const m=h[1]?Qs(h[1]):void 0,C=m?new Phaser.Display.Color(m[0],m[1],m[2]):void 0;C?r.setStrokeStyle(1,C.color,.95):r.setStrokeStyle(1,d.color,.95),this.getUi().bringToTop(T);const b=s.add.container(-85,3.5),S="34px",x=o.getNature(),A=Ti(x),w=o.getNameToRender(),k=["ko","zh_CN","zh_TW"];let B=g.t("starterSelectUiHandler:passive")??"-",X=g.t("starterSelectUiHandler:ability")??"-";k.includes(t)||(B=B.charAt(0),X=X.charAt(0));const L=o.passive?B+": "+o.getPassiveAbility().name:"",Q=X+": "+o.getAbility().name,te=g.resolvedLanguage==="ja"?12:3,P=pt(0,0,w,O.SUMMARY,{fontSize:S,lineSpacing:te});P.appendText(`${g.t("saveSlotSelectUiHandler:lv")}${ap(o.level,1)} - ${A}`),P.appendText(Q),P.appendText(L),b.add(P);const H=s.add.container(-35,6),v=[];o.stats.forEach(E=>v.push(ap(E,1)));for(let E=0;E<v.length;E++){const q=Gg(x,E);v[E]=q<1?v[E]+"[color=#40c8f8]↓[/color]":v[E],v[E]=q>1?v[E]+"[color=#f89890]↑[/color]":v[E]}const F=g.t("pokemonInfo:Stat.HPshortened")+": "+v[0],pe=g.t("pokemonInfo:Stat.ATKshortened")+": "+v[1],z=g.t("pokemonInfo:Stat.DEFshortened")+": "+v[2],ce=g.t("pokemonInfo:Stat.SPATKshortened")+": "+v[3],$=g.t("pokemonInfo:Stat.SPDEFshortened")+": "+v[4],W=(t==="es-ES"||t==="pt_BR"?g.t("runHistory:SPDshortened"):g.t("pokemonInfo:Stat.SPDshortened"))+": "+v[5],R=pt(-5,0,F,O.SUMMARY,{fontSize:S,lineSpacing:te});R.appendText(pe),R.appendText(z),H.add(R);const he=pt(25,0,ce,O.SUMMARY,{fontSize:S,lineSpacing:te});he.appendText($),he.appendText(W),H.add(he);const ae=s.add.container(0,0);if(o.fusionSpecies){const E=s.add.image(0,0,"icon_spliced");E.setScale(.35),E.setOrigin(0,0),o.isShiny()?E.setPositionRelative(b,35,0):E.setPositionRelative(b,28,0),ae.add(E),this.getUi().bringToTop(E)}if(o.isShiny()){const E=o.isFusion()&&o.shiny&&o.fusionShiny,q=s.add.image(0,0,`shiny_star_small${E?"_1":""}`);if(q.setOrigin(0,0),q.setScale(.65),q.setPositionRelative(b,28,0),q.setTint(dt(E?o.variant:o.getVariant())),ae.add(q),this.getUi().bringToTop(q),E){const K=s.add.image(0,0,"shiny_star_small_2");K.setOrigin(0,0),K.setScale(.5),K.setPosition(q.x+1,q.y+1),K.setTint(dt(o.fusionVariant)),ae.add(K),this.getUi().bringToTop(K)}}const oe=o.getMoveset(),Ve=s.add.container(70,-29),it=[],Me=[],Pe=[[-6.5,35.5],[37,35.5],[-6.5,43.5],[37,43.5]];for(let E=0;E<(oe==null?void 0:oe.length);E++){const q=s.add.container(Pe[E][0],Pe[E][1]);q.setScale(.5);const K=s.add.nineslice(0,0,"type_bgs","unknown",85,15,2,2,2,2);K.setOrigin(1,0);const N=D(-K.width/2,2,"-",O.PARTY);N.setOrigin(.5,0),N.setName("text-move-label"),it.push(K),Me.push(N),q.add(K),q.add(N),Ve.add(q);const M=(ht=oe[E])==null?void 0:ht.getMove();it[E].setFrame(ve[M?M.type:ve.UNKNOWN].toString().toLowerCase()),Me[E].setText(M?M.name:"-")}const Qe=this.runInfo.gameMode===fe.SPLICED_ENDLESS||this.runInfo.gameMode===fe.ENDLESS?.25:.5,Ue=s.add.container(-82,2),lt=[];if(this.runInfo.modifiers.length){for(const E of this.runInfo.modifiers){const q=E.toModifier(this.modifiersModule[E.className]);q instanceof Qt&&q.pokemonId===o.id&&(q.stackCount=E.stackCount,lt.push(q))}if(lt.length>0){lt.sort(Kg);let E=0;for(const[q,K]of lt.entries()){if(q>36){const M=D(182,4,"+",O.WINDOW);Ue.add(M);break}const N=K==null?void 0:K.getIcon(!0);(K==null?void 0:K.stackCount)<(K==null?void 0:K.getMaxHeldItemCount(o))&&N.list[1]instanceof Phaser.GameObjects.BitmapText&&N.list[1].clearTint(),N.setScale(Qe),N.setPosition(q%19*10,E*10),Ue.add(N),q!==0&&q%18===0&&E++}}}Ue.setName("heldItems"),Ue.setVisible(!1),l.add(r),p.add(T),l.add(p),ae.setName("PkmnMarks"),l.add(ae),Ve.setName("PkmnMoves"),l.add(Ve),b.setName("PkmnInfoText"),l.add(b),H.setName("PkmnStatsText"),l.add(H),l.add(Ue),l.setName("PkmnInfo"),this.partyContainer.add(l),o.destroy()}),this.runContainer.add(this.partyContainer)}showParty(e){this.partyContainer.getAll("name","PkmnInfo").forEach(i=>{i.getByName("PkmnMoves").setVisible(e),i.getByName("PkmnInfoText").setVisible(e),i.getByName("PkmnStatsText").setVisible(e),i.getByName("PkmnMarks").setVisible(e),i.getByName("heldItems").setVisible(!e),this.partyVisibility=e})}createVictorySplash(){this.endCardContainer=s.add.container(0,0);const t=(s.gameData.gender??Fe.UNSET)===Fe.FEMALE,i=s.add.image(0,0,`end_${t?"f":"m"}`);i.setOrigin(0),i.setScale(.5);const n=D(s.game.canvas.width/12,s.game.canvas.height/6-16,g.t("battle:congratulations"),O.SUMMARY,{fontSize:"128px"});n.setOrigin(.5),this.endCardContainer.add(i),this.endCardContainer.add(n)}createHallofFame(){const e=s.gameData.gender??Fe.UNSET,t=e===Fe.FEMALE,i=Fe[e].toLowerCase();this.hallofFameContainer=s.add.container(0,0);const n=s.add.image(0,0,`end_${t?"f":"m"}`);n.setOrigin(0),n.setPosition(-1,-1),n.setScale(.5);const a=n.getBottomCenter(),r=t?"red":"blue",o=s.add.image(0,0,"hall_of_fame_"+r);o.setPosition(159,89),o.setSize(s.game.canvas.width,s.game.canvas.height+10),o.setAlpha(.8),this.hallofFameContainer.add(n),this.hallofFameContainer.add(o);const l=D(0,0,g.t("runHistory:hallofFameText",{context:i}),O.WINDOW);l.setPosition(a.x-l.displayWidth/2,164),this.hallofFameContainer.add(l),this.runInfo.party.forEach((h,c)=>{const d=h.toPokemon(),f=c%2,p=d.id,T=d.shiny,m=d.formIndex,C=d.variant,b=d.getSpeciesForm(),S=s.add.sprite(60+40*c,40+f*80,"pkmn__sub");S.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.hallofFameContainer.add(S);const x=new Map;x.set(p,!1);const A=d.gender===1;if(b.loadAssets(A,m,T,C,!0).then(()=>{x.set(p,!0),S.play(b.getSpriteKey(A,m,T,C)),S.setPipelineData("shiny",T),S.setPipelineData("variant",C),S.setPipelineData("spriteKey",b.getSpriteKey(A,m,T,C)),S.setVisible(!0)}),d.isFusion()){const w=s.add.sprite(80+40*c,50+f*80,d.getFusionIconAtlasKey());w.setName("sprite-fusion-icon"),w.setOrigin(.5,0),w.setFrame(d.getFusionIconId(!0)),this.hallofFameContainer.add(w)}d.destroy()}),this.hallofFameContainer.setVisible(!1),this.runContainer.add(this.hallofFameContainer)}processInput(e){const t=this.getUi();let i=!1;const n=!1;switch(e){case I.CANCEL:case I.LEFT:i=!0,this.pageMode===0?(this.runInfoContainer.removeAll(!0),this.runResultContainer.removeAll(!0),this.partyContainer.removeAll(!0),this.runContainer.removeAll(!0),this.isVictory&&this.hallofFameContainer.removeAll(!0),super.clear(),this.runContainer.setVisible(!1),t.revertMode()):this.pageMode===1?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):this.pageMode===2&&(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0);break;case I.DOWN:case I.UP:break;case I.CYCLE_FORM:case I.CYCLE_SHINY:case I.CYCLE_ABILITY:this.buttonCycleOption(e);break}return i&&t.playSelect(),i||n}buttonCycleOption(e){switch(e){case I.CYCLE_FORM:this.isVictory&&this.pageMode!==1&&(!this.endCardContainer||!this.endCardContainer.visible?(this.createVictorySplash(),this.endCardContainer.setVisible(!0),this.runContainer.add(this.endCardContainer),this.pageMode=2):(this.endCardContainer.setVisible(!1),this.runContainer.remove(this.endCardContainer),this.pageMode=0));break;case I.CYCLE_SHINY:this.isVictory&&this.pageMode!==2&&(this.hallofFameContainer.visible?(this.hallofFameContainer.setVisible(!1),this.pageMode=0):(this.hallofFameContainer.setVisible(!0),this.pageMode=1));break;case I.CYCLE_ABILITY:this.runInfo.modifiers.length!==0&&this.pageMode===0&&(this.partyVisibility?this.showParty(!1):this.showParty(!0));break}}};u(Sc,"RunInfoUiHandler");let Ea=Sc;const Li=5,As=3;var Ia=(y=>(y[y.LOAD=0]="LOAD",y[y.SAVE=1]="SAVE",y))(Ia||{});const bc=class bc extends _t{constructor(){super(_.SAVE_SLOT),this.scrollCursor=0}setup(){const e=this.getUi();this.saveSlotSelectContainer=s.add.container(0,0),this.saveSlotSelectContainer.setVisible(!1),e.add(this.saveSlotSelectContainer);const t=s.add.rectangle(0,0,s.game.canvas.width/6,-s.game.canvas.height/6,26720);t.setOrigin(0,0),this.saveSlotSelectContainer.add(t),this.sessionSlotsContainerInitialY=-s.game.canvas.height/6+8,this.sessionSlotsContainer=s.add.container(8,this.sessionSlotsContainerInitialY),this.saveSlotSelectContainer.add(this.sessionSlotsContainer),this.saveSlotSelectMessageBoxContainer=s.add.container(0,0),this.saveSlotSelectMessageBoxContainer.setVisible(!1),this.saveSlotSelectContainer.add(this.saveSlotSelectMessageBoxContainer),this.saveSlotSelectMessageBox=me(1,-1,318,28),this.saveSlotSelectMessageBox.setOrigin(0,1),this.saveSlotSelectMessageBoxContainer.add(this.saveSlotSelectMessageBox),this.message=D(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.saveSlotSelectMessageBoxContainer.add(this.message),this.sessionSlots=[]}show(e){return e.length<2||!(e[1]instanceof Function)?!1:(super.show(e),this.uiMode=e[0],this.saveSlotSelectCallback=e[1],this.saveSlotSelectContainer.setVisible(!0),this.populateSessionSlots(),this.setScrollCursor(0),this.setCursor(0),!0)}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===I.ACTION||e===I.CANCEL){const a=this.saveSlotSelectCallback;if(e===I.ACTION){const r=this.cursor+this.scrollCursor;if(this.uiMode===0&&!this.sessionSlots[r].hasData)n=!0;else{switch(this.uiMode){case 0:this.saveSlotSelectCallback=null,a==null||a(r);break;case 1:{const o=u(()=>{const l=this.saveSlotSelectCallback;this.saveSlotSelectCallback=null,t.revertMode(),t.showText("",0),t.setMode(_.MESSAGE),l==null||l(r)},"saveAndCallback");if(this.sessionSlots[r].hasData)t.showText(g.t("saveSlotSelectUiHandler:overwriteData"),null,()=>{t.setOverlayMode(_.CONFIRM,()=>{s.gameData.deleteSession(r).then(l=>{l===!1?s.reset(!0):o()})},()=>{t.revertMode(),t.showText("",0)},!1,0,19,2e3)});else if(this.sessionSlots[r].hasData===!1)o();else return!1;break}}i=!0}}else this.saveSlotSelectCallback=null,a==null||a(-1),i=!0}else{const a=this.cursor+this.scrollCursor;switch(e){case I.UP:this.cursor?i=this.cursor===0?this.setCursor(this.cursor):this.setCursor(this.cursor-1,a):this.scrollCursor?i=this.setScrollCursor(this.scrollCursor-1,a):this.cursor===0&&this.scrollCursor===0&&(this.setScrollCursor(Li-As),this.revertSessionSlot(Li-As),this.setCursor(As-1),i=!0);break;case I.DOWN:this.cursor<As-1?i=this.setCursor(this.cursor+1,a):this.scrollCursor<Li-As?i=this.setScrollCursor(this.scrollCursor+1,a):this.cursor===As-1&&this.scrollCursor===Li-As&&(this.setScrollCursor(0),this.revertSessionSlot(As-1),this.setCursor(0),i=!0);break;case I.RIGHT:this.sessionSlots[a].hasData&&this.sessionSlots[a].saveData&&(s.ui.setOverlayMode(_.RUN_INFO,this.sessionSlots[a].saveData,_h.SESSION_PREVIEW),i=!0)}}return i?t.playSelect():n&&t.playError(),i||n}populateSessionSlots(){for(let e=0;e<Li;e++){const t=new ao(e);s.add.existing(t),this.sessionSlotsContainer.add(t),this.sessionSlots.push(t),t.load().then(i=>{i&&this.cursor+this.scrollCursor===e&&this.setCursor(e)})}}showText(e,t,i,n,a,r){super.showText(e,t,i,n,a,r),(e==null?void 0:e.indexOf(`
`))===-1?(this.saveSlotSelectMessageBox.setSize(318,28),this.message.setY(-22)):(this.saveSlotSelectMessageBox.setSize(318,42),this.message.setY(-37)),this.saveSlotSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}setCursor(e,t){const i=super.setCursor(e);if(!this.cursorObj){this.cursorObj=s.add.container(0,0);const r=s.add.nineslice(0,0,"select_cursor_highlight_thick",void 0,296,44,6,6,6,6),o=s.add.image(0,0,"cursor");o.setPosition(160,0),o.setName("rightArrow"),this.cursorObj.add([r,o]),this.sessionSlotsContainer.add(this.cursorObj)}const n=e+this.scrollCursor,a=n*56;if(this.sessionSlots[n]&&this.cursorObj){const r=this.sessionSlots[n].hasData;r?(this.cursorObj.setPosition(145,26+a),this.sessionSlots[n].setPosition(-6,a)):(this.cursorObj.setPosition(151,26+a),this.sessionSlots[n].setPosition(0,a)),this.setArrowVisibility(r)}return Ee(t)||this.revertSessionSlot(t),i}revertSessionSlot(e){const t=this.sessionSlots[e];t&&t.setPosition(0,e*56)}setArrowVisibility(e){var t;this.cursorObj&&((t=this.cursorObj)==null?void 0:t.getByName("rightArrow")).setVisible(e)}setScrollCursor(e,t){const i=e!==this.scrollCursor;return i&&(this.scrollCursor=e,this.setCursor(this.cursor,t),s.tweens.add({targets:this.sessionSlotsContainer,y:this.sessionSlotsContainerInitialY-56*e,duration:de(325),ease:"Sine.easeInOut"})),i}clear(){super.clear(),this.saveSlotSelectContainer.setVisible(!1),this.setScrollCursor(0),this.eraseCursor(),this.saveSlotSelectCallback=null,this.clearSessionSlots()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearSessionSlots(){this.sessionSlots.splice(0,this.sessionSlots.length),this.sessionSlotsContainer.removeAll(!0)}};u(bc,"SaveSlotSelectUiHandler");let no=bc;const Ec=class Ec extends Phaser.GameObjects.Container{constructor(e){super(s,0,e*56),this.slotId=e,this.setup()}setup(){const e=me(0,0,304,52);this.add(e),this.loadingLabel=D(152,26,g.t("saveSlotSelectUiHandler:loading"),O.WINDOW),this.loadingLabel.setOrigin(.5,.5),this.add(this.loadingLabel)}async setupWithData(e){this.remove(this.loadingLabel,!0);const t=D(8,5,`${Ut.getModeName(e.gameMode)||g.t("gameMode:unkown")} - ${g.t("saveSlotSelectUiHandler:wave")} ${e.waveIndex}`,O.WINDOW);this.add(t);const i=D(8,19,new Date(e.timestamp).toLocaleString(),O.WINDOW);this.add(i);const n=D(8,33,cf(e.playTime),O.WINDOW);this.add(n);const a=s.add.container(144,4);e.party.forEach((l,h)=>{const c=s.add.container(26*h,0);c.setScale(.75);const d=l.toPokemon(),f=s.addPokemonIcon(d,0,0,0,0),p=D(32,20,`${g.t("saveSlotSelectUiHandler:lv")}${ci(d.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});p.setShadow(0,0,void 0),p.setStroke("#424242",14),p.setOrigin(1,0),c.add(f),c.add(p),a.add(c),d.destroy()}),this.add(a);const r=s.add.container(148,30);r.setScale(.5);let o=0;for(const l of e.modifiers){const h=l.toModifier(la[l.className]);if(h instanceof Qt)continue;const c=h==null?void 0:h.getIcon(!1);if(c&&(c.setPosition(24*o,0),r.add(c)),++o===12)break}this.add(r)}load(){return new Promise(e=>{s.gameData.getSession(this.slotId).then(async t=>{if(this.active){if(!t){this.hasData=!1,this.loadingLabel.setText(g.t("saveSlotSelectUiHandler:empty")),e(!1);return}this.hasData=!0,this.saveData=t,await this.setupWithData(t),e(!0)}})})}};u(Ec,"SessionSlot");let ao=Ec;const sC=15,iC=10,zp=15,nC=[...Array(sC).fill("battlesWon"),...Array(iC).fill("underratedPokemon"),"joinTheDiscord","infiniteLevels","everythingIsStackable","optionalSaveScumming","biomes","openSource","playWithSpeed","liveBugTesting","heavyInfluence","pokemonRiskAndPokemonRain","nowWithMoreSalt","infiniteFusionAtHome","brokenEggMoves","magnificent","doPeopleReadThis","thatsCrazy","gottaCatchEmAll","questionableBalancing","coolShaders","aiFree","suddenDifficultySpikes","basedOnAnUnfinishedFlashGame","moreAddictiveThanIntended","mostlyConsistentSeeds","achievementPointsDontDoAnything","nothingBeatsAJellyFilledDonut","dontTalkAboutThePokemonIncident","alsoTryPokengine","alsoTryEmeraldRogue","alsoTryRadicalRed","eeveeExpo","checkOutYnoproject","breedersInSpace","alsoTryPokemonUnbound","tryTheJohtoDragonChallenge","basicReadingAbilityRecommended","shoutoutsToTheArtists","gamblingNotEncouraged","dontForgetToTakeABreak","wEvent","ifItsNotAccurateItsAccurate","everyLossIsProgressMade","liveWoChienReaction","itsAFeatureNotABug","theEggsAreNotForEating","7.8outOf10TooManyWaterBiomes","butNothingHappened","thePowerOfScienceIsAmazing","freeToPlay","theresATimeAndPlaceForEverything","nowWithShinierShinies","smilesGoForMiles","certainlyNotDragonFree","haveANiceDay","redacted","hi","transRights","shinyOddsHigherThanYouThink","noFalseTrades","notForProfit","timeForYourDailyRun","moreEggsThanADaycare","disclaimerHarshSunDoesNotGiveVitaminD","whoNeedsAMap","luxrayIsNotADarkType","selfDestructiveEncounters","mostOptionsAreViable","pokerogueMorse","smiley","beAwareOfPassives","asSeenOnTheWorldWideWeb","vaultinVeluzas","tooManyStarters","checkTheWiki","winWithYourFavorites","alsoTryPokerogueWait","theWayISeeItKyogreIsSurrounded","tryOutHoneyGather","notForTheFaintOfHeart","p","flipYourDeviceToEvolveInkay","inArceusWeTrust","whyDidTheTorchicCrossTheRoad","goodLuck","fuseWisely","compensation","prepareForTroubleAndMakeItDouble","anEggForYourTroubles","regirock","hereForAGoodTime","getGoodOrDont","checkTheSubreddit","betterNerfGreninja","inCaseOfUpdateClearYourCache","insertTextHere","endingEndlessNotFound","iLikeMyEggsVouchered","YOU","noAddedSugar","notSponsored","notRated","justOneMoreWaveMom","saltCured","onlyOnPokerogueNet","pixelPerfection","openSource","probablyGood","itsAMonsterHouse","dontForgetYourPassword","tripleTripleTripleAxel","questionExclamation","clownEncounters","fullOfBerries","limitsAreMeantToBeBrokenSometimes","keepItCasual","serversProbablyWorking","mew","makeItRainAndYourProblemsGoAway","customMusicTracks","youAreValid","number591IsLookingOff","timeForYourDeliDelivery","goodFirstImpression","iPreferRarerCandies","pocketRoguelite","porygonDidNothingWrong","critMattered","pickupNotRequired","stayHydrated","alsoTryCobblemon","alsoTryPokeDoku","mySleepStyleIsDoesnt","makeYourOwnWorldChampDifference","yoChampInTheMaking","notLiableForDecisionAnxiety","theAirIsTastyHere","continue","startANewRunToday","neverGiveUp","theresAlwaysNextTime","oneTwoThreeAndPoof","yourPokemonOnlyGoToLevelOneHundred","theBattlesWillBeLegendary","levelCurveBetterThanJohto","alsoTryShowering","wellStillBeHere","weHopeToSeeYouAgain","aHealthyTeamCanMeanGreaterRewards","aWildPokemonAppeared","isThisThingOn","needsMoreTesting","whoChecksStatChanges","whenTwoTrainersEyesMeet","notOfficiallyOnSteam","fiftyFifty","metaNotIncluded","bornToBeAWinner","onARollout","itsAlwaysNightDeepInTheAbyss","folksThisIsInsane"],aC=[{name:"New Year's",start:"01-01",end:"01-15",messages:["newYears.happyNewYear","newYears.andAHappyNewYear"]},{name:"Valentines",start:"02-07",end:"02-21",messages:["valentines.happyValentines","valentines.fullOfLove","valentines.applinForYou","valentines.thePowerOfLoveIsThreeThirtyBST","valentines.haveAHeartScale","valentines.i<3You"]},{name:"April Fools",start:"04-01",end:"04-03",messages:["aprilFools.battlesOne","aprilFools.aprilFools","aprilFools.removedPokemon","aprilFools.helloKyleAmber","aprilFools.gotcha","aprilFools.alsoTryPokerogueTwo","aprilFools.nowWithSameScumCountermeasures","aprilFools.neverGonnaGiveYouGoodRolls","aprilFools.youBumblingBuffoon","aprilFools.doubleShinyOddsForTrainersOnly","aprilFools.nowWithZMoves","aprilFools.newLightType","aprilFools.removedMegas","aprilFools.nerfedYourFavorites","aprilFools.grrr","aprilFools.enabledEternatusPassiveGoodLuck","aprilFools.theDarkestDaySoundsLikeAFutureProblem","aprilFools.tmShopWhen","aprilFools.whoIsFinn","aprilFools.watchOutForShadowPokemon","aprilFools.nowWithDarkTypeLuxray","aprilFools.onlyOnPokerogueNetAGAIN","aprilFools.noFreeVouchers","aprilFools.altffourAchievementPoints","aprilFools.rokePogue","aprilFools.readMe","aprilFools.winningNotIncluded","aprilFools.timeForYourSoloUnownRun","aprilFools.nowARealTimeStrategyGame","aprilFools.nowWithQuickTimeEncounters","aprilFools.timeYourInputsForHigherCatchrate","aprilFools.certifiedButtonSimulator","aprilFools.iHopeYouGetSuckerPunched"]},{name:"Halloween",start:"10-15",end:"10-31",messages:["halloween.happyHalloween","halloween.boo","halloween.pumpkabooAbout","halloween.mayContainSpiders","halloween.spookyScarySkeledirge","halloween.gourgeistUsedTrickOrTreat","halloween.letsSnuggleForever"]},{name:"Winter Holiday",start:"12-01",end:"12-31",messages:["winterHoliday.happyHolidays","winterHoliday.unaffilicatedWithDelibirdServices","winterHoliday.delibirdSeason","winterHoliday.diamondsFromTheSky","winterHoliday.holidayStylePikachuNotIncluded","winterHoliday.delibirdDirectlyToYourHouse","winterHoliday.haveAnIceDay","winterHoliday.spinTheClaydol","winterHoliday.beGoodForGoodnessSake","winterHoliday.moomooMilkAndLavaCookies","winterHoliday.iNeedAYacheBerry","winterHoliday.getJolly","winterHoliday.tisTheSeasonToBeSpeSpa","winterHoliday.deckTheHalls","winterHoliday.saveScummingGetsYouOnTheNaughtyList","winterHoliday.badTrainersGetRolycoly"]}];function rC(){const y=[...nC];for(const{name:e,start:t,end:i,messages:n}of aC){const a=new Date,r=new Date(`${t}-${a.getFullYear()}`),o=new Date(`${i}-${a.getFullYear()}`);if(a>=r&&a<=o){`${n.length}${e}${zp}`;for(const l of n){const h=Array(zp).fill(l);y.push(...h)}}}return y.map(e=>`splashMessages:${e}`)}u(rC,"getSplashMessages");const ji=class ji extends ln{constructor(e=_.TITLE){super(e)}setup(){super.setup();const e=this.getUi();this.titleContainer=s.add.container(0,-(s.game.canvas.height/6)),this.titleContainer.setName("title"),this.titleContainer.setAlpha(0),e.add(this.titleContainer);const t=s.add.image(s.game.canvas.width/6/2,8,"logo");t.setOrigin(.5,0),this.titleContainer.add(t),di.isEventActive()&&(this.eventDisplay=new zg(0,0,di.activeEvent()),this.eventDisplay.setup(),this.titleContainer.add(this.eventDisplay)),this.playerCountLabel=D(s.game.canvas.width/6-2,0,`? ${g.t("menu:playersOnline")}`,O.MESSAGE,{fontSize:"54px"}),this.playerCountLabel.setOrigin(1,0),this.titleContainer.add(this.playerCountLabel),this.splashMessageText=D(t.x+64,t.y+t.displayHeight-8,"",O.MONEY,{fontSize:"54px"}),this.splashMessageText.setOrigin(.5,.5),this.splashMessageText.setAngle(-20),this.titleContainer.add(this.splashMessageText);const i=this.splashMessageText.scale;s.tweens.add({targets:this.splashMessageText,duration:de(350),scale:i*1.25,loop:-1,yoyo:!0}),this.appVersionText=D(t.x-60,t.y+t.displayHeight+4,"",O.MONEY,{fontSize:"54px"}),this.appVersionText.setOrigin(.5,.5),this.appVersionText.setAngle(0),this.titleContainer.add(this.appVersionText)}updateTitleStats(){qe.getGameTitleStats().then(e=>{e&&(this.playerCountLabel.setText(`${e.playerCount} ${g.t("menu:playersOnline")}`),this.splashMessage==="splashMessages:battlesWon"&&this.splashMessageText.setText(g.t(this.splashMessage,{count:e.battleCount})))}).catch(e=>{console.error(`Failed to fetch title stats:
`,e)})}randomPokemon(){const e=Jt(1025,1),t=Dt(e);(this.splashMessage==="splashMessages:underratedPokemon"||this.splashMessage==="splashMessages:dontTalkAboutThePokemonIncident"||this.splashMessage==="splashMessages:aWildPokemonAppeared"||this.splashMessage==="splashMessages:aprilFools.removedPokemon")&&this.splashMessageText.setText(g.t(this.splashMessage,{pokemonName:t.name}))}genderSplash(){this.splashMessage==="splashMessages:aprilFools.helloKyleAmber"&&(s.gameData.gender===Fe.MALE?this.splashMessageText.setText(g.t(this.splashMessage,{name:g.t("trainerNames:player_m")})):this.splashMessageText.setText(g.t(this.splashMessage,{name:g.t("trainerNames:player_f")})))}show(e){const t=super.show(e);if(t){this.playerCountLabel.setY(s.game.canvas.height/6-13-this.getWindowHeight()),this.splashMessage=dg(rC()),this.splashMessageText.setText(g.t(this.splashMessage,{count:ji.BATTLES_WON_FALLBACK})),this.appVersionText.setText("v"+uf);const i=this.getUi();di.isEventActive()&&(this.eventDisplay.setWidth(s.scaledCanvas.width-this.optionSelectBg.width-this.optionSelectBg.x),this.eventDisplay.show()),this.randomPokemon(),this.genderSplash(),this.updateTitleStats(),this.titleStatsTimer=setInterval(()=>{this.updateTitleStats()},6e4),s.tweens.add({targets:[this.titleContainer,i.getMessageHandler().bg],duration:de(325),alpha:u(n=>n===this.titleContainer?1:0,"alpha"),ease:"Sine.easeInOut"})}return t}clear(){var t;super.clear();const e=this.getUi();(t=this.eventDisplay)==null||t.clear(),this.titleStatsTimer&&clearInterval(this.titleStatsTimer),this.titleStatsTimer=null,s.tweens.add({targets:[this.titleContainer,e.getMessageHandler().bg],duration:de(325),alpha:u(i=>i===this.titleContainer?0:1,"alpha"),ease:"Sine.easeInOut"})}};u(ji,"TitleUiHandler"),ji.BATTLES_WON_FALLBACK=-1;let ro=ji;const Ic=class Ic extends Phaser.GameObjects.Container{constructor(){super(s,s.game.canvas.width/6-4,s.game.canvas.height/6-4)}setup(){this.icon=s.add.sprite(0,0,"saving_icon"),this.icon.setOrigin(1,1),this.add(this.icon),this.animActive=!1,this.shown=!1,this.setAlpha(0),this.setVisible(!1)}show(){this.shown=!0,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:1,duration:de(250),ease:"Sine.easeInOut",onComplete:u(()=>{s.time.delayedCall(de(500),()=>{this.animActive=!1,this.shown||this.hide()})},"onComplete")}),this.setVisible(!0),this.shown=!0)}hide(){this.shown=!1,!this.animActive&&(this.animActive=!0,s.tweens.add({targets:this,alpha:0,duration:de(250),ease:"Sine.easeInOut",onComplete:u(()=>{this.animActive=!1,this.setVisible(!1),this.shown&&this.show()},"onComplete")}),this.shown=!1)}};u(Ic,"SavingIconHandler");let oo=Ic;const vc=class vc extends Ii{constructor(e=null){super(e),this.minTime=1e3*5,this.maxTime=1e3*60*5,this.randVarianceTime=1e3*10,this.reconnectDuration=this.minTime}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 64}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=D(this.getWidth()/2,this.getHeight()/2,g.t("menu:errorServerDown"),O.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}tryReconnect(){rs().then(e=>{e[0]||[200,400].includes(e[1])?(this.reconnectTimer=null,this.reconnectDuration=this.minTime,s.playSound("se/pb_bounce_1"),this.reconnectCallback()):e[1]===401?($n(js),s.reset(!0,!0)):(this.reconnectDuration=Math.min(this.reconnectDuration*2,this.maxTime),this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration+Math.random()*this.randVarianceTime))})}show(e){if(e.length>=1&&e[0]instanceof Function){const t={buttonActions:[]};return this.reconnectCallback=e[0],this.reconnectDuration=this.minTime,this.reconnectTimer=setTimeout(()=>this.tryReconnect(),this.reconnectDuration),super.show([t])}return!1}};u(vc,"UnavailableModalUiHandler");let lo=vc;const Oc=class Oc extends Ii{constructor(e=null){super(e)}getModalTitle(){return""}getWidth(){return 160}getHeight(){return 32}getMargin(){return[0,0,48,0]}getButtonLabels(){return[]}setup(){super.setup();const e=D(this.getWidth()/2,this.getHeight()/2,`Your session is out of date.
Your data will be reloaded…`,O.WINDOW,{fontSize:"48px",align:"center"});e.setOrigin(.5,.5),this.modalContainer.add(e)}show(e){const t={buttonActions:[]};return super.show([t])}};u(Oc,"SessionReloadModalUiHandler");let ho=Oc;const xc=class xc extends ts{constructor(e=null){super(e),this.listening=!1,this.buttonPressed=null,this.timeLeftAutoClose=5}setup(){const e=this.getUi();this.optionSelectContainer=s.add.container(0,0),this.actionsContainer=s.add.container(0,0),this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),e.add(this.optionSelectContainer),e.add(this.actionsContainer),this.titleBg=me(s.game.canvas.width/6-this.getWindowWidth(),-(s.game.canvas.height/6)+28+21,this.getWindowWidth(),24),this.titleBg.setOrigin(.5),this.optionSelectContainer.add(this.titleBg),this.actionBg=me(s.game.canvas.width/6-this.getWindowWidth(),-(s.game.canvas.height/6)+this.getWindowHeight()+28+21+21,this.getWindowWidth(),24),this.actionBg.setOrigin(.5),this.actionsContainer.add(this.actionBg),this.unlockText=D(0,0,g.t("settings:pressButton"),O.WINDOW),this.unlockText.setOrigin(0,0),this.unlockText.setPositionRelative(this.titleBg,36,4),this.optionSelectContainer.add(this.unlockText),this.timerText=D(0,0,"(5)",O.WINDOW),this.timerText.setOrigin(0,0),this.timerText.setPositionRelative(this.unlockText,this.unlockText.width/6+5,0),this.optionSelectContainer.add(this.timerText),this.optionSelectBg=me(s.game.canvas.width/6-this.getWindowWidth(),-(s.game.canvas.height/6)+this.getWindowHeight()+28,this.getWindowWidth(),this.getWindowHeight()),this.optionSelectBg.setOrigin(.5),this.optionSelectContainer.add(this.optionSelectBg),this.cancelLabel=D(0,0,g.t("settings:back"),O.SETTINGS_LABEL),this.cancelLabel.setOrigin(0,.5),this.cancelLabel.setPositionRelative(this.actionBg,10,this.actionBg.height/2),this.actionsContainer.add(this.cancelLabel)}manageAutoCloseTimer(){clearTimeout(this.countdownTimer),this.countdownTimer=setTimeout(()=>{var e;this.timeLeftAutoClose-=1,this.timerText.setText(`(${this.timeLeftAutoClose})`),this.timeLeftAutoClose>=0?this.manageAutoCloseTimer():(e=this.cancelFn)==null||e.call(this)},1e3)}show(e){return super.show(e),this.buttonPressed=null,this.timeLeftAutoClose=5,this.cancelFn=e[0].cancelHandler,this.target=e[0].target,this.getUi().bringToTop(this.optionSelectContainer),this.getUi().bringToTop(this.actionsContainer),this.optionSelectContainer.setVisible(!0),setTimeout(()=>{this.listening=!0,this.manageAutoCloseTimer()},100),!0}getWindowWidth(){return 160}getWindowHeight(){return 64}processInput(e){var n,a;if(this.buttonPressed===null)return!1;const t=this.getUi();let i=!1;switch(e){case I.LEFT:case I.RIGHT:{i=this.setCursor(this.cursor?0:1);break}case I.ACTION:this.cursor===0?(n=this.cancelFn)==null||n.call(this):(i=this.swapAction(),jt.getInstance().updateIcons(),(a=this.cancelFn)==null||a.call(this,i));break}return i?t.playSelect():t.playError(),i}setCursor(e){return this.cursor=e,e===1?(this.actionLabel.setColor(this.getTextColor(O.SETTINGS_SELECTED)),this.actionLabel.setShadowColor(this.getTextColor(O.SETTINGS_SELECTED,!0)),this.cancelLabel.setColor(this.getTextColor(O.WINDOW)),this.cancelLabel.setShadowColor(this.getTextColor(O.WINDOW,!0)),!0):(this.actionLabel.setColor(this.getTextColor(O.WINDOW)),this.actionLabel.setShadowColor(this.getTextColor(O.WINDOW,!0)),this.cancelLabel.setColor(this.getTextColor(O.SETTINGS_SELECTED)),this.cancelLabel.setShadowColor(this.getTextColor(O.SETTINGS_SELECTED,!0)),!0)}clear(){super.clear(),clearTimeout(this.countdownTimer),this.timerText.setText("(5)"),this.timeLeftAutoClose=5,this.listening=!1,this.target=null,this.cancelFn=null,this.optionSelectContainer.setVisible(!1),this.actionsContainer.setVisible(!1),this.newButtonIcon.setVisible(!1),this.buttonPressed=null}onInputDown(e,t,i){clearTimeout(this.countdownTimer),this.timerText.setText(""),this.newButtonIcon.setTexture(i),this.newButtonIcon.setFrame(e),t&&(this.targetButtonIcon.setTexture(i),this.targetButtonIcon.setFrame(t),this.targetButtonIcon.setVisible(!0),this.swapText.setVisible(!0)),this.newButtonIcon.setVisible(!0),this.setCursor(0),this.actionsContainer.setVisible(!0)}};u(xc,"AbstractBindingUiHandler");let va=xc;const _c=class _c extends va{constructor(e=null){var t;super(e),(t=s.input.gamepad)==null||t.on("down",this.gamepadButtonDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"xbox"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,16),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.swapText=D(0,0,g.t("settings:willSwapWith"),O.WINDOW),this.swapText.setOrigin(.5),this.swapText.setPositionRelative(this.optionSelectBg,this.optionSelectBg.width/2-2,this.optionSelectBg.height/2-2),this.swapText.setVisible(!1),this.targetButtonIcon=s.add.sprite(0,0,"xbox"),this.targetButtonIcon.setPositionRelative(this.optionSelectBg,78,48),this.targetButtonIcon.setOrigin(.5),this.targetButtonIcon.setVisible(!1),this.actionLabel=D(0,0,g.t("settings:confirmSwap"),O.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-75,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon),this.optionSelectContainer.add(this.swapText),this.optionSelectContainer.add(this.targetButtonIcon)}getSelectedDevice(){var e;return(e=s.inputController)==null?void 0:e.selectedDevice[_e.GAMEPAD]}gamepadButtonDown(e,t,i){const n=[12,13,14,15];if(!this.listening||e.id.toLowerCase()!==this.getSelectedDevice()||n.includes(t.index)||this.buttonPressed!==null)return;const a=s.inputController.getActiveConfig(_e.GAMEPAD),r=a.padType,o=bi(a,t.index),l=a.icons[o];if(!l)return;this.buttonPressed=t.index;const h=ma(a,this.target);this.onInputDown(l,h,r)}swapAction(){const e=s.inputController.getActiveConfig(_e.GAMEPAD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}clear(){super.clear(),this.targetButtonIcon.setVisible(!1),this.swapText.setVisible(!1)}};u(_c,"GamepadBindingUiHandler");let co=_c;const uo={padID:"default",padType:"keyboard",deviceMapping:{KEY_A:Phaser.Input.Keyboard.KeyCodes.A,KEY_B:Phaser.Input.Keyboard.KeyCodes.B,KEY_C:Phaser.Input.Keyboard.KeyCodes.C,KEY_D:Phaser.Input.Keyboard.KeyCodes.D,KEY_E:Phaser.Input.Keyboard.KeyCodes.E,KEY_F:Phaser.Input.Keyboard.KeyCodes.F,KEY_G:Phaser.Input.Keyboard.KeyCodes.G,KEY_H:Phaser.Input.Keyboard.KeyCodes.H,KEY_I:Phaser.Input.Keyboard.KeyCodes.I,KEY_J:Phaser.Input.Keyboard.KeyCodes.J,KEY_K:Phaser.Input.Keyboard.KeyCodes.K,KEY_L:Phaser.Input.Keyboard.KeyCodes.L,KEY_M:Phaser.Input.Keyboard.KeyCodes.M,KEY_N:Phaser.Input.Keyboard.KeyCodes.N,KEY_O:Phaser.Input.Keyboard.KeyCodes.O,KEY_P:Phaser.Input.Keyboard.KeyCodes.P,KEY_Q:Phaser.Input.Keyboard.KeyCodes.Q,KEY_R:Phaser.Input.Keyboard.KeyCodes.R,KEY_S:Phaser.Input.Keyboard.KeyCodes.S,KEY_T:Phaser.Input.Keyboard.KeyCodes.T,KEY_U:Phaser.Input.Keyboard.KeyCodes.U,KEY_V:Phaser.Input.Keyboard.KeyCodes.V,KEY_W:Phaser.Input.Keyboard.KeyCodes.W,KEY_X:Phaser.Input.Keyboard.KeyCodes.X,KEY_Y:Phaser.Input.Keyboard.KeyCodes.Y,KEY_Z:Phaser.Input.Keyboard.KeyCodes.Z,KEY_0:Phaser.Input.Keyboard.KeyCodes.ZERO,KEY_1:Phaser.Input.Keyboard.KeyCodes.ONE,KEY_2:Phaser.Input.Keyboard.KeyCodes.TWO,KEY_3:Phaser.Input.Keyboard.KeyCodes.THREE,KEY_4:Phaser.Input.Keyboard.KeyCodes.FOUR,KEY_5:Phaser.Input.Keyboard.KeyCodes.FIVE,KEY_6:Phaser.Input.Keyboard.KeyCodes.SIX,KEY_7:Phaser.Input.Keyboard.KeyCodes.SEVEN,KEY_8:Phaser.Input.Keyboard.KeyCodes.EIGHT,KEY_9:Phaser.Input.Keyboard.KeyCodes.NINE,KEY_F1:Phaser.Input.Keyboard.KeyCodes.F1,KEY_F2:Phaser.Input.Keyboard.KeyCodes.F2,KEY_F3:Phaser.Input.Keyboard.KeyCodes.F3,KEY_F4:Phaser.Input.Keyboard.KeyCodes.F4,KEY_F5:Phaser.Input.Keyboard.KeyCodes.F5,KEY_F6:Phaser.Input.Keyboard.KeyCodes.F6,KEY_F7:Phaser.Input.Keyboard.KeyCodes.F7,KEY_F8:Phaser.Input.Keyboard.KeyCodes.F8,KEY_F9:Phaser.Input.Keyboard.KeyCodes.F9,KEY_F10:Phaser.Input.Keyboard.KeyCodes.F10,KEY_F11:Phaser.Input.Keyboard.KeyCodes.F11,KEY_F12:Phaser.Input.Keyboard.KeyCodes.F12,KEY_PAGE_DOWN:Phaser.Input.Keyboard.KeyCodes.PAGE_DOWN,KEY_PAGE_UP:Phaser.Input.Keyboard.KeyCodes.PAGE_UP,KEY_CTRL:Phaser.Input.Keyboard.KeyCodes.CTRL,KEY_DEL:Phaser.Input.Keyboard.KeyCodes.DELETE,KEY_END:Phaser.Input.Keyboard.KeyCodes.END,KEY_ENTER:Phaser.Input.Keyboard.KeyCodes.ENTER,KEY_ESC:Phaser.Input.Keyboard.KeyCodes.ESC,KEY_HOME:Phaser.Input.Keyboard.KeyCodes.HOME,KEY_INSERT:Phaser.Input.Keyboard.KeyCodes.INSERT,KEY_PLUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_ADD,KEY_MINUS:Phaser.Input.Keyboard.KeyCodes.NUMPAD_SUBTRACT,KEY_QUOTATION:Phaser.Input.Keyboard.KeyCodes.QUOTES,KEY_SHIFT:Phaser.Input.Keyboard.KeyCodes.SHIFT,KEY_SPACE:Phaser.Input.Keyboard.KeyCodes.SPACE,KEY_TAB:Phaser.Input.Keyboard.KeyCodes.TAB,KEY_TILDE:Phaser.Input.Keyboard.KeyCodes.BACKTICK,KEY_ARROW_UP:Phaser.Input.Keyboard.KeyCodes.UP,KEY_ARROW_DOWN:Phaser.Input.Keyboard.KeyCodes.DOWN,KEY_ARROW_LEFT:Phaser.Input.Keyboard.KeyCodes.LEFT,KEY_ARROW_RIGHT:Phaser.Input.Keyboard.KeyCodes.RIGHT,KEY_LEFT_BRACKET:Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET,KEY_RIGHT_BRACKET:Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET,KEY_SEMICOLON:Phaser.Input.Keyboard.KeyCodes.SEMICOLON,KEY_COMMA:Phaser.Input.Keyboard.KeyCodes.COMMA,KEY_PERIOD:Phaser.Input.Keyboard.KeyCodes.PERIOD,KEY_BACK_SLASH:Phaser.Input.Keyboard.KeyCodes.BACK_SLASH,KEY_FORWARD_SLASH:Phaser.Input.Keyboard.KeyCodes.FORWARD_SLASH,KEY_BACKSPACE:Phaser.Input.Keyboard.KeyCodes.BACKSPACE,KEY_ALT:Phaser.Input.Keyboard.KeyCodes.ALT},icons:{KEY_A:"A.png",KEY_B:"B.png",KEY_C:"C.png",KEY_D:"D.png",KEY_E:"E.png",KEY_F:"F.png",KEY_G:"G.png",KEY_H:"H.png",KEY_I:"I.png",KEY_J:"J.png",KEY_K:"K.png",KEY_L:"L.png",KEY_M:"M.png",KEY_N:"N.png",KEY_O:"O.png",KEY_P:"P.png",KEY_Q:"Q.png",KEY_R:"R.png",KEY_S:"S.png",KEY_T:"T.png",KEY_U:"U.png",KEY_V:"V.png",KEY_W:"W.png",KEY_X:"X.png",KEY_Y:"Y.png",KEY_Z:"Z.png",KEY_0:"0.png",KEY_1:"1.png",KEY_2:"2.png",KEY_3:"3.png",KEY_4:"4.png",KEY_5:"5.png",KEY_6:"6.png",KEY_7:"7.png",KEY_8:"8.png",KEY_9:"9.png",KEY_F1:"F1.png",KEY_F2:"F2.png",KEY_F3:"F3.png",KEY_F4:"F4.png",KEY_F5:"F5.png",KEY_F6:"F6.png",KEY_F7:"F7.png",KEY_F8:"F8.png",KEY_F9:"F9.png",KEY_F10:"F10.png",KEY_F11:"F11.png",KEY_F12:"F12.png",KEY_PAGE_DOWN:"PAGE_DOWN.png",KEY_PAGE_UP:"PAGE_UP.png",KEY_CTRL:"CTRL.png",KEY_DEL:"DEL.png",KEY_END:"END.png",KEY_ENTER:"ENTER.png",KEY_ESC:"ESC.png",KEY_HOME:"HOME.png",KEY_INSERT:"INS.png",KEY_PLUS:"PLUS.png",KEY_MINUS:"MINUS.png",KEY_QUOTATION:"QUOTE.png",KEY_SHIFT:"SHIFT.png",KEY_SPACE:"SPACE.png",KEY_TAB:"TAB.png",KEY_TILDE:"TILDE.png",KEY_ARROW_UP:"KEY_ARROW_UP.png",KEY_ARROW_DOWN:"KEY_ARROW_DOWN.png",KEY_ARROW_LEFT:"KEY_ARROW_LEFT.png",KEY_ARROW_RIGHT:"KEY_ARROW_RIGHT.png",KEY_LEFT_BRACKET:"LEFT_BRACKET.png",KEY_RIGHT_BRACKET:"RIGHT_BRACKET.png",KEY_SEMICOLON:"SEMICOLON.png",KEY_COMMA:"COMMA.png",KEY_PERIOD:"PERIOD.png",KEY_BACK_SLASH:"BACK_SLASH.png",KEY_FORWARD_SLASH:"FORWARD_SLASH.png",KEY_BACKSPACE:"BACK.png",KEY_ALT:"ALT.png"},settings:{[re.Button_Up]:I.UP,[re.Button_Down]:I.DOWN,[re.Button_Left]:I.LEFT,[re.Button_Right]:I.RIGHT,[re.Button_Submit]:I.SUBMIT,[re.Button_Action]:I.ACTION,[re.Button_Cancel]:I.CANCEL,[re.Button_Menu]:I.MENU,[re.Button_Stats]:I.STATS,[re.Button_Cycle_Shiny]:I.CYCLE_SHINY,[re.Button_Cycle_Form]:I.CYCLE_FORM,[re.Button_Cycle_Gender]:I.CYCLE_GENDER,[re.Button_Cycle_Ability]:I.CYCLE_ABILITY,[re.Button_Cycle_Nature]:I.CYCLE_NATURE,[re.Button_Speed_Up]:I.SPEED_UP,[re.Button_Slow_Down]:I.SLOW_DOWN,[re.Button_Cycle_Tera]:I.CYCLE_TERA,[re.Alt_Button_Up]:I.UP,[re.Alt_Button_Down]:I.DOWN,[re.Alt_Button_Left]:I.LEFT,[re.Alt_Button_Right]:I.RIGHT,[re.Alt_Button_Submit]:I.SUBMIT,[re.Alt_Button_Action]:I.ACTION,[re.Alt_Button_Cancel]:I.CANCEL,[re.Alt_Button_Menu]:I.MENU,[re.Alt_Button_Stats]:I.STATS,[re.Alt_Button_Cycle_Shiny]:I.CYCLE_SHINY,[re.Alt_Button_Cycle_Form]:I.CYCLE_FORM,[re.Alt_Button_Cycle_Gender]:I.CYCLE_GENDER,[re.Alt_Button_Cycle_Ability]:I.CYCLE_ABILITY,[re.Alt_Button_Cycle_Nature]:I.CYCLE_NATURE,[re.Alt_Button_Speed_Up]:I.SPEED_UP,[re.Alt_Button_Slow_Down]:I.SLOW_DOWN,[re.Alt_Button_Cycle_Tera]:I.CYCLE_TERA},default:{KEY_ARROW_UP:re.Button_Up,KEY_ARROW_DOWN:re.Button_Down,KEY_ARROW_LEFT:re.Button_Left,KEY_ARROW_RIGHT:re.Button_Right,KEY_ENTER:re.Button_Submit,KEY_SPACE:re.Button_Action,KEY_BACKSPACE:re.Button_Cancel,KEY_ESC:re.Button_Menu,KEY_C:re.Button_Stats,KEY_R:re.Button_Cycle_Shiny,KEY_F:re.Button_Cycle_Form,KEY_G:re.Button_Cycle_Gender,KEY_E:re.Button_Cycle_Ability,KEY_N:re.Button_Cycle_Nature,KEY_V:re.Button_Cycle_Tera,KEY_PLUS:-1,KEY_MINUS:-1,KEY_A:re.Alt_Button_Left,KEY_B:-1,KEY_D:re.Alt_Button_Right,KEY_H:-1,KEY_I:-1,KEY_J:-1,KEY_K:-1,KEY_L:-1,KEY_M:re.Alt_Button_Menu,KEY_O:-1,KEY_P:-1,KEY_Q:-1,KEY_S:re.Alt_Button_Down,KEY_T:re.Alt_Button_Cycle_Form,KEY_U:-1,KEY_W:re.Alt_Button_Up,KEY_X:re.Alt_Button_Cancel,KEY_Y:re.Alt_Button_Cycle_Shiny,KEY_Z:re.Alt_Button_Action,KEY_0:-1,KEY_1:-1,KEY_2:-1,KEY_3:-1,KEY_4:-1,KEY_5:-1,KEY_6:-1,KEY_7:-1,KEY_8:-1,KEY_9:-1,KEY_CTRL:-1,KEY_DEL:-1,KEY_END:-1,KEY_F1:-1,KEY_F2:-1,KEY_F3:-1,KEY_F4:-1,KEY_F5:-1,KEY_F6:-1,KEY_F7:-1,KEY_F8:-1,KEY_F9:-1,KEY_F10:-1,KEY_F11:-1,KEY_F12:-1,KEY_HOME:-1,KEY_INSERT:-1,KEY_PAGE_DOWN:re.Button_Slow_Down,KEY_PAGE_UP:re.Button_Speed_Up,KEY_QUOTATION:-1,KEY_SHIFT:re.Alt_Button_Stats,KEY_TAB:-1,KEY_TILDE:-1,KEY_LEFT_BRACKET:-1,KEY_RIGHT_BRACKET:-1,KEY_SEMICOLON:-1,KEY_ALT:-1},blacklist:["KEY_ENTER","KEY_ESC","KEY_SPACE","KEY_BACKSPACE","KEY_ARROW_UP","KEY_ARROW_DOWN","KEY_ARROW_LEFT","KEY_ARROW_RIGHT","KEY_DEL","KEY_HOME"]},Ac=class Ac extends ya{constructor(e=null){var n,a;super(e),this.setSetting=qf,this.titleSelected="Keyboard",this.setting=re,this.settingDeviceDefaults=kT,this.settingDeviceOptions=MT,this.configs=[uo],this.commonSettingsCount=0,this.textureOverride="keyboard",this.localStoragePropertyName="settingsKeyboard",this.settingBlacklisted=NT,this.device=_e.KEYBOARD;const t=(n=s.input.keyboard)==null?void 0:n.addKey(Phaser.Input.Keyboard.KeyCodes.DELETE),i=(a=s.input.keyboard)==null?void 0:a.addKey(Phaser.Input.Keyboard.KeyCodes.HOME);t==null||t.on("up",this.onDeleteDown,this),i==null||i.on("up",this.onHomeDown,this)}setup(){super.setup(),this.layout.noKeyboard=new Map;const e=s.add.container(0,0);e.setVisible(!1);const t=D(8,28,g.t("settings:keyboardPleasePress"),O.SETTINGS_LABEL);t.setOrigin(0,0),e.add(t),this.settingsContainer.add(e);const i=s.add.sprite(0,0,"keyboard");i.setOrigin(0,-.1),i.setPositionRelative(this.actionsBg,this.navigationContainer.width-260,4),this.navigationIcons.BUTTON_DELETE=i;const n=D(0,0,g.t("settings:delete"),O.SETTINGS_LABEL);n.setOrigin(0,.15),n.setPositionRelative(i,-n.width/6-2,0),this.settingsContainer.add(i),this.settingsContainer.add(n),this.layout.noKeyboard.optionsContainer=e,this.layout.noKeyboard.label=t}onHomeDown(){[_.SETTINGS_KEYBOARD,_.SETTINGS_GAMEPAD].includes(s.ui.getMode())&&(s.gameData.resetMappingToFactory(),jt.getInstance().updateIcons())}onDeleteDown(){if(s.ui.getMode()!==_.SETTINGS_KEYBOARD)return;const e=this.cursor+this.scrollCursor,t=this.settingLabels[e].text,i=pg(t),n=re[i],a=this.getActiveConfig();FT(this.getActiveConfig(),n)&&(this.saveCustomKeyboardMappingToLocalStorage(a),this.updateBindings(),jt.getInstance().updateIcons())}setLayout(e){return e?super.setLayout(e):(this.layout.noKeyboard.optionsContainer.setVisible(!0),!1)}updateChosenKeyboardDisplay(){this.updateBindings();for(const[e,t]of Object.keys(this.setting).entries())if(this.setting[t]===this.setting.Default_Layout)for(const n of Object.keys(this.layout))n!=="noKeyboard"&&this.layout[n].optionValueLabels[e][0].setText(mh(s.inputController.selectedDevice[_e.KEYBOARD],22))}saveCustomKeyboardMappingToLocalStorage(e){var t;s.gameData.saveMappingConfigs((t=s.inputController)==null?void 0:t.selectedDevice[_e.KEYBOARD],e)}saveSettingToLocalStorage(e,t){this.setting[e]!==this.setting.Default_Layout&&s.gameData.saveControlSetting(this.device,this.localStoragePropertyName,e,this.settingDeviceDefaults,t)}};u(Ac,"SettingsKeyboardUiHandler");let Oa=Ac;const wc=class wc extends va{constructor(e=null){var t;super(e),(t=s.input.keyboard)==null||t.on("keydown",this.onKeyDown,this)}setup(){super.setup(),this.newButtonIcon=s.add.sprite(0,0,"keyboard"),this.newButtonIcon.setPositionRelative(this.optionSelectBg,78,32),this.newButtonIcon.setOrigin(.5),this.newButtonIcon.setVisible(!1),this.actionLabel=D(0,0,g.t("settings:assignButton"),O.SETTINGS_LABEL),this.actionLabel.setOrigin(0,.5),this.actionLabel.setPositionRelative(this.actionBg,this.actionBg.width-80,this.actionBg.height/2),this.actionsContainer.add(this.actionLabel),this.optionSelectContainer.add(this.newButtonIcon)}getSelectedDevice(){var e;return(e=s.inputController)==null?void 0:e.selectedDevice[_e.KEYBOARD]}onKeyDown(e){const t=[Phaser.Input.Keyboard.KeyCodes.UP,Phaser.Input.Keyboard.KeyCodes.DOWN,Phaser.Input.Keyboard.KeyCodes.LEFT,Phaser.Input.Keyboard.KeyCodes.RIGHT,Phaser.Input.Keyboard.KeyCodes.HOME,Phaser.Input.Keyboard.KeyCodes.ENTER,Phaser.Input.Keyboard.KeyCodes.ESC,Phaser.Input.Keyboard.KeyCodes.DELETE],i=e.keyCode;if(!this.listening||this.buttonPressed!==null||t.includes(i))return;const n=s.inputController.getActiveConfig(_e.KEYBOARD),a=bi(n,i),r=n.icons[a];r&&(this.buttonPressed=i,this.onInputDown(r,null,"keyboard"))}swapAction(){const e=s.inputController.getActiveConfig(_e.KEYBOARD);return s.inputController.assignBinding(e,this.target,this.buttonPressed)?(s.gameData.saveMappingConfigs(this.getSelectedDevice(),e),!0):!1}};u(wc,"KeyboardBindingUiHandler");let po=wc;const Mc=class Mc extends on{constructor(e=null){super(bh.DISPLAY,e),this.title="Display";const t=this.settings.findIndex(i=>i.key===ms.Language);if(t>=0)switch(localStorage.getItem("prLang")){case"en":this.settings[t].options[0]={value:"English",label:"English"};break;case"es-ES":this.settings[t].options[0]={value:"Español (ES)",label:"Español (ES)"};break;case"es-MX":this.settings[t].options[0]={value:"Español (LATAM)",label:"Español (LATAM)"};break;case"fr":this.settings[t].options[0]={value:"Français",label:"Français"};break;case"de":this.settings[t].options[0]={value:"Deutsch",label:"Deutsch"};break;case"it":this.settings[t].options[0]={value:"Italiano",label:"Italiano"};break;case"pt-BR":this.settings[t].options[0]={value:"Português (BR)",label:"Português (BR)"};break;case"ko":case"ko-KR":this.settings[t].options[0]={value:"한국어",label:"한국어"};break;case"ja":this.settings[t].options[0]={value:"日本語",label:"日本語"};break;case"zh-CN":this.settings[t].options[0]={value:"简体中文",label:"简体中文"};break;case"zh-TW":this.settings[t].options[0]={value:"繁體中文",label:"繁體中文"};break;case"ca":this.settings[t].options[0]={value:"Català",label:"Català (Needs Help)"};break;case"tr":this.settings[t].options[0]={value:"Türkçe",label:"Türkçe (Needs Help)"};break;case"ru":this.settings[t].options[0]={value:"Русский",label:"Русский (Needs Help)"};break;case"da":this.settings[t].options[0]={value:"Dansk",label:"Dansk (Needs Help)"};break;case"ro":this.settings[t].options[0]={value:"Română",label:"Română (Needs Help)"};break;default:this.settings[t].options[0]={value:"English",label:"English"};break}this.localStorageKey="settings"}};u(Mc,"SettingsDisplayUiHandler");let xa=Mc;const kc=class kc extends on{constructor(e=null){super(bh.AUDIO,e),this.title="Audio",this.localStorageKey="settings",this.rowsToDisplay=6}};u(kc,"SettingsAudioUiHandler");let _a=kc;const Nc=class Nc extends Fs{getModalTitle(e){return g.t("menu:renamePokemon")}getWidth(e){return 160}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[g.t("menu:rename"),g.t("menu:cancel")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:g.t("menu:nickname")}]}show(e){if(super.show(e)){const t=e[0];return e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender(!1):this.inputs[0].text=e[1],this.submitAction=i=>{this.sanitizeInputs();const n=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return t.buttonActions[0](n),!0},!0}return!1}};u(Nc,"RenameFormUiHandler");let fo=Nc;const oC=25,Pc=class Pc extends _t{constructor(){super(_.RUN_HISTORY),this.maxRows=3,this.scrollCursor=0}setup(){const e=this.getUi();this.runSelectContainer=s.add.container(0,0),this.runSelectContainer.setVisible(!1),e.add(this.runSelectContainer);const t=s.add.rectangle(0,0,s.game.canvas.width/6,-s.game.canvas.height/6,26720);t.setOrigin(0,0),this.runSelectContainer.add(t),this.runContainerInitialY=-s.game.canvas.height/6+8,this.runsContainer=s.add.container(8,this.runContainerInitialY),this.runSelectContainer.add(this.runsContainer),this.runs=[],s.loadImage("hall_of_fame_red","ui"),s.loadImage("hall_of_fame_blue","ui"),s.loadAtlas("rival_f","trainer"),s.loadAtlas("rival_m","trainer")}show(e){return super.show(e),this.getUi().bringToTop(this.runSelectContainer),this.runSelectContainer.setVisible(!0),this.populateRuns().then(()=>{this.setScrollCursor(0),this.setCursor(0),this.runs.length===0&&this.clearCursor()}),!0}processInput(e){const t=this.getUi();let i=!1;const n=!1;if([I.ACTION,I.CANCEL].includes(e)){if(e===I.ACTION){const a=this.cursor+this.scrollCursor;if(this.runs[a])s.ui.setOverlayMode(_.RUN_INFO,this.runs[a].entryData,_h.RUN_HISTORY,!0);else return!1;return i=!0,i}this.runSelectCallback=null,i=!0,s.ui.revertMode()}else if(this.runs.length>0)switch(e){case I.UP:this.cursor?i=this.setCursor(this.cursor-1):this.scrollCursor?i=this.setScrollCursor(this.scrollCursor-1):this.runs.length>1&&(i=this.setCursor(Math.min(this.runs.length-1,this.maxRows-1)),i=this.setScrollCursor(Math.max(0,this.runs.length-this.maxRows))||i);break;case I.DOWN:this.cursor<Math.min(this.maxRows-1,this.runs.length-this.scrollCursor-1)?i=this.setCursor(this.cursor+1):this.scrollCursor<this.runs.length-this.maxRows?i=this.setScrollCursor(this.scrollCursor+1):this.runs.length>1&&(i=this.setCursor(0),i=this.setScrollCursor(0)||i);break}return i&&t.playSelect(),i||n}async populateRuns(){const e=await s.gameData.getRunHistoryData(),t=Object.keys(e);if(t.length===0){this.showEmpty();return}const i=t.map(Number);t.length>1&&i.sort((a,r)=>r-a);const n=t.length;for(let a=0;a<n;a++){const r=new mo(e[i[a]],a);s.add.existing(r),this.runsContainer.add(r),this.runs.push(r)}this.cursorObj&&t.length>0&&this.runsContainer.bringToTop(this.cursorObj)}async showEmpty(){const e=me(0,0,304,165);this.runsContainer.add(e);const t=e.getCenter(),i=D(0,0,g.t("saveSlotSelectUiHandler:empty"),O.WINDOW,{fontSize:"128px"});i.setPosition(t.x-18,t.y-15),this.runsContainer.add(i)}setCursor(e){const t=super.setCursor(e);return this.cursorObj||(this.cursorObj=s.add.nineslice(0,0,"select_cursor_highlight_thick",void 0,296,46,6,6,6,6),this.cursorObj.setOrigin(0,0),this.runsContainer.add(this.cursorObj)),this.cursorObj.setPosition(4,4+(e+this.scrollCursor)*56),t}setScrollCursor(e){const t=e!==this.scrollCursor;return t&&(this.scrollCursor=e,this.setCursor(this.cursor),s.tweens.add({targets:this.runsContainer,y:this.runContainerInitialY-56*e,duration:de(325),ease:"Sine.easeInOut"})),t}clear(){super.clear(),this.runSelectContainer.setVisible(!1),this.setScrollCursor(0),this.clearCursor(),this.runSelectCallback=null,this.clearRuns()}clearCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=null}clearRuns(){this.runs.splice(0,this.runs.length),this.runsContainer.removeAll(!0)}};u(Pc,"RunHistoryUiHandler");let go=Pc;const Dc=class Dc extends Phaser.GameObjects.Container{constructor(e,t){super(s,0,t*56),this.slotId=t,this.entryData=e,this.setup(this.entryData)}setup(e){const t=e.isVictory,i=s.gameData.parseSessionData(JSON.stringify(e.entry)),n=me(0,0,304,52);if(this.add(n),t){const h=D(8,5,`${g.t("runHistory:victory")}`,O.WINDOW);this.add(h)}else{const h=s.gameData.gender??Fe.UNSET,c=Fe[h].toLowerCase();if(i.battleType===Ce.WILD||i.battleType===Ce.MYSTERY_ENCOUNTER&&!i.trainer){const d=s.add.container(8,5),f=D(0,0,`${g.t("runHistory:defeatedWild",{context:c})}`,O.WINDOW);d.add(f),i.enemyParty.forEach((p,T)=>{const m=s.add.container(65+T*25,-8);m.setScale(.75),p.boss=!1,p.player=!0;const C=p.toPokemon(),b=s.addPokemonIcon(C,0,0,0,0),S=D(32,20,`${g.t("saveSlotSelectUiHandler:lv")}${ci(C.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});S.setShadow(0,0,void 0),S.setStroke("#424242",14),S.setOrigin(1,0),m.add(b),m.add(S),d.add(m),C.destroy()}),this.add(d)}else if(i.battleType===Ce.TRAINER||i.battleType===Ce.MYSTERY_ENCOUNTER&&i.trainer){const d=i.trainer.toTrainer();if(i.trainer.trainerType>=375){const p=d.variant===Kt.FEMALE?"trainerNames:rival_female":"trainerNames:rival",T=D(8,5,`${g.t("runHistory:defeatedRival",{context:c})} ${g.t(p)}`,O.WINDOW);this.add(T)}else{const p=D(8,5,`${g.t("runHistory:defeatedTrainer",{context:c})}${d.getName(0,!0)}`,O.WINDOW);this.add(p)}}}const a=D(8,19,"",O.WINDOW);let r="";switch(i.gameMode){case fe.DAILY:r=g.t("gameMode:dailyRun");break;case fe.SPLICED_ENDLESS:case fe.ENDLESS:r=g.t("gameMode:endless");break;case fe.CLASSIC:r=g.t("gameMode:classic");break;case fe.CHALLENGE:r=g.t("gameMode:challenge");break}if(a.appendText(r,!1),i.gameMode===fe.SPLICED_ENDLESS){const h=s.add.image(0,0,"icon_spliced");h.setScale(.75);const c=a.getTopRight();h.setPosition(c.x+5,27),this.add(h),a.appendText("    - ",!1)}else a.appendText(" - ",!1);a.appendText(g.t("saveSlotSelectUiHandler:wave")+" "+i.waveIndex,!1),this.add(a);const o=D(8,33,new Date(i.timestamp).toLocaleString(),O.WINDOW);this.add(o);const l=s.add.container(140,17);i.party.forEach((h,c)=>{const d=s.add.container(26*c,0);d.setScale(.75);const f=h.toPokemon(),p=s.addPokemonIcon(f,0,0,0,0),T=D(32,20,`${g.t("saveSlotSelectUiHandler:lv")}${ci(f.level,1e3)}`,O.PARTY,{fontSize:"54px",color:"#f8f8f8"});T.setShadow(0,0,void 0),T.setStroke("#424242",14),T.setOrigin(1,0),d.add(p),d.add(T),l.add(d),f.destroy()}),this.add(l)}};u(Dc,"RunEntryContainer");let mo=Dc;const Wn={pt:{infoContainerTextSize:"60px",infoContainerLabelXPos:-15,infoContainerTextXPos:-12}},Bc=class Bc extends Phaser.GameObjects.Container{constructor(e=372,t=66){super(s,e,t),this.infoWindowWidth=104,this.numCharsBeforeCutoff=16,this.initialX=e}setup(){this.setName("pkmn-info");const e=g.resolvedLanguage,t=Object.keys(Wn).find(h=>e==null?void 0:e.includes(h)),i=Wn[t];this.infoBg=me(0,0,this.infoWindowWidth,132),this.infoBg.setOrigin(.5,.5),this.infoBg.setName("window-info-bg"),this.pokemonMovesContainer=s.add.container(6,14),this.pokemonMovesContainer.setName("pkmn-moves"),this.movesContainerInitialX=this.pokemonMovesContainer.x,this.pokemonMovesContainers=[],this.pokemonMoveBgs=[],this.pokemonMoveLabels=[];const n=me(0,0,58,52);n.setOrigin(1,0),n.setName("window-moves-bg"),this.pokemonMovesContainer.add(n);const a=D(-n.width/2,6,g.t("pokemonInfoContainer:moveset"),O.WINDOW,{fontSize:"64px"});a.setOrigin(.5,0),a.setName("text-moves"),this.pokemonMovesContainer.add(a);for(let h=0;h<4;h++){const c=s.add.container(-6,18+7*h);c.setScale(.5),c.setName("move");const d=s.add.nineslice(0,0,"type_bgs","unknown",92,14,2,2,2,2);d.setOrigin(1,0),d.setName("nineslice-move-bg");const f=D(-d.width/2,0,"-",O.PARTY);f.setOrigin(.5,0),f.setName("text-move-label"),this.pokemonMoveBgs.push(d),this.pokemonMoveLabels.push(f),c.add(d),c.add(f),this.pokemonMovesContainers.push(c),this.pokemonMovesContainer.add(c)}this.add(this.pokemonMovesContainer),this.statsContainer=new nn(-48,-64,!0),this.add(this.infoBg),this.add(this.statsContainer);const r=(i==null?void 0:i.infoContainerLabelXPos)||-18,o=(i==null?void 0:i.infoContainerTextXPos)||-14,l=(i==null?void 0:i.infoContainerTextSize)||"64px";this.pokemonFormLabelText=D(r,19,g.t("pokemonInfoContainer:form"),O.WINDOW,{fontSize:l}),this.pokemonFormLabelText.setOrigin(1,0),this.pokemonFormLabelText.setVisible(!1),this.add(this.pokemonFormLabelText),this.pokemonFormText=D(o,19,"",O.WINDOW,{fontSize:l}),this.pokemonFormText.setOrigin(0,0),this.pokemonFormText.setVisible(!1),this.add(this.pokemonFormText),this.pokemonGenderText=D(-42,-61,"",O.WINDOW,{fontSize:l}),this.pokemonGenderText.setOrigin(0,0),this.pokemonGenderText.setVisible(!1),this.pokemonGenderText.setName("text-pkmn-gender"),this.add(this.pokemonGenderText),this.pokemonGenderNewText=D(-36,-61,"",O.WINDOW,{fontSize:"64px"}),this.pokemonGenderNewText.setOrigin(0,0),this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderNewText.setName("text-pkmn-new-gender"),this.add(this.pokemonGenderNewText),this.pokemonAbilityLabelText=D(r,29,g.t("pokemonInfoContainer:ability"),O.WINDOW,{fontSize:l}),this.pokemonAbilityLabelText.setOrigin(1,0),this.pokemonAbilityLabelText.setName("text-pkmn-ability-label"),this.add(this.pokemonAbilityLabelText),this.pokemonAbilityText=D(o,29,"",O.WINDOW,{fontSize:l}),this.pokemonAbilityText.setOrigin(0,0),this.pokemonAbilityText.setName("text-pkmn-ability"),this.add(this.pokemonAbilityText),this.pokemonNatureLabelText=D(r,39,g.t("pokemonInfoContainer:nature"),O.WINDOW,{fontSize:l}),this.pokemonNatureLabelText.setOrigin(1,0),this.pokemonNatureLabelText.setName("text-pkmn-nature-label"),this.add(this.pokemonNatureLabelText),this.pokemonNatureText=pt(o,39,"",O.WINDOW,{fontSize:l,lineSpacing:3,maxLines:2}),this.pokemonNatureText.setOrigin(0,0),this.pokemonNatureText.setName("text-pkmn-nature"),this.add(this.pokemonNatureText),this.pokemonShinyIcon=s.add.image(-43.5,48.5,"shiny_star"),this.pokemonShinyIcon.setOrigin(0,0),this.pokemonShinyIcon.setScale(.75),this.pokemonShinyIcon.setInteractive(new Phaser.Geom.Rectangle(0,0,12,15),Phaser.Geom.Rectangle.Contains),this.pokemonShinyIcon.setName("img-pkmn-shiny-icon"),this.add(this.pokemonShinyIcon),this.pokemonShinyNewIcon=D(this.pokemonShinyIcon.x+12,this.pokemonShinyIcon.y,"",O.WINDOW,{fontSize:l}),this.pokemonShinyNewIcon.setOrigin(0,0),this.pokemonShinyNewIcon.setName("text-pkmn-shiny-new-icon"),this.add(this.pokemonShinyNewIcon),this.pokemonShinyNewIcon.setVisible(!1),this.pokemonFusionShinyIcon=s.add.image(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y,"shiny_star_2"),this.pokemonFusionShinyIcon.setOrigin(0,0),this.pokemonFusionShinyIcon.setScale(.75),this.pokemonFusionShinyIcon.setName("img-pkmn-fusion-shiny-icon"),this.add(this.pokemonFusionShinyIcon),this.setVisible(!1)}show(e,t=!1,i=1,n,a,r=!1){return new Promise(o=>{n||(n=s.gameData.dexData[e.species.speciesId]),a||(a=s.gameData.starterData[e.species.getRootSpeciesId()]);const l=BigInt(n.caughtAttr);if(e.gender>At.GENDERLESS){this.pokemonGenderText.setText(Ch(e.gender)),this.pokemonGenderText.setColor(yi(e.gender)),this.pokemonGenderText.setShadowColor(yi(e.gender,!0)),this.pokemonGenderText.setVisible(!0);const x=BigInt(1<<e.gender)*V.MALE;this.pokemonGenderNewText.setText("(+)"),this.pokemonGenderNewText.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonGenderNewText.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme)),this.pokemonGenderNewText.setVisible((x&l)===BigInt(0))}else this.pokemonGenderNewText.setVisible(!1),this.pokemonGenderText.setVisible(!1);const h=e.species.getFormNameToDisplay(e.formIndex);h?(this.pokemonFormLabelText.setVisible(!0),this.pokemonFormText.setVisible(!0),(BigInt(1<<e.formIndex)*V.DEFAULT_FORM&l)===BigInt(0)?(this.pokemonFormLabelText.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonFormLabelText.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme))):(this.pokemonFormLabelText.setColor(Oe(O.WINDOW,!1,s.uiTheme)),this.pokemonFormLabelText.setShadowColor(Oe(O.WINDOW,!0,s.uiTheme))),this.pokemonFormText.setText(h.length>this.numCharsBeforeCutoff?`${h.substring(0,this.numCharsBeforeCutoff-3)}...`:h),h.length>this.numCharsBeforeCutoff?(this.pokemonFormText.setInteractive(new Phaser.Geom.Rectangle(0,0,this.pokemonFormText.width,this.pokemonFormText.height),Phaser.Geom.Rectangle.Contains),this.pokemonFormText.on("pointerover",()=>s.ui.showTooltip("",h,!0)),this.pokemonFormText.on("pointerout",()=>s.ui.hideTooltip())):this.pokemonFormText.disableInteractive()):(this.pokemonFormLabelText.setVisible(!1),this.pokemonFormText.setVisible(!1),this.pokemonFormText.disableInteractive());const c=e.abilityIndex===2?O.MONEY:O.WINDOW;this.pokemonAbilityText.setText(e.getAbility(!0).name),this.pokemonAbilityText.setColor(Oe(c,!1,s.uiTheme)),this.pokemonAbilityText.setShadowColor(Oe(c,!0,s.uiTheme)),e.checkIfPlayerHasAbilityOfStarter(a.abilityAttr)?(this.pokemonAbilityLabelText.setColor(Oe(O.WINDOW,!1,s.uiTheme)),this.pokemonAbilityLabelText.setShadowColor(Oe(O.WINDOW,!0,s.uiTheme))):(this.pokemonAbilityLabelText.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonAbilityLabelText.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme))),this.pokemonNatureText.setText(Ti(e.getNature(),!0,!1,!1,s.uiTheme));const f=n.natureAttr,p=1<<e.nature+1;f&p?(this.pokemonNatureLabelText.setColor(Oe(O.WINDOW,!1,s.uiTheme)),this.pokemonNatureLabelText.setShadowColor(Oe(O.WINDOW,!0,s.uiTheme))):(this.pokemonNatureLabelText.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonNatureLabelText.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme)));const T=e.isFusion(),m=T&&e.shiny&&e.fusionShiny,C=m?e.variant:e.getVariant();if(this.pokemonShinyIcon.setTexture(`shiny_star${m?"_1":""}`),this.pokemonShinyIcon.setVisible(e.isShiny()),this.pokemonShinyIcon.setTint(dt(C)),this.pokemonShinyIcon.visible){let x="";(m||C)&&(x=" ("+rp(C),m&&(x+="/"+rp(e.fusionVariant)),x+=")"),this.pokemonShinyIcon.on("pointerover",()=>s.ui.showTooltip("",g.t("common:shinyOnHover")+x,!0)).on("pointerout",()=>s.ui.hideTooltip());const A=BigInt(1<<(e.shiny?1:0)),w=BigInt(1<<e.variant+4);this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonShinyNewIcon.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme));const k=(A&l)===BigInt(0)||(w&l)===BigInt(0);this.pokemonShinyNewIcon.setVisible(!!k)}else(l&V.NON_SHINY)===BigInt(0)&&(l&V.SHINY)===V.SHINY?(this.pokemonShinyNewIcon.setVisible(!0),this.pokemonShinyNewIcon.setText("(+)"),this.pokemonShinyNewIcon.setColor(Oe(O.SUMMARY_BLUE,!1,s.uiTheme)),this.pokemonShinyNewIcon.setShadowColor(Oe(O.SUMMARY_BLUE,!0,s.uiTheme))):this.pokemonShinyNewIcon.setVisible(!1);this.pokemonFusionShinyIcon.setPosition(this.pokemonShinyIcon.x,this.pokemonShinyIcon.y),this.pokemonFusionShinyIcon.setVisible(m),T&&this.pokemonFusionShinyIcon.setTint(dt(e.fusionVariant));const b=e.species.getRootSpeciesId(),S=r?n.caughtAttr?n.ivs:null:s.gameData.dexData[b].caughtAttr?s.gameData.dexData[b].ivs:null;this.statsContainer.updateIvs(e.ivs,S),r||(s.tweens.add({targets:this,duration:de(Math.floor(750/i)),ease:"Cubic.easeInOut",x:this.initialX-this.infoWindowWidth,onComplete:u(()=>{o()},"onComplete")}),t&&s.tweens.add({delay:de(Math.floor(325/i)),targets:this.pokemonMovesContainer,duration:de(Math.floor(325/i)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX-57,onComplete:u(()=>o(),"onComplete")}));for(let x=0;x<4;x++){const A=x<e.moveset.length&&e.moveset[x]?e.moveset[x].getMove():null;this.pokemonMoveBgs[x].setFrame(ve[A?A.type:ve.UNKNOWN].toString().toLowerCase()),this.pokemonMoveLabels[x].setText(A?A.name:"-"),this.pokemonMovesContainers[x].setVisible(!!A)}this.setVisible(!0),this.shown=!0,s.hideEnemyModifierBar()})}changeToEggSummaryLayout(){const e=g.resolvedLanguage,t=Object.keys(Wn).find(o=>e==null?void 0:e.includes(o)),i=Wn[t],n=43,a=((i==null?void 0:i.infoContainerLabelXPos)||-18)+n,r=((i==null?void 0:i.infoContainerTextXPos)||-14)+n;this.x=this.initialX-this.infoWindowWidth,this.pokemonGenderText.setPosition(89,-2),this.pokemonGenderNewText.setPosition(79,-2),this.pokemonShinyIcon.setPosition(82,87),this.pokemonShinyNewIcon.setPosition(72,87),this.pokemonFormLabelText.setPosition(a,152),this.pokemonFormText.setPosition(r,152),this.pokemonAbilityLabelText.setPosition(a,110),this.pokemonAbilityText.setPosition(r,110),this.pokemonNatureLabelText.setPosition(a,125),this.pokemonNatureText.setPosition(r,125),this.statsContainer.setScale(.7),this.statsContainer.setPosition(30,-3),this.infoBg.setVisible(!1),this.pokemonMovesContainer.setVisible(!1)}makeRoomForConfirmUi(e=1,t=!1){const i=t?this.initialX-this.infoWindowWidth-67:this.initialX-this.infoWindowWidth-ca.windowWidth;return new Promise(n=>{s.tweens.add({targets:this,duration:de(Math.floor(150/e)),ease:"Cubic.easeInOut",x:i,onComplete:u(()=>{n()},"onComplete")})})}hide(e=1){return new Promise(t=>{if(!this.shown)return s.showEnemyModifierBar(),t();s.tweens.add({targets:this.pokemonMovesContainer,duration:de(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.movesContainerInitialX}),s.tweens.add({targets:this,duration:de(Math.floor(750/e)),ease:"Cubic.easeInOut",x:this.initialX,onComplete:u(()=>{this.setVisible(!1),this.pokemonShinyIcon.off("pointerover"),this.pokemonShinyIcon.off("pointerout"),s.ui.hideTooltip(),s.showEnemyModifierBar(),t()},"onComplete")}),this.shown=!1})}};u(Bc,"PokemonInfoContainer");let cn=Bc;const Lc=class Lc extends cn{constructor(e,t=115,i=9){super(t,i),this.pokemonListContainer=e}setup(){super.setup(),super.changeToEggSummaryLayout(),this.currentPokemonSprite=s.add.sprite(54,80,"pkmn__sub"),this.currentPokemonSprite.setScale(.8),this.currentPokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.pokemonListContainer.add(this.currentPokemonSprite),this.pokemonNumberText=D(80,107.5,"0000",O.SUMMARY,{fontSize:74}),this.pokemonNumberText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNumberText),this.pokemonNameText=D(7,107.5,"",O.SUMMARY,{fontSize:74}),this.pokemonNameText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonNameText),this.pokemonHatchedIcon=s.add.sprite(-5,90,"egg_icons"),this.pokemonHatchedIcon.setOrigin(0,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonListContainer.add(this.pokemonHatchedIcon),this.pokemonCandyIcon=s.add.sprite(4.5,40,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(4.5,40,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyCountText=D(14,40,"x0",O.SUMMARY,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonListContainer.add(this.pokemonCandyCountText),this.pokemonEggMoveContainers=[],this.pokemonEggMoveBgs=[],this.pokemonEggMoveLabels=[],this.pokemonEggMovesContainer=s.add.container(0,200),this.pokemonEggMovesContainer.setVisible(!1),this.pokemonEggMovesContainer.setScale(.5);for(let e=0;e<4;e++){const t=s.add.container(0,0+6*e),i=s.add.nineslice(70,0,"type_bgs","unknown",92,14,2,2,2,2);i.setOrigin(1,0);const n=D(70-i.width/2,0,"???",O.PARTY);n.setOrigin(.5,0),this.pokemonEggMoveBgs.push(i),this.pokemonEggMoveLabels.push(n),t.add(i),t.add(n),t.setScale(.44),this.pokemonEggMoveContainers.push(t),this.pokemonEggMovesContainer.add(t)}super.add(this.pokemonEggMoveContainers)}hideDisplayPokemon(){this.currentPokemonSprite.setVisible(!1)}displayPokemon(e){const t=e.species,i=e.gender===At.FEMALE,n=e.formIndex,a=e.shiny,r=e.variant;this.currentPokemonSprite.setVisible(!1),t.loadAssets(i,n,a,r,!0).then(()=>{Rt(t.speciesId,e.formIndex).cry(),this.currentPokemonSprite.play(t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setPipelineData("shiny",a),this.currentPokemonSprite.setPipelineData("variant",r),this.currentPokemonSprite.setPipelineData("spriteKey",t.getSpriteKey(i,n,a,r)),this.currentPokemonSprite.setVisible(!0)})}showHatchInfo(e){this.pokemonEggMovesContainer.setVisible(!0);const t=e.pokemon,i=t.species;this.displayPokemon(t),super.show(t,!1,1,e.getDex(),e.getStarterEntry(),!0);const n=ft[i.speciesId];this.pokemonCandyIcon.setTint(Vt(Ot(n[0]))),this.pokemonCandyIcon.setVisible(!0),this.pokemonCandyOverlayIcon.setTint(Vt(Ot(n[1]))),this.pokemonCandyOverlayIcon.setVisible(!0),this.pokemonCandyCountText.setText(`x${s.gameData.starterData[i.speciesId].candyCount}`),this.pokemonCandyCountText.setVisible(!0),this.pokemonNumberText.setText(Is(i.speciesId,4)),this.pokemonNameText.setText(i.name);const a=i&&wt.hasOwnProperty(i.speciesId);for(let r=0;r<4;r++){const o=a?Ne[wt[i.speciesId][r]]:null,l=o&&s.gameData.starterData[i.speciesId].eggMoves&Math.pow(2,r);this.pokemonEggMoveBgs[r].setFrame(ve[o?o.type:ve.UNKNOWN].toString().toLowerCase()),this.pokemonEggMoveLabels[r].setText(o&&l?o.name:"???"),!(o&&e.starterDataEntryBeforeUpdate.eggMoves&Math.pow(2,r))&&l&&this.pokemonEggMoveLabels[r].setText("(+) "+o.name)}this.pokemonEggMovesContainer.setVisible(!0),i.speciesId===ge.MANAPHY||i.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame($s(i))}};u(Lc,"PokemonHatchInfoContainer");let yo=Lc;const Rc=class Rc extends Phaser.GameObjects.Container{constructor(e,t,i){super(s,e,t);const n=i.pokemon;this.species=n.species;const a=2,r=12,o=n.species,l=n.gender===At.FEMALE,h=n.formIndex,c=n.variant,d=n.shiny,f=s.add.sprite(-a,a,o.getIconAtlasKey(h,d,c));f.setScale(.5),f.setOrigin(0,0),f.setFrame(o.getIconId(l,h,d,c)),this.icon=f,this.checkIconId(l,h,d,c),this.add(this.icon),this.shinyIcon=s.add.image(r,a,"shiny_star_small"),this.shinyIcon.setOrigin(0,0),this.shinyIcon.setScale(.5),this.add(this.shinyIcon);const p=s.add.image(r,a*4,"ha_capsule");p.setOrigin(0,0),p.setScale(.5),this.hiddenAbilityIcon=p,this.add(this.hiddenAbilityIcon);const T=s.add.image(r,a*7,"icon_owned");T.setOrigin(0,0),T.setScale(.5),this.pokeballIcon=T,this.add(this.pokeballIcon);const m=s.add.image(0,a,"icon_egg_move");m.setOrigin(0,0),m.setScale(.5),this.eggMoveIcon=m,this.add(this.eggMoveIcon)}updateAndAnimate(e,t){const i=e.pokemon;this.species=i.species;const a=e.dexEntryBeforeUpdate.caughtAttr,r=BigInt(1<<(i.shiny?1:0)),o=BigInt(1<<i.variant+4),l=(r&a)===BigInt(0)||(o&a)===BigInt(0),h=(BigInt(1<<i.formIndex)*V.DEFAULT_FORM&a)===BigInt(0),c=i.gender===At.FEMALE,d=i.formIndex,f=i.variant,p=i.shiny;this.icon.setTexture(this.species.getIconAtlasKey(d,p,f)),this.icon.setFrame(this.species.getIconId(c,d,p,f)),this.checkIconId(c,d,p,f),this.shinyIcon.setVisible(i.shiny),this.shinyIcon.setTint(dt(i.variant)),this.eggMoveIcon.setVisible(e.eggMoveUnlocked),this.hiddenAbilityIcon.setVisible(i.abilityIndex===2),this.pokeballIcon.setVisible(!a||h),!a||l||h?t.addOrUpdate(this.icon,xt.PASSIVE):t.addOrUpdate(this.icon,xt.NONE)}checkIconId(e,t,i,n){this.icon.frame.name!==this.species.getIconId(e,t,i,n)&&(`${this.species.name}`,this.icon.setTexture(this.species.getIconAtlasKey(t,!1,n)),this.icon.setFrame(this.species.getIconId(e,t,!1,n)))}};u(Rc,"HatchedPokemonContainer");let To=Rc;const Sr=112,br=9,Gn=9,ws=11,Ri=18,Fc=class Fc extends _t{constructor(){super(_.EGG_HATCH_SUMMARY),this.eventTarget=new EventTarget}setup(){const e=this.getUi();this.summaryContainer=s.add.container(0,-s.game.canvas.height/6),this.summaryContainer.setVisible(!1),e.add(this.summaryContainer),this.eggHatchContainer=s.add.container(0,-s.game.canvas.height/6),this.eggHatchContainer.setVisible(!1),e.add(this.eggHatchContainer),this.iconAnimHandler=new za,this.iconAnimHandler.setup(),this.eggHatchBg=s.add.image(0,0,"egg_summary_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.cursorObj=s.add.image(0,0,"select_cursor"),this.cursorObj.setOrigin(0,0),this.summaryContainer.add(this.cursorObj),this.pokemonContainers=[],this.pokemonIconsContainer=s.add.container(Sr,br),this.summaryContainer.add(this.pokemonIconsContainer),this.infoContainer=new yo(this.summaryContainer),this.infoContainer.setup(),this.infoContainer.changeToEggSummaryLayout(),this.infoContainer.setVisible(!0),this.summaryContainer.add(this.infoContainer);const t=new ys(Sr+ws*Ri,br+3,4,s.game.canvas.height/6-20,Gn);this.summaryContainer.add(t),this.scrollGridHandler=new Ca(this,Gn,ws).withScrollBar(t).withUpdateGridCallBack(()=>this.updatePokemonIcons()).withUpdateSingleElementCallback(i=>this.infoContainer.showHatchInfo(this.eggHatchData[i])),this.cursor=-1}clear(){super.clear(),this.scrollGridHandler.reset(),this.cursor=-1,this.summaryContainer.setVisible(!1),this.pokemonIconsContainer.removeAll(!0),this.pokemonContainers=[],this.eggHatchBg.setVisible(!1),this.getUi().hideTooltip();const e=s.getActiveKeys();Object.keys(s.anims.anims.entries).forEach(n=>{n.startsWith("pkmn__")&&!e.includes(n)&&s.anims.remove(n)}),Object.keys(s.cache.audio.entries.entries).forEach(n=>{n.startsWith("cry/")&&!e.includes(n)&&delete s.cache.audio.entries.entries[n]}),this.eggHatchData.length=0,this.iconAnimHandler.removeAll()}show(e){super.show(e),e.length>=1&&(this.eggHatchData=e[0].sort(u(function(n,a){const r=n.pokemon.species,o=a.pokemon.species;return $s(r)<$s(o)?-1:$s(r)>$s(o)?1:r.speciesId<o.speciesId?-1:r.speciesId>o.speciesId?1:0},"sortHatchData"))),this.getUi().bringToTop(this.summaryContainer),this.summaryContainer.setVisible(!0),this.eggHatchContainer.setVisible(!0),this.eggHatchBg.setVisible(!0),this.infoContainer.hideDisplayPokemon(),this.scrollGridHandler.setTotalElements(this.eggHatchData.length),this.updatePokemonIcons(),this.setCursor(0),s.playSoundWithoutBgm("evolution_fanfare");const t=s.eggSkipPreference===2?2e3:1e3;return this.blockExit=!0,s.time.delayedCall(t,()=>this.blockExit=!1),!0}updatePokemonIcons(){const e=this.scrollGridHandler.getItemOffset(),t=Math.min(Gn*ws,this.eggHatchData.length-e);for(let i=0;i<Gn*ws;i++){const n=this.eggHatchData[i+e];let a=this.pokemonContainers[i];if(i<t){if(!a){const r=i%ws*Ri,o=Math.floor(i/ws)*Ri;a=new To(r,o,n).setVisible(!1),this.pokemonContainers.push(a),this.pokemonIconsContainer.add(a)}a.setVisible(!0),a.updateAndAnimate(n,this.iconAnimHandler)}else a&&(a.setVisible(!1),this.iconAnimHandler.addOrUpdate(a.icon,xt.NONE))}}processInput(e){const t=this.getUi();let i=!1,n=!1;if(e===I.CANCEL)if(this.blockExit)n=!0;else{const a=s.phaseManager.getCurrentPhase();a!=null&&a.is("EggSummaryPhase")&&a.end(),i=!0}else this.scrollGridHandler.processInput(e);return i?t.playSelect():n&&t.playError(),i||n}setCursor(e){let t=!1;const i=this.cursor;return t=super.setCursor(e),t&&(this.cursorObj.setPosition(Sr-1+Ri*(e%ws),br+1+Ri*Math.floor(e/ws)),i>-1&&this.iconAnimHandler.addOrUpdate(this.pokemonContainers[i].icon,xt.NONE),this.iconAnimHandler.addOrUpdate(this.pokemonContainers[e].icon,xt.ACTIVE),this.infoContainer.showHatchInfo(this.eggHatchData[e+this.scrollGridHandler.getItemOffset()])),t}};u(Fc,"EggSummaryUiHandler");let Co=Fc;const Uc=class Uc extends Fs{constructor(e){super(e)}setup(){super.setup();const e=u((n,a,r)=>Object.keys(n??{}).map((o,l)=>{const h=Object.values(n)[l];if(typeof h=="object"&&!Ee(h))return e(h,a??o,a?r?[...r,o]:[o]:void 0).filter(c=>c.length>0);if(typeof h=="string"||Ee(h))return r?`${a}:${r.map(c=>c).join(".")}.${o}`:`${a}:${o}`}).filter(o=>o),"flattenKeys"),i=e(g.getDataByLanguage(String(g.resolvedLanguage))).filter(n=>n.length>0).flat(Number.POSITIVE_INFINITY).map(String);this.keys=i}getModalTitle(e){return"Test Dialogue"}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return["Check","Cancel"]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){return[{label:"Dialogue"}]}show(e){const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===_.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===_.AUTO_COMPLETE&&t.revertMode();let o=[];const l=a.text.split(" "),h=this.keys.filter(c=>c.toLowerCase().includes(l[l.length-1].toLowerCase()));if(a.text!==""&&h.length>0&&(o=h.slice(0).map(c=>({label:c,handler:u(()=>{var d;if(!Ee(r.data)||((d=r.inputType)==null?void 0:d.toLowerCase())==="deletecontentbackward"){const f=a.text.split(" ");f[f.length-1]=c,a.setText(f.join(" "))}return t.revertMode(),!0},"handler")}))),o.length>0){const c={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(_.AUTO_COMPLETE,c)}}),super.show(e)){const a=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=r=>{if(t.getMode()===_.TEST_DIALOGUE){this.sanitizeInputs();const o=btoa(unescape(encodeURIComponent(this.inputs[0].text)));return a.buttonActions[0](o),!0}return!1},!0}return!1}};u(Uc,"TestDialogueUiHandler");let So=Uc;const Vc=class Vc extends sn{constructor(e=_.OPTION_SELECT){super(e)}getWindowWidth(){return 64}show(e){if(e[0].modalContainer){const{modalContainer:t}=e[0],i=super.show(e);return this.modalContainer=t,this.setupOptions(),i}return!1}setupOptions(){super.setupOptions(),this.modalContainer&&(this.optionSelectContainer.setSize(this.optionSelectContainer.height,Math.max(this.optionSelectText.displayWidth+24,this.getWindowWidth())),this.optionSelectContainer.setPositionRelative(this.modalContainer,this.optionSelectBg.width,this.optionSelectBg.height+50))}processInput(e){return e!==I.CANCEL&&e!==I.ACTION?super.processInput(e):!1}};u(Vc,"AutoCompleteUiHandler");let bo=Vc;const Hc=class Hc extends ts{constructor(){super(_.MYSTERY_ENCOUNTER),this.optionScrollTweens=new Array(4).fill(null),this.showDexProgress=!1,this.encounterOptions=[],this.viewPartyIndex=0,this.viewPartyXPosition=0,this.blockInput=!0}setup(){const e=this.getUi();this.cursorContainer=s.add.container(18,-38.7),this.cursorContainer.setVisible(!1),e.add(this.cursorContainer),this.optionsContainer=s.add.container(12,-38.7),this.optionsContainer.setVisible(!1),e.add(this.optionsContainer),this.dexProgressContainer=s.add.container(214,-43),this.dexProgressContainer.setVisible(!1),e.add(this.dexProgressContainer),this.descriptionContainer=s.add.container(0,-152),this.descriptionContainer.setVisible(!1),e.add(this.descriptionContainer),this.tooltipContainer=s.add.container(210,-48),this.tooltipContainer.setVisible(!1),e.add(this.tooltipContainer),this.setCursor(this.getCursor()),this.descriptionWindow=me(0,0,150,105,!1,!1,0,0,es.THIN),this.descriptionContainer.add(this.descriptionWindow),this.tooltipWindow=me(0,0,110,48,!1,!1,0,0,es.THIN),this.tooltipContainer.add(this.tooltipWindow),this.dexProgressWindow=me(0,0,24,28,!1,!1,0,0,es.THIN),this.dexProgressContainer.add(this.dexProgressWindow),this.rarityBall=s.add.sprite(141,9,"pb"),this.rarityBall.setScale(.75),this.descriptionContainer.add(this.rarityBall);const t=s.add.sprite(12,10,"encounter_radar");t.setScale(.8),this.dexProgressContainer.add(t),this.dexProgressContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,24,28),Phaser.Geom.Rectangle.Contains)}show(e){var r,o,l,h;super.show(e),this.overrideSettings=e[0]??{};const t=Ee((r=this.overrideSettings)==null?void 0:r.hideDescription)?!0:!this.overrideSettings.hideDescription,i=Ee((o=this.overrideSettings)==null?void 0:o.slideInDescription)?!0:this.overrideSettings.slideInDescription,n=((l=this.overrideSettings)==null?void 0:l.startingCursorIndex)??0;this.cursorContainer.setVisible(!0),this.descriptionContainer.setVisible(t),this.optionsContainer.setVisible(!0),this.dexProgressContainer.setVisible(!0),this.displayEncounterOptions(i);const a=this.getCursor();return a===(((h=this.optionsContainer)==null?void 0:h.length)||0)-1?this.setCursor(a):this.setCursor(n),this.blockInput&&setTimeout(()=>{this.unblockInput()},1e3),this.displayOptionTooltip(),!0}processInput(e){var a;const t=this.getUi();let i=!1;const n=this.getCursor();if(e===I.CANCEL||e===I.ACTION){if(e===I.ACTION){const r=this.encounterOptions[n];if(n===this.viewPartyIndex){i=!0;const o={...this.overrideSettings,slideInDescription:!1};s.ui.setMode(_.PARTY,Wt.CHECK,-1,()=>{s.ui.setMode(_.MYSTERY_ENCOUNTER,o),setTimeout(()=>{this.setCursor(this.viewPartyIndex),this.unblockInput()},300)})}else this.blockInput||!this.optionsMeetsReqs[n]&&(r.optionMode===ls.DISABLED_OR_DEFAULT||r.optionMode===ls.DISABLED_OR_SPECIAL)?i=!1:s.phaseManager.getCurrentPhase().handleOptionSelect(r,n)?i=!0:t.playError()}}else{switch((a=this.optionsContainer.getAll())==null?void 0:a.length){default:case 3:i=this.handleTwoOptionMoveInput(e);break;case 4:i=this.handleThreeOptionMoveInput(e);break;case 5:i=this.handleFourOptionMoveInput(e);break}this.displayOptionTooltip()}return i&&t.playSelect(),i}handleTwoOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case I.UP:i<this.viewPartyIndex&&(t=this.setCursor(this.viewPartyIndex));break;case I.DOWN:i===this.viewPartyIndex&&(t=this.setCursor(1));break;case I.LEFT:i>0&&(t=this.setCursor(i-1));break;case I.RIGHT:i<this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}handleThreeOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case I.UP:i===2?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case I.DOWN:i===this.viewPartyIndex?t=this.setCursor(1):t=this.setCursor(2);break;case I.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i===1&&(t=this.setCursor(i-1));break;case I.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i<1&&(t=this.setCursor(i+1));break}return t}handleFourOptionMoveInput(e){let t=!1;const i=this.getCursor();switch(e){case I.UP:i>=2&&i!==this.viewPartyIndex?t=this.setCursor(i-2):t=this.setCursor(this.viewPartyIndex);break;case I.DOWN:i<=1?t=this.setCursor(i+2):i===this.viewPartyIndex&&(t=this.setCursor(1));break;case I.LEFT:i===this.viewPartyIndex?t=this.setCursor(1):i%2===1&&(t=this.setCursor(i-1));break;case I.RIGHT:i===1?t=this.setCursor(this.viewPartyIndex):i%2===0&&i!==this.viewPartyIndex&&(t=this.setCursor(i+1));break}return t}unblockInput(){if(this.blockInput){this.blockInput=!1;for(let e=0;e<this.optionsContainer.length-1;e++){const t=this.encounterOptions[e].optionMode;!this.optionsMeetsReqs[e]&&(t===ls.DISABLED_OR_DEFAULT||t===ls.DISABLED_OR_SPECIAL)||this.optionsContainer.getAt(e).setAlpha(1)}}}getCursor(){return this.cursor?this.cursor:0}setCursor(e){var n,a,r,o;const i=this.getCursor()!==e;return i&&(this.cursor=e),this.viewPartyIndex=((n=this.optionsContainer.getAll())==null?void 0:n.length)-1,this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorContainer.add(this.cursorObj)),e===this.viewPartyIndex?this.cursorObj.setPosition(this.viewPartyXPosition,-17):((a=this.optionsContainer.getAll())==null?void 0:a.length)===3?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),15):((r=this.optionsContainer.getAll())==null?void 0:r.length)===4?this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)):((o=this.optionsContainer.getAll())==null?void 0:o.length)===5&&this.cursorObj.setPosition(-10.5+(e%2===1?100:0),7+(e>1?16:0)),i}displayEncounterOptions(e=!0){var m,C,b,S;this.getUi().clearText();const t=s.currentBattle.mysteryEncounter;this.encounterOptions=((m=this.overrideSettings)==null?void 0:m.overrideOptions)??t.options,this.optionsMeetsReqs=[];const i=Gt((C=t.dialogue.encounterOptionsDialogue)==null?void 0:C.title,O.TOOLTIP_TITLE),n=Gt((b=t.dialogue.encounterOptionsDialogue)==null?void 0:b.description,O.TOOLTIP_CONTENT),a=Gt((S=t.dialogue.encounterOptionsDialogue)==null?void 0:S.query,O.TOOLTIP_CONTENT);this.optionsContainer.removeAll(!0);for(let x=0;x<this.encounterOptions.length;x++){const A=this.encounterOptions[x];let w;switch(this.encounterOptions.length){default:case 2:w=pt(x%2===0?0:100,8,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 3:w=pt(x%2===0?0:100,x<2?0:16,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break;case 4:w=pt(x%2===0?0:100,x<2?0:16,"-",O.WINDOW,{fontSize:"80px",lineSpacing:-8});break}this.optionsMeetsReqs.push(A.meetsRequirements());const k=A.dialogue,B=!this.optionsMeetsReqs[x]&&k.disabledButtonLabel?k.disabledButtonLabel:k.buttonLabel;let X;A.hasRequirements()&&this.optionsMeetsReqs[x]&&(A.optionMode===ls.DEFAULT_OR_SPECIAL||A.optionMode===ls.DISABLED_OR_SPECIAL)?X=Gt(B,O.ME_OPTION_SPECIAL):X=Gt(B,k.style?k.style:O.ME_OPTION_DEFAULT),X&&w.setText(X),!this.optionsMeetsReqs[x]&&(A.optionMode===ls.DISABLED_OR_DEFAULT||A.optionMode===ls.DISABLED_OR_SPECIAL)&&w.setAlpha(.5),this.blockInput&&w.setAlpha(.5);const L=90,Q=s.make.graphics({});Q.setScale(6),Q.fillStyle(16777215),Q.beginPath(),Q.fillRect(w.x+11,w.y+140,L,18);const te=Q.createGeometryMask();w.setMask(te);const P=w.displayWidth,H=this.optionScrollTweens[x];H&&(H.remove(),this.optionScrollTweens[x]=null),P>L&&(this.optionScrollTweens[x]=s.tweens.add({targets:w,delay:de(2e3),loop:-1,hold:de(2e3),duration:de((P-L)/15*2e3),x:`-=${P-L}`})),this.optionsContainer.add(w)}const r=pt(s.game.canvas.width/6,-24,er(g.t("mysteryEncounterMessages:view_party_button"),O.PARTY),O.PARTY);this.optionsContainer.add(r),r.x-=r.displayWidth+16,this.viewPartyXPosition=r.x-10;const o=pt(0,0,i??"",O.TOOLTIP_TITLE,{wordWrap:{width:750},align:"center",lineSpacing:-8});this.descriptionContainer.add(o),o.setPosition(72-o.displayWidth/2,5.5);const l=t.encounterTier===ct.COMMON?0:t.encounterTier===ct.GREAT?1:t.encounterTier===ct.ULTRA?2:t.encounterTier===ct.ROGUE?3:4,h=mi(l);this.rarityBall.setTexture("pb",h);const c=pt(6,25,n??"",O.TOOLTIP_CONTENT,{wordWrap:{width:830}}),d=s.make.graphics({});d.setScale(6),d.fillStyle(16777215),d.beginPath(),d.fillRect(6,53,206,57);const f=d.createGeometryMask();c.setMask(f);const p=Math.floor(c.displayHeight/10);this.descriptionScrollTween&&(this.descriptionScrollTween.remove(),this.descriptionScrollTween=void 0),p>6&&(this.descriptionScrollTween=s.tweens.add({targets:c,delay:de(2e3),loop:-1,hold:de(2e3),duration:de((p-6)*2e3),y:`-=${10*(p-6)}`})),this.descriptionContainer.add(c);const T=pt(0,0,a??"",O.TOOLTIP_CONTENT,{wordWrap:{width:830}});this.descriptionContainer.add(T),T.setPosition(75-T.displayWidth/2,90),e&&(this.descriptionContainer.x-=150,s.tweens.add({targets:this.descriptionContainer,x:"+=150",ease:"Sine.easeInOut",duration:1e3}))}displayOptionTooltip(){const e=this.getCursor();if(this.tooltipContainer.length>1&&this.tooltipContainer.removeBetween(1,this.tooltipContainer.length,!0),this.tooltipContainer.setVisible(!0),Ee(e)||e>this.optionsContainer.length-2){this.showHideDexProgress(!1);return}let t;const i=this.encounterOptions[e],n=i.dialogue;if(!this.optionsMeetsReqs[e]&&(i.optionMode===ls.DISABLED_OR_DEFAULT||i.optionMode===ls.DISABLED_OR_SPECIAL)&&n.disabledButtonTooltip?t=Gt(n.disabledButtonTooltip,O.TOOLTIP_CONTENT):t=Gt(n.buttonTooltip,O.TOOLTIP_CONTENT),t){const a=[...t.match(new RegExp(/\[color=[^\[]*\]\[shadow=[^\[]*\]/i))][0];t=t.replace(/(\(\+\)[^\(\[]*)/gi,r=>"[/color][/shadow]"+er(r,O.SUMMARY_GREEN)+"[/color][/shadow]"+a),t=t.replace(/(\(\-\)[^\(\[]*)/gi,r=>"[/color][/shadow]"+er(r,O.SUMMARY_BLUE)+"[/color][/shadow]"+a)}if(t){const a=pt(6,7,t,O.TOOLTIP_CONTENT,{wordWrap:{width:600},fontSize:"72px"});this.tooltipContainer.add(a);const r=s.make.graphics({});r.setScale(6),r.fillStyle(16777215),r.beginPath(),r.fillRect(this.tooltipContainer.x,this.tooltipContainer.y+188.5,150,32);const o=r.createGeometryMask();a.setMask(o);const l=Math.floor(a.displayHeight/11.2);this.tooltipScrollTween&&(this.tooltipScrollTween.remove(),this.tooltipScrollTween=void 0),l>3&&(this.tooltipScrollTween=s.tweens.add({targets:a,delay:de(1200),loop:-1,hold:de(1200),duration:de((l-3)*1200),y:`-=${11.2*(l-3)}`}))}i.hasDexProgress&&!this.showDexProgress?this.showHideDexProgress(!0):i.hasDexProgress||this.showHideDexProgress(!1)}clear(){super.clear(),this.overrideSettings=void 0,this.optionsContainer.setVisible(!1),this.optionsContainer.removeAll(!0),this.dexProgressContainer.setVisible(!1),this.descriptionContainer.setVisible(!1),this.tooltipContainer.setVisible(!1),this.descriptionContainer.removeBetween(2,this.descriptionContainer.length,!0),this.getUi().getMessageHandler().clearText(),this.eraseCursor()}eraseCursor(){this.cursorObj&&this.cursorObj.destroy(),this.cursorObj=void 0}showHideDexProgress(e){e&&!this.showDexProgress?(this.showDexProgress=!0,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-63,ease:"Sine.easeInOut",duration:750,onComplete:u(()=>{this.dexProgressContainer.on("pointerover",()=>{s.ui.showTooltip("",g.t("mysteryEncounterMessages:affects_pokedex"),!0)}),this.dexProgressContainer.on("pointerout",()=>{s.ui.hideTooltip()})},"onComplete")})):!e&&this.showDexProgress&&(this.showDexProgress=!1,s.tweens.killTweensOf(this.dexProgressContainer),s.tweens.add({targets:this.dexProgressContainer,y:-43,ease:"Sine.easeInOut",duration:750,onComplete:u(()=>{this.dexProgressContainer.off("pointerover"),this.dexProgressContainer.off("pointerout")},"onComplete")}))}};u(Hc,"MysteryEncounterUiHandler");let Eo=Hc;const Yc=class Yc extends Fs{setup(){super.setup(),this.nameKeys=Xe.map(e=>e.name).filter((e,t,i)=>i.indexOf(e)===t),this.moveKeys=Ne.map(e=>e.name),this.abilityKeys=gt.map(e=>e.name)}getModalTitle(e){return g.t("pokedexUiHandler:scanChooseOption")}getWidth(e){return 300}getMargin(e){return[0,0,48,0]}getButtonLabels(e){return[g.t("pokedexUiHandler:scanSelect"),g.t("pokedexUiHandler:scanCancel")]}getReadableErrorMessage(e){const t=e==null?void 0:e.indexOf(":");return t>0&&(e=e.slice(0,t)),super.getReadableErrorMessage(e)}getInputFieldConfigs(){switch(this.row){case nt.NAME:return[{label:g.t("pokedexUiHandler:scanLabelName")}];case nt.MOVE_1:case nt.MOVE_2:return[{label:g.t("pokedexUiHandler:scanLabelMove")}];case nt.ABILITY_1:return[{label:g.t("pokedexUiHandler:scanLabelAbility")}];case nt.ABILITY_2:return[{label:g.t("pokedexUiHandler:scanLabelPassive")}];default:return[{label:""}]}}reduceKeys(){switch(this.row){case nt.NAME:{this.reducedKeys=this.nameKeys;break}case nt.MOVE_1:case nt.MOVE_2:{this.reducedKeys=this.moveKeys;break}case nt.ABILITY_1:case nt.ABILITY_2:{this.reducedKeys=this.abilityKeys;break}default:this.reducedKeys=this.keys}}show(e){this.row=e[2];const t=this.getUi(),i=!!this.getModalTitle();this.updateFields(this.getInputFieldConfigs(),i),this.updateContainer(e[0]);const n=this.inputs[0];if(n.setMaxLength(255),this.reduceKeys(),setTimeout(()=>{n.setFocus()},50),n.on("keydown",(a,r)=>{["escape","space"].some(o=>o===r.key.toLowerCase()||o===r.code.toLowerCase())&&t.getMode()===_.AUTO_COMPLETE&&(a.on("blur",()=>a.node.focus(),{once:!0}),t.revertMode())}),n.on("textchange",(a,r)=>{t.getMode()===_.AUTO_COMPLETE&&t.revertMode();let o=[];const l=this.reducedKeys.filter(h=>h.toLowerCase().includes(a.text.toLowerCase()));if(a.text!==""&&l.length>0&&(o=l.slice(0).map(h=>({label:h,handler:u(()=>{var c;return(!Ee(r.data)||((c=r.inputType)==null?void 0:c.toLowerCase())==="deletecontentbackward")&&a.setText(h),t.revertMode(),!0},"handler")}))),o.length>0){const h={options:o,maxOptions:5,modalContainer:this.modalContainer};t.setOverlayMode(_.AUTO_COMPLETE,h)}}),super.show(e)){const a=e[0];return this.inputs[0].resize(1150,116),this.inputContainers[0].list[0].width=200,e[1]&&typeof e[1].getNameToRender=="function"?this.inputs[0].text=e[1].getNameToRender():this.inputs[0].text=e[1],this.submitAction=r=>{if(t.getMode()===_.POKEDEX_SCAN){this.sanitizeInputs();const o=this.reducedKeys.includes(this.inputs[0].text)?this.inputs[0].text:"",l=btoa(unescape(encodeURIComponent(o)));return a.buttonActions[0](l),!0}return!1},!0}return!1}clear(){super.clear(),this.formLabels.forEach(e=>{e.destroy()})}};u(Yc,"PokedexScanUiHandler");let Io=Yc;const Er=48,Yt=8,Kn=6,Ya=class Ya extends Phaser.GameObjects.Container{constructor(e){super(s,e==null?void 0:e.x,e==null?void 0:e.y),this.active=!1,this.descScroll=null,this.scale=(e==null?void 0:e.scale)||1,this.setScale(this.scale),this.options=e||{},this.width=((e==null?void 0:e.width)||Ya.getWidth(this.scale))/this.scale,this.descBg=me(0,0,this.width,Er),this.descBg.setOrigin(0,0),this.add(this.descBg),this.desc=D(Yt,Yt-2,"",O.BATTLE_INFO,{wordWrap:{width:(this.width-(Yt-2)*2)*Kn}}),this.desc.setLineSpacing(g.resolvedLanguage==="ja"?25:5),this.maskPointOriginX=(e==null?void 0:e.x)||0,this.maskPointOriginY=(e==null?void 0:e.y)||0,this.maskPointOriginX<0&&(this.maskPointOriginX+=s.game.canvas.width/Kn),this.maskPointOriginY<0&&(this.maskPointOriginY+=s.game.canvas.height/Kn),this.textMaskRect=s.make.graphics(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Yt*this.scale,this.maskPointOriginY+(Yt-2)*this.scale,this.width-Yt*2*this.scale,(Er-(Yt-2)*2)*this.scale),this.textMaskRect.setScale(6);const t=this.createGeometryMask(this.textMaskRect);this.add(this.desc),this.desc.setMask(t),e!=null&&e.hideBg&&this.descBg.setVisible(!1),this.setVisible(!1)}show(e){if(!s.enableMoveInfo)return!1;this.desc.setText(e??""),this.descScroll&&(this.descScroll.remove(),this.descScroll=null,this.desc.y=Yt-2);const t=Math.floor(this.desc.displayHeight*(96/72)/14.83),i=t>=3?48:t===2?36:24;this.textMaskRect.clear(),this.textMaskRect.fillStyle(16711680),this.textMaskRect.fillRect(this.maskPointOriginX+Yt*this.scale,this.maskPointOriginY+(Yt-2)*this.scale+(48-i),this.width-Yt*2*this.scale,(i-(Yt-2)*2)*this.scale);const n=this.createGeometryMask(this.textMaskRect);return this.desc.setMask(n),this.descBg.setSize(this.descBg.width,i),this.descBg.setY(48-i),this.desc.setY(Yt-2+(48-i)),t>3&&(this.descScroll=s.tweens.add({targets:this.desc,delay:de(2e3),loop:-1,hold:de(2e3),duration:de((t-3)*2e3),y:`-=${14.83*(72/96)*(t-3)}`})),this.options.delayVisibility||this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.desc,duration:de(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return s.game.canvas.width/Kn/2}static getHeight(e,t){return Er*e}};u(Ya,"PokedexInfoOverlay");let Aa=Ya;const jp=120,Ms=8,lC=6,hC=["HP","ATK","DEF","SPATK","SPDEF","SPD"],Wa=class Wa extends Phaser.GameObjects.Container{constructor(e){super(s,e==null?void 0:e.x,e==null?void 0:e.y),this.active=!1,this.statsLabels=[],this.statsRectangles=[],this.statsShadows=[],this.scale=(e==null?void 0:e.scale)||1,this.setScale(this.scale),this.width=((e==null?void 0:e.width)||Wa.getWidth(this.scale))/this.scale,this.statsBg=me(0,0,this.width,jp),this.statsBg.setOrigin(0,0),this.add(this.statsBg);for(let t=0;t<6;t++){const i=s.add.rectangle(this.width-Ms+1,Ms+3+t*15,100,5,26720);i.setOrigin(1,0),this.statsShadows.push(i),this.add(i);const n=s.add.rectangle(this.width-Ms,Ms+2+t*15,100,5,6728345);n.setOrigin(1,0),this.statsRectangles.push(n),this.add(n);const a=D(Ms,Ms-2+t*15,"A",O.BATTLE_INFO);this.statsLabels.push(a),this.add(a)}this.statsTotalLabel=D(Ms,Ms+6*15,"A",O.MONEY_WINDOW),this.add(this.statsTotalLabel),this.setVisible(!1)}show(e,t){for(let i=0;i<6;i++)this.statsLabels[i].setText(g.t(`pokemonInfo:Stat.${hC[i]}shortened`)+`: ${e[i]}`),this.statsShadows[i].setSize(e[i]/2,5),this.statsRectangles[i].setSize(e[i]/2,5);return this.statsTotalLabel.setText(g.t("pokedexUiHandler:baseTotal")+`: ${t}`),this.setVisible(!0),this.active=!0,!0}clear(){this.setVisible(!1),this.active=!1}toggleInfo(e){e&&this.setVisible(!0),s.tweens.add({targets:this.statsLabels,duration:de(125),ease:"Sine.easeInOut",alpha:e?1:0}),e||this.setVisible(!1)}isActive(){return this.active}static getWidth(e){return s.game.canvas.width/lC/2}static getHeight(e,t){return jp*e}};u(Wa,"BaseStatsOverlay");let vo=Wa;const $p={en:{starterInfoTextSize:"56px",instructionTextSize:"38px"},de:{starterInfoTextSize:"48px",instructionTextSize:"35px",starterInfoXPos:33},"es-ES":{starterInfoTextSize:"56px",instructionTextSize:"35px"},fr:{starterInfoTextSize:"54px",instructionTextSize:"38px"},it:{starterInfoTextSize:"56px",instructionTextSize:"38px"},pt_BR:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoXPos:33},zh:{starterInfoTextSize:"47px",instructionTextSize:"38px",starterInfoYOffset:1,starterInfoXPos:24},pt:{starterInfoTextSize:"48px",instructionTextSize:"42px",starterInfoXPos:33},ko:{starterInfoTextSize:"52px",instructionTextSize:"38px"},ja:{starterInfoTextSize:"51px",instructionTextSize:"38px"},"ca-ES":{starterInfoTextSize:"56px",instructionTextSize:"38px"}},Xp=2,cC=109;var Ks=(y=>(y[y.BASE_STATS=0]="BASE_STATS",y[y.ABILITIES=1]="ABILITIES",y[y.LEVEL_MOVES=2]="LEVEL_MOVES",y[y.EGG_MOVES=3]="EGG_MOVES",y[y.TM_MOVES=4]="TM_MOVES",y[y.BIOMES=5]="BIOMES",y[y.NATURES=6]="NATURES",y[y.TOGGLE_IVS=7]="TOGGLE_IVS",y[y.EVOLUTIONS=8]="EVOLUTIONS",y))(Ks||{});const Wc=class Wc extends _t{constructor(){super(_.POKEDEX_PAGE),this.allSpecies=[],this.speciesLoaded=new Map,this.eggMoves=[],this.hasEggMoves=[],this.tmMoves=[],this.instructionRowX=0,this.instructionRowY=0,this.instructionRowTextOffset=9,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.blockInput=!1,this.blockInputOverlay=!1,this.showBackSprite=!1,this.scale=.1666666667,this.filteredIndices=null}setup(){const e=this.getUi(),t=g.resolvedLanguage??"en",i=Object.keys($p).find(d=>t.includes(d))??"en",n=$p[i];this.starterSelectContainer=s.add.container(0,-s.game.canvas.height/6),this.starterSelectContainer.setVisible(!1),e.add(this.starterSelectContainer);const a=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,26720);a.setOrigin(0,0),this.starterSelectContainer.add(a);const r=s.add.image(0,0,"pokedex_summary_bg");r.setOrigin(0,0),this.starterSelectContainer.add(r),this.pokemonSprite=s.add.sprite(53,63,"pkmn__sub"),this.pokemonSprite.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),this.starterSelectContainer.add(this.pokemonSprite),this.shinyOverlay=s.add.image(6,6,"summary_overlay_shiny"),this.shinyOverlay.setOrigin(0,0),this.shinyOverlay.setVisible(!1),this.starterSelectContainer.add(this.shinyOverlay),this.pokemonNumberText=D(17,1,"0000",O.SUMMARY),this.pokemonNumberText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNumberText),this.pokemonNameText=D(6,112,"",O.SUMMARY),this.pokemonNameText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonNameText),this.pokemonGrowthRateLabelText=D(8,106,g.t("pokedexUiHandler:growthRate"),O.SUMMARY_ALT,{fontSize:"36px"}),this.pokemonGrowthRateLabelText.setOrigin(0,0),this.pokemonGrowthRateLabelText.setVisible(!1),this.starterSelectContainer.add(this.pokemonGrowthRateLabelText),this.pokemonGrowthRateText=D(34,106,"",O.SUMMARY_PINK,{fontSize:"36px"}),this.pokemonGrowthRateText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGrowthRateText),this.pokemonGenderText=D(96,112,"",O.SUMMARY_ALT),this.pokemonGenderText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonGenderText),this.pokemonUncaughtText=D(6,127,g.t("pokedexUiHandler:uncaught"),O.WINDOW,{fontSize:"56px"}),this.pokemonUncaughtText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonUncaughtText);const o=s.add.container(cC+6,9);for(const d of Xe)!Re.hasOwnProperty(d.speciesId)||!d.isObtainable()||(this.speciesLoaded.set(d.speciesId,!1),this.allSpecies.push(d));this.starterSelectContainer.add(o),this.type1Icon=s.add.sprite(8,98,os("types")),this.type1Icon.setScale(.5),this.type1Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type1Icon),this.type2Icon=s.add.sprite(26,98,os("types")),this.type2Icon.setScale(.5),this.type2Icon.setOrigin(0,0),this.starterSelectContainer.add(this.type2Icon),this.pokemonLuckLabelText=D(8,89,g.t("common:luckIndicator"),O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonLuckLabelText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckLabelText),this.pokemonLuckText=D(8+this.pokemonLuckLabelText.displayWidth+2,89,"0",O.WINDOW,{fontSize:"56px"}),this.pokemonLuckText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonLuckText),this.pokemonCandyContainer=s.add.container(4.5,18),this.pokemonCandyIcon=s.add.sprite(0,0,"candy"),this.pokemonCandyIcon.setScale(.5),this.pokemonCandyIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyIcon),this.pokemonCandyOverlayIcon=s.add.sprite(0,0,"candy_overlay"),this.pokemonCandyOverlayIcon.setScale(.5),this.pokemonCandyOverlayIcon.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyOverlayIcon),this.pokemonCandyDarknessOverlay=s.add.sprite(0,0,"candy"),this.pokemonCandyDarknessOverlay.setScale(.5),this.pokemonCandyDarknessOverlay.setOrigin(0,0),this.pokemonCandyDarknessOverlay.setTint(0),this.pokemonCandyDarknessOverlay.setAlpha(.5),this.pokemonCandyContainer.add(this.pokemonCandyDarknessOverlay),this.pokemonCandyCountText=D(9.5,0,"x0",O.WINDOW_ALT,{fontSize:"56px"}),this.pokemonCandyCountText.setOrigin(0,0),this.pokemonCandyContainer.add(this.pokemonCandyCountText),this.pokemonCandyContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,30,20),Phaser.Geom.Rectangle.Contains),this.starterSelectContainer.add(this.pokemonCandyContainer),this.pokemonFormText=D(6,42,"Form",O.WINDOW_ALT,{fontSize:"42px"}),this.pokemonFormText.setOrigin(0,0),this.starterSelectContainer.add(this.pokemonFormText),this.pokemonCaughtHatchedContainer=s.add.container(2,25),this.pokemonCaughtHatchedContainer.setScale(.5),this.starterSelectContainer.add(this.pokemonCaughtHatchedContainer);const l=s.add.sprite(1,0,"items","pb");l.setOrigin(0,0),l.setScale(.75),this.pokemonCaughtHatchedContainer.add(l),this.pokemonCaughtCountText=D(24,4,"0",O.SUMMARY_ALT),this.pokemonCaughtCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonCaughtCountText),this.pokemonHatchedIcon=s.add.sprite(1,14,"egg_icons"),this.pokemonHatchedIcon.setOrigin(.15,.2),this.pokemonHatchedIcon.setScale(.8),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedIcon),this.pokemonShinyIcons=[];for(let d=0;d<3;d++){const f=s.add.sprite(153+d*13,160,"shiny_icons");f.setOrigin(.15,.2),f.setScale(1),f.setFrame(qt(d)),f.setVisible(!1),this.pokemonCaughtHatchedContainer.add(f),this.pokemonShinyIcons.push(f)}this.pokemonHatchedCountText=D(24,19,"0",O.SUMMARY_ALT),this.pokemonHatchedCountText.setOrigin(0,0),this.pokemonCaughtHatchedContainer.add(this.pokemonHatchedCountText);const h=n.instructionTextSize;this.instructionsContainer=s.add.container(4,128),this.instructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.instructionsContainer),this.candyUpgradeIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","C.png"),this.candyUpgradeIconElement.setName("sprite-candyUpgrade-icon-element"),this.candyUpgradeIconElement.setScale(.675),this.candyUpgradeIconElement.setOrigin(0,0),this.candyUpgradeLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("pokedexUiHandler:candyUpgrade"),O.PARTY,{fontSize:h}),this.candyUpgradeLabel.setName("text-candyUpgrade-label"),this.shinyIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","R.png"),this.shinyIconElement.setName("sprite-shiny-icon-element"),this.shinyIconElement.setScale(.675),this.shinyIconElement.setOrigin(0,0),this.shinyLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("pokedexUiHandler:cycleShiny"),O.PARTY,{fontSize:h}),this.shinyLabel.setName("text-shiny-label"),this.formIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","F.png"),this.formIconElement.setName("sprite-form-icon-element"),this.formIconElement.setScale(.675),this.formIconElement.setOrigin(0,0),this.formLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("pokedexUiHandler:cycleForm"),O.PARTY,{fontSize:h}),this.formLabel.setName("text-form-label"),this.genderIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","G.png"),this.genderIconElement.setName("sprite-gender-icon-element"),this.genderIconElement.setScale(.675),this.genderIconElement.setOrigin(0,0),this.genderLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("pokedexUiHandler:cycleGender"),O.PARTY,{fontSize:h}),this.genderLabel.setName("text-gender-label"),this.variantIconElement=new Phaser.GameObjects.Sprite(s,this.instructionRowX,this.instructionRowY,"keyboard","V.png"),this.variantIconElement.setName("sprite-variant-icon-element"),this.variantIconElement.setScale(.675),this.variantIconElement.setOrigin(0,0),this.variantLabel=D(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY,g.t("pokedexUiHandler:cycleVariant"),O.PARTY,{fontSize:h}),this.variantLabel.setName("text-variant-label"),this.showBackSpriteIconElement=new Phaser.GameObjects.Sprite(s,50,7,"keyboard","E.png"),this.showBackSpriteIconElement.setName("show-backSprite-icon-element"),this.showBackSpriteIconElement.setScale(.675),this.showBackSpriteIconElement.setOrigin(0,0),this.showBackSpriteLabel=D(60,7,g.t("pokedexUiHandler:showBackSprite"),O.PARTY,{fontSize:h}),this.showBackSpriteLabel.setName("show-backSprite-label"),this.starterSelectContainer.add(this.showBackSpriteIconElement),this.starterSelectContainer.add(this.showBackSpriteLabel),this.hideInstructions(),this.filterInstructionsContainer=s.add.container(50,5),this.filterInstructionsContainer.setVisible(!0),this.starterSelectContainer.add(this.filterInstructionsContainer),this.starterSelectMessageBoxContainer=s.add.container(0,s.game.canvas.height/6),this.starterSelectMessageBoxContainer.setVisible(!1),this.starterSelectContainer.add(this.starterSelectMessageBoxContainer),this.starterSelectMessageBox=me(1,-1,318,28),this.starterSelectMessageBox.setOrigin(0,1),this.starterSelectMessageBoxContainer.add(this.starterSelectMessageBox),this.message=D(8,8,"",O.WINDOW,{maxLines:2}),this.message.setOrigin(0,0),this.starterSelectMessageBoxContainer.add(this.message),this.initPromptSprite(this.starterSelectMessageBoxContainer),this.statsContainer=new nn(6,16),s.add.existing(this.statsContainer),this.statsContainer.setVisible(!1),this.starterSelectContainer.add(this.statsContainer),this.menuContainer=s.add.container(-130,0),this.menuContainer.setName("menu"),this.menuContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6),Phaser.Geom.Rectangle.Contains),this.menuContainer.setVisible(!1),this.menuOptions=Ds(Ks).map(d=>Number.parseInt(Ks[d])),this.optionSelectText=pt(0,0,this.menuOptions.map(d=>`${g.t(`pokedexUiHandler:${Ks[d]}`)}`).join(`
`),O.WINDOW,{maxLines:this.menuOptions.length,lineSpacing:12}),this.menuDescriptions=[g.t("pokedexUiHandler:showBaseStats"),g.t("pokedexUiHandler:showAbilities"),g.t("pokedexUiHandler:showLevelMoves"),g.t("pokedexUiHandler:showEggMoves"),g.t("pokedexUiHandler:showTmMoves"),g.t("pokedexUiHandler:showBiomes"),g.t("pokedexUiHandler:showNatures"),g.t("pokedexUiHandler:toggleIVs"),g.t("pokedexUiHandler:showEvolutions")],this.scale=Ai(O.WINDOW,s.uiTheme).scale,this.menuBg=me(s.game.canvas.width/6-83,0,this.optionSelectText.displayWidth+19+24*this.scale,s.game.canvas.height/6-2),this.menuBg.setOrigin(0,0),this.optionSelectText.setPosition(this.menuBg.x+10+24*this.scale,this.menuBg.y+6),this.menuContainer.add(this.menuBg),this.menuContainer.add(this.optionSelectText),e.add(this.menuContainer),this.starterSelectContainer.add(this.menuContainer),this.baseStatsOverlay=new vo({x:317,y:0,width:133}),this.menuContainer.add(this.baseStatsOverlay),this.menuContainer.bringToTop(this.baseStatsOverlay);const c=1;this.moveInfoOverlay=new Ls({scale:c,top:!0,x:1,y:s.game.canvas.height/6-Ls.getHeight(c)-29}),this.starterSelectContainer.add(this.moveInfoOverlay),this.infoOverlay=new Aa({scale:c,x:1,y:s.game.canvas.height/6-Aa.getHeight(c)-29}),this.starterSelectContainer.add(this.infoOverlay),this.starterSelectContainer.bringToTop(this.starterSelectMessageBoxContainer),this.previousSpecies=[],this.previousStarterAttributes=[]}show(e){var t;return this.canUseCandies=["TitlePhase","SelectStarterPhase","CommandPhase"].includes(((t=s.phaseManager.getCurrentPhase())==null?void 0:t.phaseName)??""),e.length>=1&&e[0]==="refresh"?!1:(this.species=e[0],this.savedStarterAttributes=e[1]??{shiny:!1,female:!0,variant:0,form:0},this.formIndex=this.savedStarterAttributes.form??0,this.filteredIndices=e[2]??null,this.starterSetup(),e[4]instanceof Function&&(this.exitCallback=e[4]),this.moveInfoOverlay.clear(),this.infoOverlay.clear(),super.show(e),this.starterSelectContainer.setVisible(!0),this.getUi().bringToTop(this.starterSelectContainer),this.starterAttributes=this.initStarterPrefs(),this.menuOptions=Ds(Ks).map(i=>Number.parseInt(Ks[i])),this.menuContainer.setVisible(!0),this.speciesStarterDexEntry=this.species?s.gameData.dexData[this.species.speciesId]:null,this.setSpecies(),this.updateInstructions(),this.optionSelectText.setText(this.getMenuText()),this.setCursor(0),!0)}getMenuText(){const e=this.isSeen(),t=!!this.isCaught(this.getStarterSpecies(this.species));return this.menuOptions.map(i=>{const n=`${g.t(`pokedexUiHandler:${Ks[i]}`)}`,a=!e||!t&&(i===7||i===6)||this.tmMoves.length<1&&i===4,r=Oe(a?O.SHADOW_TEXT:O.SETTINGS_VALUE,!1,s.uiTheme);return`[shadow=${Oe(a?O.SHADOW_TEXT:O.SETTINGS_VALUE,!0,s.uiTheme)}][color=${r}]${n}[/color][/shadow]`}).join(`
`)}starterSetup(){var m,C;this.evolutions=[],this.prevolutions=[],this.battleForms=[];const e=this.species;let t=((m=this.species)==null?void 0:m.forms.length)>0?this.species.forms[this.formIndex].formKey:"";this.isFormGender=t==="male"||t==="female",this.isFormGender&&(this.savedStarterAttributes.female===!0&&t==="male"||this.savedStarterAttributes.female===!1&&t==="female")&&(this.formIndex=(this.formIndex+1)%2,t=this.species.forms[this.formIndex].formKey);const i=this.formIndex??0;this.starterId=this.getStarterSpeciesId(this.species.speciesId);const n=Vi.hasOwnProperty(e.speciesId)?Vi[e.speciesId]:[];if(e.forms.length>0){const b=e.forms[i];this.levelMoves=i>0&&fs.hasOwnProperty(e.speciesId)&&fs[e.speciesId].hasOwnProperty(i)?fs[e.speciesId][i]:ra[e.speciesId],this.ability1=b.ability1,this.ability2=b.ability2===b.ability1?void 0:b.ability2,this.abilityHidden=b.abilityHidden===b.ability1?void 0:b.abilityHidden,this.evolutions=n.filter(S=>S.preFormKey===b.formKey||S.preFormKey===null),this.baseStats=b.baseStats,this.baseTotal=b.baseTotal}else this.levelMoves=ra[e.speciesId],this.ability1=e.ability1,this.ability2=e.ability2===e.ability1?void 0:e.ability2,this.abilityHidden=e.abilityHidden===e.ability1?void 0:e.abilityHidden,this.evolutions=n,this.baseStats=e.baseStats,this.baseTotal=e.baseTotal;this.eggMoves=wt[this.starterId]??[],this.hasEggMoves=Array.from({length:4},(b,S)=>(s.gameData.starterData[this.starterId].eggMoves&1<<S)!==0),this.tmMoves=((C=Ef[e.speciesId])==null?void 0:C.filter(b=>Array.isArray(b)?b[0]===t:!0).map(b=>Array.isArray(b)?b[1]:b).sort((b,S)=>Ne[b].name>Ne[S].name?1:-1))??[];const a=tr.hasOwnProperty(e.speciesId)?e.speciesId:tr.hasOwnProperty(this.starterId)?this.starterId:vt[this.starterId],r=tr[a];this.passive=this.formIndex in r?r[i]:r[0];const o=s.gameData.starterData[this.starterId],l=o.abilityAttr;this.hasPassive=o.passiveAttr>0;const h=l&Ze.ABILITY_1,c=l&Ze.ABILITY_2,d=l&Ze.ABILITY_HIDDEN;this.hasAbilities=[h,c,d];const f=oa[e.speciesId]??[];this.preBiomes=this.sanitizeBiomes((oa[this.starterId]??[]).filter(b=>!f.some(S=>b.biome===S.biome&&b.tier===S.tier)&&b.biome!==Te.TOWN),this.starterId),this.biomes=this.sanitizeBiomes(f,e.speciesId);const p=Zs.hasOwnProperty(e.speciesId)?Zs[e.speciesId]:[];this.battleForms=p.filter(b=>b.preFormKey===this.species.forms[this.formIndex].formKey);const T=vt.hasOwnProperty(this.species.speciesId)?Xe.find(b=>b.speciesId===vt[this.species.speciesId]):null;if(T){const b=Vi.hasOwnProperty(T.speciesId)?Vi[T.speciesId]:[];this.prevolutions=b.filter(S=>{var x,A;return S.speciesId===e.speciesId&&((S.evoFormKey===""||S.evoFormKey===null)&&(T.forms.some(w=>{var k;return w.formKey===((k=e.forms[i])==null?void 0:k.formKey)})||T.forms.length>0&&e.forms.length===0||T.forms.length===0&&(e.forms.length===0||((x=e.forms[i])==null?void 0:x.formKey)===""))||S.evoFormKey===((A=e.forms[i])==null?void 0:A.formKey))})}this.availableVariants=e.getFullUnlocksData()&V.VARIANT_3?3:1}sanitizeBiomes(e,t){return t===ge.BURMY||t===ge.WORMADAM?e.filter(i=>{const n=(()=>{switch(i.biome){case Te.BEACH:return 1;case Te.SLUM:return 2;default:return 0}})();return this.formIndex===n}):t===ge.ROTOM?e.filter(i=>{const n=(()=>{switch(i.biome){case Te.VOLCANO:return 1;case Te.SEA:return 2;case Te.ICE_CAVE:return 3;case Te.MOUNTAIN:return 4;case Te.TALL_GRASS:return 5;default:return 0}})();return this.formIndex===n}):t===ge.LYCANROC?e.filter(i=>{const n=(()=>{switch(i.tod[0]){case Zt.DAY:case Zt.DAWN:return 0;case Zt.DUSK:return 2;case Zt.NIGHT:return 1;default:return 0}})();return this.formIndex===n}):e}isCaught(e){const t=e||this.species;s.dexForDevs&&t.getFullUnlocksData();const i=s.gameData.dexData[t.speciesId];return((i==null?void 0:i.caughtAttr)??0n)&t.getFullUnlocksData()}isFormCaught(e,t){if(s.dexForDevs)return!0;const i=e||this.species,n=t!==void 0?t:this.formIndex,a=this.isCaught(i);return a&&(!i.forms.length||i.forms.length===1)?!0:(a&s.gameData.getFormAttr(n??0))>0n}isSeen(){var t;return(t=this.speciesStarterDexEntry)!=null&&t.seenAttr?!0:!!this.isCaught(this.getStarterSpecies(this.species))}initStarterPrefs(){const e=this.species?{...this.savedStarterAttributes}:null,t=this.isCaught();if(!e||!this.isSeen())return{};const i=t&V.SHINY,n=t&V.NON_SHINY;if(!i||e.shiny===void 0&&n?(e.shiny=!1,e.variant=0):(!n||e.shiny===void 0&&i)&&(e.shiny=!0,e.variant=0),this.unlockedVariants=[!!(i&&t&V.DEFAULT_VARIANT),!!(i&&t&V.VARIANT_2),!!(i&&t&V.VARIANT_3)],e.variant===void 0||Number.isNaN(e.variant)||e.variant<0)e.variant=0;else if(!this.unlockedVariants[e.variant]){let a=-1;for(let r=0;r<=e.variant&&r<this.unlockedVariants.length;r++)this.unlockedVariants[r]&&(a=r);e.variant=a!==-1?a:0}return e.female!==void 0?(e.female&&!(t&V.FEMALE)||!e.female&&!(t&V.MALE))&&(e.female=!e.female):t&V.FEMALE?e.female=!0:t&V.MALE&&(e.female=!1),e}showText(e,t,i,n,a,r,o){super.showText(e,t,i,n,a,r);const l=(e==null?void 0:e.indexOf(`
`))===-1;this.starterSelectMessageBox.setSize(318,l?28:42),o?(this.starterSelectMessageBox.setOrigin(0,0),this.starterSelectMessageBoxContainer.setY(0),this.message.setY(4)):(this.starterSelectMessageBoxContainer.setY(s.game.canvas.height/6),this.starterSelectMessageBox.setOrigin(0,1),this.message.setY(l?-22:-37)),this.starterSelectMessageBoxContainer.setVisible(!!(e!=null&&e.length))}isUpgradeIconEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===0}isUpgradeAnimationEnabled(){return s.candyUpgradeNotification!==0&&s.candyUpgradeDisplay===1}getStarterSpeciesId(e){return e===ge.PIKACHU?[0,1,8].includes(this.formIndex)?ge.PICHU:ge.PIKACHU:Re.hasOwnProperty(e)?e:wr[e]}getStarterSpecies(e){return Re.hasOwnProperty(e.speciesId)?e:Xe.find(t=>t.speciesId===wr[e.speciesId])??e}processInput(e){if(this.blockInput)return!1;const t=this.getUi();let i=!1,n=!1;const a=this.isCaught(),r=this.isFormCaught(),o=this.isSeen(),l=!!this.isCaught(this.getStarterSpecies(this.species));if(this.blockInputOverlay){if(e===I.CANCEL||e===I.ACTION)return this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText(""),!0;if(e===I.UP||e===I.DOWN)this.blockInputOverlay=!1,this.baseStatsOverlay.clear(),t.showText("");else return!1}if(e===I.SUBMIT)i=!0;else if(e===I.CANCEL)this.statsMode?(this.toggleStatsMode(!1),i=!0):this.previousSpecies.length>0?(this.blockInput=!0,t.setModeWithoutClear(_.OPTION_SELECT).then(()=>{const h=this.previousSpecies.pop(),c=this.previousStarterAttributes.pop();this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(_.POKEDEX_PAGE,h,c),i=!0}),this.blockInput=!1):(t.revertMode().then(()=>{if(this.exitCallback instanceof Function){const h=this.exitCallback;this.exitCallback=null,h()}}),i=!0);else{const h=s.gameData.starterData[this.starterId],c=this.starterAttributes;if(e===I.ACTION)switch(this.cursor){case 0:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{t.showText(g.t("pokedexUiHandler:showBaseStats"),null,()=>(this.baseStatsOverlay.show(this.baseStats,this.baseTotal),this.blockInput=!1,this.blockInputOverlay=!0,!0)),i=!0})):n=!0;break;case 2:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{t.showText(g.t("pokedexUiHandler:showLevelMoves"),null,()=>{this.moveInfoOverlay.show(Ne[this.levelMoves[0][1]]),t.setModeWithoutClear(_.OPTION_SELECT,{options:this.levelMoves.map(d=>({label:(d[0]>0?String(d[0]):"").padEnd(4," ")+Ne[d[1]].name,handler:u(()=>!1,"handler"),onHover:u(()=>{this.moveInfoOverlay.show(Ne[d[1]]),d[0]===0?this.showText(g.t("pokedexUiHandler:onlyEvolutionMove")):d[0]===-1?this.showText(g.t("pokedexUiHandler:onlyRecallMove")):d[0]<=5?this.showText(g.t("pokedexUiHandler:onStarterSelectMove")):this.showText(g.t("pokedexUiHandler:byLevelUpMove"))},"onHover")})).concat({label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 3:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{if(this.eggMoves.length===0)return t.showText(g.t("pokedexUiHandler:noEggMoves")),this.blockInput=!1,!0;t.showText(g.t("pokedexUiHandler:showEggMoves"),null,()=>{this.moveInfoOverlay.show(Ne[this.eggMoves[0]]),t.setModeWithoutClear(_.OPTION_SELECT,{options:[{label:g.t("pokedexUiHandler:common"),skip:!0,style:O.MONEY_WINDOW,handler:u(()=>!1,"handler"),onHover:u(()=>this.moveInfoOverlay.clear(),"onHover")},...this.eggMoves.slice(0,3).map((d,f)=>({label:Ne[d].name,style:this.hasEggMoves[f]?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.moveInfoOverlay.show(Ne[d]),"onHover")})),{label:g.t("pokedexUiHandler:rare"),skip:!0,style:O.MONEY_WINDOW,handler:u(()=>!1,"handler"),onHover:u(()=>this.moveInfoOverlay.clear(),"onHover")},{label:Ne[this.eggMoves[3]].name,style:this.hasEggMoves[3]?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.moveInfoOverlay.show(Ne[this.eggMoves[3]]),"onHover")},{label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>this.moveInfoOverlay.clear(),"onHover")}],supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 4:o?this.tmMoves.length<1?(t.showText(g.t("pokedexUiHandler:noTmMoves")),n=!0):(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{t.showText(g.t("pokedexUiHandler:showTmMoves"),null,()=>{this.moveInfoOverlay.show(Ne[this.tmMoves[0]]),t.setModeWithoutClear(_.OPTION_SELECT,{options:this.tmMoves.map(d=>({label:Ne[d].name,handler:u(()=>!1,"handler"),onHover:u(()=>{this.moveInfoOverlay.show(Ne[d])},"onHover")})).concat({label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>{this.moveInfoOverlay.clear()},"onHover")}),supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 1:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{t.showText(g.t("pokedexUiHandler:showAbilities"),null,()=>{this.infoOverlay.show(gt[this.ability1].description);const d=[];if(this.ability1&&d.push({label:gt[this.ability1].name,style:this.hasAbilities[0]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.show(gt[this.ability1].description),"onHover")}),this.ability2){const f=gt[this.ability2];d.push({label:f==null?void 0:f.name,style:this.hasAbilities[1]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.show(f==null?void 0:f.description),"onHover")})}if(this.abilityHidden){d.push({label:g.t("pokedexUiHandler:hidden"),skip:!0,style:O.MONEY_WINDOW,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.clear(),"onHover")});const f=gt[this.abilityHidden];d.push({label:gt[this.abilityHidden].name,style:this.hasAbilities[2]>0?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.show(f==null?void 0:f.description),"onHover")})}this.passive&&(d.push({label:g.t("pokedexUiHandler:passive"),skip:!0,style:O.MONEY_WINDOW,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.clear(),"onHover")}),d.push({label:gt[this.passive].name,style:this.hasPassive?O.SETTINGS_VALUE:O.SHADOW_TEXT,handler:u(()=>!1,"handler"),onHover:u(()=>this.infoOverlay.show(gt[this.passive].description),"onHover")})),d.push({label:g.t("menu:cancel"),handler:u(()=>(this.infoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>this.infoOverlay.clear(),"onHover")}),t.setModeWithoutClear(_.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 5:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{var f,p;if((!this.biomes||((f=this.biomes)==null?void 0:f.length)===0)&&(!this.preBiomes||((p=this.preBiomes)==null?void 0:p.length)===0))return t.showText(g.t("pokedexUiHandler:noBiomes")),t.playError(),this.blockInput=!1,!0;const d=[];t.showText(g.t("pokedexUiHandler:showBiomes"),null,()=>{this.biomes.map(T=>{d.push({label:g.t(`biome:${Te[T.biome].toUpperCase()}`)+" - "+g.t(`biome:${fp[T.tier].toUpperCase()}`)+(T.tod.length===1&&T.tod[0]===-1?"":" ("+T.tod.map(m=>g.t(`biome:${Zt[m].toUpperCase()}`)).join(", ")+")"),handler:u(()=>!1,"handler")})}),this.preBiomes.length>0&&(d.push({label:g.t("pokedexUiHandler:preBiomes"),skip:!0,handler:u(()=>!1,"handler")}),this.preBiomes.map(T=>{d.push({label:g.t(`biome:${Te[T.biome].toUpperCase()}`)+" - "+g.t(`biome:${fp[T.tier].toUpperCase()}`)+(T.tod.length===1&&T.tod[0]===-1?"":" ("+T.tod.map(m=>g.t(`biome:${Zt[m].toUpperCase()}`)).join(", ")+")"),handler:u(()=>!1,"handler")})})),d.push({label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(_.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 8:o?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{var f,p,T;const d=[];if((!this.prevolutions||((f=this.prevolutions)==null?void 0:f.length)===0)&&(!this.evolutions||((p=this.evolutions)==null?void 0:p.length)===0)&&(!this.battleForms||((T=this.battleForms)==null?void 0:T.length)===0))return t.showText(g.t("pokedexUiHandler:noEvolutions")),t.playError(),this.blockInput=!1,!0;t.showText(g.t("pokedexUiHandler:showEvolutions"),null,()=>{var m;((m=this.prevolutions)==null?void 0:m.length)>0&&(d.push({label:g.t("pokedexUiHandler:prevolutions"),style:O.MONEY_WINDOW,skip:!0,handler:u(()=>!1,"handler")}),this.prevolutions.map(C=>{var A;const b=Xe.find(w=>w.speciesId===vt[this.species.speciesId]),S=((A=b==null?void 0:b.forms.find(w=>w.formKey===C.preFormKey))==null?void 0:A.formIndex)??0,x=C.description;d.push({label:C.preFormKey?(b??this.species).getFormNameToDisplay(S,!0):(b??this.species).getExpandedSpeciesName(),handler:u(()=>{this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const w=Xe.find(L=>L.speciesId===vt[C.speciesId]),k=C.preFormKey?C.preFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",B=w==null?void 0:w.forms.find(L=>L.formKey===k),X=B?B.formIndex:0;return this.starterAttributes.form=X,this.savedStarterAttributes.form=X,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,w,this.savedStarterAttributes),!0},"handler"),onHover:u(()=>this.showText(x),"onHover")})})),this.evolutions.length>0&&(d.push({label:g.t("pokedexUiHandler:evolutions"),style:O.MONEY_WINDOW,skip:!0,handler:u(()=>!1,"handler")}),this.evolutions.map(C=>{const b=Xe.find(X=>X.speciesId===C.speciesId),S=!!this.isCaught(b),x=C.evoFormKey?C.evoFormKey:this.species.forms.length>0?this.species.forms[this.formIndex].formKey:"",A=b==null?void 0:b.forms.find(X=>X.formKey===x),w=A?A.formIndex:0,k=this.isFormCaught(b,w),B=C.description;d.push({label:C.evoFormKey?(b??this.species).getFormNameToDisplay(w,!0):(b??this.species).getExpandedSpeciesName(),style:S&&k?O.WINDOW:O.SHADOW_TEXT,handler:u(()=>(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}),this.starterAttributes.form=w,this.savedStarterAttributes.form=w,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,b,this.savedStarterAttributes),!0),"handler"),onHover:u(()=>this.showText(B),"onHover")})})),this.battleForms.length>0&&(d.push({label:g.t("pokedexUiHandler:forms"),style:O.MONEY_WINDOW,skip:!0,handler:u(()=>!1,"handler")}),this.battleForms.map(C=>{var k;const b=(k=this.species)==null?void 0:k.forms.find(B=>B.formKey===C.formKey),S=b?b.formIndex:0;let x="";C.trigger?x=C.trigger.description:x="";let A=this.species.getFormNameToDisplay(S);A===""&&(A=this.species.name);const w=this.isFormCaught(this.species,S);x&&d.push({label:A,style:w?O.WINDOW:O.SHADOW_TEXT,handler:u(()=>{var L;this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes});const B=this.species,X=(L=this.species.forms.find(Q=>Q.formKey===C.formKey))==null?void 0:L.formIndex;return this.starterAttributes.form=X,this.savedStarterAttributes.form=X,this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,B,this.savedStarterAttributes,this.filteredIndices),!0},"handler"),onHover:u(()=>this.showText(x),"onHover")})})),d.push({label:g.t("menu:cancel"),handler:u(()=>(this.moveInfoOverlay.clear(),this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler"),onHover:u(()=>this.moveInfoOverlay.clear(),"onHover")}),t.setModeWithoutClear(_.OPTION_SELECT,{options:d,supportHover:!0,maxOptions:8,yOffset:19}),this.blockInput=!1})}),i=!0):n=!0;break;case 7:l?(this.toggleStatsMode(),t.setMode(_.POKEDEX_PAGE,"refresh"),i=!0):n=!0;break;case 6:l?(this.blockInput=!0,t.setMode(_.POKEDEX_PAGE,"refresh").then(()=>{t.showText(g.t("pokedexUiHandler:showNature"),null,()=>{var f;const d=s.gameData.getNaturesForAttr((f=this.speciesStarterDexEntry)==null?void 0:f.natureAttr);t.setModeWithoutClear(_.OPTION_SELECT,{options:d.map((p,T)=>({label:Ti(p,!0,!0,!0,s.uiTheme),handler:u(()=>!1,"handler")})).concat({label:g.t("menu:cancel"),handler:u(()=>(this.clearText(),t.setMode(_.POKEDEX_PAGE,"refresh"),this.blockInput=!1,!0),"handler")}),maxOptions:8,yOffset:19})})}),i=!0):n=!0;break}else{const d=s.gameData.getSpeciesDexAttrProps(this.species,this.getCurrentDexProps(this.species.speciesId));switch(e){case I.CYCLE_SHINY:if(this.canCycleShiny)if(c.shiny){let f=d.variant;do if(f=(f+1)%3,f===0){if(this.isCaught()&V.DEFAULT_VARIANT)break}else if(f===1){if(this.isCaught()&V.VARIANT_2)break}else if(this.isCaught()&V.VARIANT_3)break;while(f!==d.variant);c.variant=f,this.savedStarterAttributes.variant=c.variant,this.isCaught()&V.NON_SHINY&&f<=d.variant?(this.setSpeciesDetails(this.species,{shiny:!1,variant:0}),i=!0,c.shiny=!1,this.savedStarterAttributes.shiny=c.shiny):(this.setSpeciesDetails(this.species,{variant:f}),i=!0)}else{const f=c.variant?c.variant:0;this.setSpeciesDetails(this.species,{shiny:!0,variant:f}),s.playSound("se/sparkle"),c.shiny=!0,this.savedStarterAttributes.shiny=c.shiny}break;case I.CYCLE_FORM:if(this.canCycleForm){const f=this.species.forms.length;let p=this.formIndex;do if(p=(p+1)%f,this.species.forms[p].isStarterSelectable||s.dexForDevs)break;while(p!==d.formIndex||this.species.forms[p].isUnobtainable);c.form=p,this.savedStarterAttributes.form=c.form,this.formIndex=p;let T=d.female;this.isFormGender&&(T=!d.female),c.female=T,this.savedStarterAttributes.female=c.female,this.starterSetup(),this.setSpeciesDetails(this.species,{formIndex:p,female:T}),i=this.setCursor(this.cursor)}break;case I.CYCLE_GENDER:if(this.canCycleGender){c.female=!d.female,this.savedStarterAttributes.female=c.female;let f=this.formIndex;this.isFormGender&&(f=this.formIndex===0?1:0),c.form=f,this.savedStarterAttributes.form=c.form,this.formIndex=f,this.starterSetup(),this.setSpeciesDetails(this.species,{female:!d.female,formIndex:f}),i=!0}break;case I.STATS:if(!a||!r||!this.canUseCandies)n=!0;else{const f=this.getUi();f.showText("");const p=[],T=h.passiveAttr,m=h.candyCount;if(!(T&yt.UNLOCKED)){const S=$i(Re[this.starterId]);p.push({label:`x${S} ${g.t("pokedexUiHandler:unlockPassive")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||m>=S?(h.passiveAttr|=yt.UNLOCKED|yt.ENABLED,ne.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=S),this.pokemonCandyCountText.setText(`x${h.candyCount}`),s.gameData.saveSystem().then(x=>{if(!x)return s.reset(!0)}),this.setSpeciesDetails(this.species),s.playSound("se/buy"),f.setMode(_.POKEDEX_PAGE,"refresh"),!0):!1,"handler"),style:this.isPassiveAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isPassiveAvailable()?ft[this.starterId]:["808080","808080"]})}const C=h.valueReduction;if(C<Xp){const S=Xi(Re[this.starterId])[C];p.push({label:`x${S} ${g.t("pokedexUiHandler:reduceCost")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||m>=S?(h.valueReduction++,ne.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=S),this.pokemonCandyCountText.setText(`x${h.candyCount}`),s.gameData.saveSystem().then(x=>{if(!x)return s.reset(!0)}),f.setMode(_.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isValueReductionAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isValueReductionAvailable()?ft[this.starterId]:["808080","808080"]})}const b=qi(Re[this.starterId]);p.push({label:`x${b} ${g.t("pokedexUiHandler:sameSpeciesEgg")}`,handler:u(()=>ne.FREE_CANDY_UPGRADE_OVERRIDE||m>=b?s.gameData.eggs.length>=99&&!ne.UNLIMITED_EGG_COUNT_OVERRIDE?(this.showText(g.t("egg:tooManyEggs"),void 0,()=>this.showText("",0,()=>this.tutorialActive=!1),2e3,!1,void 0,!0),!1):(ne.FREE_CANDY_UPGRADE_OVERRIDE||(h.candyCount-=b),this.pokemonCandyCountText.setText(`x${h.candyCount}`),new ui({scene:s,species:this.starterId,sourceType:Sf.SAME_SPECIES_EGG}).addEggToGameData(),s.gameData.saveSystem().then(x=>{if(!x)return s.reset(!0)}),f.setMode(_.POKEDEX_PAGE,"refresh"),s.playSound("se/buy"),!0):!1,"handler"),style:this.isSameSpeciesEggAvailable()?O.WINDOW:O.SHADOW_TEXT,item:"candy",itemArgs:this.isSameSpeciesEggAvailable()?ft[this.starterId]:["808080","808080"]}),p.push({label:g.t("menu:cancel"),handler:u(()=>(f.setMode(_.POKEDEX_PAGE,"refresh"),!0),"handler")}),f.setModeWithoutClear(_.OPTION_SELECT,{options:p,yOffset:47}),i=!0}break;case I.CYCLE_ABILITY:this.showBackSprite=!this.showBackSprite,this.showBackSprite?this.showBackSpriteLabel.setText(g.t("pokedexUiHandler:showFrontSprite")):this.showBackSpriteLabel.setText(g.t("pokedexUiHandler:showBackSprite")),this.setSpeciesDetails(this.species,{},!0),i=!0;break;case I.UP:this.cursor?i=this.setCursor(this.cursor-1):i=this.setCursor(this.menuOptions.length-1);break;case I.DOWN:this.cursor+1<this.menuOptions.length?i=this.setCursor(this.cursor+1):i=this.setCursor(0);break;case I.LEFT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;this.blockInput=!0,t.setModeWithoutClear(_.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const m=this.filteredIndices.findIndex(b=>b===this.species.speciesId),C=m<=0?this.filteredIndices.length-1:m-1;f=Dt(this.filteredIndices[C])}else{const m=Xe.findIndex(b=>b.speciesId===this.species.speciesId),C=m<=0?Xe.length-1:m-1;f=Xe[C]}const p=f==null?void 0:f.forms.find(m=>{var C,b;return m.formKey===((b=(C=this.species)==null?void 0:C.forms[this.formIndex])==null?void 0:b.formKey)}),T=p?p.formIndex:0;this.starterAttributes.form=T,this.savedStarterAttributes.form=T,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(_.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)}),this.blockInput=!1;break;case I.RIGHT:if(this.filteredIndices&&this.filteredIndices.length<=1)return t.playError(),this.blockInput=!1,!0;t.setModeWithoutClear(_.OPTION_SELECT).then(()=>{this.previousSpecies.length===0&&(this.previousSpecies.push(this.species),this.previousStarterAttributes.push({...this.savedStarterAttributes}));let f;if(this.filteredIndices){const m=this.filteredIndices.findIndex(b=>b===this.species.speciesId),C=m>=this.filteredIndices.length-1?0:m+1;f=Dt(this.filteredIndices[C])}else{const m=Xe.findIndex(b=>b.speciesId===this.species.speciesId),C=m>=Xe.length-1?0:m+1;f=Xe[C]}const p=f==null?void 0:f.forms.find(m=>{var C,b;return m.formKey===((b=(C=this.species)==null?void 0:C.forms[this.formIndex])==null?void 0:b.formKey)}),T=p?p.formIndex:0;this.starterAttributes.form=T,this.savedStarterAttributes.form=T,this.moveInfoOverlay.clear(),this.clearText(),t.setModeForceTransition(_.POKEDEX_PAGE,f,this.savedStarterAttributes,this.filteredIndices)});break}}}return i?t.playSelect():n&&t.playError(),i||n}updateButtonIcon(e,t,i,n){var r;let a;if(t==="touch")switch(t="keyboard",e){case re.Button_Cycle_Shiny:a="R.png";break;case re.Button_Cycle_Form:a="F.png";break;case re.Button_Cycle_Gender:a="G.png";break;case re.Button_Cycle_Ability:a="E.png";break}else a=(r=s.inputController)==null?void 0:r.getIconForLatestInputRecorded(e);i.setTexture(t,a),i.setPosition(this.instructionRowX,this.instructionRowY),n.setPosition(this.instructionRowX+this.instructionRowTextOffset,this.instructionRowY),i.setVisible(!0),n.setVisible(!0),this.instructionsContainer.add([i,n]),this.instructionRowY+=8,this.instructionRowY>=24&&(this.instructionRowY=8,this.instructionRowX+=50)}updateInstructions(){this.instructionRowX=0,this.instructionRowY=0,this.filterInstructionRowX=0,this.filterInstructionRowY=0,this.hideInstructions(),this.instructionsContainer.removeAll(),this.filterInstructionsContainer.removeAll();let e;if(s.inputMethod==="gamepad"?e=s.inputController.getConfig(s.inputController.selectedDevice[_e.GAMEPAD]).padType:e=s.inputMethod,!e)return;const t=this.isFormCaught();this.isCaught()&&(t?(this.canUseCandies&&this.updateButtonIcon(re.Button_Stats,e,this.candyUpgradeIconElement,this.candyUpgradeLabel),this.canCycleShiny&&this.updateButtonIcon(re.Button_Cycle_Shiny,e,this.shinyIconElement,this.shinyLabel),this.canCycleGender&&this.updateButtonIcon(re.Button_Cycle_Gender,e,this.genderIconElement,this.genderLabel)):this.instructionRowY+=8,this.canCycleForm&&this.updateButtonIcon(re.Button_Cycle_Form,e,this.formIconElement,this.formLabel))}setCursor(e){const t=super.setCursor(e);this.cursorObj||(this.cursorObj=s.add.image(0,0,"cursor"),this.cursorObj.setOrigin(0,0),this.menuContainer.add(this.cursorObj)),this.cursorObj.setScale(this.scale*6),this.cursorObj.setPositionRelative(this.menuBg,7,6+(18+this.cursor*96)*this.scale);const i=this.getUi();return this.isCaught()&&this.isFormCaught()||this.isSeen()?i.showText(this.menuDescriptions[e]):i.showText(""),t}getFriendship(e){let t=s.gameData.starterData[this.starterId].friendship;(!t||t===void 0)&&(t=0);const i=Th(Re[this.starterId]);return{currentFriendship:t,friendshipCap:i}}isPassiveAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=$i(Re[this.starterId])&&!(e.passiveAttr&yt.UNLOCKED)}isValueReductionAvailable(){const e=s.gameData.starterData[this.starterId];return e.candyCount>=Xi(Re[this.starterId])[e.valueReduction]&&e.valueReduction<Xp}isSameSpeciesEggAvailable(){return s.gameData.starterData[this.starterId].candyCount>=qi(Re[this.starterId])}setSpecies(){const e=this.species,t=e?{...this.starterAttributes}:null;if(!e&&s.ui.getTooltip().visible&&s.ui.hideTooltip(),this.statsMode&&(this.isCaught()?(this.statsContainer.setVisible(!0),this.showStats()):(this.statsContainer.setVisible(!1),this.statsContainer.updateIvs(null))),e&&(this.isSeen()||this.isCaught()))if(this.pokemonNumberText.setText(Is(e.speciesId,4)),this.isCaught()){const i=this.getCurrentDexProps(e.speciesId),n=s.gameData.getSpeciesDexAttrProps(e,i);t!=null&&t.variant&&!Number.isNaN(t.variant)&&n.shiny&&(n.variant=t.variant),n.form=(t==null?void 0:t.form)??n.form,n.female=(t==null?void 0:t.female)??n.female,this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.form,female:n.female,variant:n.variant??0})}else{this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!0),this.type2Icon.setVisible(!0),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const a of this.pokemonShinyIcons)a.setVisible(!1);this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1);const i=s.gameData.getSpeciesDefaultDexAttr(e,!0,!0),n=s.gameData.getSpeciesDexAttrProps(e,i);this.setSpeciesDetails(e,{shiny:n.shiny,formIndex:n.formIndex,female:n.female,variant:n.variant}),this.pokemonSprite.setTint(8421504)}else{this.pokemonNumberText.setText(e?Is(e.speciesId,4):""),this.pokemonNameText.setText(e?"???":""),this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1),this.type1Icon.setVisible(!1),this.type2Icon.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1),this.pokemonLuckText.setVisible(!1);for(const i of this.pokemonShinyIcons)i.setVisible(!1);this.pokemonUncaughtText.setVisible(!!e),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1),this.pokemonFormText.setVisible(!1),this.setSpeciesDetails(e,{shiny:!1,formIndex:0,female:!1,variant:0}),this.pokemonSprite.setTint(0)}}setSpeciesDetails(e,t={},i){var c,d,f;let{shiny:n,formIndex:a,female:r,variant:o}=t;const l=e?this.starterAttributes:null,h=(e==null?void 0:e.genderDiffs)&&!Ee(r)||!Ee(a)||!Ee(n)||!Ee(o)||i;if(this.activeTooltip==="CANDY")if(this.species&&this.pokemonCandyContainer.visible){const{currentFriendship:p,friendshipCap:T}=this.getFriendship(this.species.speciesId);s.ui.editTooltip("",`${p}/${T}`)}else s.ui.hideTooltip();if((c=e==null?void 0:e.forms)!=null&&c.find(p=>p.formKey==="female")&&(r!==void 0?a=r?1:0:a!==void 0&&(r=a===1)),e&&(n===void 0&&(n=(l==null?void 0:l.shiny)??!1),r===void 0&&(r=(l==null?void 0:l.female)??!1),o===void 0&&(o=(l==null?void 0:l.variant)??0),a===void 0&&(a=(l==null?void 0:l.form)??0)),this.pokemonSprite.setVisible(!1),this.assetLoadCancelled&&(this.assetLoadCancelled.value=!0,this.assetLoadCancelled=null),e){const p=this.isCaught(e);if(!p){const k=this.starterAttributes;(n===void 0||n!==k.shiny)&&(n=k.shiny),(a===void 0||a!==k.form)&&(a=k.form),(r===void 0||r!==k.female)&&(r=k.female),(o===void 0||o!==k.variant)&&(o=k.variant)}const T=this.isFormCaught(),m=this.isSeen();this.shinyOverlay.setVisible(n??!1),this.pokemonNumberText.setColor(this.getTextColor(n?O.SUMMARY_GOLD:O.SUMMARY,!1)),this.pokemonNumberText.setShadowColor(this.getTextColor(n?O.SUMMARY_GOLD:O.SUMMARY,!0));const C=new at(!1);if(this.assetLoadCancelled=C,h){const k=!!this.showBackSprite;e.loadAssets(r,a,n,o,!0,k).then(()=>{C.value||(this.assetLoadCancelled=null,this.speciesLoaded.set(e.speciesId,!0),this.pokemonSprite.play(e.getSpriteKey(r,a,n,o,k)),this.pokemonSprite.setPipelineData("shiny",n),this.pokemonSprite.setPipelineData("variant",o),this.pokemonSprite.setPipelineData("spriteKey",e.getSpriteKey(r,a,n,o,k)),this.pokemonSprite.setVisible(!this.statsMode))})}else this.pokemonSprite.setVisible(!this.statsMode);const b=!!(p&V.NON_SHINY),S=!!(p&V.SHINY),x=[V.DEFAULT_VARIANT,V.VARIANT_2,V.VARIANT_3].filter(k=>p&k);this.canCycleShiny=b&&S||S&&x.length>1;const A=!!(p&V.MALE),w=!!(p&V.FEMALE);if(this.canCycleGender=A&&w,this.canCycleForm=s.dexForDevs?e.forms.length>1:e.forms.filter(k=>k.isStarterSelectable).filter(k=>k).length>1,p&&e.malePercent!==null){const k=r?At.FEMALE:At.MALE;this.pokemonGenderText.setText(Ch(k)),this.pokemonGenderText.setColor(yi(k)),this.pokemonGenderText.setShadowColor(yi(k,!0))}else this.pokemonGenderText.setText("");if(T||m?this.pokemonNameText.setText(e.name):this.pokemonNameText.setText(e?"???":""),T?(this.species.loadAssets(r,a,n,o,!0).then(()=>{(this.species.forms&&this.species.forms.length>0?this.species.forms[a??this.formIndex]:this.species).cry()}),this.pokemonSprite.clearTint()):m?this.pokemonSprite.setTint(8421504):this.pokemonSprite.setTint(0),T){const k=s.gameData.getDexAttrLuck(this.isCaught());this.pokemonLuckText.setVisible(!!k),this.pokemonLuckText.setText(k.toString()),this.pokemonLuckText.setTint(dt(Math.min(k-1,2))),this.pokemonLuckLabelText.setVisible(this.pokemonLuckText.visible)}else this.pokemonLuckText.setVisible(!1),this.pokemonLuckLabelText.setVisible(!1);if(T){let k=of(Cf[e.growthRate]);const B=k.replace(" ","_");g.exists("growth:"+B)&&(k=g.t("growth:"+B)),this.pokemonGrowthRateText.setText(k),this.pokemonGrowthRateText.setColor(aa(e.growthRate)),this.pokemonGrowthRateText.setShadowColor(aa(e.growthRate,!0)),this.pokemonGrowthRateLabelText.setVisible(!0)}else this.pokemonGrowthRateText.setText(""),this.pokemonGrowthRateLabelText.setVisible(!1);if(T){const k=ft[this.starterId];this.pokemonUncaughtText.setVisible(!1),this.pokemonCaughtCountText.setText(`${(d=this.speciesStarterDexEntry)==null?void 0:d.caughtCount}`),e.speciesId===ge.MANAPHY||e.speciesId===ge.PHIONE?this.pokemonHatchedIcon.setFrame("manaphy"):this.pokemonHatchedIcon.setFrame($s(e)),this.pokemonHatchedCountText.setText(`${(f=this.speciesStarterDexEntry)==null?void 0:f.hatchedCount}`);const B=this.getCurrentDexProps(e.speciesId),L=s.gameData.getSpeciesDexAttrProps(e,B).variant;for(let Q=0;Q<3;Q++){const te=this.pokemonShinyIcons[Q];if(Q<this.availableVariants){if(!this.unlockedVariants[Q])te.setTint(0);else if(n&&Q===L){const P=dt(Q);te.setTint(P)}else te.setTint(8421504);te.setVisible(!0)}else te.setVisible(!1)}if(this.pokemonCaughtHatchedContainer.setVisible(!0),this.pokemonCaughtHatchedContainer.setY(25),this.pokemonCandyIcon.setTint(Vt(Ot(k[0]))),this.pokemonCandyOverlayIcon.setTint(Vt(Ot(k[1]))),this.pokemonCandyCountText.setText(`x${e.speciesId===ge.PIKACHU?0:s.gameData.starterData[this.starterId].candyCount}`),this.pokemonCandyContainer.setVisible(!0),vt.hasOwnProperty(e.speciesId))this.pokemonHatchedIcon.setVisible(!1),this.pokemonHatchedCountText.setVisible(!1),this.pokemonFormText.setY(36);else{this.pokemonHatchedIcon.setVisible(!0),this.pokemonHatchedCountText.setVisible(!0),this.pokemonFormText.setY(42);const{currentFriendship:Q,friendshipCap:te}=this.getFriendship(this.species.speciesId),P=16-16*(Q/te);this.pokemonCandyDarknessOverlay.setCrop(0,0,16,P),this.pokemonCandyContainer.on("pointerover",()=>{s.ui.showTooltip("",`${Q}/${te}`,!0),this.activeTooltip="CANDY"}),this.pokemonCandyContainer.on("pointerout",()=>{s.ui.hideTooltip(),this.activeTooltip=void 0})}}else{this.pokemonUncaughtText.setVisible(!0),this.pokemonCaughtHatchedContainer.setVisible(!1),this.pokemonCandyContainer.setVisible(!1);for(const k of this.pokemonShinyIcons)k.setVisible(!1)}if(T||m){const k=Rt(e.speciesId,a);this.setTypeIcons(k.type1,k.type2),If.includes(e.speciesId)&&!a?this.pokemonFormText.setText(""):this.pokemonFormText.setText(e.getFormNameToDisplay(a)),this.pokemonFormText.setVisible(!0),T||this.pokemonFormText.setY(18)}else this.setTypeIcons(null,null),this.pokemonFormText.setText(""),this.pokemonFormText.setVisible(!1)}else this.shinyOverlay.setVisible(!1),this.pokemonNumberText.setColor(this.getTextColor(O.SUMMARY)),this.pokemonNumberText.setShadowColor(this.getTextColor(O.SUMMARY,!0)),this.pokemonGenderText.setText(""),this.setTypeIcons(null,null);this.updateInstructions()}setTypeIcons(e,t){e!==null?(this.type1Icon.setVisible(!0),this.type1Icon.setFrame(ve[e].toLowerCase())):this.type1Icon.setVisible(!1),t!==null?(this.type2Icon.setVisible(!0),this.type2Icon.setFrame(ve[t].toLowerCase())):this.type2Icon.setVisible(!1)}getCurrentDexProps(e){var a,r,o,l,h,c,d;let t=0n;const i=Xe.find(f=>f.speciesId===e),n=s.gameData.dexData[e].caughtAttr&s.gameData.dexData[this.getStarterSpeciesId(e)].caughtAttr&((i==null?void 0:i.getFullUnlocksData())??0n);return(a=this.starterAttributes)!=null&&a.female||(n&V.FEMALE)>0n&&(n&V.MALE)===0n?t+=V.FEMALE:t+=V.MALE,(r=this.starterAttributes)!=null&&r.shiny||(n&V.SHINY)>0n&&((o=this.starterAttributes)==null?void 0:o.shiny)!==!1?(t+=V.SHINY,((l=this.starterAttributes)==null?void 0:l.variant)!==void 0?t+=BigInt(Math.pow(2,(h=this.starterAttributes)==null?void 0:h.variant))*V.DEFAULT_VARIANT:(n&V.VARIANT_3)>0?t+=V.VARIANT_3:(n&V.VARIANT_2)>0?t+=V.VARIANT_2:t+=V.DEFAULT_VARIANT):(t+=V.NON_SHINY,t+=V.DEFAULT_VARIANT),(c=this.starterAttributes)!=null&&c.form?t+=BigInt(Math.pow(2,(d=this.starterAttributes)==null?void 0:d.form))*V.DEFAULT_FORM:t+=s.gameData.getFormAttr(s.gameData.getFormIndex(n)),t}toggleStatsMode(e){e===void 0&&(e=!this.statsMode),e?(this.showStats(),this.statsMode=!0,this.pokemonSprite.setVisible(!1)):(this.statsMode=!1,this.statsContainer.setVisible(!1),this.pokemonSprite.setVisible(!0),this.statsContainer.updateIvs(null))}showStats(){this.speciesStarterDexEntry&&(this.statsContainer.setVisible(!0),this.statsContainer.updateIvs(this.speciesStarterDexEntry.ivs))}clearText(){this.starterSelectMessageBoxContainer.setVisible(!1),super.clearText()}hideInstructions(){this.candyUpgradeIconElement.setVisible(!1),this.candyUpgradeLabel.setVisible(!1),this.shinyIconElement.setVisible(!1),this.shinyLabel.setVisible(!1),this.formIconElement.setVisible(!1),this.formLabel.setVisible(!1),this.genderIconElement.setVisible(!1),this.genderLabel.setVisible(!1),this.variantIconElement.setVisible(!1),this.variantLabel.setVisible(!1)}clear(){super.clear(),this.cursor=-1,this.hideInstructions(),this.activeTooltip=void 0,s.ui.hideTooltip(),this.starterSelectContainer.setVisible(!1),this.blockInput=!1,this.showBackSprite=!1,this.showBackSpriteLabel.setText(g.t("pokedexUiHandler:showBackSprite")),this.statsMode&&this.toggleStatsMode(!1)}checkIconId(e,t,i,n,a,r){e.frame.name!==t.getIconId(i,n,a,r)&&(`${t.name}${e.frame.name}${i}${n}${a}${r}`,e.setTexture(t.getIconAtlasKey(n,!1,r)),e.setFrame(t.getIconId(i,n,!1,r)))}};u(Wc,"PokedexPageUiHandler");let un=Wc;const qp=[_.SAVE_SLOT,_.PARTY,_.SUMMARY,_.STARTER_SELECT,_.EVOLUTION_SCENE,_.EGG_HATCH_SCENE,_.EGG_LIST,_.EGG_GACHA,_.POKEDEX,_.POKEDEX_PAGE,_.CHALLENGE_SELECT,_.RUN_HISTORY],zn=[_.TITLE,_.CONFIRM,_.OPTION_SELECT,_.MENU,_.MENU_OPTION_SELECT,_.GAMEPAD_BINDING,_.KEYBOARD_BINDING,_.SETTINGS,_.SETTINGS_AUDIO,_.SETTINGS_DISPLAY,_.SETTINGS_GAMEPAD,_.SETTINGS_KEYBOARD,_.ACHIEVEMENTS,_.GAME_STATS,_.POKEDEX_SCAN,_.LOGIN_FORM,_.REGISTRATION_FORM,_.LOADING,_.SESSION_RELOAD,_.UNAVAILABLE,_.RENAME_POKEMON,_.TEST_DIALOGUE,_.AUTO_COMPLETE,_.ADMIN,_.MYSTERY_ENCOUNTER,_.RUN_INFO],Gc=class Gc extends Phaser.GameObjects.Container{constructor(){super(s,0,s.game.canvas.height/6),this.mode=_.MESSAGE,this.modeChain=[],this.handlers=[new Dr,new ro,new Br,new Lr,new Fr,new Hr,new Rr,new no,new Sn,new jg,new rn,new pa,new Qr,new Co,new ca,new ln,new Xr,new ln(_.MENU_OPTION_SELECT),new ga,new xa,new _a,new Ta,new co,new Oa,new po,new qr,new $g,new Zr,new Jr,new hn,new Io(_.TEST_DIALOGUE),new un,new to,new so,new io,new ho,new lo,new Gr,new fo,new go,new Ea,new So(_.TEST_DIALOGUE),new bo,new jr,new Eo]}setup(){this.setName(`ui-${_[this.mode]}`);for(const e of this.handlers)e.setup();this.overlay=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,0),this.overlay.setName("rect-ui-overlay"),this.overlay.setOrigin(0,0),s.uiContainer.add(this.overlay),this.overlay.setVisible(!1),this.setupTooltip(),this.achvBar=new Kr,this.achvBar.setup(),s.uiContainer.add(this.achvBar),this.savingIcon=new oo,this.savingIcon.setup(),s.uiContainer.add(this.savingIcon)}setupTooltip(){this.tooltipContainer=s.add.container(0,0),this.tooltipContainer.setName("tooltip"),this.tooltipContainer.setVisible(!1),this.tooltipBg=me(0,0,128,31),this.tooltipBg.setName("window-tooltip-bg"),this.tooltipBg.setOrigin(0,0),this.tooltipTitle=D(64,4,"",O.TOOLTIP_TITLE),this.tooltipTitle.setName("text-tooltip-title"),this.tooltipTitle.setOrigin(.5,0),this.tooltipContent=D(6,16,"",O.TOOLTIP_CONTENT),this.tooltipContent.setName("text-tooltip-content"),this.tooltipContent.setWordWrapWidth(850),this.tooltipContainer.add(this.tooltipBg),this.tooltipContainer.add(this.tooltipTitle),this.tooltipContainer.add(this.tooltipContent),s.uiContainer.add(this.tooltipContainer)}getHandler(){return this.handlers[this.mode]}getMessageHandler(){return this.handlers[_.MESSAGE]}processInfoButton(e){var t,i;return this.overlayActive?!1:[_.CONFIRM,_.COMMAND,_.FIGHT,_.MESSAGE,_.TARGET_SELECT].includes(this.mode)?((t=s)==null||t.processInfoButton(e),!0):((i=s)==null||i.processInfoButton(!1),!0)}processInput(e){if(this.overlayActive)return!1;const t=this.getHandler();return t instanceof gi&&t.tutorialActive?t.processTutorialInput(e):t.processInput(e)}showTextPromise(e,t=0,i=!0,n){return new Promise(a=>{this.showText(e??"",null,()=>a(),t,i,n)})}showText(e,t,i,n,a,r){const o=[],l=["#POKEMON1","#POKEMON2"];for(let h=0;h<s.getPlayerField().length;h++)o.push(s.getPlayerField()[h].getNameToRender()),e=e.split(o[h]).join(l[h]);if(a&&e.indexOf("$")>-1){const h=e.split(/\$/g).map(d=>d.trim());let c=u(()=>i&&i(),"showMessageAndCallback");for(let d=h.length-1;d>=0;d--){const f=c;h[d]=h[d].split(l[0]).join(o[0]),h[d]=h[d].split(l[1]).join(o[1]),c=u(()=>this.showText(h[d],null,f,null,!0),"showMessageAndCallback")}c()}else{const h=this.getHandler();for(let c=0;c<s.getPlayerField().length;c++)e=e.split(l[c]).join(o[c]);h instanceof _t?h.showText(e,t,i,n,a,r):this.getMessageHandler().showText(e,t,i,n,a,r)}}showDialogue(e,t,i=0,n,a,r){let o=!1,l=e;const h=s.gameData.gender??Fe.UNSET,c=Fe[h].toLowerCase();if(g.exists(e)){const f=e;if(o=!0,l=g.t(f,{context:c}),this.shouldSkipDialogue(f)){n();return}}let d=u(()=>{o&&s.gameData.saveSeenDialogue(e),n()},"showMessageAndCallback");if(l.indexOf("$")>-1){const f=l.split(/\$/g).map(p=>p.trim());for(let p=f.length-1;p>=0;p--){const T=d;d=u(()=>this.showDialogue(f[p],t,null,T),"showMessageAndCallback")}d()}else{const f=this.getHandler();f instanceof _t?f.showDialogue(l,t,i,d,a,!0,r):this.getMessageHandler().showDialogue(l,t,i,d,a,!0,r)}}shouldSkipDialogue(e){return!!(g.exists(e)&&s.skipSeenDialogues&&s.gameData.getSeenDialogues()[e]===!0)}getTooltip(){return{visible:this.tooltipContainer.visible,title:this.tooltipTitle.text,content:this.tooltipContent.text}}showTooltip(e,t,i){this.tooltipContainer.setVisible(!0),this.editTooltip(e,t),i?s.uiContainer.moveAbove(this.tooltipContainer,this):s.uiContainer.moveBelow(this.tooltipContainer,this)}editTooltip(e,t){this.tooltipTitle.setText(e||"");const i=this.tooltipContent.runWordWrap(t);this.tooltipContent.setText(i),this.tooltipContent.y=e?16:4,this.tooltipBg.width=Math.min(Math.max(this.tooltipTitle.displayWidth,this.tooltipContent.displayWidth)+12,838),this.tooltipBg.height=(e?31:19)+10.5*(i.split(`
`).length-1),this.tooltipTitle.x=this.tooltipBg.width/2}hideTooltip(){this.tooltipContainer.setVisible(!1),this.tooltipTitle.clearTint()}update(){if(this.tooltipContainer.visible){const e=s.inputMethod==="touch",t=s.game.input.activePointer.x,i=s.game.input.activePointer.y,n=this.tooltipBg.width,a=this.tooltipBg.height,r=2;let o=e?r:t/6+r,l=e?r:i/6+r;e?t<=s.game.canvas.width/2&&i<=s.game.canvas.height/2&&(o=s.game.canvas.width/6-n-r):(o+n+r>s.game.canvas.width/6&&(o=Math.max(r,t/6-n-r)),l+a+r>s.game.canvas.height/6&&(l=Math.max(r,i/6-a-r))),this.tooltipContainer.setPosition(o,l)}}clearText(){const e=this.getHandler();e instanceof _t?e.clearText():this.getMessageHandler().clearText()}setCursor(e){const t=this.getHandler().setCursor(e);return t&&this.playSelect(),t}playSelect(){s.playSound("ui/select")}playError(){s.playSound("ui/error")}fadeOut(e){return new Promise(t=>{if(this.overlayActive)return t();this.overlayActive=!0,this.overlay.setAlpha(0),this.overlay.setVisible(!0),s.tweens.add({targets:this.overlay,alpha:1,duration:e,ease:"Sine.easeOut",onComplete:u(()=>t(),"onComplete")})})}fadeIn(e){return new Promise(t=>{if(!this.overlayActive)return t();s.tweens.add({targets:this.overlay,alpha:0,duration:e,ease:"Sine.easeIn",onComplete:u(()=>{this.overlay.setVisible(!1),t()},"onComplete")}),this.overlayActive=!1})}setModeInternal(e,t,i,n,a){return new Promise(r=>{if(this.mode===e&&!i){r();return}const o=u(()=>{if(this.mode!==e){t&&this.getHandler().clear(),n&&this.mode&&!t&&(this.modeChain.push(this.mode),s.updateGameInfo()),this.mode=e;const l=document==null?void 0:document.getElementById("touchControls");l&&(l.dataset.uiMode=_[e]),this.getHandler().show(a)}r()},"doSetMode");!n&&(qp.indexOf(this.mode)>-1||qp.indexOf(e)>-1)&&zn.indexOf(this.mode)===-1&&zn.indexOf(e)===-1||n&&zn.indexOf(e)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{o(),this.fadeIn(250)})}):o()})}getMode(){return this.mode}setMode(e,...t){return this.setModeInternal(e,!0,!1,!1,t)}setModeForceTransition(e,...t){return this.setModeInternal(e,!0,!0,!1,t)}setModeWithoutClear(e,...t){return this.setModeInternal(e,!1,!1,!1,t)}setOverlayMode(e,...t){return this.setModeInternal(e,!1,!1,!0,t)}resetModeChain(){this.modeChain=[],s.updateGameInfo()}revertMode(){return new Promise(e=>{var n;if(!((n=this==null?void 0:this.modeChain)!=null&&n.length))return e(!1);const t=this.mode,i=u(()=>{this.getHandler().clear(),this.mode=this.modeChain.pop(),s.updateGameInfo();const a=document.getElementById("touchControls");a&&(a.dataset.uiMode=_[this.mode]),e(!0)},"doRevertMode");zn.indexOf(t)===-1?this.fadeOut(250).then(()=>{s.time.delayedCall(100,()=>{i(),this.fadeIn(250)})}):i()})}revertModes(){return new Promise(e=>{var t;if(!((t=this==null?void 0:this.modeChain)!=null&&t.length))return e();this.revertMode().then(i=>yh(i,this.revertModes).then(()=>e()))})}getModeChain(){return this.modeChain}getGamepadType(){return s.inputMethod==="gamepad"?s.inputController.getConfig(s.inputController.selectedDevice[_e.GAMEPAD]).padType:s.inputMethod}freeUIData(){this.handlers.forEach(e=>e.destroy()),this.handlers=[],jt.getInstance().clearNavigationMenus()}};u(Gc,"UI");let Oo=Gc;function uC(){const y=this,e=u(l=>l instanceof fg?l.value:y.gameSpeed===1?l:Math.ceil(l/=y.gameSpeed),"transformValue"),t=this.time.addEvent;this.time.addEvent=function(l){return!(l instanceof Phaser.Time.TimerEvent)&&l.delay&&(l.delay=e(l.delay)),t.apply(this,[l])};const i=this.tweens.add;this.tweens.add=function(l){return l.loopDelay&&(l.loopDelay=e(l.loopDelay)),l instanceof Phaser.Tweens.TweenChain||(l.duration&&(l.duration=e(l.duration)),l instanceof Phaser.Tweens.Tween||(l.delay&&(l.delay=e(l.delay)),l.repeatDelay&&(l.repeatDelay=e(l.repeatDelay)),l.hold&&(l.hold=e(l.hold)))),i.apply(this,[l])};const n=this.tweens.chain;this.tweens.chain=function(l){if(l.tweens)for(const h of l.tweens)h.duration&&(h.duration=e(h.duration)),h.delay&&(h.delay=e(h.delay)),h.repeatDelay&&(h.repeatDelay=e(h.repeatDelay)),h.loopDelay&&(h.loopDelay=e(h.loopDelay)),h.hold&&(h.hold=e(h.hold));return n.apply(this,[l])};const a=this.tweens.addCounter;this.tweens.addCounter=function(l){return l.duration&&(l.duration=e(l.duration)),l.delay&&(l.delay=e(l.delay)),l.repeatDelay&&(l.repeatDelay=e(l.repeatDelay)),l.loopDelay&&(l.loopDelay=e(l.loopDelay)),l.hold&&(l.hold=e(l.hold)),a.apply(this,[l])};const r=Cs.fadeOut;Cs.fadeOut=(l,h,c,d)=>r(s,h,e(c),d);const o=Cs.fadeIn;Cs.fadeIn=(l,h,c,d,f)=>o(s,h,e(c),d,f)}u(uC,"initGameSpeed");const Kc=class Kc{constructor(e,t){const i=e instanceof Qn?e:null;this.player=t,this.typeId=i?i.type.id:e.typeId,i?"getPregenArgs"in e.type&&(this.typePregenArgs=e.type.getPregenArgs()):e.typePregenArgs&&(this.typePregenArgs=e.typePregenArgs),this.args=i?i.getArgs():e.args||[],this.stackCount=e.stackCount,this.className=i?i.constructor.name:e.className}toModifier(e){const t=Xg(this.typeId);if(!t)return null;try{let i=t();i.id=this.typeId,i instanceof qg&&(i=i.generateType(this.player?s.getPlayerParty():s.getEnemyField(),this.typePregenArgs));const n=Reflect.construct(e,[i].concat(this.args).concat(this.stackCount));return n.stackCount>n.getMaxStackCount()&&(n.stackCount=n.getMaxStackCount()),n}catch(i){return console.error(i),null}}};u(Kc,"ModifierData");let qs=Kc;const zc=class zc{constructor(e){const t=e instanceof _f?e:null;this.biome=t?t.biomeType:e.biome,this.weather=t?t.weather:e.weather?new Qg(e.weather.weatherType,e.weather.turnsLeft):null,this.terrain=t?t.terrain:e.terrain?new Zg(e.terrain.terrainType,e.terrain.turnsLeft):null,this.playerTerasUsed=(t?t.playerTerasUsed:e.playerTerasUsed)??0,this.tags=[],e.tags&&(this.tags=e.tags.map(i=>Jg(i)))}};u(zc,"ArenaData");let dn=zc;const jc=class jc{constructor(e){const t=e instanceof Ji?e:null;this.trainerType=t?t.config.trainerType:e.trainerType,this.variant=e.hasOwnProperty("variant")?e.variant:e.female?Kt.FEMALE:Kt.DEFAULT,this.partyTemplateIndex=e.partyMemberTemplateIndex,this.nameKey=e.nameKey,this.partnerNameKey=e.partnerNameKey}toTrainer(){return new Ji(this.trainerType,this.variant,this.partyTemplateIndex,this.nameKey,this.partnerNameKey)}};u(jc,"TrainerData");let pn=jc;const $c=class $c{constructor(e){const t=e instanceof ui?e:null;this.id=t?t.id:e.id,this.tier=t?t.tier:e.tier??Math.floor(this.id/kr),e.species===0?this.sourceType=e.gachaType??e.sourceType:this.sourceType=t?t.sourceType:e.sourceType,this.hatchWaves=t?t.hatchWaves:e.hatchWaves,this.timestamp=t?t.timestamp:e.timestamp,this.variantTier=t?t.variantTier:e.variantTier,this.isShiny=t?t.isShiny:e.isShiny,this.species=t?t.species:e.species,this.eggMoveIndex=t?t.eggMoveIndex:e.eggMoveIndex,this.overrideHiddenAbility=t?t.overrideHiddenAbility:e.overrideHiddenAbility}toEgg(){return this.species?new ui({id:this.id,tier:this.tier,sourceType:this.sourceType,hatchWaves:this.hatchWaves,timestamp:this.timestamp,variantTier:this.variantTier,isShiny:this.isShiny,species:this.species,eggMoveIndex:this.eggMoveIndex,overrideHiddenAbility:this.overrideHiddenAbility}):new ui({id:this.id,hatchWaves:this.hatchWaves,sourceType:this.sourceType,timestamp:this.timestamp,tier:Math.floor(this.id/kr)})}};u($c,"EggData");let wa=$c;const Xc=class Xc{constructor(e){this.playTime=(e==null?void 0:e.playTime)||0,this.battles=(e==null?void 0:e.battles)||0,this.classicSessionsPlayed=(e==null?void 0:e.classicSessionsPlayed)||0,this.sessionsWon=(e==null?void 0:e.sessionsWon)||0,this.ribbonsOwned=(e==null?void 0:e.ribbonsOwned)||0,this.dailyRunSessionsPlayed=(e==null?void 0:e.dailyRunSessionsPlayed)||0,this.dailyRunSessionsWon=(e==null?void 0:e.dailyRunSessionsWon)||0,this.endlessSessionsPlayed=(e==null?void 0:e.endlessSessionsPlayed)||0,this.highestEndlessWave=(e==null?void 0:e.highestEndlessWave)||0,this.highestLevel=(e==null?void 0:e.highestLevel)||0,this.highestMoney=(e==null?void 0:e.highestMoney)||0,this.highestDamage=(e==null?void 0:e.highestDamage)||0,this.highestHeal=(e==null?void 0:e.highestHeal)||0,this.pokemonSeen=(e==null?void 0:e.pokemonSeen)||0,this.pokemonDefeated=(e==null?void 0:e.pokemonDefeated)||0,this.pokemonCaught=(e==null?void 0:e.pokemonCaught)||0,this.pokemonHatched=(e==null?void 0:e.pokemonHatched)||0,this.subLegendaryPokemonSeen=(e==null?void 0:e.subLegendaryPokemonSeen)??0,this.subLegendaryPokemonCaught=(e==null?void 0:e.subLegendaryPokemonCaught)??0,this.subLegendaryPokemonHatched=(e==null?void 0:e.subLegendaryPokemonHatched)??0,this.legendaryPokemonSeen=(e==null?void 0:e.legendaryPokemonSeen)||0,this.legendaryPokemonCaught=(e==null?void 0:e.legendaryPokemonCaught)||0,this.legendaryPokemonHatched=(e==null?void 0:e.legendaryPokemonHatched)||0,this.mythicalPokemonSeen=(e==null?void 0:e.mythicalPokemonSeen)||0,this.mythicalPokemonCaught=(e==null?void 0:e.mythicalPokemonCaught)||0,this.mythicalPokemonHatched=(e==null?void 0:e.mythicalPokemonHatched)||0,this.shinyPokemonSeen=(e==null?void 0:e.shinyPokemonSeen)||0,this.shinyPokemonCaught=(e==null?void 0:e.shinyPokemonCaught)||0,this.shinyPokemonHatched=(e==null?void 0:e.shinyPokemonHatched)||0,this.pokemonFused=(e==null?void 0:e.pokemonFused)||0,this.trainersDefeated=(e==null?void 0:e.trainersDefeated)||0,this.eggsPulled=(e==null?void 0:e.eggsPulled)||0,this.rareEggsPulled=(e==null?void 0:e.rareEggsPulled)||0,this.epicEggsPulled=(e==null?void 0:e.epicEggsPulled)||0,this.legendaryEggsPulled=(e==null?void 0:e.legendaryEggsPulled)||0,this.manaphyEggsPulled=(e==null?void 0:e.manaphyEggsPulled)||0}};u(Xc,"GameStats");let Ma=Xc;const qc=class qc{constructor(e){this.id=e.id,this.value=e.value,this.severity=e.severity}toChallenge(){return Mr(this)}};u(qc,"ChallengeData");let fn=qc;const dC=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Qp=u(y=>{if(typeof y!="string")throw new TypeError("Invalid argument expected string");const e=y.match(dC);if(!e)throw new Error(`Invalid argument not valid semver ('${y}' received)`);return e.shift(),e},"validateAndParse"),Zp=u(y=>y==="*"||y==="x"||y==="X","isWildcard"),Jp=u(y=>{const e=parseInt(y,10);return isNaN(e)?y:e},"tryParse"),pC=u((y,e)=>typeof y!=typeof e?[String(y),String(e)]:[y,e],"forceType"),fC=u((y,e)=>{if(Zp(y)||Zp(e))return 0;const[t,i]=pC(Jp(y),Jp(e));return t>i?1:t<i?-1:0},"compareStrings"),ef=u((y,e)=>{for(let t=0;t<Math.max(y.length,e.length);t++){const i=fC(y[t]||"0",e[t]||"0");if(i!==0)return i}return 0},"compareSegments"),En=u((y,e)=>{const t=Qp(y),i=Qp(e),n=t.pop(),a=i.pop(),r=ef(t,i);return r!==0?r:n&&a?ef(n.split("."),a.split(".")):n||a?n?-1:1:0},"compareVersions"),gC={version:"1.0.4",migrate:u(y=>{y.starterData&&y.dexData&&Object.keys(y.starterData).forEach(e=>{var t;(t=y.dexData[e])!=null&&t.caughtAttr&&y.starterData[e]&&!y.starterData[e].abilityAttr&&(y.starterData[e].abilityAttr=1)})},"migrate")},mC={version:"1.0.4",migrate:u(y=>{y.gameStats&&y.gameStats.legendaryPokemonCaught!==void 0&&y.gameStats.subLegendaryPokemonCaught===void 0&&(y.gameStats.subLegendaryPokemonSeen=0,y.gameStats.subLegendaryPokemonCaught=0,y.gameStats.subLegendaryPokemonHatched=0,Xe.filter(e=>e.subLegendary).forEach(e=>{const t=y.dexData[e.speciesId];y.gameStats.subLegendaryPokemonSeen+=t.seenCount,y.gameStats.legendaryPokemonSeen=Math.max(y.gameStats.legendaryPokemonSeen-t.seenCount,0),y.gameStats.subLegendaryPokemonCaught+=t.caughtCount,y.gameStats.legendaryPokemonCaught=Math.max(y.gameStats.legendaryPokemonCaught-t.caughtCount,0),y.gameStats.subLegendaryPokemonHatched+=t.hatchedCount,y.gameStats.legendaryPokemonHatched=Math.max(y.gameStats.legendaryPokemonHatched-t.hatchedCount,0)}),y.gameStats.subLegendaryPokemonSeen=Math.max(y.gameStats.subLegendaryPokemonSeen,y.gameStats.subLegendaryPokemonCaught),y.gameStats.legendaryPokemonSeen=Math.max(y.gameStats.legendaryPokemonSeen,y.gameStats.legendaryPokemonCaught),y.gameStats.mythicalPokemonSeen=Math.max(y.gameStats.mythicalPokemonSeen,y.gameStats.mythicalPokemonCaught))},"migrate")},yC={version:"1.0.4",migrate:u(y=>{var e,t;if(!Ee(y.starterData))for(const i of Ui)(e=y.starterData[i])!=null&&e.abilityAttr&&(y.starterData[i].abilityAttr|=Ze.ABILITY_1),(t=y.dexData[i])!=null&&t.caughtAttr&&(y.dexData[i].caughtAttr|=V.FEMALE)},"migrate")},TC=[gC,mC,yC],CC={version:"1.0.4",migrate:u(y=>{y.hasOwnProperty("REROLL_TARGET")&&!y.hasOwnProperty(ms.Shop_Cursor_Target)&&(y[ms.Shop_Cursor_Target]=y.REROLL_TARGET,delete y.REROLL_TARGET,localStorage.setItem("settings",JSON.stringify(y)))},"migrate")},SC=[CC],bC={version:"1.0.4",migrate:u(y=>{for(const e of y.modifiers)if(e.className==="PokemonBaseStatModifier")e.className="BaseStatModifier";else if(e.className==="PokemonResetNegativeStatStageModifier")e.className="ResetNegativeStatStageModifier";else if(e.className==="TempBattleStatBoosterModifier")if(e.typeId!=="DIRE_HIT"){e.className="TempStatStageBoosterModifier",e.typeId="TEMP_STAT_STAGE_BOOSTER";const i=e.typePregenArgs[0]+1;e.typePregenArgs[0]=i,e.args=[i,5,Math.min(e.args[1],5)]}else e.className="TempCritBoosterModifier",e.typePregenArgs=[],e.args=[5,Math.min(e.args[1],5)];else if(e.className==="DoubleBattleChanceBoosterModifier"&&e.args.length===1){let t;switch(e.typeId){case"MAX_LURE":t=30;break;case"SUPER_LURE":t=15;break;default:t=10;break}e.args=[t,Math.min(e.args[0],t)]}for(const e of y.enemyModifiers)e.className==="PokemonBaseStatModifier"?e.className="BaseStatModifier":e.className==="PokemonResetNegativeStatStageModifier"&&(e.className="ResetNegativeStatStageModifier")},"migrate")},EC={version:"1.0.4",migrate:u(y=>{for(const e of y.party)e.mysteryEncounterPokemonData&&(e.customPokemonData=new sr(e.mysteryEncounterPokemonData),e.mysteryEncounterPokemonData=null),e.fusionMysteryEncounterPokemonData&&(e.fusionCustomPokemonData=new sr(e.fusionMysteryEncounterPokemonData),e.fusionMysteryEncounterPokemonData=null),e.customPokemonData=e.customPokemonData??new sr,!Ee(e.natureOverride)&&e.natureOverride>=0&&(e.customPokemonData.nature=e.natureOverride,e.natureOverride=-1)},"migrate")},IC=[bC,EC],vC={version:"1.7.0",migrate:u(y=>{y.starterData&&y.dexData&&Object.keys(y.starterData).forEach(e=>{var a,r;const t=(a=y.dexData[e])==null?void 0:a.caughtAttr,i=Number(e);if(!i)return;const n=Dt(i);t&&((r=n.forms)==null?void 0:r.length)>1&&n.forms.filter((l,h)=>l.isStarterSelectable&&t&s.gameData.getFormAttr(h)).length===0&&(y.dexData[e].caughtAttr+=V.DEFAULT_FORM)})},"migrate")},OC=[vC],xC={version:"1.7.0",migrate:u(y=>{for(let e=0;e<y.modifiers.length;)y.modifiers[e].className==="TerastallizeModifier"?(y.party.forEach(t=>{t.id===y.modifiers[e].args[0]&&(t.teraType=y.modifiers[e].args[1])}),y.modifiers.splice(e,1)):e++;for(let e=0;e<y.enemyModifiers.length;)y.enemyModifiers[e].className==="TerastallizeModifier"?(y.enemyParty.forEach(t=>{t.id===y.enemyModifiers[e].args[0]&&(t.teraType=y.enemyModifiers[e].args[1])}),y.enemyModifiers.splice(e,1)):e++;y.party.forEach(e=>{Ee(e.teraType)&&(e.teraType=Rt(e.species,e.formIndex).type1)}),y.enemyParty.forEach(e=>{Ee(e.teraType)&&(e.teraType=Rt(e.species,e.formIndex).type1)})},"migrate")},_C=[xC],AC={version:"1.8.3",migrate:u(y=>{var e;if(y.starterData&&y.dexData){const i=(e=y.dexData[172])==null?void 0:e.caughtAttr,n=Dt(172);n.speciesId===ge.PICHU&&i&&(y.dexData[172].caughtAttr&=n.getFullUnlocksData(),y.dexData[172].caughtAttr|=V.DEFAULT_FORM)}},"migrate")},wC=[AC],MC={version:"1.9.0",migrate:u(y=>{const e=u(t=>{var i;return t.moveset=(t.moveset??[new Ss(It.TACKLE),new Ss(It.GROWL)]).filter(n=>!!n).map(n=>Ss.loadMove(n)),(i=t.summonData).moveset&&(i.moveset=t.summonData.moveset.filter(n=>!!n).map(n=>Ss.loadMove(n))),t.customPokemonData&&"hitsRecCount"in t.customPokemonData&&typeof t.customPokemonData.hitsRecCount=="number"&&(t.battleData.hitCount=t.customPokemonData.hitsRecCount,t.customPokemonData.hitsRecCount=null),t},"mapParty");y.party=y.party.map(e),y.enemyParty=y.enemyParty.map(e)},"migrate")},kC=[MC],Ah=uf,In=[];In.push(...TC);In.push(...OC);In.push(...wC);const vn=[];vn.push(...IC);vn.push(..._C);vn.push(...kC);const wh=[];wh.push(...SC);const Mh=u(y=>{y.sort((e,t)=>En(e.version,t.version))},"sortMigrators");Mh(In);Mh(vn);Mh(wh);const kh=u((y,e,t)=>{for(const i of y)En(t,i.version)===-1&&i.migrate(e)},"applyMigrators");function NC(y){const e=y.gameVersion;En(e,Ah)===-1&&kh(In,y,e)}u(NC,"applySystemVersionMigration");function PC(y){const e=y.gameVersion;En(e,Ah)===-1&&(y.money=Math.floor(y.money),kh(vn,y,e))}u(PC,"applySessionVersionMigration");function DC(y){const e=y.hasOwnProperty("gameVersion")?y.gameVersion:"1.0.0";En(e,Ah)===-1&&kh(wh,y,e)}u(DC,"applySettingsVersionMigration");const Qc=class Qc{constructor(e,t,i,n){this.type=e,this.tier=t,this.waveIndex=i,this.selectedOption=n??-1}};u(Qc,"SeenEncounterData");let xo=Qc;const Zc=class Zc{constructor(e){this.encounteredEvents=[],this.encounterSpawnChance=df,this.queuedEncounters=[],Ee(e)||Object.assign(this,e),this.encounteredEvents=this.encounteredEvents??[],this.queuedEncounters=this.queuedEncounters??[]}};u(Zc,"MysteryEncounterSaveData");let vi=Zc;function ni(y,e=0){switch(y){case Ye.SYSTEM:return"data";case Ye.SESSION:{let t="sessionData";return e&&(t+=e),t}case Ye.SETTINGS:return"settings";case Ye.TUTORIALS:return"tutorials";case Ye.SEEN_DIALOGUES:return"seenDialogues";case Ye.RUN_HISTORY:return"runHistoryData"}}u(ni,"getDataTypeKey");const jn={seenAttr:"$sa",caughtAttr:"$ca",natureAttr:"$na",seenCount:"$s",caughtCount:"$c",hatchedCount:"$hc",ivs:"$i",moveset:"$m",eggMoves:"$em",candyCount:"$x",friendship:"$f",abilityAttr:"$a",passiveAttr:"$pa",valueReduction:"$vr",classicWinCount:"$wc"},Jc=class Jc{constructor(){this.loadSettings(),this.loadGamepadSettings(),this.loadMappingConfigs(),this.trainerId=Jt(65536),this.secretId=Jt(65536),this.starterData={},this.gameStats=new Ma,this.runHistory={},this.unlocks={[Tt.ENDLESS_MODE]:!1,[Tt.MINI_BLACK_HOLE]:!1,[Tt.SPLICED_ENDLESS_MODE]:!1,[Tt.EVIOLITE]:!1},this.achvUnlocks={},this.voucherUnlocks={},this.voucherCounts={[et.REGULAR]:0,[et.PLUS]:0,[et.PREMIUM]:0,[et.GOLDEN]:0},this.eggs=[],this.eggPity=[0,0,0,0],this.unlockPity=[0,0,0,0],this.initDexData(),this.initStarterData()}getSystemSaveData(){return{trainerId:this.trainerId,secretId:this.secretId,gender:this.gender,dexData:this.dexData,starterData:this.starterData,gameStats:this.gameStats,unlocks:this.unlocks,achvUnlocks:this.achvUnlocks,voucherUnlocks:this.voucherUnlocks,voucherCounts:this.voucherCounts,eggs:this.eggs.map(e=>new wa(e)),gameVersion:s.game.config.gameVersion,timestamp:new Date().getTime(),eggPity:this.eggPity.slice(0),unlockPity:this.unlockPity.slice(0)}}isUnlocked(e){return ne.ITEM_UNLOCK_OVERRIDE.includes(e)?!0:this.unlocks[e]}saveSystem(){return new Promise(e=>{var a;s.ui.savingIcon.show();const t=this.getSystemSaveData(),i=2147483648,n=JSON.stringify(t,(r,o)=>typeof o=="bigint"?o<=i?Number(o):o.toString():o);localStorage.setItem(`data_${(a=ke)==null?void 0:a.username}`,Ws(n,Et)),qe.savedata.system.update({clientSessionId:Xt},n).then(r=>{if(s.ui.savingIcon.hide(),r)return r.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(r),e(!1);e(!0)})})}loadSystem(){return new Promise(e=>{qe.savedata.system.get({clientSessionId:Xt}).then(t=>{var n;if(typeof t=="number"||!t||t.length===0||t[0]!=="{")return t===404?(s.phaseManager.queueMessage("Save data could not be found. If this is a new account, you can safely ignore this message.",null,!0),e(!0)):(typeof t=="string"&&(t!=null&&t.includes("Too many connections"))&&s.phaseManager.queueMessage("Too many people are trying to connect and the server is overloaded. Please try again later.",null,!0),e(!1));const i=localStorage.getItem(`data_${(n=ke)==null?void 0:n.username}`);this.initSystem(t,i?Pi.AES.decrypt(i,Qa).toString(Pi.enc.Utf8):void 0).then(e)})})}initSystem(e,t){return new Promise(i=>{var n,a;try{let r=this.parseSystemData(e);if(t){const h=this.parseSystemData(t);h.timestamp>r.timestamp?(console.debug("Use cached system"),r=h,e=t):this.clearLocalData()}console.debug(r),localStorage.setItem(`data_${(n=ke)==null?void 0:n.username}`,Ws(e,Et));const o=`runHistoryData_${(a=ke)==null?void 0:a.username}`;if(localStorage.getItem(o)||localStorage.setItem(o,""),NC(r),this.trainerId=r.trainerId,this.secretId=r.secretId,this.gender=r.gender,this.saveSetting(ms.Player_Gender,r.gender===Fe.FEMALE?1:0),r.starterData)this.starterData=r.starterData;else{if(this.initStarterData(),r.starterMoveData){const c=r.starterMoveData;for(const d of Object.keys(c))this.starterData[d].moveset=c[d]}if(r.starterEggMoveData){const c=r.starterEggMoveData;for(const d of Object.keys(c))this.starterData[d].eggMoves=c[d]}this.migrateStarterAbilities(r,this.starterData);const h=Object.keys(this.starterData).map(c=>Number.parseInt(c));for(const c of h)this.starterData[c].candyCount+=r.dexData[c].caughtCount,this.starterData[c].candyCount+=r.dexData[c].hatchedCount*2,r.dexData[c].caughtAttr&V.SHINY&&(this.starterData[c].candyCount+=4)}if(r.gameStats&&(this.gameStats=r.gameStats),r.unlocks)for(const h of Object.keys(r.unlocks))this.unlocks.hasOwnProperty(h)&&(this.unlocks[h]=r.unlocks[h]);if(r.achvUnlocks)for(const h of Object.keys(r.achvUnlocks))Ae.hasOwnProperty(h)&&(this.achvUnlocks[h]=r.achvUnlocks[h]);if(r.voucherUnlocks)for(const h of Object.keys(r.voucherUnlocks))Nt.hasOwnProperty(h)&&(this.voucherUnlocks[h]=r.voucherUnlocks[h]);r.voucherCounts&&Ds(et).forEach(h=>{const c=et[h];this.voucherCounts[c]=r.voucherCounts[c]||0}),this.eggs=r.eggs?r.eggs.map(h=>h.toEgg()):[],this.eggPity=r.eggPity?r.eggPity.slice(0):[0,0,0,0],this.unlockPity=r.unlockPity?r.unlockPity.slice(0):[0,0,0,0],this.dexData=Object.assign(this.dexData,r.dexData),this.consolidateDexData(this.dexData),this.defaultDexData=null,i(!0)}catch(r){console.error(r),i(!1)}})}async getRunHistoryData(){var i,n,a,r;if(!li){const o=`runHistoryData_${(i=ke)==null?void 0:i.username}`,l=localStorage.getItem(o);if(l){const h=l;return h?JSON.parse(ei(h,Et)):{}}return localStorage.setItem(`runHistoryData_${(n=ke)==null?void 0:n.username}`,""),{}}const e=`runHistoryData_${(a=ke)==null?void 0:a.username}`,t=localStorage.getItem(e);if(t){const o=t;return o?JSON.parse(ei(o,Et)):{}}return localStorage.setItem(`runHistoryData_${(r=ke)==null?void 0:r.username}`,""),{}}async saveRunHistory(e,t){var r;const i=await this.getRunHistoryData();let n=Object.keys(i).map(Number);for(;n.length>=oC;){const o=Math.min.apply(Math,n).toString();delete i[o],n=Object.keys(i).map(Number)}const a=e.timestamp.toString();return i[a]={entry:e,isVictory:t,isFavorite:!1},localStorage.setItem(`runHistoryData_${(r=ke)==null?void 0:r.username}`,Ws(JSON.stringify(i),Et)),!0}parseSystemData(e){return JSON.parse(e,(t,i)=>{if(t==="gameStats")return new Ma(i);if(t==="eggs"){const n=[];i===null&&(i=[]);for(const a of i)n.push(new wa(a));return n}return t.endsWith("Attr")&&!["natureAttr","abilityAttr","passiveAttr"].includes(t)?BigInt(i??0):i})}convertSystemDataStr(e,t=!1){t||(e=e.replace(/\$pAttr/g,"$pa")),e=e.replace(/"trainerId":\d+/g,`"trainerId":${this.trainerId}`),e=e.replace(/"secretId":\d+/g,`"secretId":${this.secretId}`);const i=t?Object.keys(jn):Object.values(jn),n=t?Object.values(jn):Object.keys(jn);for(const a in i)e=e.replace(new RegExp(`${i[a].replace("$","\\$")}`,"g"),n[a]);return e}async verify(){const e=await qe.savedata.system.verify({clientSessionId:Xt});return e?(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase",JSON.stringify(e)),this.clearLocalData(),!1):!0}clearLocalData(){var e,t;localStorage.removeItem(`data_${(e=ke)==null?void 0:e.username}`);for(let i=0;i<5;i++)localStorage.removeItem(`sessionData${i||""}_${(t=ke)==null?void 0:t.username}`)}saveSetting(e,t){let i={};return localStorage.hasOwnProperty("settings")&&(i=JSON.parse(localStorage.getItem("settings"))),gp(e,t),i[e]=t,i.gameVersion=s.game.config.gameVersion,localStorage.setItem("settings",JSON.stringify(i)),!0}saveMappingConfigs(e,t){const i=e.toLowerCase();let n={};return localStorage.hasOwnProperty("mappingConfigs")&&(n=JSON.parse(localStorage.getItem("mappingConfigs"))),n[i]||(n[i]={}),n[i].custom=t.custom,localStorage.setItem("mappingConfigs",JSON.stringify(n)),!0}loadMappingConfigs(){if(!localStorage.hasOwnProperty("mappingConfigs"))return!1;const e=JSON.parse(localStorage.getItem("mappingConfigs"));for(const t of Object.keys(e))s.inputController.injectConfig(t,e[t]);return!0}resetMappingToFactory(){return localStorage.hasOwnProperty("mappingConfigs")?(localStorage.removeItem("mappingConfigs"),s.inputController.resetConfigs(),!0):!1}saveControlSetting(e,t,i,n,a){let r={};return localStorage.hasOwnProperty(t)&&(r=JSON.parse(localStorage.getItem(t))),e===_e.GAMEPAD?ta(i,a):e===_e.KEYBOARD&&qf(i,a),Object.keys(n).forEach(o=>{o===i&&(r[o]=a)}),localStorage.setItem(t,JSON.stringify(r)),!0}loadSettings(){if(em(),!localStorage.hasOwnProperty("settings"))return!1;const e=JSON.parse(localStorage.getItem("settings"));DC(e);for(const t of Object.keys(e))gp(t,e[t]);return!0}loadGamepadSettings(){if(Object.values(G).map(t=>t).forEach(t=>ta(t,Jf[t])),!localStorage.hasOwnProperty("settingsGamepad"))return!1;const e=JSON.parse(localStorage.getItem("settingsGamepad"));for(const t of Object.keys(e))ta(t,e[t]);return!0}saveTutorialFlag(e,t){const i=ni(Ye.TUTORIALS);let n={};return localStorage.hasOwnProperty(i)&&(n=JSON.parse(localStorage.getItem(i))),Object.keys(zt).map(a=>a).forEach(a=>{const r=zt[a];r===e?n[r]=t:n[r]??(n[r]=!1)}),localStorage.setItem(i,JSON.stringify(n)),!0}getTutorialFlags(){const e=ni(Ye.TUTORIALS),t={};if(Object.values(zt).map(n=>n).forEach(n=>t[zt[n]]=!1),!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}saveSeenDialogue(e){const t=ni(Ye.SEEN_DIALOGUES),i=this.getSeenDialogues();return i[e]=!0,localStorage.setItem(t,JSON.stringify(i)),!0}getSeenDialogues(){const e=ni(Ye.SEEN_DIALOGUES),t={};if(!localStorage.hasOwnProperty(e))return t;const i=JSON.parse(localStorage.getItem(e));for(const n of Object.keys(i))t[n]=i[n];return t}getSessionSaveData(){var e;return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(t=>new Gi(t)),enemyParty:s.getEnemyParty().map(t=>new Gi(t)),modifiers:s.findModifiers(()=>!0).map(t=>new qs(t,!0)),enemyModifiers:s.findModifiers(()=>!0,!1).map(t=>new qs(t,!1)),arena:new dn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.battleType===Ce.TRAINER?new pn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:new Date().getTime(),challenges:s.gameMode.challenges.map(t=>new fn(t)),mysteryEncounterType:((e=s.currentBattle.mysteryEncounter)==null?void 0:e.encounterType)??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}getSession(e){return new Promise(async(t,i)=>{var a,r;if(e<0)return t(null);const n=u(async o=>{try{const l=this.parseSessionData(o);t(l)}catch(l){i(l);return}},"handleSessionData");if(!localStorage.getItem(`sessionData${e||""}_${(a=ke)==null?void 0:a.username}`))qe.savedata.session.get({slot:e,clientSessionId:Xt}).then(async o=>{var l;if(!o||(o==null?void 0:o.length)===0||(o==null?void 0:o[0])!=="{")return console.error(o),t(null);localStorage.setItem(`sessionData${e||""}_${(l=ke)==null?void 0:l.username}`,Ws(o,Et)),await n(o)});else{const o=localStorage.getItem(`sessionData${e||""}_${(r=ke)==null?void 0:r.username}`);if(o)await n(ei(o,Et));else return t(null)}})}loadSession(e,t){return new Promise(async(i,n)=>{try{const a=u(async r=>{var p,T,m,C,b;console.debug(r),s.gameMode=ba(r.gameMode||fe.CLASSIC),r.challenges&&(s.gameMode.challenges=r.challenges.map(S=>S.toChallenge())),s.setSeed(r.seed||s.game.config.seed[0]),s.resetSeed(),s.seed,s.sessionPlayTime=r.playTime||0,s.lastSavePlayTime=0;const o=[],l=s.getPlayerParty();l.splice(0,l.length);for(const S of r.party){const x=S.toPokemon();x.setVisible(!1),o.push(x.loadAssets(!1)),l.push(x)}Object.keys(s.pokeballCounts).forEach(S=>{s.pokeballCounts[S]=r.pokeballCounts[S]||0}),ne.POKEBALL_OVERRIDE.active&&(s.pokeballCounts=ne.POKEBALL_OVERRIDE.pokeballs),s.money=Math.floor(r.money||0),s.updateMoneyText(),s.money>this.gameStats.highestMoney&&(this.gameStats.highestMoney=s.money),s.score=r.score,s.updateScoreText(),s.mysteryEncounterSaveData=new vi(r.mysteryEncounterSaveData),s.newArena(r.arena.biome,r.playerFaints);const h=r.battleType||0,c=r.trainer?pi[r.trainer.trainerType]:null,d=r.mysteryEncounterType!==-1?r.mysteryEncounterType:void 0,f=s.newBattle(r.waveIndex,h,r.trainer,h===Ce.TRAINER?(c==null?void 0:c.doubleOnly)||((p=r.trainer)==null?void 0:p.variant)===Kt.DOUBLE:r.enemyParty.length>1,d);if(f.enemyLevels=r.enemyParty.map(S=>S.level),s.arena.init(),r.enemyParty.forEach((S,x)=>{var w;const A=S.toPokemon(h,x,((w=r.trainer)==null?void 0:w.variant)===Kt.DOUBLE);f.enemyParty[x]=A,h===Ce.WILD&&f.seenEnemyPartyMemberIds.add(A.id),o.push(A.loadAssets())}),s.arena.weather=r.arena.weather,s.arena.eventTarget.dispatchEvent(new Hi(en.NONE,(T=s.arena.weather)==null?void 0:T.weatherType,(m=s.arena.weather)==null?void 0:m.turnsLeft)),s.arena.terrain=r.arena.terrain,s.arena.eventTarget.dispatchEvent(new Af(Ci.NONE,(C=s.arena.terrain)==null?void 0:C.terrainType,(b=s.arena.terrain)==null?void 0:b.turnsLeft)),s.arena.playerTerasUsed=r.arena.playerTerasUsed,s.arena.tags=r.arena.tags,s.arena.tags)for(const S of s.arena.tags)if(S instanceof Eh){const{tagType:x,side:A,turnCount:w,layers:k,maxLayers:B}=S;s.arena.eventTarget.dispatchEvent(new Nr(x,A,w,k,B))}else s.arena.eventTarget.dispatchEvent(new Nr(S.tagType,S.side,S.turnCount));s.modifiers.length&&(console.warn("Existing modifiers not cleared on session load, deleting..."),s.modifiers=[]);for(const S of r.modifiers){const x=S.toModifier(la[S.className]);x&&s.addModifier(x,!0)}s.updateModifiers(!0);for(const S of r.enemyModifiers){const x=S.toModifier(la[S.className]);x&&s.addEnemyModifier(x,!0)}s.updateModifiers(!1),Promise.all(o).then(()=>i(!0))},"initSessionFromData");t?a(t):this.getSession(e).then(r=>r&&a(r)).catch(r=>{n(r)})}catch(a){n(a);return}})}deleteSession(e){return new Promise(t=>{rs().then(i=>{if(i!==null&&!i)return t(!1);qe.savedata.session.delete({slot:e,clientSessionId:Xt}).then(n=>{var a;n?(n.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(n),t(!1)):(ke&&(ke.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${(a=ke)==null?void 0:a.username}`),t(!0))})})})}offlineNewClear(){return new Promise(e=>{const t=this.getSessionSaveData(),i=t.seed;let n=[];return t.gameMode===fe.DAILY?localStorage.hasOwnProperty("daily")?(n=JSON.parse(atob(localStorage.getItem("daily"))),n.includes(i)?e(!1):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0))):(n.push(i),localStorage.setItem("daily",btoa(JSON.stringify(n))),e(!0)):e(!0)})}async tryClearSession(e){var i,n;let t=[!1,!1];{const a=this.getSessionSaveData(),{trainerId:r}=this,o=await qe.savedata.session.clear({slot:e,trainerId:r,clientSessionId:Xt},a);o!=null&&o.error?((n=o==null?void 0:o.error)!=null&&n.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(o),t=[!1,!1]):(t=[!0,(o==null?void 0:o.success)??!1],ke&&(ke.lastSessionSlot=-1),localStorage.removeItem(`sessionData${e||""}_${(i=ke)==null?void 0:i.username}`))}return await rs(),t}parseSessionData(e){const t=JSON.parse(e,(i,n)=>{switch(i){case"party":case"enemyParty":{const a=[];for(const r of n??[])a.push(new Gi(r));return a}case"trainer":return n?new pn(n):null;case"modifiers":case"enemyModifiers":{const a=[];for(const r of n??[])(r==null?void 0:r.className)==="ExpBalanceModifier"&&(r.stackCount=Math.min(r.stackCount,4)),!(r instanceof wf&&(r.effect===Ht.FREEZE||r.effect===Ht.SLEEP))&&a.push(new qs(r,i==="modifiers"));return a}case"arena":return new dn(n);case"challenges":{const a=[];for(const r of n??[])a.push(new fn(r));return a}case"mysteryEncounterType":return n;case"mysteryEncounterSaveData":return new vi(n);default:return n}});return PC(t),t}saveAll(e=!1,t=!1,i=!1,n=!1){return new Promise(a=>{yh(!e,rs).then(r=>{var d,f,p,T;if(r!==null&&!r)return a(!1);t&&s.ui.savingIcon.show();const o=i?this.parseSessionData(ei(localStorage.getItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${(d=ke)==null?void 0:d.username}`),Et)):this.getSessionSaveData(),l=2147483648,h=n?this.parseSystemData(ei(localStorage.getItem(`data_${(f=ke)==null?void 0:f.username}`),Et)):this.getSystemSaveData(),c={system:h,session:o,sessionSlotId:s.sessionSlotId,clientSessionId:Xt};localStorage.setItem(`data_${(p=ke)==null?void 0:p.username}`,Ws(JSON.stringify(h,(m,C)=>typeof C=="bigint"?C<=l?Number(C):C.toString():C),Et)),localStorage.setItem(`sessionData${s.sessionSlotId?s.sessionSlotId:""}_${(T=ke)==null?void 0:T.username}`,Ws(JSON.stringify(o),Et)),console.debug("Session data saved!"),t?qe.savedata.updateAll(c).then(m=>{if(t&&(s.lastSavePlayTime=0,s.ui.savingIcon.hide()),m)return m.startsWith("session out of date")&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("ReloadSessionPhase")),console.error(m),a(!1);a(!0)}):this.verify().then(m=>{s.ui.savingIcon.hide(),a(m)})})})}tryExportData(e,t=0){return new Promise(i=>{var r;const n=`${ni(e,t)}_${(r=ke)==null?void 0:r.username}`,a=u(o=>{switch(e){case Ye.SYSTEM:o=this.convertSystemDataStr(o,!0);break}const l=Pi.AES.encrypt(o,Qa),h=new Blob([l.toString()],{type:"text/json"}),c=document.createElement("a");c.href=window.URL.createObjectURL(h),c.download=`${n}.prsv`,c.click(),c.remove()},"handleData");if(e<Ye.SETTINGS){let o=Promise.resolve(null);e===Ye.SYSTEM?o=qe.savedata.system.get({clientSessionId:Xt}):e===Ye.SESSION&&(o=qe.savedata.session.get({slot:t,clientSessionId:Xt})),o.then(l=>{if(typeof l=="number"||!(l!=null&&l.length)||l[0]!=="{"){console.error(l),i(!1);return}a(l),i(!0)})}else{const o=localStorage.getItem(n);o&&a(ei(o,Et)),i(!!o)}})}importData(e,t=0){var a;const i=`${ni(e,t)}_${(a=ke)==null?void 0:a.username}`;let n=document.getElementById("saveFile");n&&n.remove(),n=document.createElement("input"),n.id="saveFile",n.type="file",n.accept=".prsv",n.style.display="none",n.addEventListener("change",r=>{const o=new FileReader;o.onload=(l=>h=>{var T,m;let c,d=Pi.AES.decrypt((m=(T=h.target)==null?void 0:T.result)==null?void 0:m.toString(),Qa).toString(Pi.enc.Utf8),f=!1;try{switch(c=Ye[e].toLowerCase(),e){case Ye.SYSTEM:{d=this.convertSystemDataStr(d);const C=this.parseSystemData(d);f=!!C.dexData&&!!C.timestamp;break}case Ye.SESSION:{const C=this.parseSessionData(d);f=!!C.party&&!!C.enemyParty&&!!C.timestamp;break}case Ye.RUN_HISTORY:{const C=JSON.parse(d),b=Object.keys(C);c=g.t("menuUiHandler:RUN_HISTORY").toLowerCase(),b.forEach(S=>{const x=Object.keys(C[S]);f=["isFavorite","isVictory","entry"].every(A=>x.includes(A))&&x.length===3});break}case Ye.SETTINGS:case Ye.TUTORIALS:f=!0;break}}catch(C){console.error(C)}const p=u(C=>s.ui.showText(C,null,()=>s.ui.showText("",0),de(1500)),"displayError");if(c=c,!f)return s.ui.showText(`Your ${c} data could not be loaded. It may be corrupted.`,null,()=>s.ui.showText("",0),de(1500));s.ui.showText(`Your ${c} data will be overridden and the page will reload. Proceed?`,null,()=>{s.ui.setOverlayMode(_.CONFIRM,()=>{localStorage.setItem(i,Ws(d,Et)),e<Ye.SETTINGS?rs().then(C=>{if(!C[0])return p(`Could not contact the server. Your ${c} data could not be imported.`);const{trainerId:b,secretId:S}=this;let x;e===Ye.SESSION?x=qe.savedata.session.update({slot:t,trainerId:b,secretId:S,clientSessionId:Xt},d):x=qe.savedata.system.update({trainerId:b,secretId:S,clientSessionId:Xt},d),x.then(A=>{if(A)return console.error(A),p(`An error occurred while updating ${c} data. Please contact the administrator.`);window.location.reload()})}):window.location.reload()},()=>{s.ui.revertMode(),s.ui.showText("",0)},!1,-98)})})(r.target.files[0]),o.readAsText(r.target.files[0])}),n.click()}initDexData(){const e={};for(const n of Xe)e[n.speciesId]={seenAttr:0n,caughtAttr:0n,natureAttr:0,seenCount:0,caughtCount:0,hatchedCount:0,ivs:[0,0,0,0,0,0]};const t=V.NON_SHINY|V.MALE|V.FEMALE|V.DEFAULT_VARIANT|V.DEFAULT_FORM,i=[];s.executeWithSeedOffset(()=>{const n=[St.HARDY,St.DOCILE,St.SERIOUS,St.BASHFUL,St.QUIRKY];for(let a=0;a<Ui.length;a++)i.push(_i(n))},0,"default");for(let n=0;n<Ui.length;n++){const a=e[Ui[n]];a.seenAttr=t,a.caughtAttr=t,a.natureAttr=1<<i[n]+1;for(const r in a.ivs)a.ivs[r]=15}this.defaultDexData=Object.assign({},e),this.dexData=e}initStarterData(){const e={},t=Object.keys(Re).map(i=>Number.parseInt(i));for(const i of t)e[i]={moveset:null,eggMoves:0,candyCount:0,friendship:0,abilityAttr:Ui.includes(i)?Ze.ABILITY_1:0,passiveAttr:0,valueReduction:0,classicWinCount:0};this.starterData=e}setPokemonSeen(e,t=!0,i=!1){var a,r;if((a=s.currentBattle)!=null&&a.isBattleMysteryEncounter()&&((r=s.currentBattle.mysteryEncounter)!=null&&r.preventGameStatsUpdates))return;const n=this.dexData[e.species.speciesId];n.seenAttr|=e.getDexAttr(),t&&(n.seenCount++,this.gameStats.pokemonSeen++,!i&&e.species.subLegendary?this.gameStats.subLegendaryPokemonSeen++:!i&&e.species.legendary?this.gameStats.legendaryPokemonSeen++:!i&&e.species.mythical&&this.gameStats.mythicalPokemonSeen++,!i&&e.isShiny()&&this.gameStats.shinyPokemonSeen++)}setPokemonCaught(e,t=!0,i=!1,n=!0){const a=e.species.getRootSpeciesId();return!t&&!s.gameData.dexData[a].caughtAttr?Promise.resolve(!1):this.setPokemonSpeciesCaught(e,e.species,t,i,n)}setPokemonSpeciesCaught(e,t,i=!0,n=!1,a=!0){return new Promise(r=>{const o=this.dexData[t.speciesId],l=o.caughtAttr,h=e.formIndex,c=e.getDexAttr()&t.getFullUnlocksData();o.caughtAttr|=c;const d=e.getFormKey();h>0&&(e.species.speciesId===ge.PIKACHU&&t.speciesId===ge.PICHU&&(o.caughtAttr|=s.gameData.getFormAttr(0)),e.species.speciesId===ge.URSHIFU?h===2?o.caughtAttr|=s.gameData.getFormAttr(0):h===3&&(o.caughtAttr|=s.gameData.getFormAttr(1)):e.species.speciesId===ge.ZYGARDE?h===4?o.caughtAttr|=s.gameData.getFormAttr(2):h===5&&(o.caughtAttr|=s.gameData.getFormAttr(3)):(Zs.hasOwnProperty(t.speciesId)?Zs[t.speciesId]:[]).filter(S=>S.formKey===d).length>0&&(o.caughtAttr|=s.gameData.getFormAttr(0))),Re.hasOwnProperty(t.speciesId)&&(this.starterData[t.speciesId].abilityAttr|=e.abilityIndex!==1||e.species.ability2?1<<e.abilityIndex:Ze.ABILITY_HIDDEN),o.natureAttr|=1<<e.nature+1;const f=vt.hasOwnProperty(t.speciesId),p=!l,T=(l&c)!==c;i&&(n?(o.hatchedCount++,this.gameStats.pokemonHatched++,e.species.subLegendary?this.gameStats.subLegendaryPokemonHatched++:e.species.legendary?this.gameStats.legendaryPokemonHatched++:e.species.mythical&&this.gameStats.mythicalPokemonHatched++,e.isShiny()&&this.gameStats.shinyPokemonHatched++):(o.caughtCount++,this.gameStats.pokemonCaught++,e.species.subLegendary?this.gameStats.subLegendaryPokemonCaught++:e.species.legendary?this.gameStats.legendaryPokemonCaught++:e.species.mythical&&this.gameStats.mythicalPokemonCaught++,e.isShiny()&&this.gameStats.shinyPokemonCaught++),!f&&(!s.gameMode.isDaily||T||n)&&this.addStarterCandy(t,1*(e.isShiny()?5*(1<<(e.variant??0)):1)*(n||e.isBoss()?2:1)));const m=u(C=>{if(f){const b=vt[t.speciesId];this.setPokemonSpeciesCaught(e,Dt(b),i,n,a).then(S=>r(S))}else r(C)},"checkPrevolution");if(p&&Re.hasOwnProperty(t.speciesId)){if(!a){r(!0);return}s.playSound("level_up_fanfare"),s.ui.showText(g.t("battle:addedAsAStarter",{pokemonName:t.name}),null,()=>m(!0),null,!0)}else m(!1)})}incrementRibbonCount(e,t=!1){const i=e.getRootSpeciesId(t);this.starterData[i].classicWinCount||(this.starterData[i].classicWinCount=0),this.starterData[i].classicWinCount||s.gameData.gameStats.ribbonsOwned++;const n=s.gameData.gameStats.ribbonsOwned;return n>=100&&s.validateAchv(Ae._100_RIBBONS),n>=75&&s.validateAchv(Ae._75_RIBBONS),n>=50&&s.validateAchv(Ae._50_RIBBONS),n>=25&&s.validateAchv(Ae._25_RIBBONS),n>=10&&s.validateAchv(Ae._10_RIBBONS),++this.starterData[i].classicWinCount}addStarterCandy(e,t){const i=e.getRootSpeciesId();s.gameData.dexData[i].caughtAttr&&(s.candyBar.showStarterSpeciesCandy(e.speciesId,t),this.starterData[e.speciesId].candyCount+=t)}setEggMoveUnlocked(e,t,i=!0,n=!1){return new Promise(a=>{const r=e.speciesId;if(!wt.hasOwnProperty(r)||!wt[r][t]){a(!1);return}this.starterData[r].eggMoves||(this.starterData[r].eggMoves=0);const o=1<<t;if(this.starterData[r].eggMoves&o){a(!1);return}if(this.starterData[r].eggMoves|=o,!i){a(!0);return}s.playSound("level_up_fanfare");const l=Ne[wt[r][t]].name;let h=n?e.getName()+" ":"";h+=t===3?g.t("egg:rareEggMoveUnlock",{moveName:l}):g.t("egg:eggMoveUnlock",{moveName:l}),s.ui.showText(h,null,()=>a(!0),null,!0)})}isRootSpeciesUnlocked(e){var t;return!!((t=this.dexData[e.getRootSpeciesId()])!=null&&t.caughtAttr)}unlockSpeciesNature(e,t){if(!this.isRootSpeciesUnlocked(e))return;const i=u(n=>{this.dexData[n].natureAttr|=1<<t+1,vt.hasOwnProperty(n)&&i(vt[n])},"_unlockSpeciesNature");i(e.speciesId)}updateSpeciesDexIvs(e,t){let i;do{i=s.gameData.dexData[e];const n=i.ivs;for(let a=0;a<n.length;a++)n[a]<t[a]&&(n[a]=t[a]);n.filter(a=>a===31).length===6&&s.validateAchv(Ae.PERFECT_IVS)}while(vt.hasOwnProperty(e)&&(e=vt[e]))}getSpeciesCount(e){const t=Object.keys(this.dexData);let i=0;for(const n of t)e(this.dexData[n])&&i++;return i}getStarterCount(e){const t=Object.keys(Re);let i=0;for(const n of t){const a=this.dexData[n];e(a)&&i++}return i}getSpeciesDefaultDexAttr(e,t=!1,i=!1){let n=0n;const r=this.dexData[e.speciesId].caughtAttr;return i?r&V.SHINY?(n|=V.SHINY,r&V.VARIANT_3?n|=V.VARIANT_3:r&V.VARIANT_2?n|=V.VARIANT_2:n|=V.DEFAULT_VARIANT):(n|=V.NON_SHINY,n|=V.DEFAULT_VARIANT):(n|=r&V.NON_SHINY||!(r&V.SHINY)?V.NON_SHINY:V.SHINY,r&V.DEFAULT_VARIANT?n|=V.DEFAULT_VARIANT:r&V.VARIANT_2?n|=V.VARIANT_2:r&V.VARIANT_3?n|=V.VARIANT_3:n|=V.DEFAULT_VARIANT),n|=r&V.MALE||!(r&V.FEMALE)?V.MALE:V.FEMALE,n|=this.getFormAttr(this.getFormIndex(r)),n}getSpeciesDexAttrProps(e,t){const i=!(t&V.NON_SHINY),n=!(t&V.MALE);let a=0;t&V.DEFAULT_VARIANT?a=0:t&V.VARIANT_2?a=1:t&V.VARIANT_3&&(a=2);const r=this.getFormIndex(t);return{shiny:i,female:n,variant:a,formIndex:r}}getStarterSpeciesDefaultAbilityIndex(e){const t=this.starterData[e.speciesId].abilityAttr;return t&Ze.ABILITY_1?0:!e.ability2||t&Ze.ABILITY_2?1:2}getSpeciesDefaultNature(e){const t=this.dexData[e.speciesId];for(let i=0;i<25;i++)if(t.natureAttr&1<<i+1)return i;return 0}getSpeciesDefaultNatureAttr(e){return 1<<this.getSpeciesDefaultNature(e)}getDexAttrLuck(e){return e&V.SHINY?e&V.VARIANT_3?3:e&V.VARIANT_2?2:1:0}getNaturesForAttr(e=0){const t=[];for(let i=0;i<25;i++)e&1<<i+1&&t.push(i);return t}getSpeciesStarterValue(e){let i=Re[e];const n=u(r=>(r>1?r--:r/=2,r),"decrementValue");for(let r=0;r<this.starterData[e].valueReduction;r++)i=n(i);const a=new rt(i);return Qi(Zi.STARTER_COST,e,a),a.value}getFormIndex(e){if(!e||e<V.DEFAULT_FORM)return 0;let t=0;for(;!(e&this.getFormAttr(t));)t++;return t}getFormAttr(e){return BigInt(1)<<BigInt(7+e)}consolidateDexData(e){var t;for(const i of Object.keys(e)){const n=e[i];n.hasOwnProperty("hatchedCount")||(n.hatchedCount=0),(!n.hasOwnProperty("natureAttr")||n.caughtAttr&&!n.natureAttr)&&(n.natureAttr=((t=this.defaultDexData)==null?void 0:t[i].natureAttr)||1<<Jt(25,1))}}migrateStarterAbilities(e,t){const i=Object.keys(this.starterData).map(r=>Number.parseInt(r)),n=t||e.starterData,a=e.dexData;for(const r of i){const o=a[r].caughtAttr;n[r].abilityAttr=(o&V.DEFAULT_VARIANT?Ze.ABILITY_1:0)|(o&V.VARIANT_2?Ze.ABILITY_2:0)|(o&V.VARIANT_3?Ze.ABILITY_HIDDEN:0),o&&(o&V.DEFAULT_VARIANT||(a[r].caughtAttr^=V.DEFAULT_VARIANT),o&V.VARIANT_2&&(a[r].caughtAttr^=V.VARIANT_2),o&V.VARIANT_3&&(a[r].caughtAttr^=V.VARIANT_3))}}};u(Jc,"GameData");let ka=Jc;const Fi=118,BC=0,tf=-116,eu=class eu extends Phaser.GameObjects.Container{constructor(){super(s,Fi,tf),this.abilityBars=[],this.player=!0,this.shown=!1}setup(){for(const e of["ability_bar_right","ability_bar_left"]){const t=s.add.image(0,0,e);t.setOrigin(0,0),t.setVisible(!1),this.add(t),this.abilityBars.push(t)}this.abilityBarText=D(15,3,"",O.MESSAGE,{fontSize:"72px"}),this.abilityBarText.setOrigin(0,0),this.abilityBarText.setWordWrapWidth(600,!0),this.add(this.abilityBarText),this.bringToTop(this.abilityBarText),this.setVisible(!1),this.setX(-Fi)}setVisible(e){return this.abilityBars[+this.player].setVisible(e),this.shown=e,this}async startTween(e,t){return this.setVisible(!0),t&&this.abilityBarText.setText(t),new Promise(i=>{s.tweens.add({...e,onComplete:u(()=>{e.onComplete&&e.onComplete(),i()},"onComplete")})})}async showAbility(e,t,i=!1,n=!0){const a=`${g.t("fightUiHandler:abilityFlyInText",{pokemonName:e,passive:i?g.t("fightUiHandler:passive"):"",abilityName:t})}`;this.screenRight=s.scaledCanvas.width,n!==this.player&&(this.setX(n?-Fi:this.screenRight),this.player=n),s.fieldUI.bringToTop(this);let r=tf;return this.player?r+=s.currentBattle.double?14:0:r-=s.currentBattle.double?28:14,this.setY(r),this.startTween({targets:this,x:this.player?BC:this.screenRight-Fi,duration:500,ease:"Sine.easeOut",hold:1e3},a)}async hide(){return this.startTween({targets:this,x:this.player?-Fi:this.screenRight,duration:200,ease:"Sine.easeIn",onComplete:u(()=>{this.setVisible(!1)},"onComplete")})}isVisible(){return this.shown}};u(eu,"AbilityBar");let _o=eu;const LC=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform vec3 terrainColor;
uniform float terrainColorRatio;

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);
		
		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;
	
	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;
		
		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);
			
		float f1 = 2.0 * hsl.z - f2;
		
		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}
	
	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

void main() {
	vec4 texture;

	%forloop%

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color = vec4(blendHardLight(color.rgb, dayNightTint), color.a);
	}

	if (terrainColorRatio > 0.0 && (1.0 - terrainColorRatio) < outTexCoord.y) {
		if (color.a > 0.0 && (terrainColor.r > 0.0 || terrainColor.g > 0.0 || terrainColor.b > 0.0)) {
			color.rgb = mix(color.rgb, blendHue(color.rgb, terrainColor), 1.0);
		}
	}

	gl_FragColor = color;
}`,ng=`precision mediump float;

uniform mat4 uProjectionMatrix;
uniform int uRoundPixels;
uniform vec2 uResolution;

attribute vec2 inPosition;
attribute vec2 inTexCoord;
attribute float inTexId;
attribute float inTintEffect;
attribute vec4 inTint;

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

void main()
{
	gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);
	if (uRoundPixels == 1)
	{
		gl_Position.xy = floor(((gl_Position.xy + 1.0) * 0.5 * uResolution) + 0.5) / uResolution * 2.0 - 1.0;
	}
	outTexCoord = inTexCoord;
	outTexId = inTexId;
	outPosition = inPosition;
	outTint = inTint;
	outTintEffect = inTintEffect;
}`,tu=class tu extends Phaser.Renderer.WebGL.Pipelines.MultiPipeline{constructor(e,t){super(t||{game:e,name:"field-sprite",fragShader:LC,vertShader:ng})}onPreRender(){this.set1f("time",0),this.set1i("ignoreTimeTint",0),this.set1f("terrainColorRatio",0),this.set3fv("terrainColor",[0,0,0])}onBind(e){var o,l;super.onBind();const i=e.pipelineData,n=i.ignoreTimeTint,a=i.terrainColorRatio||0,r=(o=s.currentBattle)!=null&&o.waveIndex?(s.currentBattle.waveIndex+s.waveCycleOffset)%40/40:gg();this.set1f("time",r),this.set1i("ignoreTimeTint",n?1:0),this.set1i("isOutside",s.arena.isOutside()?1:0),this.set3fv("dayTint",s.arena.getDayTint().map(h=>h/255)),this.set3fv("duskTint",s.arena.getDuskTint().map(h=>h/255)),this.set3fv("nightTint",s.arena.getNightTint().map(h=>h/255)),this.set3fv("terrainColor",tm(((l=s.arena.terrain)==null?void 0:l.terrainType)||Ci.NONE).map(h=>h/255)),this.set1f("terrainColorRatio",a)}onBatch(e){e&&this.flush()}};u(tu,"FieldSpritePipeline");let Na=tu;const RC=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif

uniform sampler2D uMainSampler[%count%];

varying vec2 outTexCoord;
varying float outTexId;
varying vec2 outPosition;
varying float outTintEffect;
varying vec4 outTint;

uniform float time;
uniform int ignoreTimeTint;
uniform int isOutside;
uniform vec3 dayTint;
uniform vec3 duskTint;
uniform vec3 nightTint;
uniform float teraTime;
uniform vec3 teraColor;
uniform int hasShadow;
uniform int yCenter;
uniform float fieldScale;
uniform float vCutoff;
uniform vec2 relPosition;
uniform vec2 texFrameUv;
uniform vec2 size;
uniform vec2 texSize;
uniform float yOffset;
uniform float yShadowOffset;
uniform vec4 tone;
uniform vec4 baseVariantColors[32];
uniform vec4 variantColors[32];
uniform vec4 spriteColors[32];
uniform ivec4 fusionSpriteColors[32];

const vec3 lumaF = vec3(.299, .587, .114);

float blendOverlay(float base, float blend) {
	return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));
}

vec3 blendOverlay(vec3 base, vec3 blend) {
	return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));
}

vec3 blendHardLight(vec3 base, vec3 blend) {
	return blendOverlay(blend, base);
}

float hue2rgb(float f1, float f2, float hue) {
	if (hue < 0.0)
		hue += 1.0;
	else if (hue > 1.0)
		hue -= 1.0;
	float res;
	if ((6.0 * hue) < 1.0)
		res = f1 + (f2 - f1) * 6.0 * hue;
	else if ((2.0 * hue) < 1.0)
		res = f2;
	else if ((3.0 * hue) < 2.0)
		res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;
	else
		res = f1;
	return res;
}

vec3 rgb2hsl(vec3 color) {
	vec3 hsl;
	float fmin = min(min(color.r, color.g), color.b);
	float fmax = max(max(color.r, color.g), color.b);
	float delta = fmax - fmin;

	hsl.z = (fmax + fmin) / 2.0;

	if (delta == 0.0) {
		hsl.x = 0.0;
		hsl.y = 0.0;
	} else {
		if (hsl.z < 0.5)
			hsl.y = delta / (fmax + fmin);
		else
			hsl.y = delta / (2.0 - fmax - fmin);
		
		float deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;
		float deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;
		float deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;

		if (color.r == fmax )
			hsl.x = deltaB - deltaG;
		else if (color.g == fmax)
			hsl.x = (1.0 / 3.0) + deltaR - deltaB;
		else if (color.b == fmax)
			hsl.x = (2.0 / 3.0) + deltaG - deltaR;

		if (hsl.x < 0.0)
			hsl.x += 1.0;
		else if (hsl.x > 1.0)
			hsl.x -= 1.0;
	}

	return hsl;
}

vec3 hsl2rgb(vec3 hsl) {
	vec3 rgb;
	
	if (hsl.y == 0.0)
		rgb = vec3(hsl.z);
	else {
		float f2;
		
		if (hsl.z < 0.5)
			f2 = hsl.z * (1.0 + hsl.y);
		else
			f2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);
			
		float f1 = 2.0 * hsl.z - f2;
		
		rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));
		rgb.g = hue2rgb(f1, f2, hsl.x);
		rgb.b= hue2rgb(f1, f2, hsl.x - (1.0/3.0));
	}
	
	return rgb;
}

vec3 blendHue(vec3 base, vec3 blend) {
	vec3 baseHSL = rgb2hsl(base);
	return hsl2rgb(vec3(rgb2hsl(blend).r, baseHSL.g, baseHSL.b));
}

vec3 rgb2hsv(vec3 c) {
	vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
	vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
	vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

	float d = q.x - min(q.w, q.y);
	float e = 1.0e-10;
	return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
	vec4 texture = texture2D(uMainSampler[0], outTexCoord);

	for (int i = 0; i < 32; i++) {
		if (baseVariantColors[i].a == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - baseVariantColors[i].rgb), vec3(1.0/255.0)))) {
			texture.rgb = variantColors[i].rgb;
			break;
		}
	}

	for (int i = 0; i < 32; i++) {
		if (spriteColors[i][3] == 0.0)
			break;
		if (texture.a > 0.0 && all(lessThan(abs(texture.rgb - spriteColors[i].rgb), vec3(1.0/255.0)))) {
			vec3 fusionColor = vec3(fusionSpriteColors[i].rgb) / 255.0;
			vec3 bg = spriteColors[i].rgb;
			float gray = (bg.r + bg.g + bg.b) / 3.0;
			bg = vec3(gray);
			vec3 fg = fusionColor;
			texture.rgb = mix(1.0 - 2.0 * (1.0 - bg) * (1.0 - fg), 2.0 * bg * fg, step(bg, vec3(0.5)));
			break;
		}
	}

	vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);

	//  Multiply texture tint
	vec4 color = texture * texel;

	if (color.a > 0.0 && teraColor.r > 0.0 && teraColor.g > 0.0 && teraColor.b > 0.0) {
		vec2 relUv = (outTexCoord.xy - texFrameUv.xy) / (size.xy / texSize.xy);
		vec2 teraTexCoord = vec2(relUv.x * (size.x / 200.0), relUv.y * (size.y / 120.0));
		vec4 teraCol = texture2D(uMainSampler[1], teraTexCoord);
		float floorValue = 86.0 / 255.0;
		vec3 teraPatternHsv = rgb2hsv(teraCol.rgb);
		teraCol.rgb = hsv2rgb(vec3((teraPatternHsv.b - floorValue) * 4.0 + teraTexCoord.x * fieldScale / 2.0 + teraTexCoord.y * fieldScale / 2.0 + teraTime * 255.0, teraPatternHsv.b, teraPatternHsv.b));

		color.rgb = mix(color.rgb, blendHue(color.rgb, teraColor), 0.625);
		teraCol.rgb = mix(teraCol.rgb, teraColor, 0.5);
		color.rgb = blendOverlay(color.rgb, teraCol.rgb);

		if (any(lessThan(teraCol.rgb, vec3(1.0)))) {
			vec3 teraColHsv = rgb2hsv(teraColor);
			color.rgb = mix(color.rgb, teraColor, (1.0 - teraColHsv.g) / 2.0);
		}
	}

	if (outTintEffect == 1.0) {
		//  Solid color + texture alpha
		color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);
	} else if (outTintEffect == 2.0) {
		//  Solid color, no texture
		color = texel;
	}

	/* Apply gray */
	float luma = dot(color.rgb, lumaF);
	color.rgb = mix(color.rgb, vec3(luma), tone.w);

	/* Apply tone */
	color.rgb += tone.rgb * (color.a / 255.0);

	/* Apply day/night tint */
	if (color.a > 0.0 && ignoreTimeTint == 0) {
		vec3 dayNightTint;

		if (time < 0.25) {
			dayNightTint = dayTint;
		} else if (isOutside == 0 && time < 0.5) {
			dayNightTint = mix(dayTint, nightTint, (time - 0.25) / 0.25);
		} else if (time < 0.375) {
			dayNightTint = mix(dayTint, duskTint, (time - 0.25) / 0.125);
		} else if (time < 0.5) {
			dayNightTint = mix(duskTint, nightTint, (time - 0.375) / 0.125);
		} else if (time < 0.75) {
			dayNightTint = nightTint;
		} else if (isOutside == 0) {
			dayNightTint = mix(nightTint, dayTint, (time - 0.75) / 0.25);
		} else if (time < 0.875) {
			dayNightTint = mix(nightTint, duskTint, (time - 0.75) / 0.125);
		} else {
			dayNightTint = mix(duskTint, dayTint, (time - 0.875) / 0.125);
		}

		color.rgb = blendHardLight(color.rgb, dayNightTint);
	}

	if (hasShadow == 1) {
		float width = size.x - (yOffset / 2.0);

		float spriteX = ((floor(outPosition.x / fieldScale) - relPosition.x) / width) + 0.5;
		float spriteY = ((floor(outPosition.y / fieldScale) - relPosition.y - yShadowOffset) / size.y);

		if (yCenter == 1) {
			spriteY += 0.5;
		} else {
			spriteY += 1.0;
		}

		bool yOverflow = outTexCoord.y >= vCutoff;

		if ((spriteY >= 0.9 && (color.a == 0.0 || yOverflow))) {
			float shadowSpriteY = (spriteY - 0.9) * (1.0 / 0.15);
			if (distance(vec2(spriteX, shadowSpriteY), vec2(0.5)) < 0.5) {
				color = vec4(vec3(0.0), 0.5);
			} else if (yOverflow) {
				discard;
			}
		} else if (yOverflow) {
			discard;
		}
	}

	gl_FragColor = color;
}`,su=class su extends Na{constructor(e){super(e,{game:e,name:"sprite",fragShader:RC,vertShader:ng}),this._tone=[0,0,0,0]}onPreRender(){super.onPreRender(),this.set1f("teraTime",0),this.set3fv("teraColor",[0,0,0]),this.set1i("hasShadow",0),this.set1i("yCenter",0),this.set2f("relPosition",0,0),this.set2f("texFrameUv",0,0),this.set2f("size",0,0),this.set2f("texSize",0,0),this.set1f("yOffset",0),this.set1f("yShadowOffset",0),this.set4fv("tone",this._tone)}onBind(e){super.onBind(e);const t=e,i=t.pipelineData,n=i.tone,a=i.isTerastallized?i.teraColor??[0,0,0]:[0,0,0],r=i.hasShadow,o=i.yShadowOffset,l=i.ignoreFieldPos,h=i.ignoreOverride,c=t.parentContainer instanceof Ps||t.parentContainer instanceof Ji||t.parentContainer instanceof mp,d=c?t.parentContainer.parentContainer:t.parentContainer,f=c?[t.parentContainer.x,t.parentContainer.y]:[t.x,t.y];if(d&&(f[0]+=d.x/d.scale,f[1]+=d.y/d.scale),f[0]+=-(t.width-t.frame.width)/2+t.frame.x+(l?0:t.x-d.x),t.originY===.5&&(f[1]+=t.height/2*((c?t.parentContainer:t).scale-1)+(l?0:t.y-d.y)),this.set1f("teraTime",this.game.getTime()%5e5/5e5),this.set3fv("teraColor",a.map(p=>p/255)),this.set1i("hasShadow",r?1:0),this.set1i("yCenter",t.originY===.5?1:0),this.set1f("fieldScale",(d==null?void 0:d.scale)||1),this.set2f("relPosition",f[0],f[1]),this.set2f("texFrameUv",t.frame.u0,t.frame.v0),this.set2f("size",t.frame.width,t.height),this.set2f("texSize",t.texture.source[0].width,t.texture.source[0].height),this.set1f("yOffset",t.height-t.frame.height*(c?t.parentContainer.scale:t.scale)),this.set1f("yShadowOffset",o??0),this.set4fv("tone",n),this.bindTexture(this.game.textures.get("tera").source[0].glTexture,1),s.fusionPaletteSwaps){const p=h&&i.spriteColorsBase||i.spriteColors||[],T=h&&i.fusionSpriteColorsBase||i.fusionSpriteColors||[],m=[0,0,0,0],C=[],b=[];for(let S=0;S<32;S++)C.splice(C.length,0,...S<p.length?p[S].map(x=>x/255):m),b.splice(b.length,0,...S<T.length?T[S]:m);this.set4fv("spriteColors",C.flat()),this.set4iv("fusionSpriteColors",b.flat())}}onBatch(e){if(e){const t=e,i=t.pipelineData,n=i.hasOwnProperty("variant")?i.variant:t.parentContainer instanceof Ps?t.parentContainer.variant:0;let a;const r=[0,0,0,0],o=[],l=[];if((t.parentContainer instanceof Ps?t.parentContainer.shiny:i.shiny)&&(a=sm[t.parentContainer instanceof Ps?t.parentContainer.getSprite().texture.key:i.spriteKey])&&a.hasOwnProperty(n)){const h=Object.keys(a[n]);for(let c=0;c<32;c++)if(c<h.length){const d=Array.from(Object.values(Ot(h[c]))),f=Array.from(Object.values(Ot(a[n][h[c]])));o.splice(o.length,0,...d.map(p=>p/255)),l.splice(l.length,0,...f.map(p=>p/255))}else o.splice(o.length,0,...r),l.splice(l.length,0,...r)}else for(let h=0;h<32;h++)o.splice(o.length,0,...r),l.splice(l.length,0,...r);this.set4fv("baseVariantColors",o.flat()),this.set4fv("variantColors",l.flat())}super.onBatch(e)}batchQuad(e,t,i,n,a,r,o,l,h,c,d,f,p,T,m,C,b,S,x,A){const w=e;this.set1f("vCutoff",p);const k=w.pipelineData.hasShadow,B=w.pipelineData.yShadowOffset??0;if(k){const X=w.parentContainer instanceof Ps||w.parentContainer instanceof Ji||w.parentContainer instanceof mp,L=X?w.parentContainer.parentContainer:w.parentContainer,Q=L.scale/6,te=(X?w.parentContainer.y:w.y+w.height)*6/Q,P=Math.ceil(w.height*.05+Math.max(B,0))*6/Q,H=(te-a)/L.scale;o=a=te+P;const v=(p-d)/(w.frame.height*(X?w.parentContainer.scale:w.scale));p+=(H+P/L.scale)*v}return super.batchQuad(e,t,i,n,a,r,o,l,h,c,d,f,p,T,m,C,b,S,x,A)}get tone(){return this._tone}set tone(e){this._tone=e}};u(su,"SpritePipeline");let Ao=su;const iu=class iu extends Phaser.GameObjects.Container{constructor(){super(s,s.game.canvas.width/6,-(s.game.canvas.height/6)+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.expText=D(22,4,"",O.BATTLE_INFO),this.expText.setOrigin(0,0),this.add(this.expText),this.setVisible(!1),this.shown=!1}showPokemonExp(e,t,i,n){return new Promise(a=>{if(this.shown)return a();this.pokemonIcon=s.addPokemonIcon(e,-8,15,0,.5),this.pokemonIcon.setScale(.5),this.add(this.pokemonIcon),i?n>200?this.expText.setText(g.t("battleScene:levelUp")):this.expText.setText(g.t("battleScene:levelUpWithLevel",{level:n})):this.expText.setText(`+${t.toString()}`),this.bg.width=this.expText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.game.canvas.width/6-(this.bg.width-5),duration:500/Math.pow(2,s.expGainsSpeed),ease:"Sine.easeOut",onComplete:u(()=>{this.tween=null,a()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:u(()=>{var t;this.tween=null,this.shown=!1,this.setVisible(!1),(t=this.pokemonIcon)==null||t.destroy(),e()},"onComplete")})})}};u(iu,"PartyExpBar");let wo=iu;const nu=class nu extends Phaser.GameObjects.Container{constructor(e){super(s,e?s.game.canvas.width/6:0,e?-72:-144),this.player=e}setup(){this.bg=s.add.nineslice(0,0,`pb_tray_overlay_${this.player?"player":"enemy"}`,void 0,104,4,48,8,0,0),this.bg.setOrigin(this.player?1:0,0),this.add(this.bg),this.balls=new Array(6).fill(null).map((e,t)=>s.add.sprite((this.player?-83:76)+s.game.canvas.width/6*(this.player?-1:1)+10*t*(this.player?1:-1),-8,"pb_tray_ball","empty"));for(const e of this.balls)e.setOrigin(0,0),this.add(e);this.setVisible(!1),this.shown=!1}showPbTray(e){return new Promise(t=>{if(this.shown)return t();s.fieldUI.bringToTop(this),this.x+=104*(this.player?1:-1),this.bg.width=104,this.bg.alpha=1,this.balls.forEach((i,n)=>{i.x+=(s.game.canvas.width/6+104)*(this.player?1:-1);let a="ball";n>=e.length?a="empty":e[n].hp?e[n].status&&(a="status"):a="faint",i.setFrame(a)}),s.playSound("se/pb_tray_enter"),s.tweens.add({targets:this,x:`${this.player?"-":"+"}=104`,duration:500,ease:"Sine.easeIn",onComplete:u(()=>{this.balls.forEach((i,n)=>{s.tweens.add({targets:i,x:`${this.player?"-":"+"}=104`,duration:n*100,ease:"Sine.easeIn",onComplete:u(()=>s.playSound(`se/${n<e.length?"pb_tray_ball":"pb_tray_empty"}`),"onComplete")})})},"onComplete")}),this.setVisible(!0),this.shown=!0,s.time.delayedCall(1100,()=>t())})}hide(){return new Promise(e=>{if(!this.shown)return e();this.balls.forEach((t,i)=>{s.tweens.add({targets:t,x:`${this.player?"-":"+"}=${s.game.canvas.width/6}`,duration:250,delay:i*100,ease:"Sine.easeIn"})}),s.tweens.add({targets:this.bg,width:144,alpha:0,duration:500,ease:"Sine.easeIn"}),s.time.delayedCall(850,()=>{this.setVisible(!1),e()}),this.shown=!1})}};u(nu,"PokeballTray");let Pa=nu;const au=class au{setup(){this.sprites=new Set,s.tweens.addCounter({duration:de(200),from:0,to:1,yoyo:!0,repeat:-1,onRepeat:u(()=>this.onLapse(),"onRepeat")})}onLapse(){Array.from(this.sprites.values()).filter(e=>!e.scene).map(e=>this.sprites.delete(e));for(const e of this.sprites.values()){if(!e.pipelineData.teraColor||!e.pipelineData.teraColor.find(f=>f)||!e.visible||e.parentContainer instanceof Ps&&!e.parentContainer.parentContainer||!(e.parentContainer instanceof Ps)||!e.parentContainer.isTerastallized)continue;const t=e.parentContainer instanceof Ps?e.parentContainer:null,i=(t||e).parentContainer,n=e.texture,[a,r]=[n.source[0].width,n.source[0].height],[o,l]=[Jt(a),Jt(r)],h=e.width/a,c=e.height/r,d=n.manager.getPixel(o,l,n.key,"__BASE");if(d!=null&&d.alpha){const[f,p]=[-e.originX*e.width,-e.originY*e.height],T=s.addFieldSprite(((t==null?void 0:t.x)||0)+e.x+o*h+f,((t==null?void 0:t.y)||0)+e.y+l*c+p,"tera_sparkle");T.pipelineData.ignoreTimeTint=e.pipelineData.ignoreTimeTint,T.setName("sprite-tera-sparkle"),T.play("tera_sparkle"),i.add(T),e.scene.time.delayedCall(de(Math.floor(1e3/12*13)),()=>T.destroy())}}}add(e){e=na(e);for(const t of e)this.sprites.has(t)||this.sprites.add(t)}remove(e){e=na(e);for(const t of e)this.sprites.delete(t)}removeAll(){for(const e of this.sprites.values())this.sprites.delete(e)}};u(au,"PokemonSpriteSparkleHandler");let Mo=au;const ru=class ru extends Phaser.GameObjects.Container{constructor(){super(s,s.game.canvas.width/6+32,-42)}setup(){[this.sprite,this.transitionSprite]=new Array(2).fill(null).map(()=>{const e=s.add.sprite(0,0,"","");return e.setOrigin(.5,1),this.add(e),e}),this.transitionSprite.setVisible(!1),this.setVisible(!1),this.shown=!1}showCharacter(e,t){return new Promise(i=>{if(e.startsWith("c_")||(e=`c_${e}`),this.shown){if(e===this.key&&t===this.variant)return i();if(e!==this.key)return this.hide().then(()=>this.showCharacter(e,t));this.setVariant(t).then(()=>i());return}this.sprite.setTexture(e,t),s.fieldUI.bringToTop(this),s.tweens.add({targets:this,x:s.game.canvas.width/6-102,duration:750,ease:"Cubic.easeOut",onComplete:u(()=>{i()},"onComplete")}),this.setVisible(s.textures.get(e).key!==mg),this.shown=!0,this.key=e,this.variant=t})}setVariant(e){return new Promise(t=>{s.fieldUI.bringToTop(this),this.transitionSprite.setTexture(this.key,e),this.transitionSprite.setAlpha(0),this.transitionSprite.setVisible(!0),s.tweens.add({targets:this.transitionSprite,alpha:1,duration:250,ease:"Sine.easeIn",onComplete:u(()=>{this.sprite.setTexture(this.key,e),this.transitionSprite.setVisible(!1),t()},"onComplete")}),this.variant=e})}hide(){return new Promise(e=>{if(!this.shown)return e();s.tweens.add({targets:this,x:s.game.canvas.width/6+32,duration:750,ease:"Cubic.easeIn",onComplete:u(()=>{this.shown||this.setVisible(!1),e()},"onComplete")}),this.shown=!1})}};u(ru,"CharSprite");let ko=ru;const ou=class ou{constructor(){this.damageNumbers=new Map}add(e,t,i=Ge.EFFECTIVE,n=!1){var d;if(!((d=s)!=null&&d.damageNumbersMode))return;const a=e.getBattlerIndex(),r=e.getSpriteScale()/6,o=D(e.x,-(s.game.canvas.height/6)+e.y-e.getSprite().height/2,yg(t,!0),O.SUMMARY);o.setName("text-damage-number"),o.setOrigin(.5,1),o.setScale(r);let[l,h]=[null,null];switch(i){case Ge.SUPER_EFFECTIVE:[l,h]=["#f8d030","#b8a038"];break;case Ge.NOT_VERY_EFFECTIVE:[l,h]=["#f08030","#c03028"];break;case Ge.INDIRECT_KO:case Ge.ONE_HIT_KO:[l,h]=["#a040a0","#483850"];break;case Ge.HEAL:[l,h]=["#78c850","#588040"];break;default:[l,h]=["#ffffff","#636363"];break}l&&o.setColor(l),h&&(n?(o.setShadowOffset(0,0),o.setStroke(h,12)):o.setShadowColor(h)),s.fieldUI.add(o),this.damageNumbers.has(a)||this.damageNumbers.set(a,[]);const c=this.damageNumbers.get(a).length*-10;if(c&&(o.y+=c),this.damageNumbers.get(a).push(o),s.damageNumbersMode===1){s.tweens.add({targets:o,duration:de(750),alpha:1,y:"-=32"}),s.tweens.add({delay:375,targets:o,duration:de(625),alpha:0,ease:"Sine.easeIn",onComplete:u(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")});return}o.setAlpha(0),s.tweens.chain({targets:o,tweens:[{duration:de(250),alpha:1,scaleX:.75*r,scaleY:1.25*r,y:"-=16",ease:"Cubic.easeOut"},{duration:de(175),alpha:1,scaleX:.875*r,scaleY:1.125*r,y:"+=16",ease:"Cubic.easeIn"},{duration:de(100),scaleX:1.25*r,scaleY:.75*r,ease:"Cubic.easeOut"},{duration:de(175),scaleX:.875*r,scaleY:1.125*r,y:"-=8",ease:"Cubic.easeOut"},{duration:de(50),scaleX:.925*r,scaleY:1.075*r,y:"+=8",ease:"Cubic.easeIn"},{duration:de(100),scaleX:1.125*r,scaleY:.875*r,ease:"Cubic.easeOut"},{duration:de(175),scaleX:.925*r,scaleY:1.075*r,y:"-=4",ease:"Cubic.easeOut"},{duration:de(50),scaleX:.975*r,scaleY:1.025*r,y:"+=4",ease:"Cubic.easeIn"},{duration:de(100),scaleX:1.075*r,scaleY:.925*r,ease:"Cubic.easeOut"},{duration:de(25),scaleX:r,scaleY:r,ease:"Cubic.easeOut"},{delay:de(500),alpha:0,onComplete:u(()=>{this.damageNumbers.get(a).splice(this.damageNumbers.get(a).indexOf(o),1),o.destroy(!0)},"onComplete")}]})}};u(ou,"DamageNumberHandler");let No=ou;const lu=class lu extends Phaser.GameObjects.Container{constructor(){super(s,s.game.canvas.width/6,-(s.game.canvas.height/6)+15)}setup(){this.bg=s.add.nineslice(0,0,"party_exp_bar",void 0,8,18,21,5,6,4),this.bg.setOrigin(0,0),this.add(this.bg),this.candyIcon=s.add.sprite(14,0,"items","candy"),this.candyIcon.setOrigin(.5,0),this.candyIcon.setScale(.5),this.add(this.candyIcon),this.candyOverlayIcon=s.add.sprite(14,0,"items","candy_overlay"),this.candyOverlayIcon.setOrigin(.5,0),this.candyOverlayIcon.setScale(.5),this.add(this.candyOverlayIcon),this.countText=D(22,4,"",O.BATTLE_INFO),this.countText.setOrigin(0,0),this.add(this.countText),this.setVisible(!1),this.shown=!1}showStarterSpeciesCandy(e,t){return new Promise(i=>{if(this.shown)return this.speciesId===e?i():this.hide().then(()=>this.showStarterSpeciesCandy(e,t)).then(()=>i());const n=ft[e];this.candyIcon.setTint(Vt(Ot(n[0]))),this.candyOverlayIcon.setTint(Vt(Ot(n[1]))),this.countText.setText(`${s.gameData.starterData[e].candyCount+t} (+${t.toString()})`),this.bg.width=this.countText.displayWidth+28,s.fieldUI.bringToTop(this),this.tween&&this.tween.stop(),s.playSound("se/shing"),this.tween=s.tweens.add({targets:this,x:s.game.canvas.width/6-(this.bg.width-5),duration:500,ease:"Sine.easeOut",onComplete:u(()=>{this.tween=null,this.resetAutoHideTimer(),i()},"onComplete")}),this.setVisible(!0),this.shown=!0})}hide(){return new Promise(e=>{if(!this.shown)return e();this.autoHideTimer&&clearInterval(this.autoHideTimer),this.tween&&this.tween.stop(),this.tween=s.tweens.add({targets:this,x:s.game.canvas.width/6,duration:500,ease:"Sine.easeIn",onComplete:u(()=>{this.tween=null,this.shown=!1,this.setVisible(!1),e()},"onComplete")})})}resetAutoHideTimer(){this.autoHideTimer&&clearInterval(this.autoHideTimer),this.autoHideTimer=setTimeout(()=>{this.hide(),this.autoHideTimer=null},2500)}};u(lu,"CandyBar");let Po=lu;const FC={padID:"Generic",padType:"xbox",deviceMapping:{RC_S:0,RC_E:1,RC_W:2,RC_N:3,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15},icons:{RC_S:"XB_Letter_A_OL.png",RC_E:"XB_Letter_B_OL.png",RC_W:"XB_Letter_X_OL.png",RC_N:"XB_Letter_Y_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:I.UP,[G.Button_Down]:I.DOWN,[G.Button_Left]:I.LEFT,[G.Button_Right]:I.RIGHT,[G.Button_Action]:I.ACTION,[G.Button_Cancel]:I.CANCEL,[G.Button_Cycle_Nature]:I.CYCLE_NATURE,[G.Button_Cycle_Tera]:I.CYCLE_TERA,[G.Button_Menu]:I.MENU,[G.Button_Stats]:I.STATS,[G.Button_Cycle_Form]:I.CYCLE_FORM,[G.Button_Cycle_Shiny]:I.CYCLE_SHINY,[G.Button_Cycle_Gender]:I.CYCLE_GENDER,[G.Button_Cycle_Ability]:I.CYCLE_ABILITY,[G.Button_Speed_Up]:I.SPEED_UP,[G.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down},blacklist:["LC_N","LC_S","LC_W","LC_E"]},UC={padID:"Pro Controller",padType:"xbox",deviceMapping:{RC_S:1,RC_E:0,RC_W:3,RC_N:2,START:9,SELECT:8,LB:4,RB:5,LT:6,RT:7,LS:10,RS:11,LC_N:12,LC_S:13,LC_W:14,LC_E:15,MENU:16},icons:{RC_S:"XB_Letter_B_OL.png",RC_E:"XB_Letter_A_OL.png",RC_W:"XB_Letter_Y_OL.png",RC_N:"XB_Letter_X_OL.png",START:"START.png",SELECT:"SELECT.png",LB:"Bumper_L.png",RB:"Bumper_R.png",LT:"Trigger_L.png",RT:"Trigger_R.png",LS:"LS.png",RS:"RS.png",LC_N:"UP.png",LC_S:"DOWN.png",LC_W:"LEFT.png",LC_E:"RIGHT.png"},settings:{[G.Button_Up]:I.UP,[G.Button_Down]:I.DOWN,[G.Button_Left]:I.LEFT,[G.Button_Right]:I.RIGHT,[G.Button_Action]:I.ACTION,[G.Button_Cancel]:I.CANCEL,[G.Button_Cycle_Nature]:I.CYCLE_NATURE,[G.Button_Cycle_Tera]:I.CYCLE_TERA,[G.Button_Menu]:I.MENU,[G.Button_Stats]:I.STATS,[G.Button_Cycle_Form]:I.CYCLE_FORM,[G.Button_Cycle_Shiny]:I.CYCLE_SHINY,[G.Button_Cycle_Gender]:I.CYCLE_GENDER,[G.Button_Cycle_Ability]:I.CYCLE_ABILITY,[G.Button_Speed_Up]:I.SPEED_UP,[G.Button_Slow_Down]:I.SLOW_DOWN},default:{LC_N:G.Button_Up,LC_S:G.Button_Down,LC_W:G.Button_Left,LC_E:G.Button_Right,RC_S:G.Button_Action,RC_E:G.Button_Cancel,RC_W:G.Button_Cycle_Nature,RC_N:G.Button_Cycle_Tera,START:G.Button_Menu,SELECT:G.Button_Stats,LB:G.Button_Cycle_Form,RB:G.Button_Cycle_Shiny,LT:G.Button_Cycle_Gender,RT:G.Button_Cycle_Ability,LS:G.Button_Speed_Up,RS:G.Button_Slow_Down}},VC="touchControlPositionsLandscape",HC="touchControlPositionsPortrait",hu=class hu{constructor(e){this.draggingElement=null,this.configurationEventListeners={touchstart:[],touchmove:[],touchend:[]},this.isLandscapeMode=this.getScreenSize().width>this.getScreenSize().height,this.isLeft=t=>{var i;return(i=document.querySelector("#touchControls .left"))==null?void 0:i.contains(t)},this.startDrag=t=>{this.draggingElement=t},this.drag=t=>{if(!this.draggingElement)return;const i=this.draggingElement.getBoundingClientRect(),n=this.isLeft(this.draggingElement)?t.clientX-i.width/2:window.innerWidth-t.clientX-i.width/2,a=window.innerHeight-t.clientY-i.height/2;this.setPosition(this.draggingElement,n,a)},this.stopDrag=()=>{this.draggingElement=null},this.touchControls=e,this.inConfigurationMode=!1,this.setPositions(this.getSavedPositionsOfCurrentOrientation()??[]),window.addEventListener("resize",t=>{const i=this.getScreenSize();i.width>i.height!==this.isLandscapeMode&&this.changeOrientation(i.width>i.height)})}async changeOrientation(e){if(this.isLandscapeMode=e,this.inConfigurationMode){const i=document.querySelector("#touchControls #orientation");i&&(i.textContent=this.isLandscapeMode?g.t("settings:landscape"):g.t("settings:portrait"))}const t=this.getSavedPositionsOfCurrentOrientation()??[];this.setPositions(t)}getScreenSize(){return{width:window.screen.width,height:window.screen.height}}createToolbarElement(){const e=document.createElement("div");return e.id="configToolbar",e.innerHTML=`
    <div class="column">
      <div class="button-row">
        <div id="resetButton" class="button">${g.t("settings:touchReset")}</div>
        <div id="saveButton" class="button">${g.t("settings:touchSaveClose")}</div>
        <div id="cancelButton" class="button">${g.t("settings:touchCancel")}</div>
      </div>
      <div class="info-row">
        <div class="orientation-label"> 
          ${g.t("settings:orientation")}
          <span id="orientation">
            ${this.isLandscapeMode?g.t("settings:landscape"):g.t("settings:portrait")}
          </span>
        </div>
      </div>
    </div>
  `,e}createToolbar(){var a;(a=document.querySelector("#touchControls"))==null||a.prepend(this.createToolbarElement());const e=this.getConfigToolbarRefs();if(!e)return;const{saveButton:t,resetButton:i,cancelButton:n}=e;t.addEventListener("click",()=>{this.saveCurrentPositions(),this.disableConfigurationMode()}),i.addEventListener("click",()=>{this.resetPositions()}),n.addEventListener("click",()=>{const r=this.getSavedPositionsOfCurrentOrientation();this.setPositions(r),this.disableConfigurationMode()})}getConfigToolbarRefs(){const e=document.querySelector("#touchControls #configToolbar");if(e)return{toolbar:e,saveButton:e.querySelector("#saveButton"),resetButton:e.querySelector("#resetButton"),cancelButton:e.querySelector("#cancelButton")}}getModifiedCurrentPositions(){return this.getControlGroupElements().filter(e=>e.style.right||e.style.left).map(e=>({id:e.id,x:Number.parseFloat(this.isLeft(e)?e.style.left:e.style.right),y:Number.parseFloat(e.style.bottom)}))}getLocalStorageKey(){return this.isLandscapeMode?VC:HC}getSavedPositionsOfCurrentOrientation(){const e=localStorage.getItem(this.getLocalStorageKey());return e?JSON.parse(e):[]}saveCurrentPositions(){const e=this.getModifiedCurrentPositions();localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))}setPositions(e){return this.resetPositions(),e.forEach(t=>{const i=document.querySelector(`#${t.id}`);this.setPosition(i,t.x,t.y)})}setPosition(e,t,i){const n=e.getBoundingClientRect(),a=u((l,h,c)=>Math.min(Math.max(l,h),c),"checkBound"),{height:r,width:o}=this.getScreenSize();t=a(t,0,o-n.width),i=a(i,0,r-n.height),this.isLeft(e)?e.style.left=`${t}px`:e.style.right=`${t}px`,e.style.bottom=`${i}px`}resetPositions(){this.getControlGroupElements().forEach(e=>{e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.removeProperty("bottom")})}getControlGroupElements(){return[...document.querySelectorAll("#touchControls .control-group")]}createConfigurationEventListeners(e){return{touchstart:e.map(t=>{const i=u(()=>this.startDrag(t),"startDrag");return t.addEventListener("touchstart",i,{passive:!0}),i}),touchmove:e.map(()=>{const t=u(i=>this.drag(i.touches[0]),"drag");return window.addEventListener("touchmove",t,{passive:!0}),t}),touchend:e.map(()=>{const t=u(()=>this.stopDrag(),"stopDrag");return window.addEventListener("touchend",t,{passive:!0}),t})}}createOverlay(e){var n;const t=new Phaser.GameObjects.Container(s,0,0),i=new Phaser.GameObjects.Rectangle(s,0,0,s.game.canvas.width,s.game.canvas.height,0,.5);i.setInteractive(),t.add(i),e.add(t),this.overlay=t,(n=document.querySelector("#touchControls"))==null||n.classList.add("config-mode")}enableConfigurationMode(e){this.inConfigurationMode||(this.inConfigurationMode=!0,this.touchControls.disable(),this.createOverlay(e),this.createToolbar(),setTimeout(()=>{this.configurationEventListeners=this.createConfigurationEventListeners(this.getControlGroupElements())},500))}disableConfigurationMode(){var a,r;this.inConfigurationMode=!1,this.draggingElement=null;const{touchstart:e,touchmove:t,touchend:i}=this.configurationEventListeners;this.getControlGroupElements().forEach((o,l)=>o.removeEventListener("touchstart",e[l])),t.forEach(o=>window.removeEventListener("touchmove",o)),i.forEach(o=>window.removeEventListener("touchend",o));const n=document.querySelector("#touchControls #configToolbar");n==null||n.remove(),(a=this.overlay)==null||a.destroy(),(r=document.querySelector("#touchControls"))==null||r.classList.remove("config-mode"),this.touchControls.enable()}};u(hu,"MoveTouchControlsHandler");let Do=hu;const sf=250,cu=class cu{constructor(){this.gamepads=new Array,this.buttonLock=new Array,this.interactions=new Map,this.configs=new Map,this.gamepadSupport=!0,this.disconnectedGamepads=new Array,this.lastSource="keyboard",this.inputInterval=new Array,this.selectedDevice={[_e.GAMEPAD]:null,[_e.KEYBOARD]:"default"};for(const e of hi(I))this.interactions[e]={pressTime:!1,isPressed:!1,source:null};delete this.interactions[I.MENU],delete this.interactions[I.STATS],this.init()}init(){var e,t,i,n,a,r,o,l;if(this.events=s.game.events,s.game.events.on(is.Core.Events.BLUR,()=>{this.loseFocus()}),typeof s.input.gamepad<"u"){if((e=s.input.gamepad)==null||e.on("connected",function(h){h&&(this.refreshGamepads(),this.setupGamepad(h),this.onReconnect(h))},this),(t=s.input.gamepad)==null||t.on("disconnected",function(h){this.onDisconnect(h)},this),(i=s.input.gamepad)==null||i.refreshPads(),(n=s.input.gamepad)!=null&&n.total){this.refreshGamepads();for(const h of this.gamepads)s.input.gamepad.emit("connected",h)}(a=s.input.gamepad)==null||a.on("down",this.gamepadButtonDown,this),(r=s.input.gamepad)==null||r.on("up",this.gamepadButtonUp,this),(o=s.input.keyboard)==null||o.on("keydown",this.keyboardKeyDown,this),(l=s.input.keyboard)==null||l.on("keyup",this.keyboardKeyUp,this)}this.touchControls=new Tg,this.moveTouchControlsHandler=new Do(this.touchControls)}loseFocus(){this.deactivatePressedKey(),this.touchControls.deactivatePressedKey()}setGamepadSupport(e){e?this.gamepadSupport=!0:(this.gamepadSupport=!1,this.deactivatePressedKey())}setChosenGamepad(e){this.deactivatePressedKey(),this.initChosenGamepad(e)}setChosenKeyboardLayout(e){this.deactivatePressedKey(),this.initChosenLayoutKeyboard(e)}getGamepadsName(){return this.gamepads.filter(e=>!this.disconnectedGamepads.includes(e.id)).map(e=>e.id)}initChosenGamepad(e){var i;e&&(this.selectedDevice[_e.GAMEPAD]=e.toLowerCase());const t=(i=s.ui)==null?void 0:i.handlers[_.SETTINGS_GAMEPAD];t==null||t.updateChosenGamepadDisplay()}initChosenLayoutKeyboard(e){var i;e&&(this.selectedDevice[_e.KEYBOARD]=e.toLowerCase());const t=(i=s.ui)==null?void 0:i.handlers[_.SETTINGS_KEYBOARD];t==null||t.updateChosenKeyboardDisplay()}onDisconnect(e){this.disconnectedGamepads.push(e.id)}onReconnect(e){this.disconnectedGamepads=this.disconnectedGamepads.filter(t=>t!==e.id)}setupGamepad(e){var n,a,r;const t=this.getGamepadsName();for(const o of t){const l=o.toLowerCase();this.selectedDevice[_e.GAMEPAD]||this.setChosenGamepad(l);const h=yp(this.getConfig(l));h.custom=((n=this.configs[l])==null?void 0:n.custom)||{...h.default},this.configs[l]=h,(a=s.gameData)==null||a.saveMappingConfigs(l,this.configs[l])}this.lastSource="gamepad";const i=(r=s.ui)==null?void 0:r.handlers[_.SETTINGS_GAMEPAD];i==null||i.updateChosenGamepadDisplay()}setupKeyboard(){var e,t;for(const i of["default"]){const n=yp(this.getConfigKeyboard(i));n.custom=((e=this.configs[i])==null?void 0:e.custom)||{...n.default},this.configs[i]=n,(t=s.gameData)==null||t.saveMappingConfigs(this.selectedDevice[_e.KEYBOARD],this.configs[i])}this.initChosenLayoutKeyboard(this.selectedDevice[_e.KEYBOARD])}refreshGamepads(){var e;this.gamepads=((e=s.input.gamepad)==null?void 0:e.gamepads.filter(t=>t!==null))??[];for(const[t,i]of this.gamepads.entries())i.index=t}ensureKeyboardIsInit(){var e;(e=this.getActiveConfig(_e.KEYBOARD))!=null&&e.padID||this.setupKeyboard()}keyboardKeyDown(e){this.lastSource="keyboard",this.ensureKeyboardIsInit();const t=Vn(this.getActiveConfig(_e.KEYBOARD),e.keyCode);if(t!==void 0){if(this.buttonLock.includes(t))return;this.events.emit("input_down",{controller_type:"keyboard",button:t}),clearInterval(this.inputInterval[t]),this.inputInterval[t]=setInterval(()=>{this.events.emit("input_down",{controller_type:"keyboard",button:t})},sf),this.buttonLock.push(t)}}keyboardKeyUp(e){this.lastSource="keyboard";const t=Vn(this.getActiveConfig(_e.KEYBOARD),e.keyCode);if(t!==void 0){this.events.emit("input_up",{controller_type:"keyboard",button:t});const i=this.buttonLock.indexOf(t);this.buttonLock.splice(i,1),clearInterval(this.inputInterval[t])}}gamepadButtonDown(e,t,i){var r;if((r=this.configs[this.selectedDevice[_e.KEYBOARD]])!=null&&r.padID||this.setupKeyboard(),!e||(this.lastSource="gamepad",(!this.selectedDevice[_e.GAMEPAD]||s.ui.getMode()!==_.GAMEPAD_BINDING&&this.selectedDevice[_e.GAMEPAD]!==e.id.toLowerCase())&&this.setChosenGamepad(e.id),!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[_e.GAMEPAD].toLowerCase()))return;const n=this.getActiveConfig(_e.GAMEPAD),a=n&&Vn(n,t.index);if(a!==void 0){if(this.buttonLock.includes(a))return;this.events.emit("input_down",{controller_type:"gamepad",button:a}),clearInterval(this.inputInterval[a]),this.inputInterval[a]=setInterval(()=>{if(!this.buttonLock.includes(a)){clearInterval(this.inputInterval[a]);return}this.events.emit("input_down",{controller_type:"gamepad",button:a})},sf),this.buttonLock.push(a)}}gamepadButtonUp(e,t,i){if(!e||(this.lastSource="gamepad",!this.gamepadSupport||e.id.toLowerCase()!==this.selectedDevice[_e.GAMEPAD]))return;const n=Vn(this.getActiveConfig(_e.GAMEPAD),t.index);if(n!==void 0){this.events.emit("input_up",{controller_type:"gamepad",button:n});const a=this.buttonLock.indexOf(n);this.buttonLock.splice(a,1),clearInterval(this.inputInterval[n])}}getConfig(e){return e=e.toLowerCase(),e.includes("081f")&&e.includes("e401")?sg:e.includes("xbox")&&e.includes("360")?eg:e.includes("054c")?tg:e.includes("057e")&&e.includes("2009")?UC:FC}getConfigKeyboard(e){return uo}deactivatePressedKey(){for(const e of Object.keys(this.inputInterval))clearInterval(this.inputInterval[e]);this.buttonLock=[]}getActiveConfig(e){var t;return(t=this.configs[this.selectedDevice[e]])!=null&&t.padID?this.configs[this.selectedDevice[e]]:null}getIconForLatestInputRecorded(e){return this.lastSource==="keyboard"&&this.ensureKeyboardIsInit(),BT(this.configs,this.lastSource,this.selectedDevice,e)}getLastSourceDevice(){return this.lastSource==="gamepad"?_e.GAMEPAD:_e.KEYBOARD}getLastSourceConfig(){const e=this.getLastSourceDevice();return e===_e.KEYBOARD&&this.ensureKeyboardIsInit(),this.getActiveConfig(e)}getLastSourceType(){const e=this.getLastSourceConfig();return e==null?void 0:e.padType}injectConfig(e,t){this.configs[e]||(this.configs[e]={});const i={BUTTON_CYCLE_VARIANT:"BUTTON_CYCLE_TERA"};for(const n in t.custom)t.custom[n]in i&&(t.custom[n]=i[t.custom[n]]);this.configs[e].custom=t.custom}resetConfigs(){var e;this.configs=new Map,(e=this.getGamepadsName())!=null&&e.length&&this.setupGamepad(this.selectedDevice[_e.GAMEPAD]),this.setupKeyboard()}assignBinding(e,t,i){return this.deactivatePressedKey(),e.padType==="keyboard"?LT(e,t,i):RT(e,t,i)}};u(cu,"InputsController");let Bo=cu;const uu=class uu{constructor(e){this.inputsController=e,this.init()}init(){this.events=this.inputsController.events,this.listenInputs()}detectInputMethod(e){e.controller_type==="keyboard"?e.hasOwnProperty("isTouch")&&e.isTouch?s.inputMethod="touch":s.inputMethod="keyboard":e.controller_type==="gamepad"&&(s.inputMethod="gamepad")}listenInputs(){this.events.on("input_down",e=>{this.detectInputMethod(e);const t=this.getActionsKeyDown();t.hasOwnProperty(e.button)&&t[e.button]()},this),this.events.on("input_up",e=>{const t=this.getActionsKeyUp();t.hasOwnProperty(e.button)&&t[e.button]()},this)}doVibration(e,t){e&&s.enableVibration&&typeof navigator.vibrate<"u"&&navigator.vibrate(t)}getActionsKeyDown(){return{[I.UP]:()=>this.buttonDirection(I.UP),[I.DOWN]:()=>this.buttonDirection(I.DOWN),[I.LEFT]:()=>this.buttonDirection(I.LEFT),[I.RIGHT]:()=>this.buttonDirection(I.RIGHT),[I.SUBMIT]:()=>this.buttonTouch(),[I.ACTION]:()=>this.buttonAb(I.ACTION),[I.CANCEL]:()=>this.buttonAb(I.CANCEL),[I.MENU]:()=>this.buttonMenu(),[I.STATS]:()=>this.buttonGoToFilter(I.STATS),[I.CYCLE_SHINY]:()=>this.buttonCycleOption(I.CYCLE_SHINY),[I.CYCLE_FORM]:()=>this.buttonCycleOption(I.CYCLE_FORM),[I.CYCLE_GENDER]:()=>this.buttonCycleOption(I.CYCLE_GENDER),[I.CYCLE_ABILITY]:()=>this.buttonCycleOption(I.CYCLE_ABILITY),[I.CYCLE_NATURE]:()=>this.buttonCycleOption(I.CYCLE_NATURE),[I.CYCLE_TERA]:()=>this.buttonCycleOption(I.CYCLE_TERA),[I.SPEED_UP]:()=>this.buttonSpeedChange(),[I.SLOW_DOWN]:()=>this.buttonSpeedChange(!1)}}getActionsKeyUp(){return{[I.UP]:()=>{},[I.DOWN]:()=>{},[I.LEFT]:()=>{},[I.RIGHT]:()=>{},[I.SUBMIT]:()=>{},[I.ACTION]:()=>{},[I.CANCEL]:()=>{},[I.MENU]:()=>{},[I.STATS]:()=>this.buttonStats(!1),[I.CYCLE_SHINY]:()=>{},[I.CYCLE_FORM]:()=>{},[I.CYCLE_GENDER]:()=>{},[I.CYCLE_ABILITY]:()=>{},[I.CYCLE_NATURE]:()=>{},[I.CYCLE_TERA]:()=>this.buttonInfo(!1),[I.SPEED_UP]:()=>{},[I.SLOW_DOWN]:()=>{}}}buttonDirection(e){const t=s.ui.processInput(e);this.doVibration(t,5)}buttonAb(e){s.ui.processInput(e)}buttonTouch(){s.ui.processInput(I.SUBMIT)||s.ui.processInput(I.ACTION)}buttonStats(e=!0){for(const t of s.getInfoToggles(!0))t.toggleInfo(e);for(const t of s.getField().filter(i=>i==null?void 0:i.isActive(!0)))t.toggleStats(e)}buttonGoToFilter(e){var n;const t=[rn,hn,un],i=(n=s.ui)==null?void 0:n.getHandler();t.some(a=>i instanceof a)?s.ui.processInput(e):this.buttonStats(!0)}buttonInfo(e=!0){if(s.showMovesetFlyout)for(const t of s.getEnemyField().filter(i=>i==null?void 0:i.isActive(!0)))t.toggleFlyout(e);s.showArenaFlyout&&s.ui.processInfoButton(e)}buttonMenu(){var e;if(!s.disableMenu)switch((e=s.ui)==null?void 0:e.getMode()){case _.MESSAGE:{const t=s.ui.getHandler();if(!t.pendingPrompt||t.isTextAnimationInProgress())return}case _.TITLE:case _.COMMAND:case _.MODIFIER_SELECT:case _.MYSTERY_ENCOUNTER:s.ui.setOverlayMode(_.MENU);break;case _.STARTER_SELECT:case _.POKEDEX_PAGE:this.buttonTouch();break;case _.MENU:s.ui.revertMode(),s.playSound("ui/select");break;default:return}}buttonCycleOption(e){var n;const t=[rn,hn,un,ga,Ea,xa,_a,Ta,Oa],i=(n=s.ui)==null?void 0:n.getHandler();t.some(a=>i instanceof a)?s.ui.processInput(e):e===I.CYCLE_TERA&&this.buttonInfo(!0)}buttonSpeedChange(e=!0){var i,n;const t=im(ms.Game_Speed);e&&s.gameSpeed<5?(s.gameData.saveSetting(ms.Game_Speed,Ar[t].options.findIndex(a=>a.label===`${s.gameSpeed}x`)+1),((i=s.ui)==null?void 0:i.getMode())===_.SETTINGS&&s.ui.getHandler().show([])):!e&&s.gameSpeed>1&&(s.gameData.saveSetting(ms.Game_Speed,Math.max(Ar[t].options.findIndex(a=>a.label===`${s.gameSpeed}x`)-1,0)),((n=s.ui)==null?void 0:n.getMode())===_.SETTINGS&&s.ui.getHandler().show([]))}};u(uu,"UiInputs");let Lo=uu;const du=class du extends Phaser.GameObjects.Container{constructor(e=0,t=0){super(s,e,t),this.timeOfDayIconFgs=new Array(2),this.timeOfDayIconMgs=new Array(2),this.timeOfDayIconBgs=new Array(2),this.timeOfDayIconPairs=new Map([["bg",this.timeOfDayIconBgs],["mg",this.timeOfDayIconMgs],["fg",this.timeOfDayIconFgs]]),this.currentTime=Zt.ALL,this.previousTime=Zt.ALL,this.onEncounterPhaseEvent=i=>this.onEncounterPhase(i),this.setVisible(s.showTimeOfDayWidget),s.showTimeOfDayWidget&&(this.timeOfDayIconPairs.forEach((i,n)=>{for(let a=0;a<i.length;a++)i[a]=s.add.sprite(0,0,"dawn_icon_"+n).setOrigin()}),this.timeOfDayIcons=[this.timeOfDayIconBgs,this.timeOfDayIconMgs,this.timeOfDayIconFgs].flat(),this.add(this.timeOfDayIcons),s.eventTarget.addEventListener(oi.ENCOUNTER_PHASE,this.onEncounterPhaseEvent))}get parentVisible(){return this._parentVisible}set parentVisible(e){var t;e&&!this._parentVisible&&((t=this.timeOfDayIcons)==null||t.forEach(i=>s.tweens.getTweensOf(i).forEach(n=>n.resume()))),this._parentVisible=e}getBackTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:de(1500),ease:"Back.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:de(500),ease:"Linear",paused:!this.parentVisible};return[e,t]}getBounceTween(){const e={targets:[this.timeOfDayIconMgs[0],this.timeOfDayIconMgs[1]],angle:"+=90",duration:de(2e3),ease:"Bounce.easeOut",paused:!this.parentVisible},t={targets:[this.timeOfDayIconBgs[1],this.timeOfDayIconMgs[1],this.timeOfDayIconFgs[1]],alpha:0,duration:de(800),ease:"Linear",paused:!this.parentVisible};return[e,t]}resetIcons(){this.moveBelow(this.timeOfDayIconBgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconMgs[0],this.timeOfDayIconBgs[1]),this.moveBelow(this.timeOfDayIconFgs[0],this.timeOfDayIconFgs[1]),this.timeOfDayIconPairs.forEach((e,t)=>{e[0].setTexture(Zt[this.currentTime].toLowerCase()+"_icon_"+t),e[1].setTexture(Zt[this.previousTime].toLowerCase()+"_icon_"+t)}),this.timeOfDayIconMgs[0].setRotation(-90*(3.14/180)),this.timeOfDayIcons.forEach(e=>e.setAlpha(1))}tweenTimeOfDayIcon(){s.tweens.killTweensOf(this.timeOfDayIcons),this.resetIcons(),(s.timeOfDayAnimation===Mf.BACK?this.getBackTween():this.getBounceTween()).forEach(e=>s.tweens.add(e)),this.timeOfDayIconPairs.forEach(e=>{const t=e.shift();t&&e.push(t)})}onEncounterPhase(e){const t=s.arena.getTimeOfDay();this.currentTime!==t&&(this.currentTime=t,this.previousTime=this.currentTime-1,this.previousTime<Zt.DAWN&&(this.previousTime=Zt.NIGHT),this.tweenTimeOfDayIcon())}};u(du,"TimeOfDayWidget");let Ro=du;function Ir(y){if(!y||y===Si.NONE)return y;const t=`arenaFlyout:${Cg(y)}`,i=g.t(t);return!i||i===t?ia(y):i}u(Ir,"getFieldEffectText");const pu=class pu extends Phaser.GameObjects.Container{constructor(){super(s,0,0),this.flyoutWidth=170,this.flyoutHeight=51,this.fieldEffectInfo=[],this.onNewArenaEvent=e=>this.onNewArena(e),this.onTurnEndEvent=e=>this.onTurnEnd(e),this.onFieldEffectChangedEvent=e=>this.onFieldEffectChanged(e),this.setName("arena-flyout"),this.translationX=this.flyoutWidth,this.anchorX=0,this.anchorY=-98,this.flyoutParent=s.add.container(this.anchorX-this.translationX,this.anchorY),this.flyoutParent.setAlpha(0),this.add(this.flyoutParent),this.flyoutContainer=s.add.container(0,0),this.flyoutParent.add(this.flyoutContainer),this.flyoutWindow=me(0,0,this.flyoutWidth,this.flyoutHeight,!1,!1,0,0,es.THIN),this.flyoutContainer.add(this.flyoutWindow),this.flyoutWindowHeader=me(this.flyoutWidth/2,0,this.flyoutWidth/2,14,!1,!1,0,0,es.XTHIN),this.flyoutWindowHeader.setOrigin(),this.flyoutContainer.add(this.flyoutWindowHeader),this.flyoutTextHeader=D(this.flyoutWidth/2,0,g.t("arenaFlyout:activeBattleEffects"),O.BATTLE_INFO),this.flyoutTextHeader.setFontSize(54),this.flyoutTextHeader.setAlign("center"),this.flyoutTextHeader.setOrigin(),this.flyoutContainer.add(this.flyoutTextHeader),this.timeOfDayWidget=new Ro(this.flyoutWidth/2+this.flyoutWindowHeader.displayWidth/2),this.flyoutContainer.add(this.timeOfDayWidget),this.flyoutTextHeaderPlayer=D(6,5,g.t("arenaFlyout:player"),O.SUMMARY_BLUE),this.flyoutTextHeaderPlayer.setFontSize(54),this.flyoutTextHeaderPlayer.setAlign("left"),this.flyoutTextHeaderPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextHeaderPlayer),this.flyoutTextHeaderField=D(this.flyoutWidth/2,5,g.t("arenaFlyout:neutral"),O.SUMMARY_GREEN),this.flyoutTextHeaderField.setFontSize(54),this.flyoutTextHeaderField.setAlign("center"),this.flyoutTextHeaderField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextHeaderField),this.flyoutTextHeaderEnemy=D(this.flyoutWidth-6,5,g.t("arenaFlyout:enemy"),O.SUMMARY_RED),this.flyoutTextHeaderEnemy.setFontSize(54),this.flyoutTextHeaderEnemy.setAlign("right"),this.flyoutTextHeaderEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextHeaderEnemy),this.flyoutTextPlayer=D(6,13,"",O.BATTLE_INFO),this.flyoutTextPlayer.setLineSpacing(-1),this.flyoutTextPlayer.setFontSize(48),this.flyoutTextPlayer.setAlign("left"),this.flyoutTextPlayer.setOrigin(0,0),this.flyoutContainer.add(this.flyoutTextPlayer),this.flyoutTextField=D(this.flyoutWidth/2,13,"",O.BATTLE_INFO),this.flyoutTextField.setLineSpacing(-1),this.flyoutTextField.setFontSize(48),this.flyoutTextField.setAlign("center"),this.flyoutTextField.setOrigin(.5,0),this.flyoutContainer.add(this.flyoutTextField),this.flyoutTextEnemy=D(this.flyoutWidth-6,13,"",O.BATTLE_INFO),this.flyoutTextEnemy.setLineSpacing(-1),this.flyoutTextEnemy.setFontSize(48),this.flyoutTextEnemy.setAlign("right"),this.flyoutTextEnemy.setOrigin(1,0),this.flyoutContainer.add(this.flyoutTextEnemy),this.name="Fight Flyout",this.flyoutParent.name="Fight Flyout Parent",s.eventTarget.addEventListener(oi.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.addEventListener(oi.TURN_END,this.onTurnEndEvent)}onNewArena(e){this.fieldEffectInfo.length=0,s.arena.eventTarget.addEventListener(xs.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(xs.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(xs.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.addEventListener(xs.TAG_REMOVED,this.onFieldEffectChangedEvent)}clearText(){this.flyoutTextPlayer.text="",this.flyoutTextField.text="",this.flyoutTextEnemy.text=""}updateFieldText(){this.clearText(),this.fieldEffectInfo.sort((e,t)=>e.duration-t.duration);for(let e=0;e<this.fieldEffectInfo.length;e++){const t=this.fieldEffectInfo[e];let i;switch(t.effecType){case 0:i=this.flyoutTextPlayer;break;case 1:case 2:case 3:i=this.flyoutTextField;break;case 4:i=this.flyoutTextEnemy;break}i.text+=t.name,t.maxDuration!==0&&(i.text+="  "+t.duration+"/"+t.maxDuration),i.text+=`
`}}onFieldEffectChanged(e){const t=e;if(!t)return;let i;switch(t.constructor){case Nr:{const n=t,a=s.arena.getTag(n.arenaTagType)instanceof Eh;let r;n.arenaTagSide===bs.BOTH?r=3:n.arenaTagSide===bs.PLAYER?r=0:r=4;const o=a?this.fieldEffectInfo.findIndex(h=>n.arenaTagType===h.tagType&&r===h.effecType):-1;let l=Ir(Si[n.arenaTagType]);if(a){if(o!==-1){const h=n.arenaTagMaxLayers>1?` (${n.arenaTagLayers})`:"";this.fieldEffectInfo[o].name=`${l}${h}`;break}n.arenaTagMaxLayers>1&&(l=`${l} (${n.arenaTagLayers})`)}this.fieldEffectInfo.push({name:l,effecType:r,maxDuration:n.duration,duration:n.duration,tagType:n.arenaTagType});break}case nm:{const n=t;i=this.fieldEffectInfo.findIndex(a=>a.tagType===n.arenaTagType),i!==-1&&this.fieldEffectInfo.splice(i,1);break}case Hi:case Af:{const n=t,a=Ir(n instanceof Hi?en[n.oldWeatherType]:Ci[n.oldTerrainType]),r={name:Ir(n instanceof Hi?en[n.newWeatherType]:Ci[n.newTerrainType]),effecType:n instanceof Hi?1:2,maxDuration:n.duration,duration:n.duration};i=this.fieldEffectInfo.findIndex(o=>[r.name,a].includes(o.name)),i===-1?r.name!==void 0&&this.fieldEffectInfo.push(r):r.name?this.fieldEffectInfo[i]=r:this.fieldEffectInfo.splice(i,1);break}}this.updateFieldText()}onTurnEnd(e){if(!e)return;const i=[];this.fieldEffectInfo.forEach(n=>i.push(n));for(let n=0;n<i.length;n++){const a=i[n];a.maxDuration!==0&&(--a.duration,a.duration<=0&&this.fieldEffectInfo.splice(this.fieldEffectInfo.indexOf(a),1))}this.updateFieldText()}toggleFlyout(e){s.tweens.add({targets:this.flyoutParent,x:e?this.anchorX:this.anchorX-this.translationX,duration:de(125),ease:"Sine.easeInOut",alpha:e?1:0,onComplete:u(()=>this.timeOfDayWidget.parentVisible=e,"onComplete")})}destroy(e){s.eventTarget.removeEventListener(oi.NEW_ARENA,this.onNewArenaEvent),s.eventTarget.removeEventListener(oi.TURN_END,this.onTurnEndEvent),s.arena.eventTarget.removeEventListener(xs.WEATHER_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(xs.TERRAIN_CHANGED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(xs.TAG_ADDED,this.onFieldEffectChangedEvent),s.arena.eventTarget.removeEventListener(xs.TAG_REMOVED,this.onFieldEffectChangedEvent),super.destroy(e)}};u(pu,"ArenaFlyout");let Fo=pu;var Nh=(y=>(y[y.SWITCH=0]="SWITCH",y[y.SET=1]="SET",y))(Nh||{});const fu=class fu extends Ke{constructor(e){super(),this.phaseName="ActivatePriorityQueuePhase",this.type=e}start(){super.start(),s.phaseManager.startDynamicPhaseType(this.type),this.end()}getType(){return this.type}};u(fu,"ActivatePriorityQueuePhase");let Oi=fu;const gu=class gu extends Ke{constructor(){super(...arguments),this.phaseName="AddEnemyBuffModifierPhase"}start(){super.start();const e=s.currentBattle.waveIndex,t=e%1e3?e%250?ir.COMMON:ir.GREAT:ir.ULTRA;ja(s.getEnemyParty(),Bs.ENEMY_BUFF);const i=Math.ceil(e/250);for(let n=0;n<i;n++)s.addEnemyModifier(am(t,s.findModifiers(a=>a instanceof rm,!1)),!0,!0);s.updateModifiers(!1,!0),this.end()}};u(gu,"AddEnemyBuffModifierPhase");let Uo=gu;const mu=class mu extends bt{constructor(e,t){super(tt.ENEMY+e),this.phaseName="AttemptCapturePhase",this.pokeballType=t}start(){super.start();const e=this.getPokemon();if(!(e!=null&&e.hp))return this.end();const t=e.getTag(gs);t&&t.sprite.setVisible(!1),s.pokeballCounts[this.pokeballType]--,this.originalY=e.y;const i=3*e.getMaxHp(),n=2*e.hp,a=e.species.catchRate,r=om(this.pokeballType),o=e.status?lm(e.status.effect):1,l=Math.round((i-n)*a*r/i*o),h=Math.round(65536/Math.pow(255/l,.1875)),c=hm(l),d=e.randBattleSeedInt(256)<c,f=e.getFieldPositionOffset(),p=mi(this.pokeballType);this.pokeball=s.addFieldSprite(16,80,"pb",p),this.pokeball.setOrigin(.5,.625),s.field.add(this.pokeball),s.playSound(d?"se/crit_throw":"se/pb_throw"),s.time.delayedCall(300,()=>{s.field.moveBelow(this.pokeball,e)}),s.tweens.add({targets:this.pokeball,x:{value:236+f[0],ease:"Linear"},y:{value:16+f[1],ease:"Cubic.easeOut"},duration:500,onComplete:u(()=>{this.pokeball.setTexture("pb",`${p}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${p}_open`)),s.playSound("se/pb_rel"),e.tint(tn(this.pokeballType)),kf(this.pokeball.x,this.pokeball.y,this.pokeballType),s.tweens.add({targets:e,duration:500,ease:"Sine.easeIn",scale:.25,y:20,onComplete:u(()=>{this.pokeball.setTexture("pb",`${p}_opening`),e.setVisible(!1),s.playSound("se/pb_catch"),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${p}`));const T=u(()=>{let m=0;const C=this.pokeball.x,b=s.tweens.addCounter({from:0,to:1,repeat:d?2:4,yoyo:!0,ease:"Cubic.easeOut",duration:250,repeatDelay:500,onUpdate:u(S=>{if(m&&m<(d?2:4)){const x=S.getValue(),A=m%2===1?1:-1;this.pokeball.setX(C+x*4*A),this.pokeball.setAngle(x*27.5*A)}},"onUpdate"),onRepeat:u(()=>{if(!e.species.isObtainable())b.stop(),this.failCatch(m);else if(m++<(d?1:3))r===-1||d||l>=255||e.randBattleSeedInt(65536)<h?s.playSound("se/pb_move"):(b.stop(),this.failCatch(m));else if(d&&e.randBattleSeedInt(65536)>=h)b.stop(),this.failCatch(m);else{s.playSound("se/pb_lock"),um(this.pokeball);const S=s.add.sprite(this.pokeball.x,this.pokeball.y,"pb","pb");S.setOrigin(this.pokeball.originX,this.pokeball.originY),S.setTintFill(0),S.setAlpha(0),s.field.add(S),s.tweens.add({targets:S,alpha:.375,duration:200,easing:"Sine.easeOut",onComplete:u(()=>{s.tweens.add({targets:S,alpha:0,duration:200,easing:"Sine.easeIn",onComplete:u(()=>S.destroy(),"onComplete")})},"onComplete")})}},"onRepeat"),onComplete:u(()=>{this.catch()},"onComplete")})},"doShake");s.time.delayedCall(250,()=>cm(this.pokeball,16,72,350,T,d))},"onComplete")})},"onComplete")})}failCatch(e){var a;const t=this.getPokemon();s.playSound("se/pb_rel"),t.setY(this.originalY),((a=t.status)==null?void 0:a.effect)!==Ht.SLEEP&&t.cry(t.getHpRatio()>.25?void 0:{rate:.85}),t.tint(tn(this.pokeballType)),t.setVisible(!0),t.untint(250,"Sine.easeOut");const i=t.getTag(gs);i&&i.sprite.setVisible(!0);const n=mi(this.pokeballType);this.pokeball.setTexture("pb",`${n}_opening`),s.time.delayedCall(17,()=>this.pokeball.setTexture("pb",`${n}_open`)),s.tweens.add({targets:t,duration:250,ease:"Sine.easeOut",scale:1}),s.currentBattle.lastUsedPokeball=this.pokeballType,this.removePb(),this.end()}catch(){const e=this.getPokemon(),t=e.fusionSpecies?e.getFusionSpeciesForm():e.getSpeciesForm();t.abilityHidden&&(e.fusionSpecies?e.fusionAbilityIndex:e.abilityIndex)===t.getAbilityCount()-1&&s.validateAchv(Ae.HIDDEN_ABILITY),e.species.subLegendary&&s.validateAchv(Ae.CATCH_SUB_LEGENDARY),e.species.legendary&&s.validateAchv(Ae.CATCH_LEGENDARY),e.species.mythical&&s.validateAchv(Ae.CATCH_MYTHICAL),s.pokemonInfoContainer.show(e,!0),s.gameData.updateSpeciesDexIvs(e.species.getRootSpeciesId(!0),e.ivs),s.ui.showText(g.t("battle:pokemonCaught",{pokemonName:we(e)}),null,()=>{const i=u(()=>{s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),s.pokemonInfoContainer.hide(),this.removePb(),this.end()},"end"),n=u(()=>{s.addFaintedEnemyScore(e),e.hp=0,e.trySetStatus(Ht.FAINT),s.clearEnemyHeldItemModifiers(),e.leaveField(!0,!0,!0)},"removePokemon"),a=u(r=>{const o=e.addToParty(this.pokeballType,r),l=s.findModifiers(h=>h instanceof Qt,!1);s.getPlayerParty().filter(h=>h.isShiny()).length===sa&&s.validateAchv(Ae.SHINY_PARTY),Promise.all(l.map(h=>s.addModifier(h,!0))).then(()=>{s.updateModifiers(!0),n(),o?o.loadAssets().then(i):i()})},"addToParty");Promise.all([e.hideInfo(),s.gameData.setPokemonCaught(e)]).then(()=>{if(s.getPlayerParty().length===sa){const r=u(()=>{s.ui.showText(g.t("battle:partyFull",{pokemonName:e.getNameToRender()}),null,()=>{s.pokemonInfoContainer.makeRoomForConfirmUi(1,!0),s.ui.setMode(_.CONFIRM,()=>{const o=s.addPlayerPokemon(e.species,e.level,e.abilityIndex,e.formIndex,e.gender,e.shiny,e.variant,e.ivs,e.nature,e);s.ui.setMode(_.SUMMARY,o,0,Nf.DEFAULT,()=>{s.ui.setMode(_.MESSAGE).then(()=>{r()})},!1)},()=>{const o={shiny:e.shiny,variant:e.variant,form:e.formIndex,female:e.gender===At.FEMALE};s.ui.setOverlayMode(_.POKEDEX_PAGE,e.species,o,null,null,()=>{s.ui.setMode(_.MESSAGE).then(()=>{r()})})},()=>{s.ui.setMode(_.PARTY,Wt.RELEASE,this.fieldIndex,(o,l)=>{s.ui.setMode(_.MESSAGE).then(()=>{o<6?a(o):r()})})},()=>{s.ui.setMode(_.MESSAGE).then(()=>{n(),i()})},"fullParty")})},"promptRelease");r()}else a()})},0,!0)}removePb(){s.tweens.add({targets:this.pokeball,duration:250,delay:250,ease:"Sine.easeIn",alpha:0,onComplete:u(()=>this.pokeball.destroy(),"onComplete")})}};u(mu,"AttemptCapturePhase");let Vo=mu;const yu=class yu extends bt{constructor(){super(...arguments),this.phaseName="AttemptRunPhase",this.forceFailEscape=!1}start(){super.start();const e=s.getPlayerField(),t=s.getEnemyField(),i=this.getPokemon(),n=new rt(0);this.attemptRunAway(e,t,n),ot("RunSuccessAbAttr",i,null,!1,n),i.randBattleSeedInt(100)<n.value&&!this.forceFailEscape?(t.forEach(a=>dm("PreLeaveFieldAbAttr",a)),s.playSound("se/flee"),s.phaseManager.queueMessage(g.t("battle:runAwaySuccess"),null,!0,500),s.tweens.add({targets:[s.arenaEnemy,t].flat(),alpha:0,duration:250,ease:"Sine.easeIn",onComplete:u(()=>t.forEach(a=>a.destroy()),"onComplete")}),s.clearEnemyHeldItemModifiers(),t.forEach(a=>{a.hideInfo().then(()=>a.destroy()),a.hp=0,a.trySetStatus(Ht.FAINT)}),s.phaseManager.pushNew("BattleEndPhase",!1),(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")):(i.turnData.failedRunAway=!0,s.phaseManager.queueMessage(g.t("battle:runAwayCannotEscape"),null,!0,500)),this.end()}attemptRunAway(e,t,i){const n=t.reduce((p,T)=>p+T.getStat(Pt.SPD),0),a=e.reduce((p,T)=>p+T.getStat(Pt.SPD),0);let r=!1;for(let p=0;p<t.length;p++)r=r||t[p].isBoss();const o=a/n,l=r?6:4,h=5,c=r?25:95,d=r?2:10,f=(c-h)/l;i.value=Phaser.Math.Clamp(Math.round(f*o+h+d*s.currentBattle.escapeAttempts++),h,c)}};u(yu,"AttemptRunPhase");let Ho=yu;const Tu=class Tu extends st{constructor(e){super(),this.phaseName="BattleEndPhase",this.isVictory=e}start(){for(super.start(),s.phaseManager.phaseQueue=s.phaseManager.phaseQueue.filter(t=>t.is("BattleEndPhase")?(this.isVictory||(this.isVictory=t.isVictory),!1):!0);s.phaseManager.tryRemoveUnshiftedPhase(t=>t.is("BattleEndPhase")?(this.isVictory||(this.isVictory=t.isVictory),!0):!1););s.gameData.gameStats.battles++,s.gameMode.isEndless&&s.currentBattle.waveIndex+1>s.gameData.gameStats.highestEndlessWave&&(s.gameData.gameStats.highestEndlessWave=s.currentBattle.waveIndex+1),this.isVictory&&(s.currentBattle.addBattleScore(),s.currentBattle.trainer&&s.gameData.gameStats.trainersDefeated++),s.gameMode.isEndless&&s.currentBattle.waveIndex>=5850&&(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase",!0));for(const t of s.getField())t&&(t.tempSummonData.waveTurnCount=1);for(const t of s.getPokemonAllowedInBattle())pm("PostBattleAbAttr",t,!1,this.isVictory);s.currentBattle.moneyScattered&&s.currentBattle.pickUpScatteredMoney(),s.clearEnemyHeldItemModifiers();for(const t of s.getEnemyParty())try{t.destroy()}catch{console.warn("Unable to destroy stale pokemon object in BattleEndPhase:",t)}const e=s.findModifiers(t=>t instanceof fm||t instanceof Tp);for(const t of e){const i=[];t instanceof Tp&&i.push(s.getPokemonById(t.pokemonId)),t.lapse(...i)||s.removeModifier(t)}s.updateModifiers(),this.end()}};u(Tu,"BattleEndPhase");let Yo=Tu;const Cu=class Cu extends Us{constructor(){super(...arguments),this.phaseName="BerryPhase"}start(){super.start(),this.executeForAll(e=>{this.eatBerries(e),ot("RepeatBerryNextTurnAbAttr",e,null)}),this.end()}eatBerries(e){if(!!!s.findModifier(n=>n instanceof Cp&&n.shouldApply(e),e.isPlayer()))return;const i=new at(!1);if(e.getOpponents().forEach(n=>ot("PreventBerryUseAbAttr",n,i)),i.value){s.phaseManager.queueMessage(g.t("abilityTriggers:preventBerryUse",{pokemonNameWithAffix:we(e)}));return}s.phaseManager.unshiftNew("CommonAnimPhase",e.getBattlerIndex(),e.getBattlerIndex(),Js.USE_ITEM);for(const n of s.applyModifiers(Cp,e.isPlayer(),e))n.consumed&&(n.consumed=!1,e.loseHeldItem(n)),s.eventTarget.dispatchEvent(new gm(n));s.updateModifiers(e.isPlayer()),ot("HealFromBerryUseAbAttr",e,new at(!1))}};u(Cu,"BerryPhase");let Wo=Cu;const Su=class Su extends Ke{constructor(e){super(),this.phaseName="CheckStatusEffectPhase",this.order=e}start(){var t;const e=s.getField();for(const i of this.order)(t=e[i].status)!=null&&t.isPostTurn()&&s.phaseManager.unshiftNew("PostTurnStatusEffectPhase",i);this.end()}};u(Su,"CheckStatusEffectPhase");let Go=Su;const bu=class bu extends st{constructor(e,t){super(),this.phaseName="CheckSwitchPhase",this.fieldIndex=e,this.useName=t}start(){super.start();const e=s.getPlayerField()[this.fieldIndex];if(s.battleStyle===Nh.SET)return super.end();if(s.field.getAll().indexOf(e)===-1)return s.phaseManager.unshiftNew("SummonMissingPhase",this.fieldIndex),super.end();if(!s.getPlayerParty().slice(1).filter(t=>t.isActive()).length)return super.end();if(e.getTag(He.FRENZY)||e.isTrapped()||s.getPlayerField().some(t=>t.getTag(He.COMMANDED)))return super.end();s.ui.showText(g.t("battle:switchQuestion",{pokemonName:this.useName?we(e):g.t("battle:pokemon")}),null,()=>{s.ui.setMode(_.CONFIRM,()=>{s.ui.setMode(_.MESSAGE),s.phaseManager.unshiftNew("SwitchPhase",ut.INITIAL_SWITCH,this.fieldIndex,!1,!0),this.end()},()=>{s.ui.setMode(_.MESSAGE),this.end()})})}};u(bu,"CheckSwitchPhase");let Ko=bu;const Eu=class Eu extends Us{constructor(e){super(),this.phaseName="CommandPhase",this.fieldIndex=e}start(){var r,o,l,h,c;super.start(),s.updateGameInfo();const e=s.ui.handlers[_.COMMAND],t=s.currentBattle.battleType===Ce.MYSTERY_ENCOUNTER||s.currentBattle.battleType===Ce.TRAINER||s.arena.biomeType===Te.END;if(e&&(s.currentBattle.turn===1&&(!s.commandCursorMemory||t)||e.getCursor()===be.POKEMON?e.setCursor(be.FIGHT):e.setCursor(e.getCursor())),this.fieldIndex)if(s.getPlayerField().filter(d=>d.isActive()).length===1)this.fieldIndex=as.CENTER;else{const d=s.currentBattle.turnCommands[this.fieldIndex-1];((d==null?void 0:d.command)===be.BALL||(d==null?void 0:d.command)===be.RUN)&&(s.currentBattle.turnCommands[this.fieldIndex]={command:d==null?void 0:d.command,skip:!0})}if((r=s.currentBattle)!=null&&r.double&&((l=(o=this.getPokemon().getAlly())==null?void 0:o.getTag(He.COMMANDED))==null?void 0:l.getSourcePokemon())===this.getPokemon()&&(s.currentBattle.turnCommands[this.fieldIndex]={command:be.FIGHT,move:{move:It.NONE,targets:[]},skip:!0}),this.getPokemon().getTag(He.ENCORE)&&this.getPokemon().lapseTag(He.ENCORE),(h=s.currentBattle.turnCommands[this.fieldIndex])!=null&&h.skip)return this.end();const n=s.getPlayerField()[this.fieldIndex],a=n.getMoveQueue();for(;a.length&&a[0]&&a[0].move&&!a[0].virtual&&(!n.getMoveset().find(d=>d.moveId===a[0].move)||!n.getMoveset()[n.getMoveset().findIndex(d=>d.moveId===a[0].move)].isUsable(n,a[0].ignorePP));)a.shift();if(a.length>0){const d=a[0];if(!d.move)this.handleCommand(be.FIGHT,-1);else{const f=n.getMoveset().findIndex(p=>p.moveId===d.move);f>-1&&n.getMoveset()[f].isUsable(n,d.ignorePP)||d.virtual?this.handleCommand(be.FIGHT,f,d.ignorePP,d):s.ui.setMode(_.COMMAND,this.fieldIndex)}}else s.currentBattle.isBattleMysteryEncounter()&&((c=s.currentBattle.mysteryEncounter)!=null&&c.skipToFightInput)?(s.ui.clearText(),s.ui.setMode(_.FIGHT,this.fieldIndex)):s.ui.setMode(_.COMMAND,this.fieldIndex)}handleCommand(e,t,...i){var r,o;const n=s.getPlayerField()[this.fieldIndex];let a=!1;switch(e){case be.TERA:case be.FIGHT:let l=!1;const h=i.length===2?i[1]:void 0;if(t===-1||n.trySelectMove(t,i[0])||(l=t>-1&&!n.getMoveset().filter(m=>m.isUsable(n)).length)){let m;l?m=It.STRUGGLE:h!==void 0?m=h.move:t>-1?m=n.getMoveset()[t].moveId:m=It.NONE;const C={command:be.FIGHT,cursor:t,move:{move:m,targets:[],ignorePP:i[0]},args:i},b={command:e,targets:[this.fieldIndex],skip:e===be.FIGHT},S=h===void 0?Sh(n,m):{targets:h.targets,multiple:h.targets.length>1};m||(C.targets=[this.fieldIndex]),we(n),S.targets.length>1&&S.multiple&&s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),C.move&&(S.targets.length<=1||S.multiple)?C.move.targets=S.targets:C.move&&n.getTag(He.CHARGING)&&n.getMoveQueue().length>=1?C.move.targets=n.getMoveQueue()[0].targets:s.phaseManager.unshiftNew("SelectTargetPhase",this.fieldIndex),s.currentBattle.preTurnCommands[this.fieldIndex]=b,s.currentBattle.turnCommands[this.fieldIndex]=C,a=!0}else if(t<n.getMoveset().length){const m=n.getMoveset()[t];s.ui.setMode(_.MESSAGE);const C=n.isMoveRestricted(m.moveId,n)?n.getRestrictingTag(m.moveId,n).selectionDeniedText(n,m.moveId):m.getName().endsWith(" (N)")?"battle:moveNotImplemented":"battle:moveNoPP",b=m.getName().replace(" (N)","");s.ui.showText(g.t(C,{moveName:b}),null,()=>{s.ui.clearText(),s.ui.setMode(_.FIGHT,this.fieldIndex)},null,!0)}break;case be.BALL:const c=s.getEnemyField().filter(m=>m.isActive(!0)).some(m=>!s.gameData.dexData[m.species.speciesId].caughtAttr)&&s.gameData.getStarterCount(m=>!!m.caughtAttr)<Object.keys(Re).length-1;if(s.arena.biomeType===Te.END&&(!s.gameMode.isClassic||s.gameMode.isFreshStartChallenge()||c))s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noPokeballForce"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else if(s.currentBattle.battleType===Ce.TRAINER)s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noPokeballTrainer"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else if(s.currentBattle.isBattleMysteryEncounter()&&!s.currentBattle.mysteryEncounter.catchAllowed)s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noPokeballMysteryEncounter"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else{const m=s.getEnemyField().filter(C=>C.isActive(!0)).map(C=>C.getBattlerIndex());if(m.length>1)s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noPokeballMulti"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else if(t<5){const C=s.getEnemyField().find(b=>b.isActive(!0));C!=null&&C.isBoss()&&(C==null?void 0:C.bossSegmentIndex)>=1&&!(C!=null&&C.hasAbility(bn.WONDER_GUARD,!1,!0))&&t<Zn.MASTER_BALL?(s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noPokeballStrong"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0)):(s.currentBattle.turnCommands[this.fieldIndex]={command:be.BALL,cursor:t},s.currentBattle.turnCommands[this.fieldIndex].targets=m,this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),a=!0)}}break;case be.POKEMON:case be.RUN:const d=e===be.POKEMON,{currentBattle:f,arena:p}=s,T=(r=f.mysteryEncounter)==null?void 0:r.fleeAllowed;if(!d&&(p.biomeType===Te.END||!Ee(T)&&!T))s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noEscapeForce"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else if(!d&&(f.battleType===Ce.TRAINER||((o=f.mysteryEncounter)==null?void 0:o.encounterMode)===ns.TRAINER_BATTLE))s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:noEscapeTrainer"),null,()=>{s.ui.showText("",0),s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else{const m=d&&i[0],C=[];if(m||!n.isTrapped(C))f.turnCommands[this.fieldIndex]=d?{command:be.POKEMON,cursor:t,args:i}:{command:be.RUN},a=!0,!d&&this.fieldIndex&&(f.turnCommands[this.fieldIndex-1].skip=!0);else if(C.length>0)d||s.ui.setMode(_.MESSAGE),s.ui.showText(C[0],null,()=>{s.ui.showText("",0),d||s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0);else{const b=n.getTag(mm),S=s.arena.getTagOnSide(Si.FAIRY_LOCK,bs.PLAYER);if(!b&&!S){g.t(`battle:noEscape${d?"Switch":"Flee"}`);break}d||(s.ui.setMode(_.COMMAND,this.fieldIndex),s.ui.setMode(_.MESSAGE));const x=u(A=>{s.ui.showText(g.t("battle:noEscapePokemon",{pokemonName:A.sourceId&&s.getPokemonById(A.sourceId)?we(s.getPokemonById(A.sourceId)):"",moveName:A.getMoveName(),escapeVerb:d?g.t("battle:escapeVerbSwitch"):g.t("battle:escapeVerbFlee")}),null,()=>{s.ui.showText("",0),d||s.ui.setMode(_.COMMAND,this.fieldIndex)},null,!0)},"showNoEscapeText");b?x(b):S&&x(S)}}break}return a&&this.end(),a}cancel(){this.fieldIndex&&(s.phaseManager.unshiftNew("CommandPhase",0),s.phaseManager.unshiftNew("CommandPhase",1),this.end())}getFieldIndex(){return this.fieldIndex}getPokemon(){return s.getPlayerField()[this.fieldIndex]}end(){s.ui.setMode(_.MESSAGE).then(()=>super.end())}};u(Eu,"CommandPhase");let zo=Eu;const Iu=class Iu extends bt{constructor(e,t,i=null,n=!1){super(e),this.phaseName="CommonAnimPhase",this.anim=i,this.targetIndex=t,this.playOnEmptyField=n}setAnimation(e){this.anim=e}start(){const e=this.targetIndex!==void 0?(this.player?s.getEnemyField():s.getPlayerField())[this.targetIndex]:this.getPokemon();new $a(this.anim,this.getPokemon(),e).play(!1,()=>{this.end()})}};u(Iu,"CommonAnimPhase");let gn=Iu;const vu=class vu extends bt{constructor(e,t,i=Ge.EFFECTIVE,n=!1){super(e),this.phaseName="DamageAnimPhase",this.amount=t,this.damageResult=i,this.critical=n}start(){if(super.start(),this.damageResult===Ge.ONE_HIT_KO||this.damageResult===Ge.INDIRECT_KO){s.moveAnimations&&s.toggleInvert(!0),s.time.delayedCall(de(1e3),()=>{s.toggleInvert(!1),this.applyDamage()});return}this.applyDamage()}updateAmount(e){this.amount=e}applyDamage(){switch(this.damageResult){case Ge.EFFECTIVE:case Ge.CONFUSION:s.playSound("se/hit");break;case Ge.SUPER_EFFECTIVE:case Ge.INDIRECT_KO:case Ge.ONE_HIT_KO:s.playSound("se/hit_strong");break;case Ge.NOT_VERY_EFFECTIVE:s.playSound("se/hit_weak");break}if(this.amount&&s.damageNumberHandler.add(this.getPokemon(),this.amount,this.damageResult,this.critical),this.damageResult!==Ge.INDIRECT&&this.amount>0){const e=s.time.addEvent({delay:100,repeat:5,startAt:200,callback:u(()=>{this.getPokemon().getSprite().setVisible(e.repeatCount%2===0),e.repeatCount||this.getPokemon().updateInfo().then(()=>this.end())},"callback")})}else this.getPokemon().updateInfo().then(()=>this.end())}end(){s.currentBattle.battleSpec===Ft.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};u(vu,"DamageAnimPhase");let jo=vu;var ag=(y=>(y.EGG_COUNT_CHANGED="onEggCountChanged",y))(ag||{});const Ou=class Ou extends Event{constructor(e){super("onEggCountChanged"),this.eggCount=e}};u(Ou,"EggCountChangedEvent");let $o=Ou;const xu=class xu extends Phaser.GameObjects.Container{constructor(e){super(s,0,0),this.WINDOW_DEFAULT_WIDTH=37,this.WINDOW_MEDIUM_WIDTH=42,this.WINDOW_HEIGHT=26,this.onEggCountChangedEvent=i=>this.onEggCountChanged(i),this.eggCount=e,s.ui.getHandler().eventTarget.addEventListener(ag.EGG_COUNT_CHANGED,this.onEggCountChangedEvent),this.setup()}setup(){const e=this.eggCount>9?this.WINDOW_MEDIUM_WIDTH:this.WINDOW_DEFAULT_WIDTH;this.eggCountWindow=me(5,5,e,this.WINDOW_HEIGHT),this.setVisible(this.eggCount>1),this.add(this.eggCountWindow);const t=s.add.sprite(19,18,"egg","egg_0").setScale(.32);this.eggCountText=D(28,13,`${this.eggCount}`,O.MESSAGE,{fontSize:"66px"}).setName("text-egg-count"),this.add([t,this.eggCountText])}setWindowToDefaultSize(){this.eggCountWindow.setSize(this.WINDOW_DEFAULT_WIDTH,this.WINDOW_HEIGHT)}onEggCountChanged(e){var n;const t=e;if(!t||!((n=this.eggCountText)!=null&&n.data))return;const i=t.eggCount;i<10&&this.setWindowToDefaultSize(),i>0?this.eggCountText.setText(i.toString()):this.eggCountText.setVisible(!1)}};u(xu,"EggCounterContainer");let Xo=xu;const _u=class _u extends Ke{constructor(e,t,i){super(),this.phaseName="EggHatchPhase",this.eggLapsePhase=e,this.egg=t,this.eggsToHatchCount=i}start(){super.start(),s.ui.setModeForceTransition(_.EGG_HATCH_SCENE).then(()=>{if(!this.egg)return this.end();const e=s.gameData.eggs.findIndex(n=>n.id===this.egg.id);if(e===-1)return this.end();s.gameData.eggs.splice(e,1),s.fadeOutBgm(void 0,!1),this.eggHatchHandler=s.ui.getHandler(),this.eggHatchContainer=this.eggHatchHandler.eggHatchContainer,this.eggHatchBg=s.add.image(0,0,"default_bg"),this.eggHatchBg.setOrigin(0,0),this.eggHatchContainer.add(this.eggHatchBg),this.eggContainer=s.add.container(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2),this.eggSprite=s.add.sprite(0,0,"egg",`egg_${this.egg.getKey()}`),this.eggCrackSprite=s.add.sprite(0,0,"egg_crack","0"),this.eggCrackSprite.setVisible(!1),this.eggLightraysOverlay=s.add.sprite(-this.eggHatchBg.displayWidth/2+4,-this.eggHatchBg.displayHeight/2,"egg_lightrays","3"),this.eggLightraysOverlay.setOrigin(0,0),this.eggLightraysOverlay.setVisible(!1),this.eggContainer.add(this.eggSprite),this.eggContainer.add(this.eggCrackSprite),this.eggContainer.add(this.eggLightraysOverlay),this.eggHatchContainer.add(this.eggContainer),this.eggCounterContainer=new Xo(this.eggsToHatchCount),this.eggHatchContainer.add(this.eggCounterContainer);const t=u(()=>{const n=s.add.sprite(this.eggHatchBg.displayWidth/2,this.eggHatchBg.displayHeight/2,"pkmn__sub");return n.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),n},"getPokemonSprite");this.eggHatchContainer.add(this.pokemonSprite=t()),this.pokemonShinySparkle=s.add.sprite(this.pokemonSprite.x,this.pokemonSprite.y,"shiny"),this.pokemonShinySparkle.setVisible(!1),this.eggHatchContainer.add(this.pokemonShinySparkle),this.eggHatchOverlay=s.add.rectangle(0,-s.game.canvas.height/6,s.game.canvas.width/6,s.game.canvas.height/6,16777215),this.eggHatchOverlay.setOrigin(0,0),this.eggHatchOverlay.setAlpha(0),s.fieldUI.add(this.eggHatchOverlay),this.infoContainer=new cn,this.infoContainer.setup(),this.eggHatchContainer.add(this.infoContainer);const i=this.generatePokemon();i.fusionSpecies&&i.clearFusionSpecies(),this.pokemonSprite.setVisible(!1),this.pokemon=i,i.loadAssets().then(()=>{this.canSkip=!0,s.time.delayedCall(1e3,()=>{this.hatched||(this.evolutionBgm=s.playSoundWithoutBgm("evolution"))}),s.time.delayedCall(2e3,()=>{this.hatched||(this.eggCrackSprite.setVisible(!0),this.doSpray(1,this.eggSprite.displayHeight/-2),this.doEggShake(2).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(this.doSpray(2,this.eggSprite.displayHeight/-4),this.eggCrackSprite.setFrame("1"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("2")),this.doEggShake(4).then(()=>{this.hatched||s.time.delayedCall(1e3,()=>{this.hatched||(s.playSound("se/egg_crack"),this.doSpray(4),this.eggCrackSprite.setFrame("3"),s.time.delayedCall(125,()=>this.eggCrackSprite.setFrame("4")),this.doEggShake(8,2).then(()=>{this.hatched||this.doHatch()}))})}))})}))})})})}end(){s.phaseManager.findPhase(e=>e.is("EggHatchPhase"))?this.eggHatchHandler.clear():s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),super.end()}doEggShake(e,t,i){return new Promise(n=>{t===void 0&&(t=0),i===void 0&&(i=0),s.playSound("se/pb_move"),s.tweens.add({targets:this.eggContainer,x:`-=${e/(i?1:2)}`,ease:"Sine.easeInOut",duration:125,onComplete:u(()=>{s.tweens.add({targets:this.eggContainer,x:`+=${e}`,ease:"Sine.easeInOut",duration:250,onComplete:u(()=>{if(i++,i<t)return this.doEggShake(e,t,i).then(()=>n());s.tweens.add({targets:this.eggContainer,x:`-=${e/2}`,ease:"Sine.easeInOut",duration:125,onComplete:u(()=>n(),"onComplete")})},"onComplete")})},"onComplete")})})}trySkip(){var e;return!this.canSkip||this.skipped||((e=this.eggCounterContainer.eggCountText)==null?void 0:e.data)===void 0?!1:(this.skipped=!0,this.hatched?this.doReveal():this.doHatch(),!0)}doHatch(){this.canSkip=!1,this.hatched=!0,this.evolutionBgm&&Cs.fadeOut(s,this.evolutionBgm,de(100));for(let e=0;e<5;e++)s.time.delayedCall(de(375*e),()=>s.playSound("se/egg_hatch",{volume:1-e*.2}));this.eggLightraysOverlay.setVisible(!0),this.eggLightraysOverlay.play("egg_lightrays"),s.tweens.add({duration:de(125),targets:this.eggHatchOverlay,alpha:1,ease:"Cubic.easeIn",onComplete:u(()=>{this.skipped=!1,this.canSkip=!0},"onComplete")}),s.time.delayedCall(de(1500),()=>{this.canSkip=!1,this.skipped||this.doReveal()})}doReveal(){const e=this.pokemon.isShiny();this.pokemon.species.subLegendary&&s.validateAchv(Ae.HATCH_SUB_LEGENDARY),this.pokemon.species.legendary&&s.validateAchv(Ae.HATCH_LEGENDARY),this.pokemon.species.mythical&&s.validateAchv(Ae.HATCH_MYTHICAL),e&&s.validateAchv(Ae.HATCH_SHINY),this.eggContainer.setVisible(!1);const t=this.pokemon.getSpriteKey(!0);try{this.pokemonSprite.play(t)}catch(i){console.error(`Failed to play animation for ${t}`,i)}this.pokemonSprite.setPipelineData("ignoreTimeTint",!0),this.pokemonSprite.setPipelineData("spriteKey",this.pokemon.getSpriteKey()),this.pokemonSprite.setPipelineData("shiny",this.pokemon.shiny),this.pokemonSprite.setPipelineData("variant",this.pokemon.variant),this.pokemonSprite.setVisible(!0),s.time.delayedCall(de(250),()=>{this.eggsToHatchCount--,this.eggHatchHandler.eventTarget.dispatchEvent(new $o(this.eggsToHatchCount)),this.pokemon.cry(),e&&s.time.delayedCall(de(500),()=>{ym(this.pokemonShinySparkle,this.pokemon.variant)}),s.time.delayedCall(de(this.skipped?e?750:250:e?1750:1250),()=>{this.infoContainer.show(this.pokemon,!1,this.skipped?2:1),s.playSoundWithoutBgm("evolution_fanfare"),s.ui.showText(g.t("egg:hatchFromTheEgg",{pokemonName:this.pokemon.species.getExpandedSpeciesName()}),null,()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setPokemonCaught(this.pokemon,!0,!0).then(()=>{s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex).then(i=>{this.eggHatchData.setEggMoveUnlocked(i),s.ui.showText("",0),this.end()})})},null,!0,3e3)})}),s.tweens.add({duration:de(this.skipped?500:3e3),targets:this.eggHatchOverlay,alpha:0,ease:"Cubic.easeOut"})}sin(e,t){return t*Math.sin(e*(Math.PI/128))}doSpray(e,t){s.tweens.addCounter({repeat:e,duration:ds(1),onRepeat:u(()=>{this.doSprayParticle(Jt(8),t||0)},"onRepeat")})}doSprayParticle(e,t){const i=this.eggHatchBg.displayWidth/2,n=this.eggHatchBg.displayHeight/2+t,a=this.egg.isManaphyEgg()?"1":this.egg.tier.toString(),r=s.add.image(i,n,"egg_shard",`${a}_${Math.floor(e/2)}`);this.eggHatchContainer.add(r);let o=0,l=0;const h=3-Jt(8),c=24+Jt(32),d=s.tweens.addCounter({repeat:-1,duration:ds(1),onRepeat:u(()=>{f()},"onRepeat")}),f=u(()=>{const p=this.skipped?6:1;l+=p,e<160?(r.setPosition(i+h*o/3,n+l),r.y+=-this.sin(e,c),o>108&&r.setScale(1-(o-108)/20),e+=2*p,o+=p):(r.destroy(),d.remove())},"updateParticle");f()}generatePokemon(){return this.eggHatchData=this.eggLapsePhase.generatePokemon(this.egg),this.eggMoveIndex=this.eggHatchData.eggMoveIndex,this.eggHatchData.pokemon}};u(_u,"EggHatchPhase");let qo=_u;const Au=class Au{constructor(e,t){this.pokemon=e,this.eggMoveIndex=t}setEggMoveUnlocked(e){this.eggMoveUnlocked=e}setDex(){const e=s.gameData.dexData[this.pokemon.species.speciesId],t=s.gameData.starterData[this.pokemon.species.getRootSpeciesId()];this.dexEntryBeforeUpdate={seenAttr:e.seenAttr,caughtAttr:e.caughtAttr,natureAttr:e.natureAttr,seenCount:e.seenCount,caughtCount:e.caughtCount,hatchedCount:e.hatchedCount,ivs:[...e.ivs]},this.starterDataEntryBeforeUpdate={moveset:t.moveset,eggMoves:t.eggMoves,candyCount:t.candyCount,friendship:t.friendship,abilityAttr:t.abilityAttr,passiveAttr:t.passiveAttr,valueReduction:t.valueReduction,classicWinCount:t.classicWinCount}}getDex(){return this.dexEntryBeforeUpdate}getStarterEntry(){return this.starterDataEntryBeforeUpdate}updatePokemon(e=!1){return new Promise(t=>{s.gameData.setPokemonCaught(this.pokemon,!0,!0,e).then(()=>{s.gameData.updateSpeciesDexIvs(this.pokemon.species.speciesId,this.pokemon.ivs),s.gameData.setEggMoveUnlocked(this.pokemon.species,this.eggMoveIndex,e).then(i=>{this.setEggMoveUnlocked(i),t()})})})}};u(Au,"EggHatchData");let Qo=Au;const wu=class wu extends Ke{constructor(){super(...arguments),this.phaseName="EggLapsePhase",this.eggHatchData=[],this.minEggsToSkip=2}start(){super.start();const e=s.gameData.eggs.filter(i=>ne.EGG_IMMEDIATE_HATCH_OVERRIDE?!0:--i.hatchWaves<1),t=e.length;this.eggHatchData=[],t>0?t>=this.minEggsToSkip&&s.eggSkipPreference===1?s.ui.showText(g.t("battle:eggHatching"),0,()=>{s.ui.showText(g.t("battle:eggSkipPrompt",{eggsToHatch:t}),0),s.ui.setModeWithoutClear(_.CONFIRM,()=>{this.hatchEggsSkipped(e),this.showSummary()},()=>{this.hatchEggsRegular(e),this.end()},null,null,null,1e3,!0)},100,!0):t>=this.minEggsToSkip&&s.eggSkipPreference===2?(s.phaseManager.queueMessage(g.t("battle:eggHatching")),this.hatchEggsSkipped(e),this.showSummary()):(s.phaseManager.queueMessage(g.t("battle:eggHatching")),this.hatchEggsRegular(e),this.end()):this.end()}hatchEggsRegular(e){let t=e.length;for(const i of e)s.phaseManager.unshiftNew("EggHatchPhase",this,i,t),t--}hatchEggsSkipped(e){for(const t of e)this.hatchEggSilently(t)}showSummary(){s.phaseManager.unshiftNew("EggSummaryPhase",this.eggHatchData),this.end()}hatchEggSilently(e){const t=s.gameData.eggs.findIndex(a=>a.id===e.id);if(t===-1)return this.end();s.gameData.eggs.splice(t,1);const n=this.generatePokemon(e).pokemon;n.fusionSpecies&&n.clearFusionSpecies(),n.species.subLegendary&&s.validateAchv(Ae.HATCH_SUB_LEGENDARY),n.species.legendary&&s.validateAchv(Ae.HATCH_LEGENDARY),n.species.mythical&&s.validateAchv(Ae.HATCH_MYTHICAL),n.isShiny()&&s.validateAchv(Ae.HATCH_SHINY)}generatePokemon(e){let t,i;return s.executeWithSeedOffset(()=>{t=e.generatePlayerPokemon(),i=new Qo(t,e.eggMoveIndex),i.setDex(),this.eggHatchData.push(i)},e.id,kr.toString()),i}};u(wu,"EggLapsePhase");let Zo=wu;const Mu=class Mu extends Ke{constructor(e){super(),this.phaseName="EggSummaryPhase",this.eggHatchData=e}start(){super.start();const e=u(t=>{t>=this.eggHatchData.length?s.ui.setModeForceTransition(_.EGG_HATCH_SUMMARY,this.eggHatchData).then(()=>{s.fadeOutBgm(void 0,!1)}):(this.eggHatchData[t].setDex(),this.eggHatchData[t].updatePokemon().then(()=>{t<this.eggHatchData.length&&e(t+1)}))},"updateNextPokemon");e(0)}end(){s.time.delayedCall(250,()=>s.setModifiersVisible(!0)),s.ui.setModeForceTransition(_.MESSAGE).then(()=>{super.end()})}};u(Mu,"EggSummaryPhase");let Jo=Mu;const ku=class ku extends st{constructor(e=!1){super(),this.phaseName="EncounterPhase",this.loaded=e}start(){var a,r,o,l;super.start(),s.updateGameInfo(),s.initSession(),s.eventTarget.dispatchEvent(new Tm),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&s.phaseManager.unshiftNew("GameOverPhase");const e=[],t=s.currentBattle;t.isBattleMysteryEncounter()&&!t.mysteryEncounter&&s.executeWithSeedOffset(()=>{const h=t.mysteryEncounterType;t.mysteryEncounter=s.getMysteryEncounter(h)},t.waveIndex*16);const i=t.mysteryEncounter;i&&(s.executeWithSeedOffset(()=>{i.onInit&&i.onInit(),i.populateDialogueTokensFromRequirements()},t.waveIndex),i.encounterAnimations&&i.encounterAnimations.length>0&&e.push(Cm(i.encounterAnimations).then(()=>Sm(!0))),i.initIntroVisuals(),s.field.add(i.introVisuals));let n=0;if((a=t.enemyLevels)==null||a.every((h,c)=>{var p,T;if(t.isBattleMysteryEncounter())return!1;if(!this.loaded)if(t.battleType===Ce.TRAINER)t.enemyParty[c]=(p=t.trainer)==null?void 0:p.genPartyMember(c);else{let m=s.randomSpecies(t.waveIndex,h,!0);s.findModifier(C=>C instanceof bm)&&!s.gameMode.isBoss(t.waveIndex)&&s.arena.biomeType!==Te.END&&Be(10)===0&&(m=Em(h)),t.enemyParty[c]=s.addEnemyPokemon(m,h,mt.NONE,!!s.getEncounterBossSegments(t.waveIndex,h,m)),s.currentBattle.battleSpec===Ft.FINAL_BOSS&&(t.enemyParty[c].ivs=new Array(6).fill(31)),s.getPlayerParty().slice(0,t.double?2:1).reverse().forEach(C=>{ot("SyncEncounterNatureAbAttr",C,null,!1,t.enemyParty[c])})}const d=s.getEnemyParty()[c];c<(t.double?2:1)&&(d.setX(-66+d.getFieldPositionOffset()[0]),d.fieldSetup(!0)),this.loaded||s.gameData.setPokemonSeen(d,!0,t.battleType===Ce.TRAINER||((T=t==null?void 0:t.mysteryEncounter)==null?void 0:T.encounterMode)===ns.TRAINER_BATTLE),d.species.speciesId===ge.ETERNATUS&&(s.gameMode.isClassic&&(t.battleSpec===Ft.FINAL_BOSS||s.gameMode.isWaveFinal(t.waveIndex))?(t.battleSpec!==Ft.FINAL_BOSS&&(d.formIndex=1,d.updateScale()),d.setBoss()):t.waveIndex%1e3||(d.formIndex=1,d.updateScale())),n+=d.getSpeciesForm().baseTotal,e.push(d.loadAssets()),`${d.stats[0]}${d.ivs[0]}`,`${d.stats[1]}${d.ivs[1]}`,`${d.stats[2]}${d.ivs[2]}`,`${d.stats[3]}${d.ivs[3]}`,`${d.stats[4]}${d.ivs[4]}`,`${d.stats[5]}${d.ivs[5]}`;const f=[];for(const m of d.getMoveset())f.push(m.getName());return`${we(d)}`,`${d.species.speciesId}`,`${d.level}`,`${Ti(d.nature,!0,!0,!0)}`,`${d.getAbility().name}`,d.hasPassive(),`${d.getPassiveAbility().name}`,d.isBoss()&&`${d.bossSegments}`,!0}),s.getPlayerParty().filter(h=>h.isShiny()).length===sa&&s.validateAchv(Ae.SHINY_PARTY),t.battleType===Ce.TRAINER)e.push((r=t.trainer)==null?void 0:r.loadAssets().then(()=>{var h;return(h=t.trainer)==null?void 0:h.initSprite()}));else if(t.isBattleMysteryEncounter())(o=t.mysteryEncounter)!=null&&o.introVisuals&&e.push(t.mysteryEncounter.introVisuals.loadAssets().then(()=>t.mysteryEncounter.introVisuals.initSprite())),(l=t.mysteryEncounter)!=null&&l.loadAssets&&t.mysteryEncounter.loadAssets.length>0&&e.push(...t.mysteryEncounter.loadAssets),e.push(new Promise(h=>{s.loadSe("GEN8- Exclaim","battle_anims","GEN8- Exclaim.wav"),s.loadImage("encounter_exclaim","mystery-encounters"),s.load.once(Phaser.Loader.Events.COMPLETE,()=>h()),s.load.isLoading()||s.load.start()}));else if(!(ne.OPP_HEALTH_SEGMENTS_OVERRIDE>1)&&t.enemyParty.filter(c=>c.isBoss()).length>1)for(const c of t.enemyParty)c.isBoss()&&!c.isPopulatedFromDataSource&&(c.setBoss(!0,Math.ceil(c.bossSegments*(c.getSpeciesForm().baseTotal/n))),c.initBattleInfo());Promise.all(e).then(()=>{if(t.enemyParty.every((h,c)=>{var d;if(t.isBattleMysteryEncounter())return!1;if(c<(t.double?2:1)){if(t.battleType===Ce.WILD){for(const p of s.getField())Ih("PreSummonAbAttr",p,[]);s.field.add(h),t.seenEnemyPartyMemberIds.add(h.id);const f=s.getPlayerPokemon();f!=null&&f.isOnField()&&s.field.moveBelow(h,f),h.tint(0,.5)}else t.battleType===Ce.TRAINER&&(h.setVisible(!1),(d=s.currentBattle.trainer)==null||d.tint(0,.5));t.double&&h.setFieldPosition(c?as.RIGHT:as.LEFT)}return!0}),!this.loaded&&t.battleType!==Ce.MYSTERY_ENCOUNTER){ja(s.getEnemyField(),t.battleType===Ce.TRAINER?Bs.TRAINER:Bs.WILD),s.generateEnemyModifiers(),Pf(!1);for(const h of s.getEnemyField())Df(h,!1)}t.battleType===Ce.TRAINER&&s.currentBattle.trainer&&s.currentBattle.trainer.genAI(s.getEnemyParty()),s.ui.setMode(_.MESSAGE).then(()=>{this.loaded?(this.doEncounter(),s.resetSeed()):(this.trySetWeatherIfNewBiome(),s.gameData.saveAll(!0,t.waveIndex%5===1||(s.lastSavePlayTime??0)>=300).then(h=>{if(s.disableMenu=!1,!h)return s.reset(!0);this.doEncounter(),s.resetSeed()}))})})}doEncounter(){var a,r;s.playBgm(void 0,!0),s.updateModifiers(!1),s.setFieldScale(1);const{battleType:e,waveIndex:t}=s.currentBattle;s.isMysteryEncounterValidForWave(e,t)&&!s.currentBattle.isBattleMysteryEncounter()&&(s.mysteryEncounterSaveData.encounterSpawnChance+=Sg);for(const o of s.getPlayerParty())o&&o.resetWaveData();const i=s.getEnemyField();s.tweens.add({targets:[s.arenaEnemy,s.currentBattle.trainer,i,s.arenaPlayer,s.trainer].flat(),x:u((o,l,h,c)=>c<2+i.length?h+300:h-300,"x"),duration:2e3,onComplete:u(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")});const n=(r=(a=s.currentBattle)==null?void 0:a.mysteryEncounter)==null?void 0:r.introVisuals;if(n){const o=n.enterFromRight;o&&(n.x+=500),s.tweens.add({targets:n,x:o?"-=200":"+=300",duration:2e3})}}getEncounterMessage(){var t,i;const e=s.getEnemyField();return s.currentBattle.battleSpec===Ft.FINAL_BOSS?g.t("battle:bossAppeared",{bossName:we(e[0])}):s.currentBattle.battleType===Ce.TRAINER?s.currentBattle.double?g.t("battle:trainerAppearedDouble",{trainerName:(t=s.currentBattle.trainer)==null?void 0:t.getName(mt.NONE,!0)}):g.t("battle:trainerAppeared",{trainerName:(i=s.currentBattle.trainer)==null?void 0:i.getName(mt.NONE,!0)}):e.length===1?g.t("battle:singleWildAppeared",{pokemonName:e[0].getNameToRender()}):g.t("battle:multiWildAppeared",{pokemonName1:e[0].getNameToRender(),pokemonName2:e[1].getNameToRender()})}doEncounterCommon(e=!0){var i,n;const t=s.getEnemyField();if(s.currentBattle.battleType===Ce.WILD){for(const a of t)a.untint(100,"Sine.easeOut"),a.cry(),a.showInfo(),a.isShiny()&&s.validateAchv(Ae.SEE_SHINY);s.updateFieldScale(),e?s.ui.showText(this.getEncounterMessage(),null,()=>this.end(),1500):this.end()}else if(s.currentBattle.battleType===Ce.TRAINER){const a=s.currentBattle.trainer;a==null||a.untint(100,"Sine.easeOut"),a==null||a.playAnim();const r=u(()=>{s.currentBattle.started=!0,s.playBgm(void 0),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const l=u(()=>{this.hideEnemyTrainer();const h=s.getEnemyParty().filter(c=>!c.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&h>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.end()},"doTrainerSummon");e?s.ui.showText(this.getEncounterMessage(),null,l,1500,!0):l()},"doSummon"),o=(i=s.currentBattle.trainer)==null?void 0:i.getEncounterMessages();if(!(o!=null&&o.length))r();else{let l;s.executeWithSeedOffset(()=>l=_i(o),s.currentBattle.waveIndex),l=l;const h=u(()=>{s.ui.showDialogue(l,a==null?void 0:a.getName(mt.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>r()))})},"showDialogueAndSummon");(n=s.currentBattle.trainer)!=null&&n.config.hasCharSprite&&!s.ui.shouldSkipDialogue(l)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(a==null?void 0:a.getKey(),Xa(o[0])).then(()=>h())):h()}}else if(s.currentBattle.isBattleMysteryEncounter()&&s.currentBattle.mysteryEncounter){const a=s.currentBattle.mysteryEncounter,r=a.introVisuals;r==null||r.playAnim(),a.onVisualsStart?a.onVisualsStart():a.spriteConfigs&&r&&r.playShinySparkles();const o=u(()=>{const h=u(()=>{s.ui.clearText(),s.ui.getMessageHandler().hideNameText(),s.phaseManager.unshiftNew("MysteryEncounterPhase"),this.end()},"doShowEncounterOptions");if(e){const c=a.dialogue.intro;if(!c)h();else{let f=0;const p=u(()=>{const T=f===c.length-1?h:p,m=c[f],C=Gt(m==null?void 0:m.speaker),b=Gt(m.text);f++,C?s.ui.showDialogue(b,C,null,T,0,f===1?750:0):s.ui.showText(b,null,T,f===1?750:0,!0)},"showNextDialogue");c.length>0&&p()}}else h()},"doEncounter"),l=g.t("battle:mysteryEncounterAppeared");l?(Im(),s.ui.showDialogue(l,"???",null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>o()))})):o()}}end(){const e=s.getEnemyField();if(e.forEach((t,i)=>{if(t.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",tt.ENEMY+i),t.species.speciesId===ge.ETERNATUS&&(s.gameMode.isBattleClassicFinalBoss(s.currentBattle.waveIndex)||s.gameMode.isEndlessMajorBoss(s.currentBattle.waveIndex))){const n=s.findModifier(a=>a instanceof Bf,!1);n&&(s.removeModifier(n,!0),n.setTransferrableFalse(),s.addEnemyModifier(n))}}),[Ce.TRAINER,Ce.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||(e.map(i=>s.phaseManager.pushConditionalPhase(s.phaseManager.create("PostSummonPhase",i.getBattlerIndex()),()=>{if(!s.getPlayerParty().length)return!1;const n=s.getPlayerParty().filter(r=>r.isOnField()).length,a=Math.min(s.getPlayerParty().filter(r=>!r.isFainted()).length,2);return s.currentBattle.double?n===a:n===1})),s.findModifier(i=>i instanceof Lf)&&e.map(i=>s.phaseManager.pushNew("ScanIvsPhase",i.getBattlerIndex()))),!this.loaded){const t=s.getPokemonAllowedInBattle();if(t[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double?t.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),t[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1)):(t.length>1&&t[1].isOnField()&&s.phaseManager.pushNew("ReturnPhase",1),s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)),s.currentBattle.battleType!==Ce.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const i=s.currentBattle.double?2:1;t.length>i&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}Rs(zt.Access_Menu).then(()=>super.end())}tryOverrideForBattleSpec(){switch(s.currentBattle.battleSpec){case Ft.FINAL_BOSS:{const e=s.getEnemyPokemon();return s.ui.showText(this.getEncounterMessage(),null,()=>{const t="battleSpecDialogue:encounter";if(s.ui.shouldSkipDialogue(t))this.doEncounterCommon(!1);else{const i=5643853+s.gameData.gameStats.classicSessionsPlayed,n=!g.exists(t,{fallbackLng:[]})||g.resolvedLanguage==="en"?g.t("battleSpecDialogue:key",{count:i,ordinal:!0}):"",a=i.toLocaleString()+n,r=s.gameData.gender??Fe.UNSET,o=Fe[r].toLowerCase(),l=g.t(t,{context:o,cycleCount:a});s.gameData.getSeenDialogues()[t]||s.gameData.saveSeenDialogue(t),s.ui.showDialogue(l,e==null?void 0:e.species.name,null,()=>{this.doEncounterCommon(!1)})}},1500,!0),!0}}return!1}trySetWeatherIfNewBiome(){this.loaded||s.arena.trySetWeather(Rf(s.arena))}};u(ku,"EncounterPhase");let Da=ku;const Nu=class Nu extends Ke{constructor(){super(...arguments),this.phaseName="EndCardPhase"}start(){super.start(),s.ui.getMessageHandler().bg.setVisible(!1),s.ui.getMessageHandler().nameBoxContainer.setVisible(!1),this.endCard=s.add.image(0,0,`end_${s.gameData.gender===Fe.FEMALE?"f":"m"}`),this.endCard.setOrigin(0),this.endCard.setScale(.5),s.field.add(this.endCard),this.text=D(s.game.canvas.width/12,s.game.canvas.height/6-16,g.t("battle:congratulations"),O.SUMMARY,{fontSize:"128px"}),this.text.setOrigin(.5),s.field.add(this.text),s.ui.clearText(),s.ui.fadeIn(1e3).then(()=>{s.ui.showText("",null,()=>{s.ui.getMessageHandler().bg.setVisible(!0),this.end()},null,!0)})}};u(Nu,"EndCardPhase");let el=Nu;const Pu=class Pu extends Ke{constructor(){super(...arguments),this.phaseName="EndEvolutionPhase"}start(){super.start(),s.ui.setModeForceTransition(_.MESSAGE).then(()=>this.end())}};u(Pu,"EndEvolutionPhase");let tl=Pu;const Du=class Du extends Us{constructor(e){var t;super(),this.phaseName="EnemyCommandPhase",this.skipTurn=!1,this.fieldIndex=e,(t=s.currentBattle.mysteryEncounter)!=null&&t.skipEnemyBattleTurns&&(this.skipTurn=!0)}start(){var a;super.start();const e=s.getEnemyField()[this.fieldIndex],t=s.currentBattle,i=t.trainer;if(t.double&&e.hasAbility(bn.COMMANDER)&&((a=e.getAlly())!=null&&a.getTag(He.COMMANDED))&&(this.skipTurn=!0),i&&!e.getMoveQueue().length){const r=e.getOpponents();if(!e.isTrapped()){const o=i.getPartyMemberMatchupScores(e.trainerSlot,!0);if(o.length){const l=r.map(f=>e.getMatchupScore(f)),h=l.reduce((f,p)=>f+=p,0)/l.length,c=i.getSortedPartyMemberMatchupScores(o),d=1-(t.enemySwitchCounter?Math.pow(.1,1/t.enemySwitchCounter):0);if(c[0][1]*d>=h*(i.config.isBoss?2:3)){const f=i.getNextSummonIndex(e.trainerSlot,o);return t.turnCommands[this.fieldIndex+tt.ENEMY]={command:be.POKEMON,cursor:f,args:[!1],skip:this.skipTurn},t.enemySwitchCounter++,this.end()}}}}const n=e.getNextMove();i!=null&&i.shouldTera(e)&&(s.currentBattle.preTurnCommands[this.fieldIndex+tt.ENEMY]={command:be.TERA}),s.currentBattle.turnCommands[this.fieldIndex+tt.ENEMY]={command:be.FIGHT,move:n,skip:this.skipTurn},s.currentBattle.enemySwitchCounter=Math.max(s.currentBattle.enemySwitchCounter-1,0),this.end()}getFieldIndex(){return this.fieldIndex}};u(Du,"EnemyCommandPhase");let sl=Du;const Bu=class Bu extends Ke{constructor(e,t,i){super(),this.phaseName="EvolutionPhase",this.pokemon=e,this.evolution=t,this.lastLevel=i,this.fusionSpeciesEvolved=t instanceof vm}validate(){return!!this.evolution}setMode(){return s.ui.setModeForceTransition(_.EVOLUTION_SCENE)}start(){super.start(),this.setMode().then(()=>{if(!this.validate())return this.end();s.fadeOutBgm(void 0,!1),this.evolutionHandler=s.ui.getHandler(),this.evolutionContainer=this.evolutionHandler.evolutionContainer,this.evolutionBaseBg=s.add.image(0,0,"default_bg"),this.evolutionBaseBg.setOrigin(0,0),this.evolutionContainer.add(this.evolutionBaseBg),this.evolutionBg=s.add.video(0,0,"evo_bg").stop(),this.evolutionBg.setOrigin(0,0),this.evolutionBg.setScale(.4359673025),this.evolutionBg.setVisible(!1),this.evolutionContainer.add(this.evolutionBg),this.evolutionBgOverlay=s.add.rectangle(0,0,s.game.canvas.width/6,s.game.canvas.height/6,2500134),this.evolutionBgOverlay.setOrigin(0,0),this.evolutionBgOverlay.setAlpha(0),this.evolutionContainer.add(this.evolutionBgOverlay);const e=u(()=>{const t=s.addPokemonSprite(this.pokemon,this.evolutionBaseBg.displayWidth/2,this.evolutionBaseBg.displayHeight/2,"pkmn__sub");return t.setPipeline(s.spritePipeline,{tone:[0,0,0,0],ignoreTimeTint:!0}),t},"getPokemonSprite");this.evolutionContainer.add(this.pokemonSprite=e()),this.evolutionContainer.add(this.pokemonTintSprite=e()),this.evolutionContainer.add(this.pokemonEvoSprite=e()),this.evolutionContainer.add(this.pokemonEvoTintSprite=e()),this.pokemonTintSprite.setAlpha(0),this.pokemonTintSprite.setTintFill(16777215),this.pokemonEvoSprite.setVisible(!1),this.pokemonEvoTintSprite.setVisible(!1),this.pokemonEvoTintSprite.setTintFill(16777215),this.evolutionOverlay=s.add.rectangle(0,-s.game.canvas.height/6,s.game.canvas.width/6,s.game.canvas.height/6-48,16777215),this.evolutionOverlay.setOrigin(0,0),this.evolutionOverlay.setAlpha(0),s.ui.add(this.evolutionOverlay),[this.pokemonSprite,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite].map(t=>{const i=this.pokemon.getSpriteKey(!0);try{t.play(i)}catch(n){console.error(`Failed to play animation for ${i}`,n)}t.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:Qs(this.pokemon.getTeraType()),isTerastallized:this.pokemon.isTerastallized}),t.setPipelineData("ignoreTimeTint",!0),t.setPipelineData("spriteKey",this.pokemon.getSpriteKey()),t.setPipelineData("shiny",this.pokemon.shiny),t.setPipelineData("variant",this.pokemon.variant),["spriteColors","fusionSpriteColors"].map(n=>{this.pokemon.summonData.speciesForm&&(n+="Base"),t.pipelineData[n]=this.pokemon.getSprite().pipelineData[n]})}),this.preEvolvedPokemonName=we(this.pokemon),this.doEvolution()})}doEvolution(){s.ui.showText(g.t("menu:evolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{this.pokemon.cry(),this.pokemon.getPossibleEvolution(this.evolution).then(e=>{[this.pokemonEvoSprite,this.pokemonEvoTintSprite].map(t=>{const i=e.getSpriteKey(!0);try{t.play(i)}catch(n){console.error(`Failed to play animation for ${i}`,n)}t.setPipelineData("ignoreTimeTint",!0),t.setPipelineData("spriteKey",e.getSpriteKey()),t.setPipelineData("shiny",e.shiny),t.setPipelineData("variant",e.variant),["spriteColors","fusionSpriteColors"].map(n=>{e.summonData.speciesForm&&(n+="Base"),t.pipelineData[n]=e.getSprite().pipelineData[n]})}),s.time.delayedCall(1e3,()=>{this.evolutionBgm=s.playSoundWithoutBgm("evolution"),s.tweens.add({targets:this.evolutionBgOverlay,alpha:1,delay:500,duration:1500,ease:"Sine.easeOut",onComplete:u(()=>{s.time.delayedCall(1e3,()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250}),this.evolutionBg.setVisible(!0),this.evolutionBg.play()}),s.playSound("se/charge"),this.doSpiralUpward(),s.tweens.addCounter({from:0,to:1,duration:2e3,onUpdate:u(t=>{this.pokemonTintSprite.setAlpha(t.getValue())},"onUpdate"),onComplete:u(()=>{this.pokemonSprite.setVisible(!1),s.time.delayedCall(1100,()=>{s.playSound("se/beam"),this.doArcDownward(),s.time.delayedCall(1500,()=>{this.pokemonEvoTintSprite.setScale(.25),this.pokemonEvoTintSprite.setVisible(!0),this.evolutionHandler.canCancel=!0,this.doCycle(1).then(t=>{t?this.handleSuccessEvolution(e):this.handleFailedEvolution(e)})})})},"onComplete")})},"onComplete")})})})},1e3)}handleFailedEvolution(e){this.pokemonSprite.setVisible(!0),this.pokemonTintSprite.setScale(1),s.tweens.add({targets:[this.evolutionBg,this.pokemonTintSprite,this.pokemonEvoSprite,this.pokemonEvoTintSprite],alpha:0,duration:250,onComplete:u(()=>{this.evolutionBg.setVisible(!1)},"onComplete")}),Cs.fadeOut(s,this.evolutionBgm,100),s.phaseManager.unshiftNew("EndEvolutionPhase"),s.ui.showText(g.t("menu:stoppedEvolving",{pokemonName:this.preEvolvedPokemonName}),null,()=>{s.ui.showText(g.t("menu:pauseEvolutionsQuestion",{pokemonName:this.preEvolvedPokemonName}),null,()=>{const t=u(()=>{s.ui.showText("",0),s.playBgm(),e.destroy(),this.end()},"end");s.ui.setOverlayMode(_.CONFIRM,()=>{s.ui.revertMode(),this.pokemon.pauseEvolutions=!0,s.ui.showText(g.t("menu:evolutionsPaused",{pokemonName:this.preEvolvedPokemonName}),null,t,3e3)},()=>{s.ui.revertMode(),s.time.delayedCall(3e3,t)})})},null,!0)}handleSuccessEvolution(e){s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward();const t=u(()=>{Cs.fadeOut(s,this.evolutionBgm,100),s.time.delayedCall(250,()=>{this.pokemon.cry(),s.time.delayedCall(1250,()=>{s.playSoundWithoutBgm("evolution_fanfare"),e.destroy(),s.ui.showText(g.t("menu:evolutionDone",{pokemonName:this.preEvolvedPokemonName,evolvedPokemonName:this.pokemon.species.getExpandedSpeciesName()}),null,()=>this.end(),null,!0,de(4e3)),s.time.delayedCall(de(4250),()=>s.playBgm())})})},"onEvolutionComplete");s.time.delayedCall(900,()=>{this.evolutionHandler.canCancel=!1,this.pokemon.evolve(this.evolution,this.pokemon.species).then(()=>{const i=this.fusionSpeciesEvolved?nr.EVOLUTION_FUSED:this.pokemon.fusionSpecies?nr.EVOLUTION_FUSED_BASE:nr.EVOLUTION,n=this.pokemon.getLevelMoves(this.lastLevel+1,!0,!1,!1,i).filter(a=>a[0]===Om);for(const a of n)s.phaseManager.unshiftNew("LearnMovePhase",s.getPlayerParty().indexOf(this.pokemon),a[1]);s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),s.tweens.add({targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:u(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1),s.tweens.add({targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn",onComplete:u(()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250,onComplete:t})},"onComplete")})},"onComplete")})})})}doSpiralUpward(){let e=0;s.tweens.addCounter({repeat:64,duration:ds(1),onRepeat:u(()=>{if(e<64){if(!(e&7))for(let t=0;t<4;t++)this.doSpiralUpwardParticle((e&120)*2+t*64);e++}},"onRepeat")})}doArcDownward(){let e=0;s.tweens.addCounter({repeat:96,duration:ds(1),onRepeat:u(()=>{if(e<96){if(e<6)for(let t=0;t<9;t++)this.doArcDownParticle(t*16);e++}},"onRepeat")})}doCycle(e,t=15){return new Promise(i=>{const n=e===t;s.tweens.add({targets:this.pokemonTintSprite,scale:.25,ease:"Cubic.easeInOut",duration:500/e,yoyo:!n}),s.tweens.add({targets:this.pokemonEvoTintSprite,scale:1,ease:"Cubic.easeInOut",duration:500/e,yoyo:!n,onComplete:u(()=>{if(this.evolutionHandler.cancelled)return i(!1);e<t?this.doCycle(e+.5,t).then(a=>i(a)):(this.pokemonTintSprite.setVisible(!1),i(!0))},"onComplete")})})}doCircleInward(){let e=0;s.tweens.addCounter({repeat:48,duration:ds(1),onRepeat:u(()=>{if(e){if(e===32)for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,8)}else for(let t=0;t<16;t++)this.doCircleInwardParticle(t*16,4);e++},"onRepeat")})}doSpray(){let e=0;s.tweens.addCounter({repeat:48,duration:ds(1),onRepeat:u(()=>{if(e)e<50&&this.doSprayParticle(Jt(8));else for(let t=0;t<8;t++)this.doSprayParticle(t);e++},"onRepeat")})}doSpiralUpwardParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");this.evolutionContainer.add(i);let n=0,a=48;const r=s.tweens.addCounter({repeat:-1,duration:ds(1),onRepeat:u(()=>{o()},"onRepeat")}),o=u(()=>{!n||i.y>8?(i.setPosition(t,88-n*n/80),i.y+=Di(e,a)/4,i.x+=ar(e,a),i.setScale(1-n/80),e+=4,n&1&&a--,n++):(i.destroy(),r.remove())},"updateParticle");o()}doArcDownParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=s.add.image(t,0,"evo_sparkle");i.setScale(.5),this.evolutionContainer.add(i);let n=0,a=8;const r=s.tweens.addCounter({repeat:-1,duration:ds(1),onRepeat:u(()=>{o()},"onRepeat")}),o=u(()=>{!n||i.y<88?(i.setPosition(t,8+n*n/5),i.y+=Di(e,a)/4,i.x+=ar(e,a),a=8+Di(n*4,40),n++):(i.destroy(),r.remove())},"updateParticle");o()}doCircleInwardParticle(e,t){const i=this.evolutionBaseBg.displayWidth/2,n=this.evolutionBaseBg.displayHeight/2,a=s.add.image(i,n,"evo_sparkle");this.evolutionContainer.add(a);let r=120;const o=s.tweens.addCounter({repeat:-1,duration:ds(1),onRepeat:u(()=>{l()},"onRepeat")}),l=u(()=>{r>8?(a.setPosition(i,n),a.y+=Di(e,r),a.x+=ar(e,r),r-=t,e+=4):(a.destroy(),o.remove())},"updateParticle");l()}doSprayParticle(e){const t=this.evolutionBaseBg.displayWidth/2,i=this.evolutionBaseBg.displayHeight/2,n=s.add.image(t,i,"evo_sparkle");this.evolutionContainer.add(n);let a=0,r=0;const o=3-Jt(8),l=48+Jt(64),h=s.tweens.addCounter({repeat:-1,duration:ds(1),onRepeat:u(()=>{c()},"onRepeat")}),c=u(()=>{a&3||r++,e<128?(n.setPosition(t+o*a/3,i+r),n.y+=-Di(e,l),a>108&&n.setScale(1-(a-108)/20),e++,a++):(n.destroy(),h.remove())},"updateParticle");c()}};u(Bu,"EvolutionPhase");let Ba=Bu;const Lu=class Lu extends Us{constructor(e,t){super(),this.partyMemberIndex=e,this.fieldIndex=e<s.currentBattle.getBattlerCount()?e:-1,this.player=t}getParty(){return this.player?s.getPlayerParty():s.getEnemyParty()}getPokemon(){return this.getParty()[this.partyMemberIndex]}};u(Lu,"PartyMemberPokemonPhase");let La=Lu;const Ru=class Ru extends La{constructor(e){super(e,!0)}getPlayerPokemon(){return super.getPokemon()}};u(Ru,"PlayerPartyMemberPokemonPhase");let xi=Ru;const Fu=class Fu extends xi{constructor(e,t){super(e),this.phaseName="ExpPhase",this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new rt(this.expValue);s.applyModifiers(Ff,!0,t),t.value=Math.floor(t.value),s.ui.showText(g.t("battle:expGain",{pokemonName:we(e),exp:t.value}),null,()=>{const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),e.updateInfo().then(()=>this.end())},null,!0)}};u(Fu,"ExpPhase");let il=Fu;const Uu=class Uu extends bt{constructor(e,t=!1,i){super(e),this.phaseName="FaintPhase",this.preventInstantRevive=t,this.source=i}start(){var t,i;super.start();const e=this.getPokemon();if(this.source&&((t=e.getTag(He.DESTINY_BOND))==null||t.lapse(this.source,Es.CUSTOM),(i=e.getTag(He.GRUDGE))==null||i.lapse(e,Es.CUSTOM,this.source)),e.resetSummonData(),!this.preventInstantRevive){const n=s.applyModifier(xm,this.player,e);if(n)return e.loseHeldItem(n),s.updateModifiers(this.player),this.end()}for(const n of s.getPlayerField())(n!=null&&n.isActive()||n!=null&&n.isFainted())&&s.currentBattle.addParticipant(n);this.tryOverrideForBattleSpec()||this.doFaint()}doFaint(){var n,a;const e=this.getPokemon();if(e.isPlayer()?(s.arena.playerFaints+=1,s.currentBattle.playerFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})):(s.currentBattle.enemyFaints+=1,s.currentBattle.enemyFaintsHistory.push({pokemon:e,turn:s.currentBattle.turn})),s.phaseManager.queueMessage(g.t("battle:fainted",{pokemonNameWithAffix:we(e)}),null,!0),s.triggerPokemonFormChange(e,qa,!0),e.resetTera(),(n=e.turnData.attacksReceived)!=null&&n.length){const r=e.turnData.attacksReceived[0];Sp("PostFaintAbAttr",e,s.getPokemonById(r.sourceId),new Ss(r.move).getMove(),r.result)}else Sp("PostFaintAbAttr",e);const t=s.getField(!0);for(const r of t)_m("PostKnockOutAbAttr",r,e);if((a=e.turnData.attacksReceived)!=null&&a.length){const r=this.source;if(r!=null&&r.isOnField()){Am("PostVictoryAbAttr",r);const o=Ne[e.turnData.attacksReceived[0].move],l=o.getAttrs("PostVictoryStatStageChangeAttr");if(l.length)for(const h of l)h.applyPostVictory(r,r,o)}}if(this.player){const r=s.getPokemonAllowedInBattle(),o=r.filter(l=>!l.isActive(!0));r.length?s.currentBattle.double&&r.length===1&&o.length===0?s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0):o.length>0&&s.phaseManager.pushNew("SwitchPhase",ut.SWITCH,this.fieldIndex,!0,!1):s.phaseManager.unshiftNew("GameOverPhase")}else s.phaseManager.unshiftNew("VictoryPhase",this.battlerIndex),[Ce.TRAINER,Ce.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)&&s.getEnemyParty().filter(o=>o.isActive()&&!o.isOnField()&&o.trainerSlot===e.trainerSlot).length&&s.phaseManager.pushNew("SwitchSummonPhase",ut.SWITCH,this.fieldIndex,-1,!1,!1);const i=e.getAlly();s.currentBattle.double&&!Ee(i)&&s.redirectPokemonMoves(e,i),e.faintCry(()=>{e.isPlayer()&&e.addFriendship(-5),e.hideInfo(),s.playSound("se/faint"),s.tweens.add({targets:e,duration:500,y:e.y+150,ease:"Sine.easeIn",onComplete:u(()=>{e.lapseTags(Es.FAINT),e.y-=150,e.trySetStatus(Ht.FAINT),e.isPlayer()?s.currentBattle.removeFaintedParticipant(e):(s.addFaintedEnemyScore(e),s.currentBattle.addPostBattleLoot(e)),e.leaveField(),this.end()},"onComplete")})})}tryOverrideForBattleSpec(){switch(s.currentBattle.battleSpec){case Ft.FINAL_BOSS:if(!this.player){const e=this.getPokemon();return e.formIndex?s.ui.showDialogue(Uf[Ft.FINAL_BOSS].secondStageWin,e.species.name,null,()=>this.doFaint()):(e.hp++,s.phaseManager.unshiftNew("DamageAnimPhase",e.getBattlerIndex(),0,Ge.INDIRECT),this.end()),!0}}return!1}};u(Uu,"FaintPhase");let nl=Uu;const Vu=class Vu extends Ba{constructor(e,t,i){super(e,null,0),this.phaseName="FormChangePhase",this.formChange=t,this.modal=i}validate(){return!!this.formChange}setMode(){return this.modal?s.ui.setOverlayMode(_.EVOLUTION_SCENE):super.setMode()}doEvolution(){const e=we(this.pokemon);this.pokemon.getPossibleForm(this.formChange).then(t=>{[this.pokemonEvoSprite,this.pokemonEvoTintSprite].map(i=>{const n=t.getSpriteKey(!0);try{i.play(n)}catch(a){console.error(`Failed to play animation for ${n}`,a)}i.setPipelineData("ignoreTimeTint",!0),i.setPipelineData("spriteKey",t.getSpriteKey()),i.setPipelineData("shiny",t.shiny),i.setPipelineData("variant",t.variant),["spriteColors","fusionSpriteColors"].map(a=>{t.summonData.speciesForm&&(a+="Base"),i.pipelineData[a]=t.getSprite().pipelineData[a]})}),s.time.delayedCall(250,()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:1,delay:500,duration:1500,ease:"Sine.easeOut",onComplete:u(()=>{s.time.delayedCall(1e3,()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250}),this.evolutionBg.setVisible(!0),this.evolutionBg.play()}),s.playSound("se/charge"),this.doSpiralUpward(),s.tweens.addCounter({from:0,to:1,duration:2e3,onUpdate:u(i=>{this.pokemonTintSprite.setAlpha(i.getValue())},"onUpdate"),onComplete:u(()=>{this.pokemonSprite.setVisible(!1),s.time.delayedCall(1100,()=>{s.playSound("se/beam"),this.doArcDownward(),s.time.delayedCall(1e3,()=>{this.pokemonEvoTintSprite.setScale(.25),this.pokemonEvoTintSprite.setVisible(!0),this.doCycle(1,1).then(i=>{s.playSound("se/sparkle"),this.pokemonEvoSprite.setVisible(!0),this.doCircleInward(),s.time.delayedCall(900,()=>{this.pokemon.changeForm(this.formChange).then(()=>{this.modal||s.phaseManager.unshiftNew("EndEvolutionPhase"),s.playSound("se/shine"),this.doSpray(),s.tweens.add({targets:this.evolutionOverlay,alpha:1,duration:250,easing:"Sine.easeIn",onComplete:u(()=>{this.evolutionBgOverlay.setAlpha(1),this.evolutionBg.setVisible(!1),s.tweens.add({targets:[this.evolutionOverlay,this.pokemonEvoTintSprite],alpha:0,duration:2e3,delay:150,easing:"Sine.easeIn",onComplete:u(()=>{s.tweens.add({targets:this.evolutionBgOverlay,alpha:0,duration:250,onComplete:u(()=>{s.time.delayedCall(250,()=>{this.pokemon.cry(),s.time.delayedCall(1250,()=>{let n=!1;this.formChange.formKey.indexOf(rr.MEGA)>-1?(s.validateAchv(Ae.MEGA_EVOLVE),n=!0):(this.formChange.formKey.indexOf(rr.GIGANTAMAX)>-1||this.formChange.formKey.indexOf(rr.ETERNAMAX)>-1)&&(s.validateAchv(Ae.GIGANTAMAX),n=!0);const a=n?4e3:1750;s.playSoundWithoutBgm(n?"evolution_fanfare":"minor_fanfare"),t.destroy(),s.ui.showText(Pr(this.pokemon,this.formChange,e),null,()=>this.end(),null,!0,de(a)),s.time.delayedCall(de(a+250),()=>s.playBgm())})})},"onComplete")})},"onComplete")})},"onComplete")})})})})})})},"onComplete")})},"onComplete")})})})}end(){this.pokemon.findAndRemoveTags(e=>e.tagType===He.AUTOTOMIZED),this.modal?s.ui.revertMode().then(()=>{if(s.ui.getMode()===_.PARTY){const e=s.ui.getHandler();e.clearPartySlots(),e.populatePartySlots()}super.end()}):super.end()}};u(Vu,"FormChangePhase");let al=Vu;const Hu=class Hu extends st{constructor(e){super(),this.phaseName="ModifierRewardPhase",this.modifierType=Vf(e)}start(){super.start(),this.doReward().then(()=>this.end())}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("item_fanfare"),s.ui.showText(g.t("battle:rewardGain",{modifierName:t==null?void 0:t.type.name}),null,()=>e(),null,!0)})}};u(Hu,"ModifierRewardPhase");let mn=Hu;const Yu=class Yu extends mn{constructor(){super(...arguments),this.phaseName="GameOverModifierRewardPhase"}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(_.MESSAGE),s.ui.fadeIn(250).then(()=>{s.ui.showText(g.t("battle:rewardGain",{modifierName:t==null?void 0:t.type.name}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),e()},null,!0,1500)})})}};u(Yu,"GameOverModifierRewardPhase");let rl=Yu;const Wu=class Wu extends st{constructor(e=!1){super(),this.phaseName="GameOverPhase",this.firstRibbons=[],this.isVictory=e}start(){var e;if(super.start(),s.phaseManager.hideAbilityBar(),s.gameMode.isClassic&&s.currentBattle.waveIndex>200&&(this.isVictory=!0),!this.isVictory&&((e=s.currentBattle.mysteryEncounter)!=null&&e.onGameOver)&&!s.currentBattle.mysteryEncounter.onGameOver())return this.end();if(this.isVictory&&s.gameMode.isEndless){const t=s.gameData.gender??Fe.UNSET,i=Fe[t].toLowerCase();s.ui.showDialogue(g.t("miscDialogue:ending_endless",{context:i}),g.t("miscDialogue:ending_name"),0,()=>this.handleGameOver())}else this.isVictory||!s.enableRetries?this.handleGameOver():s.ui.showText(g.t("battle:retryBattle"),null,()=>{s.ui.setMode(_.CONFIRM,()=>{s.ui.fadeOut(1250).then(()=>{s.reset(),s.phaseManager.clearPhaseQueue(),s.gameData.loadSession(s.sessionSlotId).then(()=>{s.phaseManager.pushNew("EncounterPhase",!0);const t=s.getPokemonAllowedInBattle().length;s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double&&t>1&&s.phaseManager.pushNew("SummonPhase",1),s.currentBattle.waveIndex>1&&s.currentBattle.battleType!==Ce.TRAINER&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&t>1&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double)),s.ui.fadeIn(1250),this.end()})})},()=>this.handleGameOver(),!1,0,0,1e3)})}handleGameOver(){const e=u(t=>{s.disableMenu=!0,s.time.delayedCall(1e3,()=>{let i=!1;if(this.isVictory)if(s.gameMode.isClassic){i=s.validateAchv(Ae.CLASSIC_VICTORY),s.validateAchv(Ae.UNEVOLVED_CLASSIC_VICTORY),s.gameData.gameStats.sessionsWon++;for(const r of s.getPlayerParty())this.awardRibbon(r),r.species.getRootSpeciesId()!==r.species.getRootSpeciesId(!0)&&this.awardRibbon(r,!0)}else s.gameMode.isDaily&&t&&s.gameData.gameStats.dailyRunSessionsWon++;const n=this.isVictory?1e4:5e3;s.fadeOutBgm(n,!0);const a=s.getField().filter(r=>r==null?void 0:r.isActive(!0));a.map(r=>r.hideInfo()),s.ui.fadeOut(n).then(()=>{a.map(o=>o.setVisible(!1)),s.setFieldScale(1,!0),s.phaseManager.clearPhaseQueue(),s.ui.clearText(),this.isVictory&&s.gameMode.isChallenge&&s.gameMode.challenges.forEach(o=>s.validateAchvs(wm,o));const r=u(o=>{if(this.isVictory&&t){this.handleUnlocks();for(const l of this.firstRibbons)s.phaseManager.unshiftNew("RibbonModifierRewardPhase",$e.VOUCHER_PLUS,l);i||s.phaseManager.unshiftNew("GameOverModifierRewardPhase",$e.VOUCHER_PREMIUM)}this.getRunHistoryEntry().then(l=>{s.gameData.saveRunHistory(l,this.isVictory),s.phaseManager.pushNew("PostGameOverPhase",o),this.end()})},"clear");if(this.isVictory&&s.gameMode.isClassic){const o="miscDialogue:ending";if(!s.ui.shouldSkipDialogue(o))s.ui.fadeIn(500).then(()=>{const l=s.gameData.gender??Fe.UNSET,h=Fe[l].toLowerCase(),c=g.t(o,{context:h});s.charSprite.showCharacter(`rival_${s.gameData.gender===Fe.FEMALE?"m":"f"}`,Xa(c)).then(()=>{s.ui.showDialogue(o,s.gameData.gender===Fe.FEMALE?pi[ps.RIVAL].name:pi[ps.RIVAL].nameFemale,null,()=>{s.ui.fadeOut(500).then(()=>{s.charSprite.hide().then(()=>{const d=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(d),r(d)})})})})});else{const l=s.phaseManager.create("EndCardPhase");s.phaseManager.unshiftPhase(l),r(l)}}else r()})})},"doGameOver");!li||pf?qe.savedata.session.newclear({slot:s.sessionSlotId,isVictory:this.isVictory,clientSessionId:Xt}).then(t=>e(!s.gameMode.isDaily||!!t)).catch(t=>{s.phaseManager.clearPhaseQueue(),s.phaseManager.clearPhaseQueueSplice(),s.phaseManager.unshiftNew("MessagePhase",g.t("menu:serverCommunicationFailed"),2500),setTimeout(()=>{window.location.reload()},2e3),this.end()}):this.isVictory?s.gameData.offlineNewClear().then(t=>{e(t)}):e(!1)}handleUnlocks(){this.isVictory&&s.gameMode.isClassic&&(s.gameData.unlocks[Tt.ENDLESS_MODE]||s.phaseManager.unshiftNew("UnlockPhase",Tt.ENDLESS_MODE),s.getPlayerParty().filter(e=>e.fusionSpecies).length&&!s.gameData.unlocks[Tt.SPLICED_ENDLESS_MODE]&&s.phaseManager.unshiftNew("UnlockPhase",Tt.SPLICED_ENDLESS_MODE),s.gameData.unlocks[Tt.MINI_BLACK_HOLE]||s.phaseManager.unshiftNew("UnlockPhase",Tt.MINI_BLACK_HOLE),!s.gameData.unlocks[Tt.EVIOLITE]&&s.getPlayerParty().some(e=>e.getSpeciesForm(!0).speciesId in Vi)&&s.phaseManager.unshiftNew("UnlockPhase",Tt.EVIOLITE))}awardRibbon(e,t=!1){const i=Dt(e.species.speciesId);s.gameData.incrementRibbonCount(i,t)===1&&this.firstRibbons.push(Dt(e.species.getRootSpeciesId(t)))}async getRunHistoryEntry(){var t;const e=await s.gameData.getSession(s.sessionSlotId);return{seed:s.seed,playTime:s.sessionPlayTime,gameMode:s.gameMode.modeId,party:s.getPlayerParty().map(i=>new Gi(i)),enemyParty:s.getEnemyParty().map(i=>new Gi(i)),modifiers:e?e.modifiers:s.findModifiers(()=>!0).map(i=>new qs(i,!0)),enemyModifiers:e?e.enemyModifiers:s.findModifiers(()=>!0,!1).map(i=>new qs(i,!1)),arena:new dn(s.arena),pokeballCounts:s.pokeballCounts,money:Math.floor(s.money),score:s.score,waveIndex:s.currentBattle.waveIndex,battleType:s.currentBattle.battleType,trainer:s.currentBattle.trainer?new pn(s.currentBattle.trainer):null,gameVersion:s.game.config.gameVersion,timestamp:new Date().getTime(),challenges:s.gameMode.challenges.map(i=>new fn(i)),mysteryEncounterType:((t=s.currentBattle.mysteryEncounter)==null?void 0:t.encounterType)??-1,mysteryEncounterSaveData:s.mysteryEncounterSaveData,playerFaints:s.arena.playerFaints}}};u(Wu,"GameOverPhase");let ol=Wu;const Gu=class Gu extends Ke{constructor(){super(...arguments),this.phaseName="HideAbilityPhase"}start(){super.start(),s.abilityBar.hide().then(()=>{this.end()})}};u(Gu,"HideAbilityPhase");let yn=Gu;const Ku=class Ku extends st{constructor(){super(...arguments),this.phaseName="HidePartyExpBarPhase"}start(){super.start(),s.partyExpBar.hide().then(()=>this.end())}};u(Ku,"HidePartyExpBarPhase");let ll=Ku;const zu=class zu extends xi{constructor(e,t,i=or.LEARN_MOVE,n=-1){super(e),this.phaseName="LearnMovePhase",this.moveId=t,this.learnMoveType=i,this.cost=n}start(){super.start();const e=this.getPokemon(),t=Ne[this.moveId],i=e.getMoveset();if(i.some(a=>a.moveId===t.id)&&this.moveId!==It.SKETCH)return this.end();this.messageMode=s.ui.getHandler()instanceof pa?_.EVOLUTION_SCENE:_.MESSAGE,s.ui.setMode(this.messageMode),i.length<4?this.learnMove(i.length,t,e):this.replaceMoveCheck(t,e)}async replaceMoveCheck(e,t){const i=g.t("battle:learnMovePrompt",{pokemonName:we(t),moveName:e.name}),n=g.t("battle:learnMoveLimitReached",{pokemonName:we(t)}),a=g.t("battle:learnMoveReplaceQuestion",{moveName:e.name}),r=[i,n].join("$");await s.ui.showTextPromise(r),await s.ui.showTextPromise(a,void 0,!1),await s.ui.setModeWithoutClear(_.CONFIRM,()=>this.forgetMoveProcess(e,t),()=>{s.ui.setMode(this.messageMode),this.rejectMoveAndEnd(e,t)})}async forgetMoveProcess(e,t){s.ui.setMode(this.messageMode),await s.ui.showTextPromise(g.t("battle:learnMoveForgetQuestion"),void 0,!0),await s.ui.setModeWithoutClear(_.SUMMARY,t,Nf.LEARN_MOVE,e,i=>{if(i===4){s.ui.setMode(this.messageMode).then(()=>this.rejectMoveAndEnd(e,t));return}const n=g.t("battle:learnMoveForgetSuccess",{pokemonName:we(t),moveName:t.moveset[i].getName()}),a=[g.t("battle:countdownPoof"),n,g.t("battle:learnMoveAnd")].join("$");s.ui.setMode(this.messageMode).then(()=>this.learnMove(i,e,t,a))})}async rejectMoveAndEnd(e,t){await s.ui.showTextPromise(g.t("battle:learnMoveStopTeaching",{moveName:e.name}),void 0,!1),s.ui.setModeWithoutClear(_.CONFIRM,()=>{s.ui.setMode(this.messageMode),s.ui.showTextPromise(g.t("battle:learnMoveNotLearned",{pokemonName:we(t),moveName:e.name}),void 0,!0).then(()=>this.end())},()=>{s.ui.setMode(this.messageMode),this.replaceMoveCheck(e,t)},!1,0,0,Jn.DEFAULT_NO)}async learnMove(e,t,i,n){this.learnMoveType===or.TM?(i.usedTMs||(i.usedTMs=[]),i.usedTMs.push(this.moveId),s.phaseManager.tryRemovePhase(r=>r.is("SelectModifierPhase"))):this.learnMoveType===or.MEMORY&&(this.cost!==-1?(ne.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=this.cost,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy")):s.phaseManager.tryRemovePhase(r=>r.is("SelectModifierPhase"))),i.setMove(e,this.moveId),vh(this.moveId).then(()=>{Oh([this.moveId],!0)}),s.ui.setMode(this.messageMode);const a=g.t("battle:learnMove",{pokemonName:we(i),moveName:t.name});n&&await s.ui.showTextPromise(n),s.playSound("level_up_fanfare"),s.ui.showText(a,null,()=>{s.triggerPokemonFormChange(i,Hf,!0),this.end()},this.messageMode===_.EVOLUTION_SCENE?1e3:void 0,!0)}};u(zu,"LearnMovePhase");let hl=zu;const ju=class ju extends Us{constructor(){super(...arguments),this.phaseName="LevelCapPhase"}start(){super.start(),s.ui.setMode(_.MESSAGE).then(()=>{s.playSound("level_up_fanfare"),s.ui.showText(g.t("battle:levelCapUp",{levelCap:s.getMaxExpLevel()}),null,()=>this.end(),null,!0),this.executeForAll(e=>e.updateInfo(!0))})}};u(ju,"LevelCapPhase");let cl=ju;var fi=(y=>(y[y.DEFAULT=0]="DEFAULT",y[y.ONLY_LEVEL_UP=1]="ONLY_LEVEL_UP",y[y.SKIP=2]="SKIP",y))(fi||{});const $u=class $u extends xi{constructor(e,t,i){super(e),this.phaseName="LevelUpPhase",this.pokemon=this.getPlayerPokemon(),this.lastLevel=t,this.level=i}start(){super.start(),this.level>s.gameData.gameStats.highestLevel&&(s.gameData.gameStats.highestLevel=this.level),s.validateAchvs(Mm,new rt(this.level));const e=this.pokemon.stats.slice(0);this.pokemon.calculateStats(),this.pokemon.updateInfo(),s.expParty===fi.DEFAULT?(s.playSound("level_up_fanfare"),s.ui.showText(g.t("battle:levelUp",{pokemonName:we(this.pokemon),level:this.level}),null,()=>s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end()),null,!0)):s.expParty===fi.SKIP?this.end():s.ui.getMessageHandler().promptLevelUpStats(this.partyMemberIndex,e,!1).then(()=>this.end())}end(){if(this.lastLevel<100){const e=this.getPokemon().getLevelMoves(this.lastLevel+1);for(const t of e)s.phaseManager.unshiftNew("LearnMovePhase",this.partyMemberIndex,t[1])}if(!this.pokemon.pauseEvolutions){const e=this.pokemon.getEvolution();e&&(this.pokemon.breakIllusion(),s.phaseManager.unshiftNew("EvolutionPhase",this.pokemon,e,this.lastLevel))}return super.end()}};u($u,"LevelUpPhase");let ul=$u;const Xu=class Xu extends Ke{constructor(e){super(),this.moveId=e,this.phaseName="LoadMoveAnimPhase"}start(){vh(this.moveId).then(()=>Oh([this.moveId],!0)).then(()=>this.end())}};u(Xu,"LoadMoveAnimPhase");let dl=Xu;const qu=class qu extends Ke{constructor(e=!0){super(),this.phaseName="LoginPhase",this.showText=e}start(){super.start();const e=!!Or(js);s.ui.setMode(_.LOADING,{buttonActions:[]}),yh(e,rs).then(t=>{const i=t?t[0]:!1,n=t?t[1]:null;if(!i){if(!n||n===400){this.showText&&s.ui.showText(g.t("menu:logInOrCreateAccount")),s.playSound("menu_open");const a=u(()=>{rs().then(r=>{if(!r[0]){$n(js),s.reset(!0,!0);return}s.gameData.loadSystem().then(()=>this.end())})},"loadData");s.ui.setMode(_.LOGIN_FORM,{buttonActions:[()=>{s.ui.playSelect(),a()},()=>{s.playSound("menu_open"),s.ui.setMode(_.REGISTRATION_FORM,{buttonActions:[()=>{s.ui.playSelect(),rs().then(r=>{if(!r[0]){$n(js),s.reset(!0,!0);return}this.end()})},()=>{s.phaseManager.unshiftNew("LoginPhase",!1),this.end()}]})},()=>{const l=`https://discord.com/api/oauth2/authorize?client_id=1248062921129459756&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/discord/callback")}&response_type=code&scope=identify&prompt=none`;window.open(l,"_self")},()=>{const l=`https://accounts.google.com/o/oauth2/auth?client_id=955345393540-2k6lfftf0fdnb0krqmpthjnqavfvvf73.apps.googleusercontent.com&redirect_uri=${encodeURIComponent("https://api.pokerogue.net/auth/google/callback")}&response_type=code&scope=openid`;window.open(l,"_self")}]})}else n===401?($n(js),s.reset(!0,!0)):(s.phaseManager.unshiftNew("UnavailablePhase"),super.end());return null}s.gameData.loadSystem().then(a=>{a||Et?this.end():(s.ui.setMode(_.MESSAGE),s.ui.showText(bg("menu:failedToLoadSaveData")))})})}end(){s.ui.setMode(_.MESSAGE),s.gameData.gender||s.phaseManager.unshiftNew("SelectGenderPhase"),Rs(zt.Intro).then(()=>super.end())}};u(qu,"LoginPhase");let pl=qu;const Qu=class Qu extends Ke{constructor(e,t,i,n,a){super(),this.phaseName="MessagePhase",this.text=e,this.callbackDelay=t,this.prompt=i,this.promptDelay=n,this.speaker=a}start(){if(super.start(),this.text.indexOf("$")>-1){const e=[],t=["#POKEMON1","#POKEMON2"];for(let n=0;n<s.getPlayerField().length;n++)e.push(s.getPlayerField()[n].getNameToRender()),this.text=this.text.split(e[n]).join(t[n]);const i=this.text.indexOf("$");if(i!==-1){let n=this.text.slice(0,i),a=this.text.slice(i+1);for(let r=0;r<s.getPlayerField().length;r++)n=n.split(t[r]).join(e[r]),a=a.split(t[r]).join(e[r]);s.phaseManager.unshiftNew("MessagePhase",a,this.callbackDelay,this.prompt,this.promptDelay,this.speaker),this.text=n.trim()}else for(let n=0;n<s.getPlayerField().length;n++)this.text=this.text.split(t[n]).join(e[n])}this.speaker?s.ui.showDialogue(this.text,this.speaker,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.promptDelay??0):s.ui.showText(this.text,null,()=>this.end(),this.callbackDelay||(this.prompt?0:1500),this.prompt,this.promptDelay)}};u(Qu,"MessagePhase");let Ra=Qu;const Zu=class Zu extends st{constructor(e){super(),this.phaseName="MoneyRewardPhase",this.moneyMultiplier=e}start(){const e=new rt(s.getWaveMoneyAmount(this.moneyMultiplier));s.applyModifiers(km,!0,e),s.arena.getTag(Si.HAPPY_HOUR)&&(e.value*=2),s.addMoney(e.value);const t=navigator.language||"en-US",i=e.value.toLocaleString(t),n=g.t("battle:moneyWon",{moneyAmount:i});s.ui.showText(n,null,()=>this.end(),null,!0)}};u(Zu,"MoneyRewardPhase");let fl=Zu;const Ju=class Ju extends Ke{constructor(e,t=!1){super(),this.anim=e,this.onSubstitute=t,this.phaseName="MoveAnimPhase"}start(){super.start(),this.anim.play(this.onSubstitute,()=>this.end())}};u(Ju,"MoveAnimPhase");let gl=Ju;const ed=class ed extends bt{constructor(e,t,i){super(e),this.phaseName="MoveChargePhase",this.move=i,this.targetIndex=t}start(){super.start();const e=this.getUserPokemon(),t=this.getTargetPokemon(),i=this.move.getMove();if(!t||!i.isChargingMove())return console.warn("Invalid parameters for MoveChargePhase"),super.end();new Nm(i.chargeAnim,i.id,e).play(!1,()=>{i.showChargeText(e,t),bp("MoveEffectAttr",e,t,i),e.addTag(He.CHARGING,1,i.id,e.id),this.end()})}end(){const e=this.getUserPokemon(),t=this.move.getMove();if(t.isChargingMove()){const i=new at(!1);bp("InstantChargeAttr",e,null,t,i),i.value?(s.phaseManager.tryRemovePhase(n=>n.is("MoveEndPhase")&&n.getPokemon()===e),s.phaseManager.unshiftNew("MovePhase",e,[this.targetIndex],this.move,!1)):e.getMoveQueue().push({move:t.id,targets:[this.targetIndex]}),e.pushMoveHistory({move:this.move.moveId,targets:[this.targetIndex],result:ai.OTHER})}super.end()}getUserPokemon(){return(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]}getTargetPokemon(){return s.getField(!0).find(e=>this.targetIndex===e.getBattlerIndex())}};u(ed,"MoveChargePhase");let ml=ed;const je={PENDING:0,HIT:1,NO_EFFECT:2,NO_EFFECT_NO_MESSAGE:3,PROTECTED:4,MISS:5,REFLECTED:6,TARGET_NOT_ON_FIELD:7,ERROR:8},Ga=class Ga extends bt{constructor(e,t,i,n=!1,a=!1){if(super(e),this.phaseName="MoveEffectPhase",this.virtual=!1,this.reflected=!1,this.queuedPhases=[],this.move=i,this.virtual=a,this.reflected=n,t.includes(e)&&this.move.moveTarget===Mn.ALL_NEAR_OTHERS){const r=t.indexOf(e);t.splice(r,r+1)}this.targets=t,this.hitChecks=Array(this.targets.length).fill([je.PENDING,0])}conductHitChecks(e,t){let i=!1,n=!0,a=this.getTargets();for(const[r,o]of a.entries()){const l=this.hitCheck(o);if(t&&l[0]===je.REFLECTED){a=[o],this.hitChecks=[l];break}l[0]===je.HIT?i=!0:n||(n=l[0]===je.MISS),this.hitChecks[r]=l}return i?this.moveHistoryEntry.result=ai.SUCCESS:(e.turnData.hitCount=1,e.turnData.hitsLeft=1,this.moveHistoryEntry.result=n?ai.MISS:ai.FAIL),a}queueReflectedMove(e,t){const i=this.move.isMultiTarget()?Sh(t,this.move.id).targets:[e.getBattlerIndex()];t.getTag(He.MAGIC_COAT)||(this.queuedPhases.push(s.phaseManager.create("ShowAbilityPhase",t.getBattlerIndex(),t.getPassiveAbility().hasAttr("ReflectStatusMoveAbAttr"))),this.queuedPhases.push(s.phaseManager.create("HideAbilityPhase"))),this.queuedPhases.push(s.phaseManager.create("MovePhase",t,i,new Ss(this.move.id,0,0,!0),!0,!0,!0))}applyToTargets(e,t){let i=!0;for(const[n,a]of t.entries()){const[r,o]=this.hitChecks[n];switch(r){case je.HIT:if(this.applyMoveEffects(a,o,i),i=!1,kn(this.move))return;break;case je.NO_EFFECT:s.phaseManager.queueMessage(g.t(this.move.id===It.SHEER_COLD?"battle:hitResultImmune":"battle:hitResultNoEffect",{pokemonName:we(a)}));case je.NO_EFFECT_NO_MESSAGE:case je.PROTECTED:case je.TARGET_NOT_ON_FIELD:ri("NoEffectAttr",e,a,this.move);break;case je.MISS:s.phaseManager.queueMessage(g.t("battle:attackMissed",{pokemonNameWithAffix:we(a)})),ri("MissEffectAttr",e,a,this.move);break;case je.REFLECTED:this.queueReflectedMove(e,a);break;case je.PENDING:case je.ERROR:throw new Error("Unexpected hit check result")}}}start(){var o,l;super.start();const e=this.getUserPokemon();if(!e){super.end();return}e.isPlayer()?s.currentBattle.lastPlayerInvolved=this.fieldIndex:s.currentBattle.lastEnemyInvolved=this.fieldIndex;const t=this.move.hasAttr("DelayedAttackAttr");if(!e.isOnField()){if(!t){super.end();return}if(!e.scene){super.end();return}}const i=new at(!1),n=this.move;if(ri("OverrideMoveEffectAttr",e,this.getFirstTarget()??null,n,i,this.virtual),i.value){this.end();return}if(e.lapseTags(Es.MOVE_EFFECT),e.turnData.hitsLeft===0&&e.turnData.hitCount>0&&e.turnData.extraTurns>0&&(e.turnData.hitsLeft=-1,e.turnData.hitCount=0,e.turnData.extraTurns--),e.turnData.hitsLeft===-1){const h=new rt(1);ri("MultiHitAttr",e,this.getFirstTarget()??null,n,h),Pm("AddSecondStrikeAbAttr",e,null,n,!1,h,null),s.applyModifiers(Dm,e.isPlayer(),e,n.id,h),e.turnData.hitCount=h.value,e.turnData.hitsLeft=h.value}this.moveHistoryEntry={move:this.move.id,targets:this.targets,result:ai.PENDING,virtual:this.virtual};const a=kn(n),r=this.conductHitChecks(e,a);if(this.firstHit=e.turnData.hitCount===e.turnData.hitsLeft,this.lastHit=e.turnData.hitsLeft===1||!r.some(h=>h.isActive(!0)),this.moveHistoryEntry.result===ai.SUCCESS||n.getAttrs("MoveEffectAttr").some(h=>h.trigger===Bi.POST_TARGET)){const h=this.getFirstTarget();new Bm(n.id,e,(h==null?void 0:h.getBattlerIndex())??tt.ATTACKER,((l=(o=s.currentBattle)==null?void 0:o.mysteryEncounter)==null?void 0:l.hasBattleAnimationsWithoutTargets)??!1).play(n.hitsSubstitute(e,h),()=>this.postAnimCallback(e,r));return}this.postAnimCallback(e,r)}postAnimCallback(e,t){this.firstHit&&(e.pushMoveHistory(this.moveHistoryEntry),Lm("ExecutedMoveAbAttr",e));try{this.applyToTargets(e,t)}catch(n){console.warn(n.message||"Unexpected error in move effect phase"),this.end();return}this.queuedPhases.length&&s.phaseManager.appendToPhase(this.queuedPhases,"MoveEndPhase");const i=e.getMoveType(this.move,!0);this.move.category!==Xn.STATUS&&!e.stellarTypesBoosted.includes(i)&&e.stellarTypesBoosted.push(i),this.lastHit&&this.triggerMoveEffects(Bi.POST_TARGET,e,null),this.updateSubstitutes(),this.end()}end(){var t;const e=this.getUserPokemon();if(e)if(e.turnData.hitsLeft&&--e.turnData.hitsLeft>=1&&((t=this.getFirstTarget())!=null&&t.isActive()))s.phaseManager.unshiftPhase(this.getNewHitPhase());else{const i=e.turnData.hitCount-Math.max(e.turnData.hitsLeft,0);(i>1||e.turnData.hitsLeft&&e.turnData.hitsLeft>0)&&s.phaseManager.queueMessage(g.t("battle:attackHitsCount",{count:i})),s.applyModifiers(Rm,this.player,e),this.getTargets().forEach(n=>n.turnData.moveEffectiveness=null)}super.end()}applyOnGetHitAbEffects(e,t,i){Fm("PostDefendAbAttr",t,e,this.move,i),t.lapseTags(Es.AFTER_HIT)}applyHeldItemFlinchCheck(e,t,i){if(!this.move.hasAttr("FlinchAttr")&&i&&!t.hasAbilityWithAttr("IgnoreMoveEffectsAbAttr")&&!this.move.hitsSubstitute(e,t)){const n=new at(!1);s.applyModifiers(Um,e.isPlayer(),e,n),n.value&&t.addTag(He.FLINCHED,void 0,this.move.id,e.id)}}protectedCheck(e,t){const i=t.isPlayer()?bs.PLAYER:bs.ENEMY,n=new at(!1),a=new at(!1);return this.move.isAllyTarget()||s.arena.applyTagsForSide(Vm,i,!1,n,e,t,this.move.id,a),![Mn.ENEMY_SIDE,Mn.BOTH_SIDES].includes(this.move.moveTarget)&&(a.value||!this.move.doesFlagEffectApply({flag:lr.IGNORE_PROTECT,user:e,target:t}))&&(n.value||!t.findTags(r=>r instanceof Ep).length&&t.findTags(r=>r instanceof Hm).find(r=>t.lapseTag(r.tagType))||this.move.category!==Xn.STATUS&&t.findTags(r=>r instanceof Ep).find(r=>t.lapseTag(r.tagType)))}hitCheck(e){var p,T;const t=this.getUserPokemon(),i=this.move;if(!t)return[je.ERROR,0];if(i.moveTarget===Mn.USER)return[je.HIT,1];const n=kn(i);if(!e.isActive(!0)&&!n)return[je.TARGET_NOT_ON_FIELD,0];if(!n&&s.currentBattle.double&&((T=(p=e.getAlly())==null?void 0:p.getTag(He.COMMANDED))==null?void 0:T.getSourcePokemon())===e)return[je.MISS,0];const a=n||this.checkBypassAccAndInvuln(e),r=e.getTag(Yf);if(r&&!a&&!this.checkBypassSemiInvuln(r))return[je.MISS,0];if(!n&&this.protectedCheck(t,e))return[je.PROTECTED,0];if(!this.reflected&&i.doesFlagEffectApply({flag:lr.REFLECTABLE,user:t,target:e}))return[je.REFLECTED,0];if(n)return[je.HIT,1];const o=new at(!1),l=e.getMoveEffectiveness(t,i,!1,!1,o);if(l===0)return[o.value?je.NO_EFFECT_NO_MESSAGE:je.NO_EFFECT,l];const h=i.calculateBattleAccuracy(t,e);if(t.turnData.hitsLeft<t.turnData.hitCount&&(!i.hasFlag(lr.CHECK_ALL_HITS)||t.hasAbilityWithAttr("MaxMultiHitAbAttr")))return[je.HIT,l];const c=a||e.getTag(He.ALWAYS_GET_HIT)||e.getTag(He.TELEKINESIS)&&!this.move.hasAttr("OneHitKOAttr");if(h===-1||c)return[je.HIT,l];const d=t.getAccuracyMultiplier(e,this.move);return t.randBattleSeedInt(100)<h*d?[je.HIT,l]:[je.MISS,0]}checkBypassAccAndInvuln(e){var i;const t=this.getUserPokemon();if(!t)return!1;if(t.hasAbilityWithAttr("AlwaysHitAbAttr")||e.hasAbilityWithAttr("AlwaysHitAbAttr")||this.move.hasAttr("ToxicAccuracyAttr")&&t.isOfType(ve.POISON)||t.getTag(He.IGNORE_ACCURACY)&&(((i=t.getLastXMoves().find(()=>!0))==null?void 0:i.targets)||[]).indexOf(e.getBattlerIndex())!==-1||kn(this.move))return!0}checkBypassSemiInvuln(e){return e?this.move.getAttrs("HitsTagAttr").some(i=>i.tagType===e.tagType):!1}getUserPokemon(){return this.battlerIndex>tt.ENEMY_2?s.getPokemonById(this.battlerIndex):(this.player?s.getPlayerField():s.getEnemyField())[this.fieldIndex]}getTargets(){return s.getField(!0).filter(e=>this.targets.indexOf(e.getBattlerIndex())>-1)}getFirstTarget(){return this.getTargets()[0]}removeTarget(e){this.targets.findIndex(i=>i===e.getBattlerIndex())!==-1&&this.targets.splice(this.targets.findIndex(i=>i===e.getBattlerIndex()),1)}stopMultiHit(e){e&&this.removeTarget(e);const t=this.getUserPokemon();t&&(!e||this.targets.length===0)&&(t.turnData.hitCount=1,t.turnData.hitsLeft=1)}getNewHitPhase(){return new Ga(this.battlerIndex,this.targets,this.move,this.reflected,this.virtual)}updateSubstitutes(){const e=this.getTargets();for(const t of e){const i=t.getTag(gs);i&&i.hp<=0&&t.lapseTag(He.SUBSTITUTE)}}triggerMoveEffects(e,t,i,n,a){Ym(r=>r.is("MoveEffectAttr")&&r.trigger===e&&(Ee(a)||r.selfTarget===a)&&(!r.firstHitOnly||this.firstHit)&&(!r.lastHitOnly||this.lastHit)&&(!r.firstTargetOnly||(n??!0)),t,i,this.move)}applyMoveEffects(e,t,i){const n=this.getUserPokemon();if(Ee(n))return;this.triggerMoveEffects(Bi.PRE_APPLY,n,e);const a=this.applyMove(n,e,t);this.triggerMoveEffects(Bi.POST_APPLY,n,e,i,!0),this.move.hitsSubstitute(n,e)||this.applyOnTargetEffects(n,e,a,i),this.lastHit&&(s.triggerPokemonFormChange(n,Wm),n.turnData.hitCount>1&&Wf("PostDamageAbAttr",e,0,e.hasPassive(),!1,[],n))}applyMoveDamage(e,t,i){const n=t.getCriticalHitResult(e,this.move,!1);ri("StatChangeBeforeDmgCalcAttr",e,t,this.move);const{result:a,damage:r}=t.getAttackDamage({source:e,move:this.move,ignoreAbility:!1,ignoreSourceAbility:!1,ignoreAllyAbility:!1,ignoreSourceAllyAbility:!1,simulated:!1,effectiveness:i,isCritical:n}),o=e.findTag(f=>f instanceof Gm&&f.boostedType===e.getMoveType(this.move));o!=null&&o.oneUse&&e.removeTag(o.tagType);const l=a===Ge.ONE_HIT_KO;if(!r)return a;t.lapseTags(Es.HIT);const h=t.getTag(gs),c=h&&this.move.hitsSubstitute(e,t);c?h.hp-=r:!t.isPlayer()&&r>=t.hp&&s.applyModifiers(Km,!1,t);const d=c?0:t.damageAndUpdate(r,{result:a,ignoreFaintPhase:!0,ignoreSegments:l,isCritical:n,source:e});return n&&s.phaseManager.queueMessage(g.t("battle:hitResultCriticalHit")),d<=0||(e.isPlayer()&&(s.validateAchvs(zm,new rt(d)),d>s.gameData.gameStats.highestDamage&&(s.gameData.gameStats.highestDamage=d)),e.turnData.totalDamageDealt+=d,e.turnData.singleHitDamageDealt=d,t.battleData.hitCount++,t.turnData.damageTaken+=d,t.turnData.attacksReceived.unshift({move:this.move.id,result:a,damage:d,critical:n,sourceId:e.id,sourceBattlerIndex:e.getBattlerIndex()}),e.isPlayer()&&t.isEnemy()&&s.applyModifiers(jm,!0,e,new rt(d))),a}onFaintTarget(e,t){s.phaseManager.setPhaseQueueSplice(),s.phaseManager.unshiftNew("FaintPhase",t.getBattlerIndex(),!1,e),t.destroySubstitute(),t.lapseTag(He.COMMANDED),!this.lastHit&&e.turnData.hitsLeft>1&&(this.lastHit=!0)}queueHitResultMessage(e){let t;switch(e){case Ge.SUPER_EFFECTIVE:t=g.t("battle:hitResultSuperEffective");break;case Ge.NOT_VERY_EFFECTIVE:t=g.t("battle:hitResultNotVeryEffective");break;case Ge.ONE_HIT_KO:t=g.t("battle:hitResultOneHitKO");break}t&&s.phaseManager.queueMessage(t)}applyMove(e,t,i){if(e.getMoveCategory(t,this.move)===Xn.STATUS)return Ge.STATUS;const a=this.applyMoveDamage(e,t,i);return(e.turnData.hitsLeft===1||t.isFainted())&&this.queueHitResultMessage(a),t.isFainted()&&this.onFaintTarget(e,t),a}applyOnTargetEffects(e,t,i,n){const a=[Ge.EFFECTIVE,Ge.SUPER_EFFECTIVE,Ge.NOT_VERY_EFFECTIVE,Ge.ONE_HIT_KO].includes(i);this.triggerMoveEffects(Bi.POST_APPLY,e,t,n,!1),this.applyHeldItemFlinchCheck(e,t,a),this.applyOnGetHitAbEffects(e,t,i),$m("PostAttackAbAttr",e,t,this.move,i),!e.isPlayer()&&this.move.is("AttackMove")&&s.applyShuffledModifiers(wf,!1,t),this.move.is("AttackMove")&&s.applyModifiers(Xm,this.player,e,t)}};u(Ga,"MoveEffectPhase");let yl=Ga;const td=class td extends st{constructor(e,t){super(),this.phaseName="MoveHeaderPhase",this.pokemon=e,this.move=t}canMove(){return this.pokemon.isActive(!0)&&this.move.isUsable(this.pokemon)}start(){super.start(),this.canMove()&&ri("MoveHeaderAttr",this.pokemon,null,this.move.getMove()),this.end()}};u(td,"MoveHeaderPhase");let Tl=td;const sd=class sd extends Ke{constructor(e){super(),this.phaseName="MysteryEncounterPhase",this.FIRST_DIALOGUE_PROMPT_DELAY=300,this.optionSelectSettings=e}start(){super.start(),s.phaseManager.clearPhaseQueue(),s.phaseManager.clearPhaseQueueSplice();const e=s.currentBattle.mysteryEncounter;e.updateSeedOffset(),this.optionSelectSettings||s.mysteryEncounterSaveData.encounteredEvents.push(new xo(e.encounterType,e.encounterTier,s.currentBattle.waveIndex)),s.ui.setMode(_.MYSTERY_ENCOUNTER,this.optionSelectSettings)}handleOptionSelect(e,t){var i,n;if(s.currentBattle.mysteryEncounter.selectedOption=e,!this.optionSelectSettings){const a=s.mysteryEncounterSaveData.encounteredEvents[s.mysteryEncounterSaveData.encounteredEvents.length-1];a.type===((i=s.currentBattle.mysteryEncounter)==null?void 0:i.encounterType)&&(a.selectedOption=t)}return e.onOptionPhase?(s.currentBattle.mysteryEncounter.populateDialogueTokensFromRequirements(),e.onPreOptionPhase?s.executeWithSeedOffset(async()=>await e.onPreOptionPhase().then(a=>{(Ee(a)||a)&&this.continueEncounter()}),(n=s.currentBattle.mysteryEncounter)==null?void 0:n.getSeedOffset()):this.continueEncounter(),!0):!1}continueEncounter(){var i,n,a;const e=u(()=>{s.phaseManager.pushNew("MysteryEncounterOptionSelectedPhase"),this.end()},"endDialogueAndContinueEncounter"),t=(a=(n=(i=s.currentBattle)==null?void 0:i.mysteryEncounter)==null?void 0:n.selectedOption)==null?void 0:a.dialogue;if(t!=null&&t.selected&&t.selected.length>0){s.ui.setMode(_.MESSAGE);const r=t.selected;let o=0;const l=u(()=>{const h=o===r.length-1?e:l,c=r[o];let d=null;const f=Gt(c.text);c.speaker&&(d=Gt(c.speaker)),o++,d?s.ui.showDialogue(f??"",d,null,h,0,o===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(f??"",null,h,o===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");l()}else e()}end(){s.ui.setMode(_.MESSAGE).then(()=>super.end())}};u(sd,"MysteryEncounterPhase");let Cl=sd;const id=class id extends Ke{constructor(){super(),this.phaseName="MysteryEncounterOptionSelectedPhase",this.onOptionSelect=s.currentBattle.mysteryEncounter.selectedOption.onOptionPhase}start(){var e,t;super.start(),(e=s.currentBattle.mysteryEncounter)!=null&&e.autoHideIntroVisuals?qm().then(()=>{var i;s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},((i=s.currentBattle.mysteryEncounter)==null?void 0:i.getSeedOffset())*500)}):s.executeWithSeedOffset(()=>{this.onOptionSelect().finally(()=>{this.end()})},((t=s.currentBattle.mysteryEncounter)==null?void 0:t.getSeedOffset())*500)}};u(id,"MysteryEncounterOptionSelectedPhase");let Sl=id;const nd=class nd extends Ke{constructor(){super(...arguments),this.phaseName="MysteryEncounterBattleStartCleanupPhase"}start(){super.start();const e=[He.FLINCHED,He.ENDURING];for(s.getField(!0).forEach(a=>{const r=a.summonData.tags;r.filter(o=>e.includes(o.tagType)&&o.lapseTypes.includes(Es.TURN_END)&&!o.lapse(a,Es.TURN_END)).forEach(o=>{o.onRemove(a),r.splice(r.indexOf(o),1)})});s.phaseManager.findPhase(a=>a.is("PostTurnStatusEffectPhase"));)s.phaseManager.tryRemovePhase(a=>a.is("PostTurnStatusEffectPhase"));const t=s.getPokemonAllowedInBattle(),i=t.filter(a=>!a.isActive(!0));if(!t.length)return s.phaseManager.unshiftNew("GameOverPhase"),this.end();s.getPlayerField().forEach((a,r)=>{!a.isAllowedInBattle()&&i.length>r&&s.phaseManager.unshiftNew("SwitchPhase",ut.SWITCH,r,!0,!1)}),s.currentBattle.double&&t.length===1&&i.length===0&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0),this.end()}};u(nd,"MysteryEncounterBattleStartCleanupPhase");let bl=nd;const ad=class ad extends Ke{constructor(e=!1){super(),this.phaseName="MysteryEncounterBattlePhase",this.disableSwitch=e}start(){super.start(),this.doMysteryEncounterBattle()}getBattleMessage(){var i,n;const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;return s.currentBattle.battleSpec===Ft.FINAL_BOSS?g.t("battle:bossAppeared",{bossName:e[0].name}):t===ns.TRAINER_BATTLE?s.currentBattle.double?g.t("battle:trainerAppearedDouble",{trainerName:(i=s.currentBattle.trainer)==null?void 0:i.getName(mt.NONE,!0)}):g.t("battle:trainerAppeared",{trainerName:(n=s.currentBattle.trainer)==null?void 0:n.getName(mt.NONE,!0)}):e.length===1?g.t("battle:singleWildAppeared",{pokemonName:e[0].name}):g.t("battle:multiWildAppeared",{pokemonName1:e[0].name,pokemonName2:e[1].name})}doMysteryEncounterBattle(){var t,i,n,a;const e=s.currentBattle.mysteryEncounter.encounterMode;if(e===ns.WILD_BATTLE||e===ns.BOSS_BATTLE){e===ns.BOSS_BATTLE&&s.playBgm();const r=s.getEnemyParty().filter(o=>!o.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&r>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),(t=s.currentBattle.mysteryEncounter)!=null&&t.hideBattleIntroMessage?this.endBattleSetup():s.ui.showText(this.getBattleMessage(),null,()=>this.endBattleSetup(),0)}else if(e===ns.TRAINER_BATTLE){this.showEnemyTrainer();const r=u(()=>{var h;s.currentBattle.started=!0,s.playBgm(),s.pbTray.showPbTray(s.getPlayerParty()),s.pbTrayEnemy.showPbTray(s.getEnemyParty());const l=u(()=>{this.hideEnemyTrainer();const c=s.getEnemyParty().filter(d=>!d.isFainted()).length;s.phaseManager.unshiftNew("SummonPhase",0,!1),s.currentBattle.double&&c>1&&s.phaseManager.unshiftNew("SummonPhase",1,!1),this.endBattleSetup()},"doTrainerSummon");(h=s.currentBattle.mysteryEncounter)!=null&&h.hideBattleIntroMessage?l():s.ui.showText(this.getBattleMessage(),null,l,1e3,!0)},"doSummon"),o=(i=s.currentBattle.trainer)==null?void 0:i.getEncounterMessages();if(!o||!o.length)r();else{const l=s.currentBattle.trainer;let h;s.executeWithSeedOffset(()=>h=_i(o),(n=s.currentBattle.mysteryEncounter)==null?void 0:n.getSeedOffset()),h=h;const c=u(()=>{s.ui.showDialogue(h,l==null?void 0:l.getName(mt.NONE,!0),null,()=>{s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>r()))})},"showDialogueAndSummon");(a=s.currentBattle.trainer)!=null&&a.config.hasCharSprite&&!s.ui.shouldSkipDialogue(h)?s.showFieldOverlay(500).then(()=>s.charSprite.showCharacter(l==null?void 0:l.getKey(),Xa(o[0])).then(()=>c())):c()}}}endBattleSetup(){const e=s.getEnemyField(),t=s.currentBattle.mysteryEncounter.encounterMode;t!==ns.TRAINER_BATTLE&&s.findModifier(a=>a instanceof Lf)&&e.map(a=>s.phaseManager.pushNew("ScanIvsPhase",a.getBattlerIndex()));const i=s.getPlayerParty().filter(n=>n.isAllowedInBattle());if(i[0].isOnField()||s.phaseManager.pushNew("SummonPhase",0),s.currentBattle.double?i.length>1&&(s.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||s.phaseManager.pushNew("SummonPhase",1)):(i.length>1&&i[1].isOnField()&&(s.getPlayerField().forEach(n=>n.lapseTag(He.COMMANDED)),s.phaseManager.pushNew("ReturnPhase",1)),s.phaseManager.pushNew("ToggleDoublePositionPhase",!1)),t!==ns.TRAINER_BATTLE&&!this.disableSwitch){const n=s.currentBattle.double?2:1;i.length>n&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}this.end()}showEnemyTrainer(){const e=s.currentBattle.trainer;e&&(e.alpha=0,e.x+=16,e.y-=16,e.setVisible(!0),s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,ease:"Sine.easeInOut",duration:750,onComplete:u(()=>{e.untint(100,"Sine.easeOut"),e.playAnim()},"onComplete")}))}hideEnemyTrainer(){s.tweens.add({targets:s.currentBattle.trainer,x:"+=16",y:"-=16",alpha:0,ease:"Sine.easeInOut",duration:750})}};u(ad,"MysteryEncounterBattlePhase");let El=ad;const rd=class rd extends Ke{constructor(e=!1){super(),this.phaseName="MysteryEncounterRewardsPhase",this.addHealPhase=e}start(){super.start();const e=s.currentBattle.mysteryEncounter;e.doContinueEncounter?e.doContinueEncounter().then(()=>{this.end()}):s.executeWithSeedOffset(()=>{e.onRewards?e.onRewards().then(()=>{this.doEncounterRewardsAndContinue()}):this.doEncounterRewardsAndContinue()},s.currentBattle.waveIndex*1e3)}doEncounterRewardsAndContinue(){const e=s.currentBattle.mysteryEncounter;e.doEncounterExp&&e.doEncounterExp(),e.doEncounterRewards?e.doEncounterRewards():this.addHealPhase&&(s.phaseManager.tryRemovePhase(t=>t.is("SelectModifierPhase")),s.phaseManager.unshiftNew("SelectModifierPhase",0,void 0,{fillRemaining:!1,rerollMultiplier:-1})),s.phaseManager.pushNew("PostMysteryEncounterPhase"),this.end()}};u(rd,"MysteryEncounterRewardsPhase");let Il=rd;const od=class od extends Ke{constructor(){var e,t;super(),this.phaseName="PostMysteryEncounterPhase",this.FIRST_DIALOGUE_PROMPT_DELAY=750,this.onPostOptionSelect=(t=(e=s.currentBattle.mysteryEncounter)==null?void 0:e.selectedOption)==null?void 0:t.onPostOptionPhase}start(){var e;super.start(),this.onPostOptionSelect?s.executeWithSeedOffset(async()=>await this.onPostOptionSelect().then(t=>{(Ee(t)||t)&&this.continueEncounter()}),((e=s.currentBattle.mysteryEncounter)==null?void 0:e.getSeedOffset())*2e3):this.continueEncounter()}continueEncounter(){var i,n,a;const e=u(()=>{(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase"),this.end()},"endPhase"),t=(a=(n=(i=s.currentBattle)==null?void 0:i.mysteryEncounter)==null?void 0:n.dialogue)==null?void 0:a.outro;if(t&&t.length>0){let r=0;const o=u(()=>{const l=r===t.length-1?e:o,h=t[r];let c=null;const d=Gt(h.text);h.speaker&&(c=Gt(h.speaker)),r++,s.ui.setMode(_.MESSAGE),c?s.ui.showDialogue(d??"",c,null,l,0,r===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0):s.ui.showText(d??"",null,l,r===1?this.FIRST_DIALOGUE_PROMPT_DELAY:0,!0)},"showNextDialogue");o()}else e()}};u(od,"PostMysteryEncounterPhase");let vl=od;const ld=class ld extends st{constructor(){super(...arguments),this.phaseName="NewBattlePhase"}start(){for(super.start(),s.phaseManager.phaseQueue=s.phaseManager.phaseQueue.filter(e=>!e.is("NewBattlePhase"));s.phaseManager.tryRemoveUnshiftedPhase(e=>e.is("NewBattlePhase")););s.newBattle(),this.end()}};u(ld,"NewBattlePhase");let Ol=ld;const hd=class hd extends Da{constructor(){super(...arguments),this.phaseName="NextEncounterPhase"}start(){super.start()}doEncounter(){var a,r;s.playBgm(void 0,!0);for(const o of s.getPlayerParty())o&&o.resetWaveData();s.arenaNextEnemy.setBiome(s.arena.biomeType),s.arenaNextEnemy.setVisible(!0);const e=s.getEnemyField(),t=[s.arenaEnemy,s.arenaNextEnemy,s.currentBattle.trainer,e,s.lastEnemyTrainer],i=(a=s.lastMysteryEncounter)==null?void 0:a.introVisuals;i&&t.push(i);const n=(r=s.currentBattle.mysteryEncounter)==null?void 0:r.introVisuals;n&&(n.enterFromRight?(n.x+=500,s.tweens.add({targets:n,x:"-=200",duration:2e3})):t.push(n)),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:u(()=>{s.arenaEnemy.setBiome(s.arena.biomeType),s.arenaEnemy.setX(s.arenaNextEnemy.x),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setX(s.arenaNextEnemy.x-300),s.arenaNextEnemy.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),i&&(s.field.remove(i,!0),s.lastMysteryEncounter.introVisuals=void 0),this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){}};u(hd,"NextEncounterPhase");let Fa=hd;const cd=class cd extends Fa{constructor(){super(...arguments),this.phaseName="NewBiomeEncounterPhase"}doEncounter(){var n,a;s.playBgm(void 0,!0);for(const r of s.getPlayerParty())r&&(r.resetBattleAndWaveData(),r.isOnField()&&ot("PostBiomeChangeAbAttr",r,null));const e=s.getEnemyField(),t=[s.arenaEnemy,e],i=(a=(n=s.currentBattle)==null?void 0:n.mysteryEncounter)==null?void 0:a.introVisuals;i&&t.push(i),s.tweens.add({targets:t.flat(),x:"+=300",duration:2e3,onComplete:u(()=>{this.tryOverrideForBattleSpec()||this.doEncounterCommon()},"onComplete")})}trySetWeatherIfNewBiome(){s.arena.trySetWeather(Rf(s.arena))}};u(cd,"NewBiomeEncounterPhase");let xl=cd;const ud=class ud extends bt{constructor(e,t,i,n,a){super(e),this.phaseName="ObtainStatusEffectPhase",this.statusEffect=t,this.turnsRemaining=i,this.sourceText=n,this.sourcePokemon=a}start(){var t;const e=this.getPokemon();if(e&&!e.status){if(e.trySetStatus(this.statusEffect,!1,this.sourcePokemon)){this.turnsRemaining&&(e.status.sleepTurnsRemaining=this.turnsRemaining),e.updateInfo(!0),new $a(Js.POISON+(this.statusEffect-1),e).play(!1,()=>{s.phaseManager.queueMessage(Qm(this.statusEffect,we(e),this.sourceText??void 0)),!Ee(this.statusEffect)&&this.statusEffect!==Ht.FAINT&&(s.triggerPokemonFormChange(e,Zm,!0),s.arena.setIgnoreAbilities(!1),Jm("PostSetStatusAbAttr",e,this.statusEffect,this.sourcePokemon)),this.end()});return}}else((t=e.status)==null?void 0:t.effect)===this.statusEffect&&s.phaseManager.queueMessage(ey(this.statusEffect??Ht.NONE,we(e)));this.end()}};u(ud,"ObtainStatusEffectPhase");let _l=ud;const dd=class dd extends Ke{constructor(e,t,i){super(),this.phaseName="PartyExpPhase",this.expValue=e,this.useWaveIndexMultiplier=t,this.pokemonParticipantIds=i}start(){super.start(),s.applyPartyExp(this.expValue,!1,this.useWaveIndexMultiplier,this.pokemonParticipantIds),this.end()}};u(dd,"PartyExpPhase");let Al=dd;const pd=class pd extends st{constructor(e){super(),this.phaseName="PartyHealPhase",this.resumeBgm=e}start(){super.start();const e=s.isBgmPlaying();e&&s.fadeOutBgm(1e3,!1),s.ui.fadeOut(1e3).then(()=>{for(const i of s.getPlayerParty()){i.hp=i.getMaxHp(),i.resetStatus(!0,!1,!1,!0);for(const n of i.moveset)n.ppUsed=0;i.updateInfo(!0)}const t=s.playSoundWithoutBgm("heal");s.time.delayedCall(de(t.totalDuration*1e3),()=>{t.destroy(),this.resumeBgm&&e&&s.playBgm(),s.ui.fadeIn(500).then(()=>this.end())})}),s.arena.playerTerasUsed=0}};u(pd,"PartyHealPhase");let wl=pd;const fd=class fd extends bt{constructor(){super(...arguments),this.phaseName="PostSummonPhase"}start(){var i;super.start();const e=this.getPokemon();((i=e.status)==null?void 0:i.effect)===Ht.TOXIC&&(e.status.toxicTurnCount=0),s.arena.applyTags(Eh,!1,e),s.currentBattle.isBattleMysteryEncounter()&&e.findTags(n=>n instanceof ty).length>0&&e.lapseTag(He.MYSTERY_ENCOUNTER_POST_SUMMON);const t=e.isPlayer()?s.getPlayerField():s.getEnemyField();for(const n of t)ot("CommanderAbAttr",n,null,!1);this.end()}getPriority(){return 0}};u(fd,"PostSummonPhase");let Tn=fd;const gd=class gd extends Tn{constructor(e,t,i){super(e),this.priority=t,this.passive=i}start(){sy("PostSummonAbAttr",this.getPokemon(),this.passive,!1),this.end()}getPriority(){return this.priority}};u(gd,"PostSummonActivateAbilityPhase");let Ml=gd;var kl=(y=>(y[y.POST_SUMMON=0]="POST_SUMMON",y))(kl||{});const md=class md{pop(){return this.reorder(),this.queue.shift()}push(e){this.queue.push(e)}clear(){this.queue.splice(0,this.queue.length)}};u(md,"PhasePriorityQueue");let Nl=md;const yd=class yd extends Nl{constructor(){super(...arguments),this.queue=[]}reorder(){this.queue.sort((e,t)=>e.getPriority()===t.getPriority()?(t.getPokemon().getEffectiveStat(Pt.SPD)-e.getPokemon().getEffectiveStat(Pt.SPD))*(YC()?-1:1):t.getPriority()-e.getPriority())}push(e){super.push(e),this.queueAbilityPhase(e)}queueAbilityPhase(e){const t=e.getPokemon();t.getAbilityPriorities().forEach((i,n)=>{this.queue.push(new Ml(t.getBattlerIndex(),i,!!n)),s.phaseManager.appendToPhase(new Oi(kl.POST_SUMMON),"ActivatePriorityQueuePhase",a=>a.getType()===kl.POST_SUMMON)})}};u(yd,"PostSummonPhasePriorityQueue");let Pl=yd;function YC(){const y=new at(!1);return s.arena.applyTags(Gf,!1,y),y.value}u(YC,"isTrickRoom");const Td=class Td extends st{constructor(e,t,i=[]){super(),this.phaseName="PokemonAnimPhase",this.key=e,this.pokemon=t,this.fieldAssets=i}start(){switch(super.start(),this.key){case ti.SUBSTITUTE_ADD:this.doSubstituteAddAnim();break;case ti.SUBSTITUTE_PRE_MOVE:this.doSubstitutePreMoveAnim();break;case ti.SUBSTITUTE_POST_MOVE:this.doSubstitutePostMoveAnim();break;case ti.SUBSTITUTE_REMOVE:this.doSubstituteRemoveAnim();break;case ti.COMMANDER_APPLY:this.doCommanderApplyAnim();break;case ti.COMMANDER_REMOVE:this.doCommanderRemoveAnim();break;default:this.end()}}doSubstituteAddAnim(){const e=this.pokemon.getTag(gs);if(Ee(e))return this.end();const t=u(()=>{const r=s.addFieldSprite(this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return r.setOrigin(.5,1),s.field.add(r),r},"getSprite"),[i,n]=[t(),t()],a=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setVisible(!1),i.setScale(a),n.setTintFill(16777215),n.setScale(.01),this.pokemon.isPlayer()&&s.field.bringToTop(this.pokemon),s.playSound("PRSFX- Transform"),s.tweens.add({targets:this.pokemon,duration:500,x:this.pokemon.x+this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeIn"}),s.tweens.add({targets:n,delay:250,scale:a,ease:"Cubic.easeInOut",duration:500,onComplete:u(()=>{i.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:u(()=>{n.destroy(),e.sprite=i,this.end()},"onComplete")})},"onComplete")})}doSubstitutePreMoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();s.tweens.add({targets:e,alpha:0,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:this.pokemon,x:e.x,y:e.y,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:u(()=>this.end(),"onComplete")})}doSubstitutePostMoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();s.tweens.add({targets:this.pokemon,x:e.x+this.pokemon.getSubstituteOffset()[0],y:e.y+this.pokemon.getSubstituteOffset()[1],alpha:.5,ease:"Sine.easeInOut",duration:500}),s.tweens.add({targets:e,alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:u(()=>this.end(),"onComplete")})}doSubstituteRemoveAnim(){if(this.fieldAssets.length!==1)return this.end();const e=this.fieldAssets[0];if(e===void 0)return this.end();const i=u(()=>{const a=s.addFieldSprite(e.x,e.y,`pkmn${this.pokemon.isPlayer()?"__back":""}__sub`);return a.setOrigin(.5,1),s.field.add(a),a},"getSprite")(),n=this.pokemon.getSpriteScale()*(this.pokemon.isPlayer()?.5:1);i.setAlpha(0),i.setTintFill(16777215),i.setScale(n),s.tweens.add({targets:i,alpha:1,ease:"Sine.easeInOut",duration:500,onComplete:u(()=>{e.destroy();const a=s.time.addEvent({delay:100,repeat:7,startAt:200,callback:u(()=>{s.playSound("PRSFX- Substitute2.wav"),i.setVisible(a.repeatCount%2===0),a.repeatCount||(s.tweens.add({targets:i,scale:.01,ease:"Sine.cubicEaseIn",duration:500}),s.tweens.add({targets:this.pokemon,x:this.pokemon.x-this.pokemon.getSubstituteOffset()[0],y:this.pokemon.y-this.pokemon.getSubstituteOffset()[1],alpha:1,ease:"Sine.easeInOut",delay:250,duration:500,onComplete:u(()=>{i.destroy(),this.end()},"onComplete")}))},"callback")})},"onComplete")})}doCommanderApplyAnim(){var l,h;if(!((l=s.currentBattle)!=null&&l.double))return this.end();const e=this.pokemon.getAlly();if(((h=e==null?void 0:e.species)==null?void 0:h.speciesId)!==ge.DONDOZO)return this.end();const t=this.pokemon.x+this.pokemon.getSprite().x,i=this.pokemon.y+this.pokemon.getSprite().y,a=u(()=>{const c=s.addPokemonSprite(this.pokemon,t,i,this.pokemon.getSprite().texture,this.pokemon.getSprite().frame.name,!0);return["spriteColors","fusionSpriteColors"].map(d=>c.pipelineData[d]=this.pokemon.getSprite().pipelineData[d]),c.setPipelineData("spriteKey",this.pokemon.getBattleSpriteKey()),c.setPipelineData("shiny",this.pokemon.shiny),c.setPipelineData("variant",this.pokemon.variant),c.setPipelineData("ignoreFieldPos",!0),c.setOrigin(.5,1),this.pokemon.getSprite().on("animationupdate",(d,f)=>c.setFrame(f.textureFrame)),s.field.add(c),c},"getSourceSprite")();this.pokemon.setVisible(!1);const r=this.pokemon.getFieldPositionOffset(),o=e.getFieldPositionOffset();s.playSound("se/pb_throw"),s.tweens.add({targets:a,duration:375,scale:.5,x:{value:t+(o[0]-r[0])/2,ease:"Linear"},y:{value:(this.pokemon.isPlayer()?100:65)+r[1],ease:"Sine.easeOut"},onComplete:u(()=>{s.field.bringToTop(e),s.tweens.add({targets:a,duration:375,scale:.01,x:{value:e.x,ease:"Linear"},y:{value:e.y+e.height/2,ease:"Sine.easeIn"},onComplete:u(()=>{a.destroy(),s.playSound("battle_anims/PRSFX- Liquidation1.wav"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeInOut",scale:.85,yoyo:!0,onComplete:u(()=>this.end(),"onComplete")})},"onComplete")})},"onComplete")})}doCommanderRemoveAnim(){const e=this.pokemon.getAlly();if(Ee(e))return console.warn("Aborting COMMANDER_REMOVE anim: Tatsugiri is undefined"),this.end();const t=s.addPokemonSprite(e,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y+this.pokemon.height/2,e.getSprite().texture,e.getSprite().frame.name,!0);["spriteColors","fusionSpriteColors"].map(i=>t.pipelineData[i]=e.getSprite().pipelineData[i]),t.setPipelineData("spriteKey",e.getBattleSpriteKey()),t.setPipelineData("shiny",e.shiny),t.setPipelineData("variant",e.variant),t.setPipelineData("ignoreFieldPos",!0),this.pokemon.getSprite().on("animationupdate",(i,n)=>t.setFrame(n.textureFrame)),t.setOrigin(.5,1),t.setScale(.01),s.field.add(t),s.field.bringToTop(this.pokemon),t.setVisible(!0),s.tweens.add({targets:this.pokemon,duration:250,ease:"Sine.easeInOut",scale:1.15,yoyo:!0,onComplete:u(()=>{s.playSound("battle_anims/PRSFX- Liquidation4.wav"),s.tweens.add({targets:t,duration:500,scale:1,x:{value:e.x+e.getSprite().x,ease:"Linear"},y:{value:e.y+e.getSprite().y,ease:"Sine.easeIn"},onComplete:u(()=>{e.setVisible(!0),t.destroy(),this.end()},"onComplete")})},"onComplete")})}};u(Td,"PokemonAnimPhase");let Dl=Td;const Cd=class Cd extends gn{constructor(e,t,i,n,a=!1,r=!1,o=!1,l=!1,h=!1){super(e,void 0,Js.HEALTH_UP),this.phaseName="PokemonHealPhase",this.hpHealed=t,this.message=i,this.showFullHpMessage=n,this.skipAnim=a,this.revive=r,this.healStatus=o,this.preventFullHeal=l,this.fullRestorePP=h}start(){!this.skipAnim&&(this.revive||this.getPokemon().hp)&&!this.getPokemon().isFullHp()?super.start():this.end()}end(){const e=this.getPokemon();if(!e.isOnField()||!this.revive&&!e.isActive())return super.end();const t=!!this.message,i=!e.isFullHp()||this.hpHealed<0,n=e.getTag(He.HEAL_BLOCK);let a=Ht.NONE;if(n&&this.hpHealed>0)return s.phaseManager.queueMessage(n.onActivation(e)),this.message=null,super.end();if(i){const r=new rt(1);this.revive||s.applyModifiers(Kf,this.player,r);const o=new rt(Math.floor(this.hpHealed*r.value));if(o.value<0&&(e.damageAndUpdate(o.value*-1,{result:Ge.INDIRECT}),o.value=0),this.preventFullHeal&&e.hp+o.value>=e.getMaxHp()&&(o.value=e.getMaxHp()-e.hp-1),o.value=e.heal(o.value),o.value&&s.damageNumberHandler.add(e,o.value,Ge.HEAL),e.isPlayer()&&(s.validateAchvs(iy,o),o.value>s.gameData.gameStats.highestHeal&&(s.gameData.gameStats.highestHeal=o.value)),this.healStatus&&!this.revive&&e.status&&(a=e.status.effect,e.resetStatus()),this.fullRestorePP)for(const l of this.getPokemon().getMoveset())l&&(l.ppUsed=0);e.updateInfo().then(()=>super.end())}else this.healStatus&&!this.revive&&e.status?(a=e.status.effect,e.resetStatus(),e.updateInfo().then(()=>super.end())):this.showFullHpMessage&&(this.message=g.t("battle:hpIsFull",{pokemonName:we(e)}));this.message&&s.phaseManager.queueMessage(this.message),this.healStatus&&a&&!t&&s.phaseManager.queueMessage(ny(a,we(e))),!i&&!a&&super.end()}};u(Cd,"PokemonHealPhase");let Bl=Cd;const Sd=class Sd extends bt{constructor(e,t,i=!1){super(e),this.phaseName="PokemonTransformPhase",this.targetIndex=t,this.playSound=i}start(){const e=this.getPokemon(),t=s.getField(!0).find(n=>n.getBattlerIndex()===this.targetIndex);if(!t)return this.end();e.summonData.speciesForm=t.getSpeciesForm(),e.summonData.ability=t.getAbility().id,e.summonData.gender=t.getGender(),e.removeTag(He.POWER_TRICK);for(const n of ay)e.setStat(n,t.getStat(n,!1),!1);for(const n of ry)e.setStatStage(n,t.getStatStage(n));e.summonData.moveset=t.getMoveset().map(n=>n?new Ss(n.moveId,0,0,!1,Math.min(n.getMove().pp,5)):(console.warn(`Transform: somehow iterating over a ${n} value when copying moveset!`),new Ss(It.NONE))),e.summonData.types=t.getTypes();const i=[e.updateInfo()];this.playSound&&s.playSound("battle_anims/PRSFX- Transform"),s.phaseManager.queueMessage(g.t("abilityTriggers:postSummonTransform",{pokemonNameWithAffix:we(e),targetName:t.name})),i.push(e.loadAssets(!1).then(()=>{e.playAnim(),e.updateInfo(),e.setTempAbility(t.getAbility())})),Promise.allSettled(i).then(()=>this.end())}};u(Sd,"PokemonTransformPhase");let Ll=Sd;const bd=class bd extends Ke{constructor(e){super(),this.phaseName="PostGameOverPhase",this.endCardPhase=e}start(){super.start();const e=u(()=>{s.gameData.saveAll(!0,!0,!0).then(t=>{if(!t)return s.reset(!0);s.gameData.tryClearSession(s.sessionSlotId).then(i=>{if(!i[0])return s.reset(!0);s.reset(),s.phaseManager.unshiftNew("TitlePhase"),this.end()})})},"saveAndReset");this.endCardPhase?s.ui.fadeOut(500).then(()=>{var t,i;s.ui.getMessageHandler().bg.setVisible(!0),(t=this.endCardPhase)==null||t.endCard.destroy(),(i=this.endCardPhase)==null||i.text.destroy(),e()}):e()}};u(bd,"PostGameOverPhase");let Rl=bd;const Ed=class Ed extends bt{constructor(e){super(e),this.phaseName="PostTurnStatusEffectPhase"}start(){const e=this.getPokemon();if(e!=null&&e.isActive(!0)&&e.status&&e.status.isPostTurn()&&!e.switchOutStatus){e.status.incrementTurn();const t=new at(!1);if(ot("BlockNonDirectDamageAbAttr",e,t),ot("BlockStatusDamageAbAttr",e,t),t.value)this.end();else{s.phaseManager.queueMessage(oy(e.status.effect,we(e)));const i=new rt(0);switch(e.status.effect){case Ht.POISON:i.value=Math.max(e.getMaxHp()>>3,1);break;case Ht.TOXIC:i.value=Math.max(Math.floor(e.getMaxHp()/16*e.status.toxicTurnCount),1);break;case Ht.BURN:i.value=Math.max(e.getMaxHp()>>4,1),ot("ReduceBurnDamageAbAttr",e,null,!1,i);break}i.value&&(s.damageNumberHandler.add(this.getPokemon(),e.damage(i.value,!1,!0)),e.updateInfo(),Wf("PostDamageAbAttr",e,i.value,e.hasPassive(),!1,[])),new $a(Js.POISON+(e.status.effect-1),e).play(!1,()=>this.end())}}else this.end()}end(){s.currentBattle.battleSpec===Ft.FINAL_BOSS?s.initFinalBossPhaseTwo(this.getPokemon()):super.end()}};u(Ed,"PostTurnStatusEffectPhase");let Fl=Ed;const Id=class Id extends st{constructor(e,t){super(),this.phaseName="QuietFormChangePhase",this.pokemon=e,this.formChange=t}start(){if(super.start(),this.pokemon.formIndex===this.pokemon.species.forms.findIndex(a=>a.formKey===this.formChange.formKey))return this.end();const e=we(this.pokemon);if(!this.pokemon.isOnField()||this.pokemon.getTag(Yf)||this.pokemon.isFainted()){this.pokemon.isPlayer()||this.pokemon.isActive()?this.pokemon.changeForm(this.formChange).then(()=>{s.ui.showText(Pr(this.pokemon,this.formChange,e),null,()=>this.end(),1500)}):this.end();return}const t=u(()=>{const a=s.addPokemonSprite(this.pokemon,this.pokemon.x+this.pokemon.getSprite().x,this.pokemon.y+this.pokemon.getSprite().y,"pkmn__sub");a.setOrigin(.5,1);const r=this.pokemon.getBattleSpriteKey();try{a.play(r).stop()}catch(o){console.error(`Failed to play animation for ${r}`,o)}return a.setPipeline(s.spritePipeline,{tone:[0,0,0,0],hasShadow:!1,teraColor:Qs(this.pokemon.getTeraType()),isTerastallized:this.pokemon.isTerastallized}),["spriteColors","fusionSpriteColors"].map(o=>{this.pokemon.summonData.speciesForm&&(o+="Base"),a.pipelineData[o]=this.pokemon.getSprite().pipelineData[o]}),s.field.add(a),a},"getPokemonSprite"),[i,n]=[t(),t()];this.pokemon.getSprite().on("animationupdate",(a,r)=>{r.textureKey===i.texture.key?i.setFrame(r.textureFrame):n.setFrame(r.textureFrame)}),i.setAlpha(0),i.setTintFill(16777215),n.setVisible(!1),n.setTintFill(16777215),s.playSound("battle_anims/PRSFX- Transform"),s.tweens.add({targets:i,alpha:1,duration:1e3,ease:"Cubic.easeIn",onComplete:u(()=>{this.pokemon.setVisible(!1),this.pokemon.changeForm(this.formChange).then(()=>{n.setScale(.01);const a=this.pokemon.getBattleSpriteKey();try{n.play(a).stop()}catch(r){console.error(`Failed to play animation for ${a}`,r)}n.setVisible(!0),s.tweens.add({targets:i,delay:250,scale:.01,ease:"Cubic.easeInOut",duration:500,onComplete:u(()=>i.destroy(),"onComplete")}),s.tweens.add({targets:n,delay:250,scale:this.pokemon.getSpriteScale(),ease:"Cubic.easeInOut",duration:500,onComplete:u(()=>{this.pokemon.setVisible(!0),s.tweens.add({targets:n,delay:250,alpha:0,ease:"Cubic.easeOut",duration:1e3,onComplete:u(()=>{i.setVisible(!1),s.ui.showText(Pr(this.pokemon,this.formChange,e),null,()=>this.end(),1500)},"onComplete")})},"onComplete")})})},"onComplete")})}end(){var e;if(this.pokemon.findAndRemoveTags(t=>t.tagType===He.AUTOTOMIZED),((e=s)==null?void 0:e.currentBattle.battleSpec)===Ft.FINAL_BOSS&&this.pokemon.isEnemy()){s.playBgm(),s.phaseManager.unshiftNew("PokemonHealPhase",this.pokemon.getBattlerIndex(),this.pokemon.getMaxHp(),null,!1,!1,!1,!0),this.pokemon.findAndRemoveTags(()=>!0),this.pokemon.bossSegments=5,this.pokemon.bossSegmentIndex=4,this.pokemon.initBattleInfo(),this.pokemon.cry();const t=s.phaseManager.findPhase(i=>i.is("MovePhase")&&i.pokemon===this.pokemon);t&&t.cancel()}this.formChange.trigger instanceof zf&&(ot("PostTeraFormChangeStatChangeAbAttr",this.pokemon,null),ot("ClearWeatherAbAttr",this.pokemon,null),ot("ClearTerrainAbAttr",this.pokemon,null)),super.end()}};u(Id,"QuietFormChangePhase");let Ul=Id;const vd=class vd extends Ke{constructor(e){super(),this.phaseName="ReloadSessionPhase",this.systemDataStr=e}start(){s.ui.setMode(_.SESSION_RELOAD);let e=!1,t=!1;s.time.delayedCall(de(1500),()=>{t?this.end():e=!0}),s.gameData.clearLocalData(),(this.systemDataStr?s.gameData.initSystem(this.systemDataStr):s.gameData.loadSystem()).then(()=>{e?this.end():t=!0})}};u(vd,"ReloadSessionPhase");let Vl=vd;const Od=class Od extends st{constructor(e,t,i){super(),this.phaseName="ResetStatusPhase",this.pokemon=e,this.affectConfusion=t,this.reloadAssets=i}start(){this.pokemon.clearStatus(this.affectConfusion,this.reloadAssets),this.end()}};u(Od,"ResetStatusPhase");let Hl=Od;const xd=class xd extends La{constructor(e,t=!0,i=!1){super(e,t),this.phaseName="SummonPhase",this.loaded=i}start(){super.start(),Ih("PreSummonAbAttr",this.getPokemon()),this.preSummon()}preSummon(){var t,i;const e=this.getPokemon();if(!e.isAllowedInBattle()||this.player&&!this.getParty().some(n=>n.id===e.id)){console.warn("The Pokemon about to be sent out is fainted or illegal under a challenge. Attempting to resolve..."),e.isOnField()&&e.leaveField();const n=this.getParty(),a=n.findIndex((r,o)=>o>this.partyMemberIndex&&r.isAllowedInBattle());if(a===-1){console.error(`Party Details:
`,n),console.error("All available Pokemon were fainted or illegal!"),s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase"),this.end();return}[n[this.partyMemberIndex],n[a]]=[n[a],n[this.partyMemberIndex]],console.warn("Swapped %s %O with %s %O",we(e),e,we(n[0]),n[0])}if(this.player)s.ui.showText(g.t("battle:playerGo",{pokemonName:we(this.getPokemon())})),this.player&&s.pbTray.hide(),s.trainer.setTexture(`trainer_${s.gameData.gender===Fe.FEMALE?"f":"m"}_back_pb`),s.time.delayedCall(562,()=>{s.trainer.setFrame("2"),s.time.delayedCall(64,()=>{s.trainer.setFrame("3")})}),s.tweens.add({targets:s.trainer,x:-36,duration:1e3,onComplete:u(()=>s.trainer.setVisible(!1),"onComplete")}),s.time.delayedCall(750,()=>this.summon());else if(s.currentBattle.battleType===Ce.TRAINER||((t=s.currentBattle.mysteryEncounter)==null?void 0:t.encounterMode)===ns.TRAINER_BATTLE){const n=(i=s.currentBattle.trainer)==null?void 0:i.getName(this.fieldIndex%2?mt.TRAINER_PARTNER:mt.TRAINER),a=this.getPokemon().getNameToRender(),r=g.t("battle:trainerSendOut",{trainerName:n,pokemonName:a});s.pbTrayEnemy.hide(),s.ui.showText(r,null,()=>this.summon())}else s.currentBattle.isBattleMysteryEncounter()&&(s.pbTrayEnemy.hide(),this.summonWild())}summon(){const e=this.getPokemon(),t=s.addFieldSprite(this.player?36:248,this.player?80:44,"pb",mi(e.getPokeball(!0)));if(t.setVisible(!1),t.setOrigin(.5,.625),s.field.add(t),this.fieldIndex===1)e.setFieldPosition(as.RIGHT,0);else{const n=this.getParty().filter(a=>a.isAllowedInBattle()).length;e.setFieldPosition(!s.currentBattle.double||n===1?as.CENTER:as.LEFT)}const i=e.getFieldPositionOffset();t.setVisible(!0),s.tweens.add({targets:t,duration:650,x:(this.player?100:236)+i[0]}),s.tweens.add({targets:t,duration:150,ease:"Cubic.easeOut",y:(this.player?70:34)+i[1],onComplete:u(()=>{s.tweens.add({targets:t,duration:500,ease:"Cubic.easeIn",angle:1440,y:(this.player?132:86)+i[1],onComplete:u(()=>{if(s.playSound("se/pb_rel"),t.destroy(),s.add.existing(e),s.field.add(e),!this.player){const n=s.getPlayerPokemon();n!=null&&n.isOnField()&&s.field.moveBelow(e,n),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}kf(e.x,e.y-16,e.getPokeball(!0)),s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.5),e.tint(tn(e.getPokeball(!0))),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:u(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),e.summonData.speciesForm&&e.loadAssets(!1),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})},"onComplete")})},"onComplete")})}summonWild(){const e=this.getPokemon();if(this.fieldIndex===1)e.setFieldPosition(as.RIGHT,0);else{const t=this.getParty().filter(i=>!i.isFainted()).length;e.setFieldPosition(!s.currentBattle.double||t===1?as.CENTER:as.LEFT)}if(s.add.existing(e),s.field.add(e),!this.player){const t=s.getPlayerPokemon();t!=null&&t.isOnField()&&s.field.moveBelow(e,t),s.currentBattle.seenEnemyPartyMemberIds.add(e.id)}s.updateModifiers(this.player),s.updateFieldScale(),e.showInfo(),e.playAnim(),e.setVisible(!0),e.getSprite().setVisible(!0),e.setScale(.75),e.tint(tn(e.pokeball)),e.untint(250,"Sine.easeIn"),s.updateFieldScale(),e.x+=16,e.y-=20,e.alpha=0,s.tweens.add({targets:e,x:"-=16",y:"+=16",alpha:1,duration:1e3,ease:"Sine.easeIn",scale:e.getSpriteScale(),onComplete:u(()=>{e.cry(e.getHpRatio()>.25?void 0:{rate:.85}),e.getSprite().clearTint(),e.fieldSetup(),s.updateFieldScale(),s.time.delayedCall(1e3,()=>this.end())},"onComplete")})}onEnd(){const e=this.getPokemon();e.isShiny(!0)&&s.phaseManager.unshiftNew("ShinySparklePhase",e.getBattlerIndex()),e.resetTurnData(),(!this.loaded||[Ce.TRAINER,Ce.MYSTERY_ENCOUNTER].includes(s.currentBattle.battleType)||s.currentBattle.waveIndex%10===1)&&(s.triggerPokemonFormChange(e,qa,!0),this.queuePostSummon())}queuePostSummon(){s.phaseManager.pushNew("PostSummonPhase",this.getPokemon().getBattlerIndex())}end(){this.onEnd(),super.end()}};u(xd,"SummonPhase");let Cn=xd;const _d=class _d extends Cn{constructor(e,t,i,n,a=!0){super(t,a),this.phaseName="SwitchSummonPhase",this.switchType=e,this.slotIndex=i,this.doReturn=n}start(){super.start()}preSummon(){var t,i;if(this.player||(this.slotIndex===-1&&(this.slotIndex=(t=s.currentBattle.trainer)==null?void 0:t.getNextSummonIndex(this.fieldIndex?mt.TRAINER_PARTNER:mt.TRAINER)),this.slotIndex>-1&&(this.showEnemyTrainer(this.fieldIndex%2?mt.TRAINER_PARTNER:mt.TRAINER),s.pbTrayEnemy.showPbTray(s.getEnemyParty()))),!this.doReturn||this.slotIndex!==-1&&!(this.player?s.getPlayerParty():s.getEnemyParty())[this.slotIndex]){if(this.player){this.switchAndSummon();return}s.time.delayedCall(750,()=>this.switchAndSummon());return}const e=this.getPokemon();if((this.player?s.getEnemyField():s.getPlayerField()).forEach(n=>n.removeTagsBySourceId(e.id)),this.switchType===ut.SWITCH||this.switchType===ut.INITIAL_SWITCH){const n=e.getTag(gs);n&&s.tweens.add({targets:n.sprite,duration:250,scale:n.sprite.scale*.5,ease:"Sine.easeIn",onComplete:u(()=>n.sprite.destroy(),"onComplete")})}s.ui.showText(this.player?g.t("battle:playerComeBack",{pokemonName:we(e)}):g.t("battle:trainerComeBack",{trainerName:(i=s.currentBattle.trainer)==null?void 0:i.getName(this.fieldIndex%2?mt.TRAINER_PARTNER:mt.TRAINER),pokemonName:e.getNameToRender()})),s.playSound("se/pb_rel"),e.hideInfo(),e.tint(tn(e.getPokeball(!0)),1,250,"Sine.easeIn"),s.tweens.add({targets:e,duration:250,ease:"Sine.easeIn",scale:.5,onComplete:u(()=>{s.time.delayedCall(750,()=>this.switchAndSummon()),e.leaveField(this.switchType===ut.SWITCH,!1)},"onComplete")})}switchAndSummon(){const e=this.player?this.getParty():s.getEnemyParty(),t=e[this.slotIndex];if(this.lastPokemon=this.getPokemon(),t.resetSummonData(),t.loadAssets(!0),Ih("PreSummonAbAttr",t),ly("PreSwitchOutAbAttr",this.lastPokemon),!t){this.end();return}if(this.switchType===ut.BATON_PASS&&((this.player?s.getEnemyField():s.getPlayerField()).forEach(n=>n.transferTagsBySourceId(this.lastPokemon.id,t.id)),!s.findModifier(n=>n instanceof Ip&&n.pokemonId===t.id))){const n=s.findModifier(a=>a instanceof Ip&&a.pokemonId===this.lastPokemon.id);n&&s.tryTransferHeldItemModifier(n,t,!1,void 0,void 0,void 0,!1)}e[this.slotIndex]=this.lastPokemon,e[this.fieldIndex]=t;const i=u(()=>{s.ui.showText(this.getSendOutText(t)),this.switchType===ut.BATON_PASS||this.switchType===ut.SHED_TAIL?this.lastPokemon.getTag(gs)&&(t.x+=this.lastPokemon.getSubstituteOffset()[0],t.y+=this.lastPokemon.getSubstituteOffset()[1],t.setAlpha(.5)):t.fieldSetup(!0),this.summon()},"showTextAndSummon");this.player?i():s.time.delayedCall(1500,()=>{this.hideEnemyTrainer(),s.pbTrayEnemy.hide(),i()})}onEnd(){var o;super.onEnd();const e=this.getPokemon(),t=s.currentBattle.lastMove,i=t?Ne[t]:void 0,n=(o=s.currentBattle.turnCommands[this.fieldIndex])==null?void 0:o.command,a=(i==null?void 0:i.hasAttr("ForceSwitchOutAttr"))&&!this.lastPokemon.isFainted(),r=this.lastPokemon.hasAbilityWithAttr("PostDamageForceSwitchAbAttr")&&!this.lastPokemon.isFainted();if((n===be.POKEMON||a||r)&&(e.tempSummonData.turnCount--,e.tempSummonData.waveTurnCount--),this.switchType===ut.BATON_PASS&&e)e.transferSummon(this.lastPokemon);else if(this.switchType===ut.SHED_TAIL&&e){const l=this.lastPokemon.getTag(gs);l&&e.summonData.tags.push(l)}this.switchType!==ut.INITIAL_SWITCH&&(e.resetTurnData(),e.turnData.switchedInThisTurn=!0),this.lastPokemon.resetSummonData(),s.triggerPokemonFormChange(e,qa,!0),s.arena.triggerWeatherBasedFormChanges()}queuePostSummon(){s.phaseManager.startNewDynamicPhase("PostSummonPhase",this.getPokemon().getBattlerIndex())}getSendOutText(e){var t;return this.switchType===ut.FORCE_SWITCH?g.t("battle:pokemonDraggedOut",{pokemonName:we(e)}):this.player?g.t("battle:playerGo",{pokemonName:we(e)}):g.t("battle:trainerGo",{trainerName:(t=s.currentBattle.trainer)==null?void 0:t.getName(this.fieldIndex%2?mt.TRAINER_PARTNER:mt.TRAINER),pokemonName:this.getPokemon().getNameToRender()})}};u(_d,"SwitchSummonPhase");let Ua=_d;const Ad=class Ad extends Ua{constructor(e){super(ut.SWITCH,e,-1,!0),this.phaseName="ReturnPhase"}switchAndSummon(){this.end()}summon(){}onEnd(){const e=this.getPokemon();e.resetSprite(),e.resetTurnData(),e.resetSummonData(),s.updateFieldScale(),s.triggerPokemonFormChange(e,qa)}};u(Ad,"ReturnPhase");let Yl=Ad;const wd=class wd extends st{constructor(e){super(),this.user=e,this.phaseName="RevivalBlessingPhase"}start(){s.ui.setMode(_.PARTY,Wt.REVIVAL_BLESSING,this.user.getFieldIndex(),(e,t)=>{if(e>=0&&e<6){const i=s.getPlayerParty()[e];if(!i||!i.isFainted())return this.end();i.resetTurnData(),i.resetStatus(!0,!1,!1,!1),i.heal(Math.min(ff(.5*i.getMaxHp()),i.getMaxHp())),s.phaseManager.queueMessage(g.t("moveTriggers:revivalBlessing",{pokemonName:i.name}),0,!0);const n=this.user.getAlly();s.currentBattle.double&&s.getPlayerParty().length>1&&!Ee(n)&&(e<=1?(s.phaseManager.unshiftNew("SwitchSummonPhase",ut.SWITCH,i.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)):n.isFainted()&&(s.phaseManager.unshiftNew("SwitchSummonPhase",ut.SWITCH,n.getFieldIndex(),e,!1,!0),s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)))}s.ui.setMode(_.MESSAGE).then(()=>this.end())},Sn.FilterFainted)}};u(wd,"RevivalBlessingPhase");let Wl=wd;const Md=class Md extends mn{constructor(e,t){super(e),this.phaseName="RibbonModifierRewardPhase",this.species=t}doReward(){return new Promise(e=>{const t=this.modifierType.newModifier();s.addModifier(t),s.playSound("level_up_fanfare"),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:beatModeFirstTime",{speciesName:this.species.name,gameMode:s.gameMode.getName(),newModifier:t==null?void 0:t.type.name}),null,()=>{e()},null,!0,1500)})}};u(Md,"RibbonModifierRewardPhase");let Gl=Md;const kd=class kd extends bt{constructor(e){super(e),this.phaseName="ScanIvsPhase"}start(){super.start();const e=this.getPokemon();let t=[],i=[],n=[];const a=s.getEnemyField(),r=s.uiTheme;for(let o=0;o<a.length;o++){t=a[o].ivs;const l=s.gameData.dexData[a[o].species.getRootSpeciesId()].ivs;i=a[o].getBattleInfo().getStatsValueContainer().list,n=i.filter(h=>h.name.indexOf("icon_stat_label")>=0);for(let h=0;h<n.length;h++){const c=Pt[n[h].frame.name];if(t[c]>l[c]&&Yi.indexOf(Number(c))>=0){const d=t[c]===31?Oe(O.PERFECT_IV,!1,r):Oe(O.SUMMARY_GREEN,!1,r),f=Phaser.Display.Color.HexStringToColor(d).color;n[h].setTint(f)}n[h].setVisible(!0)}}s.hideIvs?this.end():s.ui.showText(g.t("battle:ivScannerUseQuestion",{pokemonName:we(e)}),null,()=>{s.ui.setMode(_.CONFIRM,()=>{s.ui.setMode(_.MESSAGE),s.ui.clearText(),s.ui.getMessageHandler().promptIvs(e.id,e.ivs).then(()=>this.end())},()=>{s.ui.setMode(_.MESSAGE),s.ui.clearText(),this.end()})})}};u(kd,"ScanIvsPhase");let Kl=kd;const Nd=class Nd extends st{constructor(){super(...arguments),this.phaseName="SelectBiomePhase"}start(){super.start(),s.resetSeed();const e=s.arena.biomeType,t=s.currentBattle.waveIndex+1,i=u(n=>{t%10===1&&(s.applyModifiers(cy,!0),s.phaseManager.unshiftNew("PartyHealPhase",!1)),s.phaseManager.unshiftNew("SwitchBiomePhase",n),this.end()},"setNextBiome");if(s.gameMode.isClassic&&s.gameMode.isWaveFinal(t+9)||s.gameMode.isDaily&&s.gameMode.isWaveFinal(t)||s.gameMode.hasShortBiomes&&!(t%50))i(Te.END);else if(s.gameMode.hasRandomBiomes)i(this.generateNextBiome(t));else if(Array.isArray(Nn[e])){const n=Nn[e].filter(a=>!Array.isArray(a)||!Be(a[1])).map(a=>Array.isArray(a)?a[0]:a);if(n.length>1&&s.findModifier(a=>a instanceof hy)){const a=n.map(r=>({label:ha(r),handler:u(()=>(s.ui.setMode(_.MESSAGE),i(r),!0),"handler")}));s.ui.setMode(_.OPTION_SELECT,{options:a,delay:1e3})}else i(n[Be(n.length)])}else Nn.hasOwnProperty(e)?i(Nn[e]):i(this.generateNextBiome(t))}generateNextBiome(e){return e%50?s.generateRandomBiome(e):Te.END}};u(Nd,"SelectBiomePhase");let zl=Nd;const Pd=class Pd extends Ke{constructor(){super(...arguments),this.phaseName="SelectChallengePhase"}start(){super.start(),s.playBgm("menu"),s.ui.setMode(_.CHALLENGE_SELECT)}};u(Pd,"SelectChallengePhase");let jl=Pd;const Dd=class Dd extends Ke{constructor(){super(...arguments),this.phaseName="SelectGenderPhase"}start(){super.start(),s.ui.showText(g.t("menu:boyOrGirl"),null,()=>{s.ui.setMode(_.OPTION_SELECT,{options:[{label:g.t("settings:boy"),handler:u(()=>(s.gameData.gender=Fe.MALE,s.gameData.saveSetting(ms.Player_Gender,0),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")},{label:g.t("settings:girl"),handler:u(()=>(s.gameData.gender=Fe.FEMALE,s.gameData.saveSetting(ms.Player_Gender,1),s.gameData.saveSystem().then(()=>this.end()),!0),"handler")}]})})}end(){s.ui.setMode(_.MESSAGE),super.end()}};u(Dd,"SelectGenderPhase");let $l=Dd;const Bd=class Bd extends st{constructor(e=0,t,i,n=!1){super(),this.phaseName="SelectModifierPhase",this.rerollCount=e,this.modifierTiers=t,this.customModifierSettings=i,this.isCopy=n}start(){if(super.start(),!this.isPlayer())return!1;!this.rerollCount&&!this.isCopy?this.updateSeed():this.rerollCount&&(s.reroll=!1);const e=s.getPlayerParty();this.isCopy||ja(e,this.getPoolType(),this.rerollCount);const t=this.getModifierCount();this.typeOptions=this.getModifierTypeOptions(t);const i=u((n,a)=>{if(n<0||a<0)return s.ui.showText(g.t("battle:skipItemQuestion"),null,()=>{s.ui.setOverlayMode(_.CONFIRM,()=>{s.ui.revertMode(),s.ui.setMode(_.MESSAGE),super.end()},()=>this.resetModifierSelect(i))}),!1;switch(n){case 0:switch(a){case 0:return this.rerollModifiers();case 1:return this.openModifierTransferScreen(i);case 2:return s.ui.setModeWithoutClear(_.PARTY,Wt.CHECK,-1,()=>{this.resetModifierSelect(i)}),!0;case 3:return this.toggleRerollLock();default:return!1}case 1:return this.selectRewardModifierOption(a,i);default:return this.selectShopModifierOption(n,a,i)}},"modifierSelectCallback");this.resetModifierSelect(i)}selectRewardModifierOption(e,t){if(this.typeOptions.length===0)return s.ui.clearText(),s.ui.setMode(_.MESSAGE),super.end(),!0;const i=this.typeOptions[e].type;return this.applyChosenModifier(i,0,t)}selectShopModifierOption(e,t,i){const n=gf(s.currentBattle.waveIndex,s.getWaveMoneyAmount(1)),a=n[e>2||n.length<=Ns?t:t+Ns],r=a.type,o=new rt(a.cost);s.applyModifier(xr,!0,o);const l=o.value;return s.money<l&&!ne.WAIVE_ROLL_FEE_OVERRIDE?(s.ui.playError(),!1):this.applyChosenModifier(r,l,i)}applyChosenModifier(e,t,i){return e instanceof uy?e instanceof dy?this.openFusionMenu(e,t,i):this.openModifierMenu(e,t,i):this.applyModifier(e.newModifier()),!t}rerollModifiers(){const e=this.getRerollCost(s.lockModifierTiers);return e<0||s.money<e?(s.ui.playError(),!1):(s.reroll=!0,s.phaseManager.unshiftNew("SelectModifierPhase",this.rerollCount+1,this.typeOptions.map(t=>{var i;return(i=t.type)==null?void 0:i.tier}).filter(t=>t!==void 0)),s.ui.clearText(),s.ui.setMode(_.MESSAGE).then(()=>super.end()),ne.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=e,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy"),!0)}openModifierTransferScreen(e){const t=s.getPlayerParty();return s.ui.setModeWithoutClear(_.PARTY,Wt.MODIFIER_TRANSFER,-1,(i,n,a,r)=>{if(r!==void 0&&i<6&&r<6&&i!==r&&n>-1){const l=s.findModifiers(h=>h instanceof Qt&&h.isTransferable&&h.pokemonId===t[i].id)[n];s.tryTransferHeldItemModifier(l,t[r],!0,a,void 0,void 0,!1)}else this.resetModifierSelect(e)},Sn.FilterItemMaxStacks),!0}toggleRerollLock(){if(this.getRerollCost(s.lockModifierTiers)<0)return s.ui.playError(),!1;s.lockModifierTiers=!s.lockModifierTiers;const t=s.ui.getHandler();return t.setRerollCost(this.getRerollCost(s.lockModifierTiers)),t.updateLockRaritiesText(),t.updateRerollCostText(),!1}applyModifier(e,t=0,i=!1){const n=s.addModifier(e,!1,i,void 0,void 0,t);(e.type instanceof hr||e.type instanceof _r)&&s.phaseManager.unshiftPhase(this.copy()),t&&!(e.type instanceof hr)?n?(ne.WAIVE_ROLL_FEE_OVERRIDE||(s.money-=t,s.updateMoneyText(),s.animateMoneyChanged(!1)),s.playSound("se/buy"),s.ui.getHandler().updateCostText()):s.ui.playError():(s.ui.clearText(),s.ui.setMode(_.MESSAGE),super.end())}openFusionMenu(e,t,i){const n=s.getPlayerParty();s.ui.setModeWithoutClear(_.PARTY,Wt.SPLICE,-1,(a,r)=>{r!==void 0&&a<6&&r<6&&a!==r?s.ui.setMode(_.MODIFIER_SELECT,this.isPlayer()).then(()=>{const o=e.newModifier(n[a],n[r]);this.applyModifier(o,t,!0)}):this.resetModifierSelect(i)},e.selectFilter)}openModifierMenu(e,t,i){const n=s.getPlayerParty(),a=e,r=e instanceof vp,o=e instanceof _r,l=e instanceof hr,h=e instanceof my||e instanceof yy,c=r?Wt.MOVE_MODIFIER:o?Wt.TM_MODIFIER:l?Wt.REMEMBER_MOVE_MODIFIER:Wt.MODIFIER,d=o?e.moveId:void 0;s.ui.setModeWithoutClear(_.PARTY,c,-1,(f,p)=>{f<6?s.ui.setMode(_.MODIFIER_SELECT,this.isPlayer()).then(()=>{const T=r?e.newModifier(n[f],p-jf.MOVE_1):l?e.newModifier(n[f],p):e.newModifier(n[f]);this.applyModifier(T,t,!0)}):this.resetModifierSelect(i)},a.selectFilter,e instanceof vp?e.moveSelectFilter:void 0,d,h)}getModifierCount(){var t,i,n;const e=new rt(3);if(s.applyModifiers(py,!0,e),s.applyModifiers(fy,!0,e),this.customModifierSettings){const a=(((t=this.customModifierSettings.guaranteedModifierTiers)==null?void 0:t.length)??0)+(((i=this.customModifierSettings.guaranteedModifierTypeOptions)==null?void 0:i.length)??0)+(((n=this.customModifierSettings.guaranteedModifierTypeFuncs)==null?void 0:n.length)??0);if(this.customModifierSettings.fillRemaining){const r=e.value;e.value=r>a?r:a}else e.value=a}return e.value}resetModifierSelect(e){s.ui.setMode(_.MODIFIER_SELECT,this.isPlayer(),this.typeOptions,e,this.getRerollCost(s.lockModifierTiers))}updateSeed(){s.resetSeed()}isPlayer(){return!0}getRerollCost(e){var r;let t=0;if(ne.WAIVE_ROLL_FEE_OVERRIDE)return t;if(e){const o=[50,125,300,750,2e3];for(const l of this.typeOptions)t+=o[l.type.tier??0]}else t=250;let i=1;if(!Ee((r=this.customModifierSettings)==null?void 0:r.rerollMultiplier)){if(this.customModifierSettings.rerollMultiplier<0)return-1;i=this.customModifierSettings.rerollMultiplier}const n=Math.min(Math.ceil(s.currentBattle.waveIndex/10)*t*2**this.rerollCount*i,Number.MAX_SAFE_INTEGER),a=new rt(n);return s.applyModifier(xr,!0,a),a.value}getPoolType(){return Bs.PLAYER}getModifierTypeOptions(e){return gy(e,s.getPlayerParty(),s.lockModifierTiers?this.modifierTiers:void 0,this.customModifierSettings)}copy(){var e;return s.phaseManager.create("SelectModifierPhase",this.rerollCount,this.modifierTiers,{guaranteedModifierTypeOptions:this.typeOptions,rerollMultiplier:(e=this.customModifierSettings)==null?void 0:e.rerollMultiplier,allowLuckUpgrades:!1},!0)}addModifier(e){return s.addModifier(e,!1,!0)}};u(Bd,"SelectModifierPhase");let Xl=Bd;const Ld=class Ld extends Ke{constructor(){super(...arguments),this.phaseName="SelectStarterPhase"}start(){super.start(),s.playBgm("menu"),s.ui.setMode(_.STARTER_SELECT,e=>{s.ui.clearText(),s.ui.setMode(_.SAVE_SLOT,Ia.SAVE,t=>{if(t===-1)return s.phaseManager.clearPhaseQueue(),s.phaseManager.pushNew("TitlePhase"),this.end();s.sessionSlotId=t,this.initBattle(e)})})}initBattle(e){const t=s.getPlayerParty(),i=[];e.forEach((n,a)=>{!a&&ne.STARTER_SPECIES_OVERRIDE&&(n.species=Dt(ne.STARTER_SPECIES_OVERRIDE));const r=s.gameData.getSpeciesDexAttrProps(n.species,n.dexAttr);let o=Math.min(r.formIndex,Math.max(n.species.forms.length-1,0));n.species.speciesId in ne.STARTER_FORM_OVERRIDES&&!Ee(ne.STARTER_FORM_OVERRIDES[n.species.speciesId])&&n.species.forms[ne.STARTER_FORM_OVERRIDES[n.species.speciesId]]&&(o=ne.STARTER_FORM_OVERRIDES[n.species.speciesId]);let l=n.species.malePercent!==null?r.female?At.FEMALE:At.MALE:At.GENDERLESS;ne.GENDER_OVERRIDE!==null&&(l=ne.GENDER_OVERRIDE);const h=s.gameData.dexData[n.species.speciesId].ivs.slice(0),c=s.addPlayerPokemon(n.species,s.gameMode.getStartingLevel(),n.abilityIndex,o,l,r.shiny,r.variant,h,n.nature);n.moveset&&c.tryPopulateMoveset(n.moveset),n.passive&&(c.passive=!0),c.luck=s.gameData.getDexAttrLuck(s.gameData.dexData[n.species.speciesId].caughtAttr),n.pokerus&&(c.pokerus=!0),n.nickname&&(c.nickname=n.nickname),Ee(n.teraType)?c.teraType=c.species.type1:c.teraType=n.teraType,(s.gameMode.isSplicedOnly||ne.STARTER_FUSION_OVERRIDE)&&c.generateFusionSpecies(!0),c.setVisible(!1),Qi(Zi.STARTER_MODIFY,c),t.push(c),i.push(c.loadAssets())}),Pf(),Df(t[0]),Promise.all(i).then(()=>{Cs.fadeOut(s,s.sound.get("menu"),500,!0),s.time.delayedCall(500,()=>s.playBgm()),s.gameMode.isClassic?s.gameData.gameStats.classicSessionsPlayed++:s.gameData.gameStats.endlessSessionsPlayed++,s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,s.getPlayerParty().forEach(n=>{s.triggerPokemonFormChange(n,Hf)}),this.end()})}};u(Ld,"SelectStarterPhase");let ql=Ld;const Rd=class Rd extends bt{constructor(e){super(e),this.phaseName="SelectTargetPhase"}start(){var i;super.start();const e=s.currentBattle.turnCommands[this.fieldIndex],t=(i=e==null?void 0:e.move)==null?void 0:i.move;s.ui.setMode(_.TARGET_SELECT,this.fieldIndex,t,n=>{s.ui.setMode(_.MESSAGE);const a=s.getField(),r=a[this.fieldIndex],o=Ne[t];if(o&&r.isMoveTargetRestricted(o.id,r,a[n[0]])){const l=r.getRestrictingTag(t,r,a[n[0]]).selectionDeniedText(r,o.id);s.phaseManager.queueMessage(g.t(l,{moveName:o.name}),0,!0),n=[]}n.length<1?(s.currentBattle.turnCommands[this.fieldIndex]=null,s.phaseManager.unshiftNew("CommandPhase",this.fieldIndex)):e.targets=n,(e==null?void 0:e.command)===be.BALL&&this.fieldIndex&&(s.currentBattle.turnCommands[this.fieldIndex-1].skip=!0),this.end()})}};u(Rd,"SelectTargetPhase");let Ql=Rd;const Fd=class Fd extends bt{constructor(e){super(e),this.phaseName="ShinySparklePhase"}start(){super.start(),this.getPokemon().sparkle(),s.time.delayedCall(1e3,()=>this.end())}};u(Fd,"ShinySparklePhase");let Zl=Fd;const Ud=class Ud extends bt{constructor(e,t=!1){super(e),this.phaseName="ShowAbilityPhase",this.passive=t;const i=this.getPokemon();i?(this.pokemonName=we(i),this.abilityName=(t?this.getPokemon().getPassiveAbility():this.getPokemon().getAbility()).name,this.pokemonOnField=!0):this.pokemonOnField=!1}start(){if(super.start(),!this.pokemonOnField||!this.getPokemon())return this.end();if(s.abilityBar.isVisible())return s.phaseManager.unshiftNew("HideAbilityPhase"),s.phaseManager.unshiftNew("ShowAbilityPhase",this.battlerIndex,this.passive),this.end();const e=this.getPokemon();e.isPlayer()?s.currentBattle.lastPlayerInvolved=e.getBattlerIndex()%2:s.currentBattle.lastEnemyInvolved=e.getBattlerIndex()%2,s.abilityBar.showAbility(this.pokemonName,this.abilityName,this.passive,this.player).then(()=>{e.waveData.abilityRevealed=!0,this.end()})}};u(Ud,"ShowAbilityPhase");let Va=Ud;const Vd=class Vd extends xi{constructor(e,t){super(e),this.phaseName="ShowPartyExpBarPhase",this.expValue=t}start(){super.start();const e=this.getPokemon(),t=new rt(this.expValue);s.applyModifiers(Ff,!0,t),t.value=Math.floor(t.value);const i=e.level;e.addExp(t.value);const n=e.level;n>i&&s.phaseManager.unshiftNew("LevelUpPhase",this.partyMemberIndex,i,n),s.phaseManager.unshiftNew("HidePartyExpBarPhase"),e.updateInfo(),s.expParty===fi.SKIP?this.end():s.expParty===fi.ONLY_LEVEL_UP?n>i?s.partyExpBar.showPokemonExp(e,t.value,s.expParty===fi.ONLY_LEVEL_UP,n).then(()=>{setTimeout(()=>this.end(),800/Math.pow(2,s.expGainsSpeed))}):this.end():s.expGainsSpeed<$f.SKIP?s.partyExpBar.showPokemonExp(e,t.value,!1,n).then(()=>{setTimeout(()=>this.end(),500/Math.pow(2,s.expGainsSpeed))}):this.end()}};u(Vd,"ShowPartyExpBarPhase");let Jl=Vd;const Hd=class Hd extends st{constructor(){super(...arguments),this.phaseName="ShowTrainerPhase"}start(){super.start(),s.trainer.setVisible(!0),s.trainer.setTexture(`trainer_${s.gameData.gender===Fe.FEMALE?"f":"m"}_back`),s.tweens.add({targets:s.trainer,x:106,duration:1e3,onComplete:u(()=>this.end(),"onComplete")})}};u(Hd,"ShowTrainerPhase");let eh=Hd;const Yd=class Yd extends bt{constructor(e,t,i,n,a=!0,r=!1,o=!0,l=null,h=!1,c=!1){super(e),this.phaseName="StatStageChangePhase",this.selfTarget=t,this.stats=i,this.stages=n,this.showMessage=a,this.ignoreAbilities=r,this.canBeCopied=o,this.onChange=l,this.comingFromMirrorArmorUser=h,this.comingFromStickyWeb=c}start(){var l;if(this.stats.length>1){for(let h=0;h<this.stats.length;h++){const c=[this.stats[h]];s.phaseManager.unshiftNew("StatStageChangePhase",this.battlerIndex,this.selfTarget,c,this.stages,this.showMessage,this.ignoreAbilities,this.canBeCopied,this.onChange,this.comingFromMirrorArmorUser)}return this.end()}const e=this.getPokemon();let t;if(e.isPlayer())if(!this.comingFromStickyWeb)t=s.getEnemyField()[s.currentBattle.lastEnemyInvolved];else{const h=s.arena.findTagsOnSide(c=>c.tagType===Si.STICKY_WEB,bs.PLAYER)[0].sourceId;s.getEnemyField().forEach(c=>{c.id===h&&(t=c)})}else if(!this.comingFromStickyWeb)t=s.getPlayerField()[s.currentBattle.lastPlayerInvolved];else{const h=s.arena.findTagsOnSide(c=>c.tagType===Si.STICKY_WEB,bs.ENEMY)[0].sourceId;s.getPlayerField().forEach(c=>{c.id===h&&(t=c)})}if(!e.isActive(!0))return this.end();const i=new rt(this.stages);this.ignoreAbilities||ot("StatStageChangeMultiplierAbAttr",e,null,!1,i);let n=!1;const a=this.stats.filter(h=>{const c=new at(!1);if(!this.selfTarget&&i.value<0&&s.arena.applyTagsForSide(Ty,e.isPlayer()?bs.PLAYER:bs.ENEMY,!1,null,c),!c.value&&!this.selfTarget&&i.value<0){Pn("ProtectStatAbAttr",e,h,c,n),Pn("ConditionalUserFieldProtectStatAbAttr",e,h,c,n,e);const d=e.getAlly();Ee(d)||Pn("ConditionalUserFieldProtectStatAbAttr",d,h,c,n,e),t!==void 0&&!e.findTag(f=>f instanceof Cy)&&!this.comingFromMirrorArmorUser&&Pn("ReflectStatStageChangeAbAttr",e,h,c,n,t,this.stages)}return c.value&&(n=!0),!c.value}),r=a.map(h=>(i.value>=1?Math.min(e.getStatStage(h)+i.value,6):Math.max(e.getStatStage(h)+i.value,-6))-e.getStatStage(h));(l=this.onChange)==null||l.call(this,this.getPokemon(),a,r);const o=u(()=>{if(this.showMessage){const c=this.getStatStageChangeMessages(a,i.value,r);for(const d of c)s.phaseManager.queueMessage(d)}for(const c of a)i.value>0&&e.getStatStage(c)<6?e.turnData.statStagesIncreased=!0:i.value<0&&e.getStatStage(c)>-6&&(e.turnData.statStagesDecreased=!0),e.setStatStage(c,e.getStatStage(c)+i.value);if(i.value>0&&this.canBeCopied)for(const c of e.getOpponents())ot("StatStageChangeCopyAbAttr",c,null,!1,this.stats,i.value);Sy("PostStatStageChangeAbAttr",e,a,this.stages,this.selfTarget);const h=s.phaseManager.findPhase(c=>c.is("StatStageChangePhase")&&c.battlerIndex===this.battlerIndex);if(!(h!=null&&h.is("StatStageChangePhase"))){const c=s.applyModifier(by,this.player,e);c&&(e.loseHeldItem(c),s.updateModifiers(this.player))}e.updateInfo(),Rs(zt.Stat_Change).then(()=>super.end())},"end");if(r.filter(h=>h).length&&s.moveAnimations){e.enableMask();const h=e.maskSprite,c=(this.player?106:236)*e.getSpriteScale()*s.field.scale,d=((this.player?148:84)+(i.value>=1?160:0))*e.getSpriteScale()*s.field.scale,f=156*s.field.scale*e.getSpriteScale(),p=316*s.field.scale*e.getSpriteScale(),T=i.value>=1?Pt[Pt.ATK].toLowerCase():Pt[Pt.SPD].toLowerCase(),m=s.add.tileSprite(c,d,f,p,"battle_stats",T);m.setPipeline(s.fieldSpritePipeline),m.setAlpha(0),m.setScale(6),m.setOrigin(.5,1),s.playSound(`se/stat_${i.value>=1?"up":"down"}`),m.setMask(new Phaser.Display.Masks.BitmapMask(s,h??void 0)),s.tweens.add({targets:m,duration:250,alpha:.8375,onComplete:u(()=>{s.tweens.add({targets:m,delay:1e3,duration:250,alpha:0})},"onComplete")}),s.tweens.add({targets:m,duration:1500,y:`${i.value>=1?"-":"+"}=${160*6}`}),s.time.delayedCall(1750,()=>{e.disableMask(),o()})}else o()}aggregateStatStageChanges(){const e=[Pt.ACC,Pt.EVA],t=e.some(n=>this.stats.includes(n));let i;if(this.stats.length===1)for(;(i=s.phaseManager.findPhase(n=>n.is("StatStageChangePhase")&&n.battlerIndex===this.battlerIndex&&n.stats.length===1&&n.stats[0]===this.stats[0]&&n.selfTarget===this.selfTarget&&n.showMessage===this.showMessage&&n.ignoreAbilities===this.ignoreAbilities))&&(this.stages+=i.stages,!!s.phaseManager.tryRemovePhase(n=>n===i)););for(;(i=s.phaseManager.findPhase(n=>n.is("StatStageChangePhase")&&n.battlerIndex===this.battlerIndex&&n.selfTarget===this.selfTarget&&e.some(a=>n.stats.includes(a))===t&&n.stages===this.stages&&n.showMessage===this.showMessage&&n.ignoreAbilities===this.ignoreAbilities))&&(this.stats.push(...i.stats),!!s.phaseManager.tryRemovePhase(n=>n===i)););}getStatStageChangeMessages(e,t,i){const n=[],a={};for(let r=0;r<i.length;r++){const o=i[r];a[o]||(a[o]=[]),a[o].push(r)}return Object.keys(a).forEach(r=>{const o=e.filter((h,c)=>a[r].includes(c));let l="";o.length>1?(l=o.length>=5?g.t("battle:stats"):`${o.slice(0,-1).map(h=>g.t(Wi(h))).join(", ")}${o.length>2?",":""} ${g.t("battle:statsAnd")} ${g.t(Wi(o[o.length-1]))}`,n.push(g.t(Op(Math.abs(Number.parseInt(r)),t>=1),{pokemonNameWithAffix:we(this.getPokemon()),stats:l,count:o.length}))):(l=g.t(Wi(o[0])),n.push(g.t(Op(Math.abs(Number.parseInt(r)),t>=1),{pokemonNameWithAffix:we(this.getPokemon()),stats:l,count:o.length})))}),n}};u(Yd,"StatStageChangePhase");let th=Yd;const Wd=class Wd extends Cn{constructor(){super(...arguments),this.phaseName="SummonMissingPhase"}preSummon(){s.ui.showText(g.t("battle:sendOutPokemon",{pokemonName:we(this.getPokemon())})),s.time.delayedCall(250,()=>this.summon())}};u(Wd,"SummonMissingPhase");let sh=Wd;const Gd=class Gd extends st{constructor(e){super(),this.phaseName="SwitchBiomePhase",this.nextBiome=e}start(){var e,t;if(super.start(),this.nextBiome===void 0)return this.end();s.lastEnemyTrainer=((e=s.currentBattle)==null?void 0:e.trainer)??null,s.lastMysteryEncounter=(t=s.currentBattle)==null?void 0:t.mysteryEncounter,s.tweens.add({targets:[s.arenaEnemy,s.lastEnemyTrainer],x:"+=300",duration:2e3,onComplete:u(()=>{s.arenaEnemy.setX(s.arenaEnemy.x-600),s.newArena(this.nextBiome);const n=`${Xf(this.nextBiome)}_bg`;s.arenaBgTransition.setTexture(n),s.arenaBgTransition.setAlpha(0),s.arenaBgTransition.setVisible(!0),s.arenaPlayerTransition.setBiome(this.nextBiome),s.arenaPlayerTransition.setAlpha(0),s.arenaPlayerTransition.setVisible(!0),s.tweens.add({targets:[s.arenaPlayer,s.arenaBgTransition,s.arenaPlayerTransition],duration:1e3,delay:1e3,ease:"Sine.easeInOut",alpha:u(a=>a===s.arenaPlayer?0:1,"alpha"),onComplete:u(()=>{s.arenaBg.setTexture(n),s.arenaPlayer.setBiome(this.nextBiome),s.arenaPlayer.setAlpha(1),s.arenaEnemy.setBiome(this.nextBiome),s.arenaEnemy.setAlpha(1),s.arenaNextEnemy.setBiome(this.nextBiome),s.arenaBgTransition.setVisible(!1),s.arenaPlayerTransition.setVisible(!1),s.lastEnemyTrainer&&s.lastEnemyTrainer.destroy(),this.end()},"onComplete")})},"onComplete")})}};u(Gd,"SwitchBiomePhase");let ih=Gd;const Kd=class Kd extends st{constructor(e,t,i,n){super(),this.phaseName="SwitchPhase",this.switchType=e,this.fieldIndex=t,this.isModal=i,this.doReturn=n}start(){if(super.start(),this.isModal&&!s.getPlayerParty().filter(t=>t.isAllowedInBattle()&&!t.isActive(!0)).length)return super.end();if(this.isModal&&!this.doReturn&&!s.getPlayerParty()[this.fieldIndex].isFainted())return super.end();if(this.isModal&&s.getPlayerField().filter(t=>t.isAllowedInBattle()&&t.isActive(!0)).length>=s.currentBattle.getBattlerCount())return super.end();const e=s.currentBattle.getBattlerCount()===1||s.getPokemonAllowedInBattle().length>1?this.fieldIndex:0;s.ui.setMode(_.PARTY,this.isModal?Wt.FAINT_SWITCH:Wt.POST_BATTLE_SWITCH,e,(t,i)=>{if(t>=s.currentBattle.getBattlerCount()&&t<6){s.phaseManager.tryRemovePhase(a=>a.is("PostSummonPhase")&&a.player&&a.fieldIndex===this.fieldIndex);const n=i===jf.PASS_BATON?ut.BATON_PASS:this.switchType;s.phaseManager.unshiftNew("SwitchSummonPhase",n,e,t,this.doReturn)}s.ui.setMode(_.MESSAGE).then(()=>super.end())},Sn.FilterNonFainted)}};u(Kd,"SwitchPhase");let nh=Kd;const zd=class zd extends st{constructor(e){super(),this.phaseName="TeraPhase",this.pokemon=e}start(){super.start(),s.phaseManager.queueMessage(g.t("battle:pokemonTerastallized",{pokemonNameWithAffix:we(this.pokemon),type:g.t(`pokemonInfo:Type.${ve[this.pokemon.getTeraType()]}`)})),new $a(Js.TERASTALLIZE,this.pokemon).play(!1,()=>{this.end()})}end(){this.pokemon.isTerastallized=!0,this.pokemon.updateSpritePipelineData(),this.pokemon.isPlayer()&&(s.arena.playerTerasUsed+=1),s.triggerPokemonFormChange(this.pokemon,zf),this.pokemon.isPlayer()&&(s.validateAchv(Ae.TERASTALLIZE),this.pokemon.getTeraType()===ve.STELLAR&&s.validateAchv(Ae.STELLAR_TERASTALLIZE)),super.end()}};u(zd,"TeraPhase");let ah=zd;const jd=class jd extends Ke{constructor(){super(...arguments),this.phaseName="TitlePhase",this.loaded=!1}start(){var e;super.start(),s.ui.clearText(),s.ui.fadeIn(250),s.playBgm("title",!0),s.gameData.getSession(((e=ke)==null?void 0:e.lastSessionSlot)??-1).then(t=>{if(t){this.lastSessionData=t;const n=`${Xf(t.arena.biome)}_bg`;s.arenaBg.setTexture(n)}this.showOptions()}).catch(t=>{console.error(t),this.showOptions()})}showOptions(){const e=[];ke&&ke.lastSessionSlot>-1&&e.push({label:g.t("continue",{ns:"menu"}),handler:u(()=>(this.loadSaveSlot(this.lastSessionData||!ke?-1:ke.lastSessionSlot),!0),"handler")}),e.push({label:g.t("menu:newGame"),handler:u(()=>{const i=u(r=>{this.gameMode=r,s.ui.setMode(_.MESSAGE),s.ui.clearText(),this.end()},"setModeAndEnd"),{gameData:n}=s,a=[];return a.push({label:Ut.getModeName(fe.CLASSIC),handler:u(()=>(i(fe.CLASSIC),!0),"handler")}),a.push({label:g.t("menu:dailyRun"),handler:u(()=>(this.initDailyRun(),!0),"handler")}),n.isUnlocked(Tt.ENDLESS_MODE)&&(a.push({label:Ut.getModeName(fe.CHALLENGE),handler:u(()=>(i(fe.CHALLENGE),!0),"handler")}),a.push({label:Ut.getModeName(fe.ENDLESS),handler:u(()=>(i(fe.ENDLESS),!0),"handler")}),n.isUnlocked(Tt.SPLICED_ENDLESS_MODE)&&a.push({label:Ut.getModeName(fe.SPLICED_ENDLESS),handler:u(()=>(i(fe.SPLICED_ENDLESS),!0),"handler")})),a.push({label:g.t("menu:cancel"),handler:u(()=>(s.phaseManager.clearPhaseQueue(),s.phaseManager.pushNew("TitlePhase"),super.end(),!0),"handler")}),s.ui.showText(g.t("menu:selectGameMode"),null,()=>s.ui.setOverlayMode(_.OPTION_SELECT,{options:a})),!0},"handler")},{label:g.t("menu:loadGame"),handler:u(()=>(s.ui.setOverlayMode(_.SAVE_SLOT,Ia.LOAD,i=>{if(i===-1)return this.showOptions();this.loadSaveSlot(i)}),!0),"handler")},{label:g.t("menu:runHistory"),handler:u(()=>(s.ui.setOverlayMode(_.RUN_HISTORY),!0),"handler"),keepOpen:!0},{label:g.t("menu:settings"),handler:u(()=>(s.ui.setOverlayMode(_.SETTINGS),!0),"handler"),keepOpen:!0});const t={options:e,noCancel:!0,yOffset:47};s.ui.setMode(_.TITLE,t)}loadSaveSlot(e){s.sessionSlotId=e>-1||!ke?e:ke.lastSessionSlot,s.ui.setMode(_.MESSAGE),s.ui.resetModeChain(),s.gameData.loadSession(e,e===-1?this.lastSessionData:void 0).then(t=>{t?(this.loaded=!0,s.ui.showText(g.t("menu:sessionSuccess"),null,()=>this.end())):this.end()}).catch(t=>{console.error(t),s.ui.showText(g.t("menu:failedToLoadSession"),null)})}initDailyRun(){s.ui.clearText(),s.ui.setMode(_.SAVE_SLOT,Ia.SAVE,e=>{if(s.phaseManager.clearPhaseQueue(),e===-1)return s.phaseManager.pushNew("TitlePhase"),super.end();s.sessionSlotId=e;const t=u(i=>{s.gameMode=ba(fe.DAILY),s.eventManager.startEventChallenges(),s.setSeed(i),s.resetSeed(0),s.money=s.gameMode.getStartingMoney();const n=JT(i),a=s.gameMode.getStartingLevel(),r=s.getPlayerParty(),o=[];for(const h of n){const c=s.gameData.getSpeciesDexAttrProps(h.species,h.dexAttr),d=Math.min(c.formIndex,Math.max(h.species.forms.length-1,0)),f=h.species.malePercent!==null?c.female?At.FEMALE:At.MALE:At.GENDERLESS,p=s.addPlayerPokemon(h.species,a,h.abilityIndex,d,f,c.shiny,c.variant,void 0,h.nature);p.setVisible(!1),r.push(p),o.push(p.loadAssets())}ja(r,Bs.DAILY_STARTER);const l=Array(3).fill(null).map(()=>$e.EXP_SHARE().withIdFromFunc($e.EXP_SHARE).newModifier()).concat(Array(3).fill(null).map(()=>$e.GOLDEN_EXP_CHARM().withIdFromFunc($e.GOLDEN_EXP_CHARM).newModifier())).concat([$e.MAP().withIdFromFunc($e.MAP).newModifier()]).concat(Ey(r)).filter(h=>h!==null);for(const h of l)s.addModifier(h,!0,!1,!1,!0);s.updateModifiers(!0,!0),Promise.all(o).then(()=>{s.time.delayedCall(500,()=>s.playBgm()),s.gameData.gameStats.dailyRunSessionsPlayed++,s.newArena(s.gameMode.getStartingBiome()),s.newBattle(),s.arena.init(),s.sessionPlayTime=0,s.lastSavePlayTime=0,this.end()})},"generateDaily");if(!li||pf)ZT().then(i=>{if(i)t(i);else throw new Error("Daily run seed is null!")}).catch(i=>{console.error(`Failed to load daily run:
`,i)});else{let i=btoa(new Date().toISOString().substring(0,10));Ee(ne.DAILY_RUN_SEED_OVERRIDE)||(i=ne.DAILY_RUN_SEED_OVERRIDE),t(i)}})}end(){if(!this.loaded&&!s.gameMode.isDaily?(s.arena.preloadBgm(),s.gameMode=ba(this.gameMode),this.gameMode===fe.CHALLENGE?s.phaseManager.pushNew("SelectChallengePhase"):s.phaseManager.pushNew("SelectStarterPhase"),s.newArena(s.gameMode.getStartingBiome())):s.playBgm(),s.phaseManager.pushNew("EncounterPhase",this.loaded),this.loaded){const e=s.getPokemonAllowedInBattle().length;if(s.phaseManager.pushNew("SummonPhase",0,!0,!0),s.currentBattle.double&&e>1&&s.phaseManager.pushNew("SummonPhase",1,!0,!0),s.currentBattle.battleType!==Ce.TRAINER&&(s.currentBattle.waveIndex>1||!s.gameMode.isDaily)){const t=s.currentBattle.double?2:1;e>t&&(s.phaseManager.pushNew("CheckSwitchPhase",0,s.currentBattle.double),s.currentBattle.double&&s.phaseManager.pushNew("CheckSwitchPhase",1,s.currentBattle.double))}}for(const e of Object.keys(s.gameData.achvUnlocks))Nt.hasOwnProperty(e)&&e!=="CLASSIC_VICTORY"&&s.validateVoucher(Nt[e]);super.end()}};u(jd,"TitlePhase");let rh=jd;const $d=class $d extends st{constructor(e){super(),this.phaseName="ToggleDoublePositionPhase",this.double=e}start(){super.start();const e=s.getPlayerField().find(t=>t.isActive(!0));e?e.setFieldPosition(this.double&&s.getPokemonAllowedInBattle().length>1?as.LEFT:as.CENTER,500).then(()=>{if(e.getFieldIndex()===1){const t=s.getPlayerParty();t[1]=t[0],t[0]=e}this.end()}):this.end()}};u($d,"ToggleDoublePositionPhase");let oh=$d;const Xd=class Xd extends st{constructor(){super(...arguments),this.phaseName="TrainerVictoryPhase"}start(){var i,n,a,r,o,l;s.disableMenu=!0,s.playBgm((i=s.currentBattle.trainer)==null?void 0:i.config.victoryBgm),s.phaseManager.unshiftNew("MoneyRewardPhase",(n=s.currentBattle.trainer)==null?void 0:n.config.moneyMultiplier);const e=(a=s.currentBattle.trainer)==null?void 0:a.config.modifierRewardFuncs;for(const h of e)s.phaseManager.unshiftNew("ModifierRewardPhase",h);const t=(r=s.currentBattle.trainer)==null?void 0:r.config.trainerType;Nt.hasOwnProperty(ps[t])&&!s.validateVoucher(Nt[ps[t]])&&(o=s.currentBattle.trainer)!=null&&o.config.isBoss&&(di.getUpgradeUnlockedVouchers()?s.phaseManager.unshiftNew("ModifierRewardPhase",[$e.VOUCHER_PLUS,$e.VOUCHER_PLUS,$e.VOUCHER_PLUS,$e.VOUCHER_PREMIUM][Nt[ps[t]].voucherType]):s.phaseManager.unshiftNew("ModifierRewardPhase",[$e.VOUCHER,$e.VOUCHER,$e.VOUCHER_PLUS,$e.VOUCHER_PREMIUM][Nt[ps[t]].voucherType])),s.arena.biomeType===Te.SPACE&&(t===ps.BREEDER||t===ps.EXPERT_POKEMON_BREEDER)&&s.validateAchv(Ae.BREEDERS_IN_SPACE),s.ui.showText(g.t("battle:trainerDefeated",{trainerName:(l=s.currentBattle.trainer)==null?void 0:l.getName(mt.NONE,!0)}),null,()=>{var p,T;const h=(p=s.currentBattle.trainer)==null?void 0:p.getVictoryMessages();let c;s.executeWithSeedOffset(()=>c=_i(h),s.currentBattle.waveIndex),c=c;const d=u(()=>{const m=f;f=u(()=>{var C;return s.ui.showDialogue(c,(C=s.currentBattle.trainer)==null?void 0:C.getName(mt.TRAINER,!0),null,m)},"showMessageOrEnd"),f()},"showMessage");let f=u(()=>this.end(),"showMessageOrEnd");if(h!=null&&h.length)if((T=s.currentBattle.trainer)!=null&&T.config.hasCharSprite&&!s.ui.shouldSkipDialogue(c)){const m=f;f=u(()=>s.charSprite.hide().then(()=>s.hideFieldOverlay(250).then(()=>m())),"showMessageOrEnd"),s.showFieldOverlay(500).then(()=>{var C;return s.charSprite.showCharacter((C=s.currentBattle.trainer)==null?void 0:C.getKey(),Xa(h[0])).then(()=>d())})}else d();else f()},null,!0),this.showEnemyTrainer()}};u(Xd,"TrainerVictoryPhase");let lh=Xd;const qd=class qd extends Us{constructor(){super(...arguments),this.phaseName="TurnEndPhase"}start(){super.start(),s.currentBattle.incrementTurn(),s.eventTarget.dispatchEvent(new Iy(s.currentBattle.turn)),s.phaseManager.hideAbilityBar();const e=u(t=>{var i;t.switchOutStatus||(t.lapseTags(Es.TURN_END),s.applyModifiers(vy,t.isPlayer(),t),((i=s.arena.terrain)==null?void 0:i.terrainType)===Ci.GRASSY&&t.isGrounded()&&s.phaseManager.unshiftNew("PokemonHealPhase",t.getBattlerIndex(),Math.max(t.getMaxHp()>>4,1),g.t("battle:turnEndHpRestore",{pokemonName:we(t)}),!0),t.isPlayer()||(s.applyModifiers(Oy,!1,t),s.applyModifier(xy,!1,t)),_y("PostTurnAbAttr",t)),s.applyModifiers(Ay,t.isPlayer(),t),s.applyModifiers(Bf,t.isPlayer(),t),t.tempSummonData.turnCount++,t.tempSummonData.waveTurnCount++},"handlePokemon");this.executeForAll(e),s.arena.lapseTags(),s.arena.weather&&!s.arena.weather.lapse()&&(s.arena.trySetWeather(en.NONE),s.arena.triggerWeatherBasedFormChangesToNormal()),s.arena.terrain&&!s.arena.terrain.lapse()&&s.arena.trySetTerrain(Ci.NONE),this.end()}};u(qd,"TurnEndPhase");let hh=qd;const Qd=class Qd extends Us{constructor(){super(...arguments),this.phaseName="TurnInitPhase"}start(){if(super.start(),s.getPlayerField().forEach(e=>{if(e.isOnField()&&!e.isAllowedInBattle()){s.phaseManager.queueMessage(g.t("challenges:illegalEvolution",{pokemon:e.name}),null,!0);const t=s.getPokemonAllowedInBattle();t.length?t.length>=s.currentBattle.getBattlerCount()||s.currentBattle.double&&!t[0].isActive(!0)?e.switchOut():e.leaveField():(s.phaseManager.clearPhaseQueue(),s.phaseManager.unshiftNew("GameOverPhase")),t.length===1&&s.currentBattle.double&&s.phaseManager.unshiftNew("ToggleDoublePositionPhase",!0)}}),s.eventTarget.dispatchEvent(new wy),My(),ky()){this.end();return}s.getField().forEach((e,t)=>{e!=null&&e.isActive()&&(e.isPlayer()&&s.currentBattle.addParticipant(e),e.resetTurnData(),e.isPlayer()?s.phaseManager.pushNew("CommandPhase",t):s.phaseManager.pushNew("EnemyCommandPhase",t-tt.ENEMY))}),s.phaseManager.pushNew("TurnStartPhase"),this.end()}};u(Qd,"TurnInitPhase");let Ha=Qd;const Zd=class Zd extends Us{constructor(){super(...arguments),this.phaseName="TurnStartPhase"}getSpeedOrder(){const e=s.getPlayerField().filter(a=>a.isActive()),t=s.getEnemyField().filter(a=>a.isActive());let i=e.concat(t);s.executeWithSeedOffset(()=>{i=hf(i)},s.currentBattle.turn,s.waveSeed);const n=new at(!1);return s.arena.applyTags(Gf,!1,n),i.sort((a,r)=>{const o=(a==null?void 0:a.getEffectiveStat(Pt.SPD))??0,l=(r==null?void 0:r.getEffectiveStat(Pt.SPD))??0;return n.value?o-l:l-o}),i.map(a=>a.getFieldIndex()+(a.isPlayer()?tt.PLAYER:tt.ENEMY))}getCommandOrder(){let e=this.getSpeedOrder();const t={};return s.getField(!0).map(i=>{const n=new at(!1),a=new at(!0);ot("BypassSpeedChanceAbAttr",i,null,!1,n),ot("PreventBypassSpeedChanceAbAttr",i,null,!1,n,a),a.value&&s.applyModifiers(Ny,i.isPlayer(),i,n),t[i.getBattlerIndex()]=n}),e=e.slice(0),e.sort((i,n)=>{const a=s.currentBattle.turnCommands[i],r=s.currentBattle.turnCommands[n];if((a==null?void 0:a.command)!==(r==null?void 0:r.command)){if((a==null?void 0:a.command)===be.FIGHT)return 1;if((r==null?void 0:r.command)===be.FIGHT)return-1}else if((a==null?void 0:a.command)===be.FIGHT){const h=Ne[a.move.move],c=Ne[r.move.move],d=s.getField(!0).find(C=>C.getBattlerIndex()===i),f=s.getField(!0).find(C=>C.getBattlerIndex()===n),p=h.getPriority(d,!1),T=c.getPriority(f,!1),m=Math.ceil(p)-Math.ceil(T)===0;if(p!==T)return m&&t[i].value!==t[n].value?t[i].value?-1:1:p<T?1:-1}if(t[i].value!==t[n].value)return t[i].value?-1:1;const o=e.indexOf(i),l=e.indexOf(n);return o<l?-1:o>l?1:0}),e}start(){var a;super.start();const e=s.getField(),t=this.getCommandOrder();let i=0;for(const r of this.getSpeedOrder()){const o=e[r],l=s.currentBattle.preTurnCommands[r];if(!(l!=null&&l.skip))switch(l==null?void 0:l.command){case be.TERA:s.phaseManager.pushNew("TeraPhase",o)}}const n=s.phaseManager;for(const r of t){const o=e[r],l=s.currentBattle.turnCommands[r];if(!(l!=null&&l.skip))switch(l==null?void 0:l.command){case be.FIGHT:{const h=l.move;if(o.turnData.order=i++,!h)continue;const c=o.getMoveset().find(d=>d.moveId===h.move&&d.ppUsed<d.getMovePp())||new Ss(h.move);c.getMove().hasAttr("MoveHeaderAttr")&&n.unshiftNew("MoveHeaderPhase",o,c),o.isPlayer()&&l.cursor===-1?n.pushNew("MovePhase",o,l.targets||l.move.targets,c):n.pushNew("MovePhase",o,l.targets||l.move.targets,c,!1,h.ignorePP)}break;case be.BALL:n.unshiftNew("AttemptCapturePhase",l.targets[0]%2,l.cursor);break;case be.POKEMON:{const h=(a=l.args)!=null&&a[0]?ut.BATON_PASS:ut.SWITCH;n.unshiftNew("SwitchSummonPhase",h,o.getFieldIndex(),l.cursor,!0,o.isPlayer())}break;case be.RUN:{let h=o;if(s.currentBattle.double){const c=e.filter(d=>{if(d)return d.isPlayer()&&d.isActive()});if(c.length>1){const d=c[0].getStat(Pt.SPD)>c[1].getStat(Pt.SPD)?c[0]:c[1],f=c.find(p=>p.hasAbility(bn.RUN_AWAY));h=f!==void 0?f:d}}n.unshiftNew("AttemptRunPhase",h.getFieldIndex())}break}}n.pushNew("WeatherEffectPhase"),n.pushNew("BerryPhase"),n.pushNew("CheckStatusEffectPhase",t),n.pushNew("TurnEndPhase"),this.end()}};u(Zd,"TurnStartPhase");let ch=Zd;const Jd=class Jd extends Ke{constructor(){super(...arguments),this.phaseName="UnavailablePhase"}start(){s.ui.setMode(_.UNAVAILABLE,()=>{s.phaseManager.unshiftNew("LoginPhase",!0),this.end()})}};u(Jd,"UnavailablePhase");let uh=Jd;function WC(y){switch(y){case Tt.ENDLESS_MODE:return`${Ut.getModeName(fe.ENDLESS)} Mode`;case Tt.MINI_BLACK_HOLE:return g.t("modifierType:ModifierType.MINI_BLACK_HOLE.name");case Tt.SPLICED_ENDLESS_MODE:return`${Ut.getModeName(fe.SPLICED_ENDLESS)} Mode`;case Tt.EVIOLITE:return g.t("modifierType:ModifierType.EVIOLITE.name")}}u(WC,"getUnlockableName");const ep=class ep extends Ke{constructor(e){super(),this.phaseName="UnlockPhase",this.unlockable=e}start(){s.time.delayedCall(2e3,()=>{s.gameData.unlocks[this.unlockable]=!0,s.playSound("level_up_fanfare"),s.ui.setMode(_.MESSAGE),s.ui.showText(g.t("battle:unlockedSomething",{unlockedThing:WC(this.unlockable)}),null,()=>{s.time.delayedCall(1500,()=>s.arenaBg.setVisible(!0)),this.end()},null,!0,1500)})}};u(ep,"UnlockPhase");let dh=ep;const tp=class tp extends bt{constructor(e,t=!1){super(e),this.phaseName="VictoryPhase",this.isExpOnly=t}start(){var i;super.start();const e=s.currentBattle.isBattleMysteryEncounter();(!e||!((i=s.currentBattle.mysteryEncounter)!=null&&i.preventGameStatsUpdates))&&s.gameData.gameStats.pokemonDefeated++;const t=this.getPokemon().getExpValue();if(s.applyPartyExp(t,!0),e)return Py(!1,this.isExpOnly),this.end();if(!s.getEnemyParty().find(n=>s.currentBattle.battleType===Ce.WILD?n.isOnField():!(n!=null&&n.isFainted(!0))))if(s.phaseManager.pushNew("BattleEndPhase",!0),s.currentBattle.battleType===Ce.TRAINER&&s.phaseManager.pushNew("TrainerVictoryPhase"),s.gameMode.isEndless||!s.gameMode.isWaveFinal(s.currentBattle.waveIndex)){if(s.phaseManager.pushNew("EggLapsePhase"),s.gameMode.isClassic)switch(s.currentBattle.waveIndex){case cr.RIVAL_1:case cr.RIVAL_2:di.getFixedBattleEventRewards(s.currentBattle.waveIndex).map(n=>s.phaseManager.pushNew("ModifierRewardPhase",$e[n]));break;case cr.EVIL_BOSS_2:s.phaseManager.pushNew("ModifierRewardPhase",$e.LOCK_CAPSULE);break}if(s.currentBattle.waveIndex%10)s.phaseManager.pushNew("SelectModifierPhase",void 0,void 0,this.getFixedBattleCustomModifiers());else if(s.gameMode.isDaily)s.phaseManager.pushNew("ModifierRewardPhase",$e.EXP_CHARM),s.currentBattle.waveIndex>10&&!s.gameMode.isWaveFinal(s.currentBattle.waveIndex)&&s.phaseManager.pushNew("ModifierRewardPhase",$e.GOLDEN_POKEBALL);else{const n=s.gameMode.isEndless?10:s.offsetGym?0:20;s.gameMode.isEndless&&s.currentBattle.waveIndex===10&&s.phaseManager.pushNew("ModifierRewardPhase",$e.EXP_SHARE),s.currentBattle.waveIndex<=750&&(s.currentBattle.waveIndex<=500||s.currentBattle.waveIndex%30===n)&&s.phaseManager.pushNew("ModifierRewardPhase",s.currentBattle.waveIndex%30!==n||s.currentBattle.waveIndex>250?$e.EXP_CHARM:$e.SUPER_EXP_CHARM),s.currentBattle.waveIndex<=150&&!(s.currentBattle.waveIndex%50)&&s.phaseManager.pushNew("ModifierRewardPhase",$e.GOLDEN_POKEBALL),s.gameMode.isEndless&&!(s.currentBattle.waveIndex%50)&&(s.phaseManager.pushNew("ModifierRewardPhase",s.currentBattle.waveIndex%250?$e.VOUCHER_PLUS:$e.VOUCHER_PREMIUM),s.phaseManager.pushNew("AddEnemyBuffModifierPhase"))}(s.gameMode.hasRandomBiomes||s.isNewBiome())&&s.phaseManager.pushNew("SelectBiomePhase"),s.phaseManager.pushNew("NewBattlePhase")}else s.currentBattle.battleType=Ce.CLEAR,s.score+=s.gameMode.getClearScoreBonus(),s.updateScoreText(),s.phaseManager.pushNew("GameOverPhase",!0);this.end()}getFixedBattleCustomModifiers(){const e=s.gameMode,t=s.currentBattle.waveIndex;if(e.isFixedBattle(t))return e.getFixedBattle(t).customModifierRewardSettings}};u(tp,"VictoryPhase");let ph=tp;const sp=class sp extends gn{constructor(){var e,t,i,n,a;super(void 0,void 0,Js.SUNNY+((((i=(t=(e=s)==null?void 0:e.arena)==null?void 0:t.weather)==null?void 0:i.weatherType)||en.NONE)-1)),this.phaseName="WeatherEffectPhase",this.weather=(a=(n=s)==null?void 0:n.arena)==null?void 0:a.weather}start(){var e,t;if(this.weather=(t=(e=s)==null?void 0:e.arena)==null?void 0:t.weather,!this.weather)return this.end();if(this.setAnimation(Js.SUNNY+(this.weather.weatherType-1)),this.weather.isDamaging()){const i=new at(!1);if(this.executeForAll(n=>xp("SuppressWeatherEffectAbAttr",n,this.weather,i)),!i.value){const n=u(a=>{const r=new at(!1);if(xp("PreWeatherDamageAbAttr",a,this.weather,r),ot("BlockNonDirectDamageAbAttr",a,r),r.value||a.getTag(He.UNDERGROUND)||a.getTag(He.UNDERWATER))return;const o=ff(a.getMaxHp()/16);s.phaseManager.queueMessage(Ly(this.weather.weatherType,a)??""),a.damageAndUpdate(o,{result:Ge.INDIRECT,ignoreSegments:!0})},"inflictDamage");this.executeForAll(a=>{!a||!!a.getTypes(!0,!0).filter(o=>{var l;return(l=this.weather)==null?void 0:l.isTypeDamageImmune(o)}).length||a.switchOutStatus||n(a)})}}s.ui.showText(Dy(this.weather.weatherType)??"",null,()=>{this.executeForAll(i=>{i.switchOutStatus||By("PostWeatherLapseAbAttr",i,this.weather)}),super.start()})}};u(sp,"WeatherEffectPhase");let fh=sp;const vr=Object.freeze({ActivatePriorityQueuePhase:Oi,AddEnemyBuffModifierPhase:Uo,AttemptCapturePhase:Vo,AttemptRunPhase:Ho,BattleEndPhase:Yo,BerryPhase:Wo,CheckStatusEffectPhase:Go,CheckSwitchPhase:Ko,CommandPhase:zo,CommonAnimPhase:gn,DamageAnimPhase:jo,EggHatchPhase:qo,EggLapsePhase:Zo,EggSummaryPhase:Jo,EncounterPhase:Da,EndCardPhase:el,EndEvolutionPhase:tl,EnemyCommandPhase:sl,EvolutionPhase:Ba,ExpPhase:il,FaintPhase:nl,FormChangePhase:al,GameOverPhase:ol,GameOverModifierRewardPhase:rl,HideAbilityPhase:yn,HidePartyExpBarPhase:ll,LearnMovePhase:hl,LevelCapPhase:cl,LevelUpPhase:ul,LoadMoveAnimPhase:dl,LoginPhase:pl,MessagePhase:Ra,ModifierRewardPhase:mn,MoneyRewardPhase:fl,MoveAnimPhase:gl,MoveChargePhase:ml,MoveEffectPhase:yl,MoveEndPhase:Fy,MoveHeaderPhase:Tl,MovePhase:Ry,MysteryEncounterPhase:Cl,MysteryEncounterOptionSelectedPhase:Sl,MysteryEncounterBattlePhase:El,MysteryEncounterBattleStartCleanupPhase:bl,MysteryEncounterRewardsPhase:Il,PostMysteryEncounterPhase:vl,NewBattlePhase:Ol,NewBiomeEncounterPhase:xl,NextEncounterPhase:Fa,ObtainStatusEffectPhase:_l,PartyExpPhase:Al,PartyHealPhase:wl,PokemonAnimPhase:Dl,PokemonHealPhase:Bl,PokemonTransformPhase:Ll,PostGameOverPhase:Rl,PostSummonPhase:Tn,PostTurnStatusEffectPhase:Fl,QuietFormChangePhase:Ul,ReloadSessionPhase:Vl,ResetStatusPhase:Hl,ReturnPhase:Yl,RevivalBlessingPhase:Wl,RibbonModifierRewardPhase:Gl,ScanIvsPhase:Kl,SelectBiomePhase:zl,SelectChallengePhase:jl,SelectGenderPhase:$l,SelectModifierPhase:Xl,SelectStarterPhase:ql,SelectTargetPhase:Ql,ShinySparklePhase:Zl,ShowAbilityPhase:Va,ShowPartyExpBarPhase:Jl,ShowTrainerPhase:eh,StatStageChangePhase:th,SummonMissingPhase:sh,SummonPhase:Cn,SwitchBiomePhase:ih,SwitchPhase:nh,SwitchSummonPhase:Ua,TeraPhase:ah,TitlePhase:rh,ToggleDoublePositionPhase:oh,TrainerVictoryPhase:lh,TurnEndPhase:hh,TurnInitPhase:Ha,TurnStartPhase:ch,UnavailablePhase:uh,UnlockPhase:dh,VictoryPhase:ph,WeatherEffectPhase:fh}),ip=class ip{constructor(){this.phaseQueue=[],this.conditionalQueue=[],this.phaseQueuePrepend=[],this.phaseQueuePrependSpliceIndex=-1,this.nextCommandPhaseQueue=[],this.currentPhase=null,this.standbyPhase=null,this.dynamicPhaseQueues=[new Pl],this.dynamicPhaseTypes=[Tn]}getCurrentPhase(){return this.currentPhase}getStandbyPhase(){return this.standbyPhase}pushConditionalPhase(e,t){this.conditionalQueue.push([t,e])}pushPhase(e,t=!1){this.getDynamicPhaseType(e)!==void 0?this.pushDynamicPhase(e):(t?this.nextCommandPhaseQueue:this.phaseQueue).push(e)}unshiftPhase(...e){this.phaseQueuePrependSpliceIndex===-1?this.phaseQueuePrepend.push(...e):this.phaseQueuePrepend.splice(this.phaseQueuePrependSpliceIndex,0,...e)}clearPhaseQueue(){this.phaseQueue.splice(0,this.phaseQueue.length)}clearAllPhases(){for(const e of[this.phaseQueue,this.phaseQueuePrepend,this.conditionalQueue,this.nextCommandPhaseQueue])e.splice(0,e.length);this.dynamicPhaseQueues.forEach(e=>e.clear()),this.currentPhase=null,this.standbyPhase=null,this.clearPhaseQueueSplice()}setPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=this.phaseQueuePrepend.length}clearPhaseQueueSplice(){this.phaseQueuePrependSpliceIndex=-1}shiftPhase(){var t;if(this.standbyPhase){this.currentPhase=this.standbyPhase,this.standbyPhase=null;return}if(this.phaseQueuePrependSpliceIndex>-1&&this.clearPhaseQueueSplice(),this.phaseQueuePrepend.length)for(;this.phaseQueuePrepend.length;){const i=this.phaseQueuePrepend.pop();i&&this.phaseQueue.unshift(i)}this.phaseQueue.length||(this.populatePhaseQueue(),this.conditionalQueue=[]),this.currentPhase=this.phaseQueue.shift()??null;const e=[];for(;(t=this.conditionalQueue)!=null&&t.length;){const i=this.conditionalQueue.shift();i!=null&&i[0]()?this.pushPhase(i[1]):i?e.push(i):console.warn("condition phase is undefined/null!",i)}this.conditionalQueue.push(...e),this.currentPhase&&(`${this.currentPhase.constructor.name}`,this.currentPhase.start())}overridePhase(e){return this.standbyPhase?!1:(this.standbyPhase=this.currentPhase,this.currentPhase=e,`${e.constructor.name}`,e.start(),!0)}findPhase(e){return this.phaseQueue.find(e)}tryReplacePhase(e,t){const i=this.phaseQueue.findIndex(e);return i>-1?(this.phaseQueue[i]=t,!0):!1}tryRemovePhase(e){const t=this.phaseQueue.findIndex(e);return t>-1?(this.phaseQueue.splice(t,1),!0):!1}tryRemoveUnshiftedPhase(e){const t=this.phaseQueuePrepend.findIndex(e);return t>-1?(this.phaseQueuePrepend.splice(t,1),!0):!1}prependToPhase(e,t){e=na(e);const i=vr[t],n=this.phaseQueue.findIndex(a=>a instanceof i);return n!==-1?(this.phaseQueue.splice(n,0,...e),!0):(this.unshiftPhase(...e),!1)}appendToPhase(e,t,i){e=na(e);const n=vr[t],a=this.phaseQueue.findIndex(r=>r instanceof n&&(!i||i(r)));return a!==-1&&this.phaseQueue.length>a?(this.phaseQueue.splice(a+1,0,...e),!0):(this.unshiftPhase(...e),!1)}getDynamicPhaseType(e){let t;return this.dynamicPhaseTypes.forEach((i,n)=>{e instanceof i&&(t=n)}),t}pushDynamicPhase(e){const t=this.getDynamicPhaseType(e);t!==void 0&&(this.pushPhase(new Oi(t)),this.dynamicPhaseQueues[t].push(e))}startDynamicPhaseType(e){const t=this.dynamicPhaseQueues[e].pop();t&&this.unshiftPhase(t)}startDynamicPhase(e){const t=this.getDynamicPhaseType(e);t!==void 0&&(this.unshiftPhase(new Oi(t)),this.dynamicPhaseQueues[t].push(e))}queueMessage(e,t,i,n,a){const r=new Ra(e,t,i,n);a?this.pushPhase(r):this.unshiftPhase(r)}queueAbilityDisplay(e,t,i){this.unshiftPhase(i?new Va(e.getBattlerIndex(),t):new yn),this.clearPhaseQueueSplice()}hideAbilityBar(){s.abilityBar.isVisible()&&this.unshiftPhase(new yn)}populatePhaseQueue(){this.nextCommandPhaseQueue.length&&(this.phaseQueue.push(...this.nextCommandPhaseQueue),this.nextCommandPhaseQueue.splice(0,this.nextCommandPhaseQueue.length)),this.phaseQueue.push(new Ha)}create(e,...t){const i=vr[e];if(!i)throw new Error(`Phase ${e} does not exist in PhaseMap.`);return new i(...t)}pushNew(e,...t){this.pushPhase(this.create(e,...t))}unshiftNew(e,...t){this.unshiftPhase(this.create(e,...t))}prependNewToPhase(e,t,...i){return this.prependToPhase(this.create(t,...i),e)}appendNewToPhase(e,t,...i){return this.appendToPhase(this.create(t,...i),e)}startNewDynamicPhase(e,...t){this.startDynamicPhase(this.create(e,...t))}};u(ip,"PhaseManager");let gh=ip;const nf=(Array.isArray(ne.OPP_IVS_OVERRIDE)?ne.OPP_IVS_OVERRIDE:new Array(6).fill(ne.OPP_IVS_OVERRIDE)).map(y=>Number.isNaN(y)||y===null||y>31?-1:y),np=class np extends Uy{constructor(){super("battle"),this.sessionPlayTime=null,this.lastSavePlayTime=null,this.masterVolume=.5,this.bgmVolume=1,this.fieldVolume=1,this.seVolume=1,this.uiVolume=1,this.gameSpeed=1,this.damageNumbersMode=0,this.reroll=!1,this.shopCursorTarget=qn.REWARDS,this.commandCursorMemory=!1,this.dexForDevs=!1,this.showMovesetFlyout=!0,this.showArenaFlyout=!0,this.showTimeOfDayWidget=!0,this.timeOfDayAnimation=Mf.NONE,this.showLevelUpStats=!0,this.enableTutorials=!1,this.enableMoveInfo=!0,this.enableRetries=!1,this.hideIvs=!1,this.candyUpgradeNotification=0,this.candyUpgradeDisplay=0,this.moneyFormat=Eg.NORMAL,this.uiTheme=Vy.DEFAULT,this.windowType=0,this.experimentalSprites=!1,this.musicPreference=Hy.ALLGENS,this.moveAnimations=!0,this.expGainsSpeed=$f.DEFAULT,this.skipSeenDialogues=!1,this.eggSkipPreference=0,this.expParty=0,this.hpBarSpeed=0,this.fusionPaletteSwaps=!0,this.enableTouchControls=!1,this.enableVibration=!1,this.showBgmBar=!0,this.battleStyle=Nh.SWITCH,this.typeHints=!1,this.disableMenu=!1,this.mysteryEncounterSaveData=new vi,this.shopOverlayShown=!1,this.shopOverlayOpacity=.8,this.bgmCache=new Set,this.rngCounter=0,this.rngSeedOverride="",this.rngOffset=0,this.infoToggles=[],this.eventTarget=new EventTarget,this.phaseManager=new gh,this.eventManager=new Yy,this.updateGameInfo(),xg(this)}loadPokemonAtlas(e,t,i){i===void 0&&(i=this.experimentalSprites);const n=t.includes("variant/")||/_[0-3]$/.test(t);i&&(i=Wy(e)),n&&(t=t.replace("variant/","")),this.load.atlas(e,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.png`,`images/pokemon/${n?"variant/":""}${i?"exp/":""}${t}.json`)}async preload(){Gy(),await this.initVariantData()}create(){this.scene.remove(Ky.KEY),uC.apply(this),this.inputController=new Bo,this.uiInputs=new Lo(this.inputController),this.gameData=new ka,zy(),this.load.setBaseURL(),this.spritePipeline=new Ao(this.game),this.renderer.pipelines.add("Sprite",this.spritePipeline),this.fieldSpritePipeline=new Na(this.game),this.renderer.pipelines.add("FieldSprite",this.fieldSpritePipeline),this.launchBattle()}update(){var e;(e=this.ui)==null||e.update()}launchBattle(){this.arenaBg=this.add.sprite(0,0,"plains_bg"),this.arenaBg.setName("sprite-arena-bg"),this.arenaBgTransition=this.add.sprite(0,0,"plains_bg"),this.arenaBgTransition.setName("sprite-arena-bg-transition");for(const d of[this.arenaBgTransition,this.arenaBg])d.setPipeline(this.fieldSpritePipeline),d.setScale(6),d.setOrigin(0),d.setSize(320,240);const e=this.add.container(0,0);e.setName("field"),e.setScale(6),this.field=e;const t=this.add.container(0,this.game.canvas.height);t.setName("field-ui"),t.setDepth(1),t.setScale(6),this.fieldUI=t;const i=this.make.rexTransitionImagePack({x:0,y:0,scale:6,key:"loading_bg",origin:{x:0,y:0}},!0);i.transit({mode:"blinds",ease:"Cubic.easeInOut",duration:1250}),i.once("complete",()=>{i.destroy()}),this.add.existing(i);const n=this.add.container(0,0);n.setName("ui"),n.setDepth(2),n.setScale(6),this.uiContainer=n;const a=this.game.canvas.width/6,r=this.game.canvas.height/6-48;this.fieldOverlay=this.add.rectangle(0,r*-1-48,a,r,4342338),this.fieldOverlay.setName("rect-field-overlay"),this.fieldOverlay.setOrigin(0,0),this.fieldOverlay.setAlpha(0),this.fieldUI.add(this.fieldOverlay),this.shopOverlay=this.add.rectangle(0,r*-1-48,a,r,460551),this.shopOverlay.setName("rect-shop-overlay"),this.shopOverlay.setOrigin(0,0),this.shopOverlay.setAlpha(0),this.fieldUI.add(this.shopOverlay),this.modifiers=[],this.enemyModifiers=[],this.modifierBar=new _p,this.modifierBar.setName("modifier-bar"),this.add.existing(this.modifierBar),n.add(this.modifierBar),this.enemyModifierBar=new _p(!0),this.enemyModifierBar.setName("enemy-modifier-bar"),this.add.existing(this.enemyModifierBar),n.add(this.enemyModifierBar),this.charSprite=new ko,this.charSprite.setName("sprite-char"),this.charSprite.setup(),this.fieldUI.add(this.charSprite),this.pbTray=new Pa(!0),this.pbTray.setName("pb-tray"),this.pbTray.setup(),this.pbTrayEnemy=new Pa(!1),this.pbTrayEnemy.setName("enemy-pb-tray"),this.pbTrayEnemy.setup(),this.fieldUI.add(this.pbTray),this.fieldUI.add(this.pbTrayEnemy),this.abilityBar=new _o,this.abilityBar.setName("ability-bar"),this.abilityBar.setup(),this.fieldUI.add(this.abilityBar),this.partyExpBar=new wo,this.partyExpBar.setName("party-exp-bar"),this.partyExpBar.setup(),this.fieldUI.add(this.partyExpBar),this.candyBar=new Po,this.candyBar.setName("candy-bar"),this.candyBar.setup(),this.fieldUI.add(this.candyBar),this.biomeWaveText=D(this.game.canvas.width/6-2,0,ur.toString(),O.BATTLE_INFO),this.biomeWaveText.setName("text-biome-wave"),this.biomeWaveText.setOrigin(1,.5),this.fieldUI.add(this.biomeWaveText),this.moneyText=D(this.game.canvas.width/6-2,0,"",O.MONEY),this.moneyText.setName("text-money"),this.moneyText.setOrigin(1,.5),this.fieldUI.add(this.moneyText),this.scoreText=D(this.game.canvas.width/6-2,0,"",O.PARTY,{fontSize:"54px"}),this.scoreText.setName("text-score"),this.scoreText.setOrigin(1,.5),this.fieldUI.add(this.scoreText),this.luckText=D(this.game.canvas.width/6-2,0,"",O.PARTY,{fontSize:"54px"}),this.luckText.setName("text-luck"),this.luckText.setOrigin(1,.5),this.luckText.setVisible(!1),this.fieldUI.add(this.luckText),this.luckLabelText=D(this.game.canvas.width/6-2,0,g.t("common:luckIndicator"),O.PARTY,{fontSize:"54px"}),this.luckLabelText.setName("text-luck-label"),this.luckLabelText.setOrigin(1,.5),this.luckLabelText.setVisible(!1),this.fieldUI.add(this.luckLabelText),this.arenaFlyout=new Fo,this.fieldUI.add(this.arenaFlyout),this.fieldUI.moveBelow(this.arenaFlyout,this.fieldOverlay),this.updateUIPositions(),this.damageNumberHandler=new No,this.spriteSparkleHandler=new Mo,this.spriteSparkleHandler.setup(),this.pokemonInfoContainer=new cn(this.game.canvas.width/6+52,-(this.game.canvas.height/6)+66),this.pokemonInfoContainer.setup(),this.fieldUI.add(this.pokemonInfoContainer),this.party=[];const o=[];this.arenaPlayer=new Dn(!0),this.arenaPlayer.setName("arena-player"),this.arenaPlayerTransition=new Dn(!0),this.arenaPlayerTransition.setName("arena-player-transition"),this.arenaEnemy=new Dn(!1),this.arenaEnemy.setName("arena-enemy"),this.arenaNextEnemy=new Dn(!1),this.arenaNextEnemy.setName("arena-next-enemy"),this.arenaBgTransition.setVisible(!1),this.arenaPlayerTransition.setVisible(!1),this.arenaNextEnemy.setVisible(!1);for(const d of[this.arenaPlayer,this.arenaPlayerTransition,this.arenaEnemy,this.arenaNextEnemy])d instanceof is.GameObjects.Sprite&&d.setOrigin(0,0),e.add(d);const l=this.addFieldSprite(0,0,`trainer_${this.gameData.gender===Fe.FEMALE?"f":"m"}_back`);l.setOrigin(.5,1),l.setName("sprite-trainer"),e.add(l),this.trainer=l,this.anims.create({key:"prompt",frames:this.anims.generateFrameNumbers("prompt",{start:1,end:4}),frameRate:6,repeat:-1,showOnStart:!0}),this.anims.create({key:"tera_sparkle",frames:this.anims.generateFrameNumbers("tera_sparkle",{start:0,end:12}),frameRate:18,repeat:0,showOnStart:!0,hideOnComplete:!0}),this.reset(!1,!1,!0);const h=new Oo;this.uiContainer.add(h),this.ui=h,h.setup();const c=[It.TACKLE,It.TAIL_WHIP,It.FOCUS_ENERGY,It.STRUGGLE];Promise.all([Promise.all(o),jy().then(()=>$y(!0)),Promise.all([It.TACKLE,It.TAIL_WHIP,It.FOCUS_ENERGY,It.STRUGGLE].map(d=>vh(d))).then(()=>Oh(c,!0)),this.initStarterColors()]).then(()=>{this.phaseManager.pushNew("LoginPhase"),this.phaseManager.pushNew("TitlePhase"),this.phaseManager.shiftPhase()})}initSession(){this.sessionPlayTime===null&&(this.sessionPlayTime=0),this.lastSavePlayTime===null&&(this.lastSavePlayTime=0),this.playTimeTimer&&this.playTimeTimer.destroy(),this.playTimeTimer=this.time.addEvent({delay:de(1e3),repeat:-1,callback:u(()=>{this.gameData&&this.gameData.gameStats.playTime++,this.sessionPlayTime!==null&&this.sessionPlayTime++,this.lastSavePlayTime!==null&&this.lastSavePlayTime++},"callback")}),this.updateBiomeWaveText(),this.updateMoneyText(),this.updateScoreText()}async initExpSprites(){Ap.size>0||this.cachedFetch("./exp-sprites.json").then(e=>e.json()).then(e=>{if(Array.isArray(e))for(const t of e)Ap.add(t);Promise.resolve()})}async initVariantData(){Xy();const e=await this.cachedFetch("./images/pokemon/variant/_masterlist.json").then(i=>i.json());for(const i of Object.keys(e))wp[i]=e[i];if(!this.experimentalSprites)return;const t=await this.cachedFetch("./images/pokemon/variant/_exp_masterlist.json").then(i=>i.json());qy(wp,t)}cachedFetch(e,t){const i=this.game.manifest;if(i){const n=i[`/${e.replace("./","")}`];n&&(e+=`?t=${n}`)}return fetch(e,t)}async initStarterColors(){if(Object.keys(ft).length>0)return;const e=await this.cachedFetch("./starter-colors.json").then(t=>t.json());for(const t of Object.keys(e))ft[t]=e[t]}getPlayerParty(){return this.party}getPokemonAllowedInBattle(){return this.getPlayerParty().filter(e=>e.isAllowedInBattle())}getPlayerPokemon(e=!0){return this.getPlayerField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getPlayerField(){var t;const e=this.getPlayerParty();return e.slice(0,Math.min(e.length,(t=this.currentBattle)!=null&&t.double?2:1))}getEnemyParty(){var e;return((e=this.currentBattle)==null?void 0:e.enemyParty)??[]}getEnemyPokemon(e=!0){return this.getEnemyField().find(t=>t.isActive()&&(e||t.switchOutStatus===!1))}getEnemyField(){var t;const e=this.getEnemyParty();return e.slice(0,Math.min(e.length,(t=this.currentBattle)!=null&&t.double?2:1))}getField(e=!1){const t=new Array(4).fill(null),i=this.getPlayerField(),n=this.getEnemyField();return t.splice(0,i.length,...i),t.splice(2,n.length,...n),e?t.filter(a=>a==null?void 0:a.isActive()):t}redirectPokemonMoves(e,t){if(this.currentBattle.double!==!1&&t!=null&&t.isActive(!0)){let i;do i=this.phaseManager.findPhase(n=>n.is("MovePhase")&&n.targets.length===1&&n.targets[0]===e.getBattlerIndex()&&n.pokemon.isPlayer()!==t.isPlayer()),i&&i.targets[0]!==t.getBattlerIndex()&&(i.targets[0]=t.getBattlerIndex());while(i)}}getModifierBar(e){return e?this.enemyModifierBar:this.modifierBar}addInfoToggle(e){this.infoToggles.push(e)}getInfoToggles(e=!1){return e?this.infoToggles.filter(t=>t==null?void 0:t.isActive()):this.infoToggles}getPokemonById(e){const t=u(i=>i.find(n=>n.id===e),"findInParty");return(t(this.getPlayerParty())||t(this.getEnemyParty()))??null}addPlayerPokemon(e,t,i,n,a,r,o,l,h,c,d){const f=new vf(e,t,i,n,a,r,o,l,h,c);return d&&d(f),f.init(),f}addEnemyPokemon(e,t,i,n=!1,a=!1,r,o){ne.OPP_LEVEL_OVERRIDE>0&&(t=ne.OPP_LEVEL_OVERRIDE),ne.OPP_SPECIES_OVERRIDE&&(e=Dt(ne.OPP_SPECIES_OVERRIDE),n=this.getEncounterBossSegments(this.currentBattle.waveIndex,t,e)>1);const l=new Qy(e,t,i,n,a,r);if(ne.OPP_FUSION_OVERRIDE&&l.generateFusionSpecies(),n&&!r){const h=Ig(Be(4294967296));for(let c=0;c<l.ivs.length;c++)l.ivs[c]=Math.round(is.Math.Linear(Math.min(l.ivs[c],h[c]),Math.max(l.ivs[c],h[c]),.75))}o&&o(l);for(let h=0;h<l.ivs.length;h++)nf[h]>-1&&(l.ivs[h]=nf[h]);return l.init(),l}removePokemonFromPlayerParty(e,t=!0){if(!e)return;const i=this.party.indexOf(e);this.party.splice(i,1),t&&(this.field.remove(e,!0),e.destroy()),this.updateModifiers(!0)}addPokemonIcon(e,t,i,n=.5,a=.5,r=!0,o=!1){const l=this.add.container(t,i);l.setName(`${e.name}-icon`);const h=this.add.sprite(0,0,e.getIconAtlasKey(r,o));if(h.setName(`sprite-${e.name}-icon`),h.setFrame(e.getIconId(r,o)),h.frame.name!==e.getIconId(r,o)){`${e.name}`;const c=e.shiny;e.shiny=!1,h.setTexture(e.getIconAtlasKey(r,o)),h.setFrame(e.getIconId(!0,o)),e.shiny=c}if(h.setOrigin(.5,0),l.add(h),e.isFusion(o)){const c=this.add.sprite(0,0,e.getFusionIconAtlasKey(r,o));c.setName("sprite-fusion-icon"),c.setOrigin(.5,0),c.setFrame(e.getFusionIconId(r,o));const d=h.width,f=h.height,p=h.frame,T=(h.frame.cutHeight<=c.frame.cutHeight?Math.ceil:Math.floor)((h.frame.cutHeight+c.frame.cutHeight)/4),m=`${h.frame.name}f${c.frame.name}`;h.frame.texture.has(m)||h.frame.texture.add(m,h.frame.sourceIndex,h.frame.cutX,h.frame.cutY,h.frame.cutWidth,T),h.setFrame(m),c.y=h.frame.cutHeight;const C=c.frame,b=c.frame.cutY+h.frame.cutHeight,S=c.frame.cutHeight-h.frame.cutHeight,x=`${c.frame.name}f${h.frame.name}`;c.frame.texture.has(x)||c.frame.texture.add(x,c.frame.sourceIndex,c.frame.cutX,b,c.frame.cutWidth,S),c.setFrame(x);const A=(p.y+C.y)/2;h.frame.y=c.frame.y=A,l.add(c),n!==.5&&(l.x-=d*(n-.5)),a!==0&&(l.y-=f*a)}else n!==.5&&(l.x-=h.width*(n-.5)),a!==0&&(l.y-=h.height*a);return l}setSeed(e){this.seed=e,this.rngCounter=0,this.waveCycleOffset=this.getGeneratedWaveCycleOffset(),this.offsetGym=this.gameMode.isClassic&&this.getGeneratedOffsetGym()}randBattleSeedInt(e,t=0){var i;return(i=this.currentBattle)==null?void 0:i.randSeedInt(e,t)}reset(e=!1,t=!1,i=!1){var n,a,r;t&&(this.gameData=new ka),this.gameMode=ba(fe.CLASSIC),this.disableMenu=!1,this.score=0,this.money=0,this.lockModifierTiers=!1,this.pokeballCounts=Object.fromEntries(hi(Zn).filter(o=>o<=Zn.MASTER_BALL).map(o=>[o,0])),this.pokeballCounts[Zn.POKEBALL]+=5,ne.POKEBALL_OVERRIDE.active&&(this.pokeballCounts=ne.POKEBALL_OVERRIDE.pokeballs),this.modifiers=[],this.enemyModifiers=[],this.modifierBar.removeAll(!0),this.enemyModifierBar.removeAll(!0);for(const o of this.getPlayerParty())o.destroy();this.party=[];for(const o of this.getEnemyParty())o.destroy();if((a=(n=this.currentBattle)==null?void 0:n.mysteryEncounter)!=null&&a.introVisuals&&this.field.remove((r=this.currentBattle.mysteryEncounter)==null?void 0:r.introVisuals,!0),this.currentBattle=null,this.setSeed(ne.SEED_OVERRIDE||vg(24)),this.seed,this.resetSeed(),this.biomeWaveText.setText(ur.toString()),this.biomeWaveText.setVisible(!1),this.updateMoneyText(),this.moneyText.setVisible(!1),this.updateScoreText(),this.scoreText.setVisible(!1),[this.luckLabelText,this.luckText].map(o=>o.setVisible(!1)),this.newArena(ne.STARTING_BIOME_OVERRIDE||Te.TOWN),this.field.setVisible(!0),this.arenaBgTransition.setPosition(0,0),this.arenaPlayer.setPosition(300,0),this.arenaPlayerTransition.setPosition(0,0),this.arenaEnemy.setPosition(-280,0),this.arenaNextEnemy.setPosition(-280,0),this.arenaNextEnemy.setVisible(!1),this.arena.init(),this.trainer.setTexture(`trainer_${this.gameData.gender===Fe.FEMALE?"f":"m"}_back`),this.trainer.setPosition(406,186),this.trainer.setVisible(!0),this.mysteryEncounterSaveData=new vi,this.updateGameInfo(),i){const o=[...Xe,...Ne,...gt,...hi(Bs).map(l=>Zy(l)).flatMap(l=>Object.values(l).flat().map(h=>h.modifierType).filter(h=>"localize"in h).map(h=>h))];for(const l of o)l.localize()}e&&(this.initVariantData(),this.fadeOutBgm(250,!1),this.tweens.add({targets:[this.uiContainer],alpha:0,duration:250,ease:"Sine.easeInOut",onComplete:u(()=>{this.phaseManager.clearPhaseQueue(),this.ui.freeUIData(),this.uiContainer.remove(this.ui,!0),this.uiContainer.destroy(),this.children.removeAll(!0),this.game.domContainer.innerHTML="",this.launchBattle()},"onComplete")}))}getDoubleBattleChance(e,t){const i=new rt(e%10===0?32:8);this.applyModifiers(Jy,!0,i);for(const n of t)ot("DoubleBattleChanceAbAttr",n,null,!1,i);return Math.max(i.value,1)}isNewBiome(e=this.currentBattle){const t=!(e.waveIndex%10),i=this.gameMode.hasShortBiomes||this.gameMode.isDaily,n=this.gameMode.hasShortBiomes&&e.waveIndex%5===0,a=e.waveIndex%50===49;return t||n||i&&a}newBattle(e,t,i,n,a){var m,C,b;const r=ne.STARTING_WAVE_OVERRIDE||ur,o=e||(((m=this.currentBattle)==null?void 0:m.waveIndex)||r-1)+1;let l,h,c,d=null;this.resetSeed(o);const f=this.getPlayerField();if(this.gameMode.isFixedBattle(o)&&i===void 0)d=this.gameMode.getFixedBattle(o),l=d.double,h=d.battleType,this.executeWithSeedOffset(()=>c=d==null?void 0:d.getTrainer(),(d.seedOffsetWaveIndex||o)<<8),c&&this.field.add(c);else{if(!this.gameMode.hasTrainers||ne.BATTLE_TYPE_OVERRIDE===Ce.WILD||ne.DISABLE_STANDARD_TRAINERS_OVERRIDE&&Ee(i)?h=Ce.WILD:h=ne.BATTLE_TYPE_OVERRIDE??t??(this.gameMode.isWaveTrainer(o,this.arena)?Ce.TRAINER:Ce.WILD),h===Ce.TRAINER){const S=((C=ne.RANDOM_TRAINER_OVERRIDE)==null?void 0:C.trainerType)??this.arena.randomTrainerType(o);let x=!1;pi[S].doubleOnly?x=!0:pi[S].hasDouble&&(x=((b=ne.RANDOM_TRAINER_OVERRIDE)==null?void 0:b.alwaysDouble)||!Be(this.getDoubleBattleChance(o,f)),pi[S].trainerTypeDouble&&![ps.TATE,ps.LIZA].includes(S)&&(x=!1));const A=x?Kt.DOUBLE:Be(2)?Kt.FEMALE:Kt.DEFAULT;c=i!==void 0?i.toTrainer():new Ji(S,A),this.field.add(c)}!ne.BATTLE_TYPE_OVERRIDE&&(this.isWaveMysteryEncounter(h,o)||h===Ce.MYSTERY_ENCOUNTER)&&(h=Ce.MYSTERY_ENCOUNTER,this.mysteryEncounterSaveData.encounterSpawnChance=df)}if(n===void 0&&o>1?h===Ce.WILD&&!this.gameMode.isWaveFinal(o)?l=!Be(this.getDoubleBattleChance(o,f)):h===Ce.TRAINER&&(l=(c==null?void 0:c.variant)===Kt.DOUBLE):d||(l=!!n),this.gameMode.isEndlessBoss(o)&&(l=!1),!Ee(ne.BATTLE_STYLE_OVERRIDE)){let S=null;switch(ne.BATTLE_STYLE_OVERRIDE){case"double":S="double";break;case"single":S="single";break;case"even-doubles":S=o%2?"single":"double";break;case"odd-doubles":S=o%2?"double":"single";break}S==="double"&&(l=!0),h!==Ce.TRAINER&&S==="single"&&(l=!1)}const p=this.currentBattle,T=this.getMaxExpLevel();if(this.lastEnemyTrainer=(p==null?void 0:p.trainer)??null,this.lastMysteryEncounter=p==null?void 0:p.mysteryEncounter,h===Ce.MYSTERY_ENCOUNTER&&(l=!1),p!=null&&p.double&&!l){this.phaseManager.tryRemovePhase(S=>S.is("SwitchPhase"));for(const S of this.getPlayerField())S.lapseTag(He.COMMANDED)}if(this.executeWithSeedOffset(()=>{this.currentBattle=new eT(this.gameMode,o,h,c,l)},o<<3,this.waveSeed),this.currentBattle.incrementTurn(),h===Ce.MYSTERY_ENCOUNTER&&(this.currentBattle.mysteryEncounterType=a),!e&&p){const S=this.isNewBiome(p),x=S||[Ce.TRAINER,Ce.MYSTERY_ENCOUNTER].includes(this.currentBattle.battleType)||this.currentBattle.battleSpec===Ft.FINAL_BOSS;for(const A of this.getEnemyParty())A.destroy();if(this.trySpreadPokerus(),!S&&o%10===5&&this.arena.updatePoolsForTimeOfDay(),x){this.arena.resetArenaEffects();for(const A of f)A.lapseTag(He.COMMANDED);f.forEach((A,w)=>{A.isOnField()&&this.phaseManager.pushNew("ReturnPhase",w)});for(const A of this.getPlayerParty())A.resetBattleAndWaveData(),A.resetTera(),tT("PostBattleInitAbAttr",A),(A.hasSpecies(ge.TERAPAGOS)||this.gameMode.isClassic&&this.currentBattle.waveIndex>180&&this.currentBattle.waveIndex<=190)&&(this.arena.playerTerasUsed=0);this.trainer.visible||this.phaseManager.pushNew("ShowTrainerPhase")}for(const A of this.getPlayerParty())this.triggerPokemonFormChange(A,sT);!this.gameMode.hasRandomBiomes&&!S?this.phaseManager.pushNew("NextEncounterPhase"):(this.phaseManager.pushNew("NewBiomeEncounterPhase"),this.getMaxExpLevel()>T&&this.phaseManager.pushNew("LevelCapPhase"))}return this.currentBattle}newArena(e,t){return this.arena=new _f(e,Te[e].toLowerCase(),t),this.eventTarget.dispatchEvent(new iT),this.arenaBg.pipelineData={terrainColorRatio:this.arena.getBgTerrainColorRatioForBiome()},this.arena}updateFieldScale(){return new Promise(e=>{const t=Math.floor(Math.pow(1/this.getField(!0).map(i=>i.getSpriteScale()).reduce((i,n)=>i=Math.max(n,i),0),.7)*40)/40;this.setFieldScale(t).then(()=>e())})}setFieldScale(e,t=!1){return new Promise(i=>{if(e*=6,this.field.scale===e)return i();const n=this.arenaBg.width*6,a=132*6,r=this.arenaBg.width*e,o=132*e;this.tweens.add({targets:this.field,scale:e,x:(n-r)/2,y:a-o,duration:t?0:de(Math.abs(this.field.scale-e)*200),ease:"Sine.easeInOut",onComplete:u(()=>i(),"onComplete")})})}getSpeciesFormIndex(e,t,i,n){var r,o,l,h,c,d,f,p;if(!((r=e.forms)!=null&&r.length))return 0;const a=["EggLapsePhase","EggHatchPhase"].includes(((o=this.phaseManager.getCurrentPhase())==null?void 0:o.phaseName)??"");if(!a&&((l=this.currentBattle)==null?void 0:l.battleType)===Ce.TRAINER&&!Ee(this.currentBattle.trainer)&&this.currentBattle.trainer.config.hasSpecialtyType()){if(e.speciesId===ge.WORMADAM)switch(this.currentBattle.trainer.config.specialtyType){case ve.GROUND:return 1;case ve.STEEL:return 2;case ve.GRASS:return 0}if(e.speciesId===ge.ROTOM)switch(this.currentBattle.trainer.config.specialtyType){case ve.FLYING:return 4;case ve.GHOST:return 0;case ve.FIRE:return 1;case ve.GRASS:return 5;case ve.WATER:return 2;case ve.ICE:return 3}if(e.speciesId===ge.ORICORIO)switch(this.currentBattle.trainer.config.specialtyType){case ve.GHOST:return 3;case ve.FIRE:return 0;case ve.ELECTRIC:return 1;case ve.PSYCHIC:return 2}if(e.speciesId===ge.PALDEA_TAUROS)switch(this.currentBattle.trainer.config.specialtyType){case ve.FIRE:return 1;case ve.WATER:return 2}if(e.speciesId===ge.SILVALLY||e.speciesId===ge.ARCEUS)return this.currentBattle.trainer.config.specialtyType}switch(e.speciesId){case ge.UNOWN:case ge.SHELLOS:case ge.GASTRODON:case ge.BASCULIN:case ge.DEERLING:case ge.SAWSBUCK:case ge.SCATTERBUG:case ge.SPEWPA:case ge.VIVILLON:case ge.FLABEBE:case ge.FLOETTE:case ge.FLORGES:case ge.FURFROU:case ge.PUMPKABOO:case ge.GOURGEIST:case ge.ORICORIO:case ge.MAGEARNA:case ge.ZARUDE:case ge.SQUAWKABILLY:case ge.TATSUGIRI:case ge.PALDEA_TAUROS:return Be(e.forms.length);case ge.MAUSHOLD:case ge.DUDUNSPARCE:return Be(4)?0:1;case ge.PIKACHU:return((h=this.currentBattle)==null?void 0:h.battleType)===Ce.TRAINER&&((c=this.currentBattle)==null?void 0:c.waveIndex)<30?0:Be(8);case ge.EEVEE:return((d=this.currentBattle)==null?void 0:d.battleType)===Ce.TRAINER&&((f=this.currentBattle)==null?void 0:f.waveIndex)<30&&!a?0:Be(2);case ge.FROAKIE:case ge.FROGADIER:case ge.GRENINJA:return((p=this.currentBattle)==null?void 0:p.battleType)===Ce.TRAINER&&!a?0:Be(2);case ge.URSHIFU:return Be(2);case ge.ZYGARDE:return Be(4);case ge.MINIOR:return Be(7);case ge.ALCREMIE:return Be(9);case ge.MEOWSTIC:case ge.INDEEDEE:case ge.BASCULEGION:case ge.OINKOLOGNE:return t===At.FEMALE?1:0;case ge.TOXTRICITY:{const T=[St.LONELY,St.BOLD,St.RELAXED,St.TIMID,St.SERIOUS,St.MODEST,St.MILD,St.QUIET,St.BASHFUL,St.CALM,St.GENTLE,St.CAREFUL];return i!==void 0&&T.indexOf(i)>-1?1:0}case ge.GIMMIGHOUL:return this.gameMode.hasMysteryEncounters&&!a?1:Be(e.forms.length)}if(n){switch(e.speciesId){case ge.BURMY:case ge.WORMADAM:case ge.ROTOM:case ge.LYCANROC:return Be(e.forms.length)}return 0}return this.arena.getSpeciesFormIndex(e)}getGeneratedOffsetGym(){let e=!1;return this.executeWithSeedOffset(()=>{e=!Be(2)},0,this.seed.toString()),e}getGeneratedWaveCycleOffset(){let e=0;return this.executeWithSeedOffset(()=>{e=Be(8)*5},0,this.seed.toString()),e}getEncounterBossSegments(e,t,i,n=!1){if(ne.OPP_HEALTH_SEGMENTS_OVERRIDE>1)return ne.OPP_HEALTH_SEGMENTS_OVERRIDE;if(ne.OPP_HEALTH_SEGMENTS_OVERRIDE===1)return 0;if(this.gameMode.isDaily&&this.gameMode.isWaveFinal(e))return 5;let a;if(n||i&&(i.subLegendary||i.legendary||i.mythical)?a=!0:this.executeWithSeedOffset(()=>{a=e%10===0||this.gameMode.hasRandomBosses&&Be(100)<Math.min(Math.max(Math.ceil((e-250)/50),0)*2,30)},e<<2),!a)return 0;let r=2;return t>=100&&r++,i&&i.baseTotal>=670&&r++,r+=Math.floor(e/250),r}trySpreadPokerus(){const e=this.getPlayerParty(),t=[],i=u((n,a)=>{const r=e[n+a];!r.pokerus&&!Be(10)&&(r.pokerus=!0,t.push(n+a))},"spread");e.forEach((n,a)=>{!n.pokerus||t.indexOf(a)>-1||this.executeWithSeedOffset(()=>{a&&i(a,-1),a<e.length-1&&i(a,1)},this.currentBattle.waveIndex+(a<<8))})}resetSeed(e){var i;const t=e||((i=this.currentBattle)==null?void 0:i.waveIndex)||0;this.waveSeed=op(this.seed,t),is.Math.RND.sow([this.waveSeed]),this.waveSeed,this.rngCounter=0}executeWithSeedOffset(e,t,i){if(!e)return;const n=this.rngCounter,a=this.rngOffset,r=this.rngSeedOverride,o=is.Math.RND.state();is.Math.RND.sow([op(i||this.seed,t)]),this.rngCounter=0,this.rngOffset=t,this.rngSeedOverride=i||"",e(),is.Math.RND.state(o),this.rngCounter=n,this.rngOffset=a,this.rngSeedOverride=r}addFieldSprite(e,t,i,n,a=0){const r=this.add.sprite(e,t,i,n);return r.setPipeline(this.fieldSpritePipeline),a&&(r.pipelineData.terrainColorRatio=a),r}addPokemonSprite(e,t,i,n,a,r=!1,o=!1){const l=this.addFieldSprite(t,i,n,a);return this.initPokemonSprite(l,e,r,o),l}initPokemonSprite(e,t,i=!1,n=!1){return e.setPipeline(this.spritePipeline,{tone:[0,0,0,0],hasShadow:i,ignoreOverride:n,teraColor:t?Qs(t.getTeraType()):void 0,isTerastallized:t?t.isTerastallized:!1}),this.spriteSparkleHandler.add(e),e}moveBelowOverlay(e){this.fieldUI.moveBelow(e,this.fieldOverlay)}processInfoButton(e){this.arenaFlyout.toggleFlyout(e)}showFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:.5,ease:"Sine.easeOut",duration:e,onComplete:u(()=>t(),"onComplete")})})}hideFieldOverlay(e){return new Promise(t=>{this.tweens.add({targets:this.fieldOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:u(()=>t(),"onComplete")})})}updateShopOverlayOpacity(e){this.shopOverlayOpacity=e,this.shopOverlayShown&&this.shopOverlay.setAlpha(this.shopOverlayOpacity)}showShopOverlay(e){return this.shopOverlayShown=!0,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:this.shopOverlayOpacity,ease:"Sine.easeOut",duration:e,onComplete:u(()=>t(),"onComplete")})})}hideShopOverlay(e){return this.shopOverlayShown=!1,new Promise(t=>{this.tweens.add({targets:this.shopOverlay,alpha:0,duration:e,ease:"Cubic.easeIn",onComplete:u(()=>t(),"onComplete")})})}showEnemyModifierBar(){this.enemyModifierBar.setVisible(!0)}hideEnemyModifierBar(){this.enemyModifierBar.setVisible(!1)}updateBiomeWaveText(){const e=!(this.currentBattle.waveIndex%10),t=ha(this.arena.biomeType);this.fieldUI.moveAbove(this.biomeWaveText,this.luckText),this.biomeWaveText.setText(t+" - "+this.currentBattle.waveIndex.toString()),this.biomeWaveText.setColor(e?"#f89890":"#ffffff"),this.biomeWaveText.setShadowColor(e?"#984038":"#636363"),this.biomeWaveText.setVisible(!0)}updateMoneyText(e=!0){if(this.money===void 0)return;const t=Ka(this.moneyFormat,this.money);this.moneyText.setText(g.t("battleScene:moneyOwned",{formattedMoney:t})),this.fieldUI.moveAbove(this.moneyText,this.luckText),e&&this.moneyText.setVisible(!0)}animateMoneyChanged(e){if(this.tweens.getTweensOf(this.moneyText).length>0)return;const t=this.moneyText.scale*.14*(e?1:-1);this.moneyText.setShadowColor(e?"#008000":"#FF0000"),this.tweens.add({targets:this.moneyText,duration:250,scale:this.moneyText.scale+t,loop:0,yoyo:!0,onComplete:u(i=>this.moneyText.setShadowColor(Oe(O.MONEY,!0)),"onComplete")})}updateScoreText(){this.scoreText.setText(`Score: ${this.score.toString()}`),this.scoreText.setVisible(this.gameMode.isDaily)}updateAndShowText(e){const t=[this.luckLabelText,this.luckText];for(const n of t)n.setAlpha(0);const i=Mp(this.getPlayerParty());this.luckText.setText(Of(i)),i<14?this.luckText.setTint(xf(i)):this.luckText.setTint(16772956,4718441,7039999,16738665),this.luckLabelText.setX(this.game.canvas.width/6-2-(this.luckText.displayWidth+2)),this.tweens.add({targets:t,duration:e,alpha:1,onComplete:u(()=>{for(const n of t)n.setVisible(!0)},"onComplete")})}hideLuckText(e){if(this.reroll)return;const t=[this.luckLabelText,this.luckText];this.tweens.add({targets:t,duration:e,alpha:0,onComplete:u(()=>{for(const i of t)i.setVisible(!1)},"onComplete")})}updateUIPositions(){var n;const e=this.enemyModifiers.filter(a=>a.isIconVisible()).length,t=this.biomeWaveText.getBottomLeft().y-this.biomeWaveText.getTopLeft().y;this.biomeWaveText.setY(-(this.game.canvas.height/6)+(e?e<=12?15:24:0)+t/2),this.moneyText.setY(this.biomeWaveText.y+10),this.scoreText.setY(this.moneyText.y+10),[this.luckLabelText,this.luckText].map(a=>a.setY((this.scoreText.visible?this.scoreText:this.moneyText).y+10));const i=(this.scoreText.visible?this.scoreText:this.moneyText).y+15;this.partyExpBar.setY(i),this.candyBar.setY(i+15),(n=this.ui)==null||n.achvBar.setY(this.game.canvas.height/6+i)}sendTextToBack(){this.fieldUI.sendToBack(this.biomeWaveText),this.fieldUI.sendToBack(this.moneyText),this.fieldUI.sendToBack(this.scoreText)}addFaintedEnemyScore(e){let t=e.getSpeciesForm().getBaseExp()*(e.level/this.getMaxExpLevel())*(e.ivs.reduce((i,n)=>n+=i,0)/93*.2+.8);this.findModifiers(i=>i instanceof Qt&&i.pokemonId===e.id,!1).map(i=>t*=i.getScoreMultiplier()),e.isBoss()&&(t*=Math.sqrt(e.bossSegments)),this.currentBattle.battleScore+=Math.ceil(t)}getMaxExpLevel(e=!1){var a;if(ne.LEVEL_CAP_OVERRIDE>0)return ne.LEVEL_CAP_OVERRIDE;if(e||ne.LEVEL_CAP_OVERRIDE<0)return Number.MAX_SAFE_INTEGER;const t=Math.ceil((((a=this.currentBattle)==null?void 0:a.waveIndex)||1)/10)*10,i=this.gameMode.getWaveForDifficulty(t),n=(1+i/2+Math.pow(i/25,2))*1.2;return Math.ceil(n/2)*2+2}randomSpecies(e,t,i,n,a){if(i)return this.arena.randomSpecies(e,t,void 0,Mp(this.party));const r=n?[...new Set(Xe.filter(o=>o.isCatchable()).filter(n).map(o=>{if(!a)for(;vt.hasOwnProperty(o.speciesId);)o=Dt(vt[o.speciesId]);return o}))]:Xe.filter(o=>o.isCatchable());return r[Be(r.length)]}generateRandomBiome(e){const t=e%250,i=hi(Te).filter(h=>h!==Te.TOWN&&h!==Te.END),n=dr[Te.END][0]-2,a=new Array(n+1).fill(null).map((h,c)=>(1-Math.min(Math.abs(c/(n-1)-t/250)+.25,1))/.75*250),r=[];let o=0;for(const h of i)o+=Math.ceil(a[dr[h][0]-1]/dr[h][1]),r.push(o);const l=Be(o);for(let h=0;h<i.length;h++)if(l<r[h])return i[h];return i[Be(i.length)]}isBgmPlaying(){var e;return((e=this.bgm)==null?void 0:e.isPlaying)??!1}playBgm(e,t){var r,o;if(e===void 0&&(e=((r=this.currentBattle)==null?void 0:r.getBgmOverride())||((o=this.arena)==null?void 0:o.bgm)),e=di.getEventBgmReplacement(e),this.bgm&&e===this.bgm.key){this.bgm.isPlaying||this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}t&&!this.bgm&&(t=!1),this.bgmCache.add(e),this.loadBgm(e);let i=0;i=e===this.arena.bgm?this.arena.getBgmLoopPoint():this.getBgmLoopPoint(e);let n=!1;const a=u(()=>{if(this.ui.bgmBar.setBgmToBgmBar(e),e===null&&this.bgm&&!this.bgm.pendingRemove){this.bgm.play({volume:this.masterVolume*this.bgmVolume});return}this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying&&this.bgm.stop(),this.bgm=this.sound.add(e,{loop:!0}),this.bgm.play({volume:this.masterVolume*this.bgmVolume}),i&&this.bgm.on("looped",()=>this.bgm.play({seek:i}))},"playNewBgm");if(this.load.once(is.Loader.Events.COMPLETE,()=>{n=!0,(!t||!this.bgm.isPlaying)&&a()}),t){const l=u(()=>{n&&(!this.bgm.isPlaying||this.bgm.pendingRemove)&&a()},"onBgmFaded");this.time.delayedCall(this.fadeOutBgm(500,!0)?750:250,l)}this.load.isLoading()||this.load.start()}pauseBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPlaying?(this.bgm.pause(),!0):!1}resumeBgm(){return this.bgm&&!this.bgm.pendingRemove&&this.bgm.isPaused?(this.bgm.resume(),!0):!1}updateSoundVolume(){if(this.sound)for(const e of this.sound.getAllPlaying())if(this.bgmCache.has(e.key))e.setVolume(this.masterVolume*this.bgmVolume);else{const t=e.key.split("/");switch(t[0]){case"battle_anims":case"cry":t[1].startsWith("PRSFX- ")?e.setVolume(this.masterVolume*this.fieldVolume*.5):e.setVolume(this.masterVolume*this.fieldVolume);break;case"se":case"ui":e.setVolume(this.masterVolume*this.seVolume)}}}fadeOutBgm(e=500,t=!0){return this.bgm&&this.sound.getAllPlaying().find(n=>n.key===this.bgm.key)?(Cs.fadeOut(this,this.bgm,e,t),!0):!1}fadeAndSwitchBgm(e,t=!1,i=2e3){this.fadeOutBgm(i,t),this.time.delayedCall(i,()=>{this.playBgm(e)})}playSound(e,t){const i=typeof e=="string"?e:e.key;t=t??{};try{const n=i.split("/");switch(t.volume=t.volume??1,n[0]){case"level_up_fanfare":case"item_fanfare":case"minor_fanfare":case"heal":case"evolution":case"evolution_fanfare":t.volume*=this.masterVolume*this.bgmVolume;break;case"battle_anims":case"cry":t.volume*=this.masterVolume*this.fieldVolume,n[1].startsWith("PRSFX- ")&&(t.volume*=.5);break;case"ui":t.volume*=this.masterVolume*this.uiVolume;break;case"se":t.volume*=this.masterVolume*this.seVolume;break}return this.sound.play(i,t),this.sound.get(i)}catch{return e}}playSoundWithoutBgm(e,t){this.bgmCache.add(e);const i=this.pauseBgm();this.playSound(e);const n=this.sound.get(e);return this.bgmResumeTimer&&this.bgmResumeTimer.destroy(),i&&(this.bgmResumeTimer=this.time.delayedCall(t||de(n.totalDuration*1e3),()=>{this.resumeBgm(),this.bgmResumeTimer=null})),n}getBgmLoopPoint(e){switch(e){case"title":return 46.5;case"battle_kanto_champion":return 13.95;case"battle_johto_champion":return 23.498;case"battle_hoenn_champion_g5":return 11.328;case"battle_hoenn_champion_g6":return 11.762;case"battle_sinnoh_champion":return 12.235;case"battle_champion_alder":return 27.653;case"battle_champion_iris":return 10.145;case"battle_kalos_champion":return 10.38;case"battle_champion_kukui":return 15.784;case"battle_alola_champion":return 13.025;case"battle_galar_champion":return 61.635;case"battle_mustard":return 22.442;case"battle_champion_geeta":return 37.447;case"battle_champion_nemona":return 14.914;case"battle_champion_kieran":return 7.206;case"battle_hoenn_elite":return 11.35;case"battle_unova_elite":return 17.73;case"battle_kalos_elite":return 12.34;case"battle_alola_elite":return 19.212;case"battle_galar_elite":return 164.069;case"battle_paldea_elite":return 12.77;case"battle_bb_elite":return 19.434;case"battle_final_encounter":return 19.159;case"battle_final":return 16.453;case"battle_kanto_gym":return 13.857;case"battle_johto_gym":return 12.911;case"battle_hoenn_gym":return 12.379;case"battle_sinnoh_gym":return 13.122;case"battle_unova_gym":return 19.145;case"battle_kalos_gym":return 44.81;case"battle_galar_gym":return 171.262;case"battle_paldea_gym":return 127.489;case"battle_legendary_kanto":return 32.966;case"battle_legendary_raikou":return 12.632;case"battle_legendary_entei":return 2.905;case"battle_legendary_suicune":return 12.636;case"battle_legendary_lugia":return 19.77;case"battle_legendary_ho_oh":return 17.668;case"battle_legendary_regis_g5":return 49.5;case"battle_legendary_regis_g6":return 21.13;case"battle_legendary_gro_kyo":return 10.547;case"battle_legendary_rayquaza":return 10.495;case"battle_legendary_deoxys":return 13.333;case"battle_legendary_lake_trio":return 16.887;case"battle_legendary_sinnoh":return 22.77;case"battle_legendary_dia_pal":return 16.009;case"battle_legendary_origin_forme":return 18.961;case"battle_legendary_giratina":return 10.451;case"battle_legendary_arceus":return 9.595;case"battle_legendary_unova":return 13.855;case"battle_legendary_kyurem":return 18.314;case"battle_legendary_res_zek":return 18.329;case"battle_legendary_xern_yvel":return 26.468;case"battle_legendary_tapu":return 0;case"battle_legendary_sol_lun":return 6.525;case"battle_legendary_ub":return 9.818;case"battle_legendary_dusk_dawn":return 5.211;case"battle_legendary_ultra_nec":return 10.344;case"battle_legendary_zac_zam":return 11.424;case"battle_legendary_glas_spec":return 12.503;case"battle_legendary_calyrex":return 50.641;case"battle_legendary_riders":return 18.155;case"battle_legendary_birds_galar":return .175;case"battle_legendary_ruinous":return 6.333;case"battle_legendary_kor_mir":return 6.442;case"battle_legendary_loyal_three":return 6.5;case"battle_legendary_ogerpon":return 14.335;case"battle_legendary_terapagos":return 24.377;case"battle_legendary_pecharunt":return 6.508;case"battle_rival":return 14.11;case"battle_rival_2":return 17.714;case"battle_rival_3":return 17.586;case"battle_trainer":return 13.686;case"battle_wild":return 12.703;case"battle_wild_strong":return 13.94;case"end_summit":return 30.025;case"battle_rocket_grunt":return 12.707;case"battle_aqua_magma_grunt":return 12.062;case"battle_galactic_grunt":return 13.043;case"battle_plasma_grunt":return 14.758;case"battle_flare_grunt":return 4.228;case"battle_aether_grunt":return 16;case"battle_skull_grunt":return 20.87;case"battle_macro_grunt":return 11.56;case"battle_star_grunt":return 133.362;case"battle_galactic_admin":return 11.997;case"battle_colress":return 12.234;case"battle_skull_admin":return 15.463;case"battle_oleana":return 14.11;case"battle_star_admin":return 9.493;case"battle_rocket_boss":return 9.115;case"battle_aqua_magma_boss":return 14.847;case"battle_galactic_boss":return 106.962;case"battle_plasma_boss":return 25.624;case"battle_flare_boss":return 8.085;case"battle_aether_boss":return 11.33;case"battle_skull_boss":return 13.13;case"battle_macro_boss":return 11.42;case"battle_star_boss":return 25.764;case"mystery_encounter_gen_5_gts":return 8.52;case"mystery_encounter_gen_6_gts":return 9.24;case"mystery_encounter_fun_and_games":return 4.78;case"mystery_encounter_weird_dream":return 41.42;case"mystery_encounter_delibirdy":return 82.28;case"title_afd":return 47.66;case"battle_rival_3_afd":return 49.147}return 0}toggleInvert(e){e?this.cameras.main.setPostPipeline(Og):this.cameras.main.removePostPipeline("InvertPostFX")}addMoney(e){this.money=Math.min(this.money+e,Number.MAX_SAFE_INTEGER),this.updateMoneyText(),this.animateMoneyChanged(!0),this.validateAchvs(nT)}getWaveMoneyAmount(e){const t=this.currentBattle.waveIndex,i=Math.ceil(t/10)-1,n=Math.pow((i+1+(.75+((t-1)%10+1)/10))*100,1+.005*i)*e;return Math.floor(n/10)*10}addModifier(e,t,i,n,a,r){if(!e||!e.type)return!1;let o=!1;const l=e.type.soundName;this.validateAchvs(aT,e);const h=[];if(e instanceof Qn){if(e.add(this.modifiers,!!n)){if(e instanceof Bn){const c=this.getPokemonById(e.pokemonId);c&&(o=e.apply(c,!0))}i&&!this.sound.get(l)&&this.playSound(l)}else if(!n){const c=rT(e.type.tier);return this.phaseManager.queueMessage(g.t("battle:itemStackFull",{fullItemName:e.type.name,itemName:c.name}),void 0,!1,3e3),this.addModifier(c.newModifier(),t,i,!1,a)}for(const c of h)this.removeModifier(c);!t&&!n&&this.updateModifiers(!0,a)}else if(e instanceof oT)if(i&&!this.sound.get(l)&&this.playSound(l),e instanceof lT){for(const c in this.party){const d=this.party[c],f=[];if(e instanceof hT)if(e.fainted)f.push(1);else{const p=new rt(1);this.applyModifiers(Kf,!0,p),f.push(p.value)}else e instanceof cT?f.push(this.getPokemonById(e.fusePokemonId)):e instanceof uT&&!Ee(r)&&f.push(r);if(e.shouldApply(d,...f)){const p=e.apply(d,...f);o||(o=p)}}this.party.map(c=>c.updateInfo(a))}else{const c=[this];if(e.shouldApply(...c)){const d=e.apply(...c);o||(o=d)}}return o}addEnemyModifier(e,t,i){return new Promise(n=>{const a=[];if(e.add(this.enemyModifiers,!1)){if(e instanceof Bn){const r=this.getPokemonById(e.pokemonId);r&&e.apply(r,!0)}for(const r of a)this.removeModifier(r,!0)}t||this.updateModifiers(!1,i),n()})}tryTransferHeldItemModifier(e,t,i,n=1,a,r,o=!0){const l=e.pokemonId?e.getPokemon():null,h=new at(!1);if(l&&l.isPlayer()!==t.isPlayer()&&ot("BlockItemTheftAbAttr",l,h),h.value)return!1;const c=e.clone();c.pokemonId=t.id;const d=this.findModifier(p=>p instanceof Qt&&p.matchType(e)&&p.pokemonId===t.id,t.isPlayer());if(d){const p=d.getMaxStackCount();if(d.stackCount>=p)return!1;const T=Math.min(n,e.stackCount,p-d.stackCount);e.stackCount-=T,c.stackCount=d.stackCount+T}else{const p=Math.min(n,e.stackCount);e.stackCount-=p,c.stackCount=p}if(!(e.stackCount===0)||!l||this.removeModifier(e,l.isEnemy())){const p=u(()=>!d||this.removeModifier(d,t.isEnemy())?t.isPlayer()?(this.addModifier(c,r,i,!1,a),l&&o&&Pp("PostItemLostAbAttr",l,!1),!0):(this.addEnemyModifier(c,r,a),l&&o&&Pp("PostItemLostAbAttr",l,!1),!0):!1,"addModifier");return l&&l.isPlayer()!==t.isPlayer()&&!r&&this.updateModifiers(l.isPlayer(),a),p(),!0}return!1}canTransferHeldItemModifier(e,t,i=1){const n=e.clone(),a=n.pokemonId?n.getPokemon():null,r=new at(!1);if(a&&a.isPlayer()!==t.isPlayer()&&ot("BlockItemTheftAbAttr",a,r),r.value)return!1;const o=this.findModifier(h=>h instanceof Qt&&h.matchType(n)&&h.pokemonId===t.id,t.isPlayer());if(o){const h=o.getMaxStackCount();if(o.stackCount>=h)return!1;const c=Math.min(i,n.stackCount,h-o.stackCount);n.stackCount-=c}else{const h=Math.min(i,n.stackCount);n.stackCount-=h}return!(n.stackCount===0)||!a||this.hasModifier(e,!a.isPlayer())}removePartyMemberModifiers(e){return new Promise(t=>{const i=this.getPlayerParty()[e].id,n=this.modifiers.filter(a=>a instanceof Qt&&a.pokemonId===i);for(const a of n)this.modifiers.splice(this.modifiers.indexOf(a),1);this.updateModifiers(),t()})}generateEnemyModifiers(e){return new Promise(t=>{if(this.currentBattle.battleSpec===Ft.FINAL_BOSS)return t();const i=this.gameMode.getWaveForDifficulty(this.currentBattle.waveIndex),n=this.gameMode.isWaveFinal(this.currentBattle.waveIndex);let a=Math.ceil(i/10);n&&(a=Math.ceil(a*2.5));const r=this.getEnemyParty();if(this.currentBattle.trainer){const o=this.currentBattle.trainer.genModifiers(r);for(const l of o)this.addEnemyModifier(l,!0,!0)}r.forEach((o,l)=>{var h;if(e&&l<e.length&&e[l])for(const c of e[l]){let d;c.modifier instanceof dT?d=c.modifier.newModifier(o):(d=c.modifier,d.pokemonId=o.id),d.stackCount=c.stackCount??1,d.isTransferable=c.isTransferable??d.isTransferable,this.addEnemyModifier(d,!0)}else{const c=o.isBoss()||this.currentBattle.battleType===Ce.TRAINER&&!!((h=this.currentBattle.trainer)!=null&&h.config.isBoss);let d=32;c&&(d/=2),n&&(d/=8);let f=0;for(let p=0;p<a;p++)Be(this.gameMode.getEnemyModifierChance(c))||f++;c&&(f=Math.max(f,Math.floor(a/2))),pT(i,f,[o],this.currentBattle.battleType===Ce.TRAINER?Bs.TRAINER:Bs.WILD,d).map(p=>p.newModifier(o).add(this.enemyModifiers,!1))}return!0}),this.updateModifiers(!1),t()})}clearEnemyModifiers(){const e=this.enemyModifiers.filter(t=>t instanceof Qn);for(const t of e)this.enemyModifiers.splice(this.enemyModifiers.indexOf(t),1);this.updateModifiers(!1),this.updateUIPositions()}clearEnemyHeldItemModifiers(e){const t=this.enemyModifiers.filter(i=>i instanceof Qt&&(!e||i.getPokemon()===e));for(const i of t)this.enemyModifiers.splice(this.enemyModifiers.indexOf(i),1);this.updateModifiers(!1),this.updateUIPositions()}setModifiersVisible(e){[this.modifierBar,this.enemyModifierBar].map(t=>t.setVisible(e))}updateModifiers(e=!0,t){const i=e?this.modifiers:this.enemyModifiers;for(let a=0;a<i.length;a++){const r=i[a];r instanceof Qt&&!this.getPokemonById(r.pokemonId)&&i.splice(a--,1)}for(const a of i)a instanceof Qn&&(a.virtualStackCount=0);const n=i.slice(0);for(const a of n)a.getStackCount()||i.splice(i.indexOf(a),1);this.updatePartyForModifiers(e?this.getPlayerParty():this.getEnemyParty(),t),(e?this.modifierBar:this.enemyModifierBar).updateModifiers(i),e||this.updateUIPositions()}updatePartyForModifiers(e,t){return new Promise(i=>{Promise.allSettled(e.map(n=>(n.calculateStats(),n.updateInfo(t)))).then(()=>i())})}hasModifier(e,t=!1){return(t?this.enemyModifiers:this.modifiers).indexOf(e)>-1}removeModifier(e,t=!1){const i=t?this.enemyModifiers:this.modifiers,n=i.indexOf(e);if(n>-1){if(i.splice(n,1),e instanceof Bn){const a=this.getPokemonById(e.pokemonId);a&&e.apply(a,!1)}return!0}return!1}getModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(i=>i instanceof e)}findModifiers(e,t=!0){return(t?this.modifiers:this.enemyModifiers).filter(e)}findModifier(e,t=!0){return(t?this.modifiers:this.enemyModifiers).find(e)}applyShuffledModifiers(e,t=!0,...i){let n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.executeWithSeedOffset(()=>{const a=u(r=>{if(r.length<1)return r;const o=Be(r.length);return[r[o],...a(r.filter((l,h)=>h!==o))]},"shuffleModifiers");n=a(n)},this.currentBattle.turn<<4,this.waveSeed),this.applyModifiersInternal(n,t,i)}applyModifiers(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));return this.applyModifiersInternal(n,t,i)}applyModifiersInternal(e,t,i){const n=[];for(const a of e)a.apply(...i)&&(a.type.name,n.push(a));return n}applyModifier(e,t=!0,...i){const n=(t?this.modifiers:this.enemyModifiers).filter(a=>a instanceof e&&a.shouldApply(...i));for(const a of n)if(a.apply(...i))return a.type.name,a;return null}triggerPokemonFormChange(e,t,i=!1,n=!1){if(Zs.hasOwnProperty(e.species.speciesId)){const a=Zs[e.species.speciesId].filter(o=>o.findTrigger(t)&&o.canChange(e));let r;if(e.species.speciesId===ge.NECROZMA&&a.length>1){const o=this.findModifiers(l=>l instanceof Bn&&l.pokemonId===e.id).filter(l=>l.active).map(l=>l.formChangeItem);r=o.includes(kp.N_LUNARIZER)?a[0]:o.includes(kp.N_SOLARIZER)?a[1]:null}else r=a[0];if(r){let o;return e.isPlayer()&&!r.quiet?o=this.phaseManager.create("FormChangePhase",e,r,n):o=this.phaseManager.create("QuietFormChangePhase",e,r),e.isPlayer()&&!r.quiet&&n?this.phaseManager.overridePhase(o):i?this.phaseManager.pushPhase(o):this.phaseManager.unshiftPhase(o),!0}}return!1}triggerPokemonBattleAnim(e,t,i,n=!1){const a=this.phaseManager,r=a.create("PokemonAnimPhase",t,e,i);return n?a.pushPhase(r):a.unshiftPhase(r),!0}validateAchvs(e,...t){const i=Object.values(Ae).filter(n=>n instanceof e);for(const n of i)this.validateAchv(n,t)}validateAchv(e,t){return(!this.gameData.achvUnlocks.hasOwnProperty(e.id)||ne.ACHIEVEMENTS_REUNLOCK_OVERRIDE)&&e.validate(t)?(this.gameData.achvUnlocks[e.id]=new Date().getTime(),this.ui.achvBar.showAchv(e),Nt.hasOwnProperty(e.id)&&this.validateVoucher(Nt[e.id]),!0):!1}validateVoucher(e,t){return!this.gameData.voucherUnlocks.hasOwnProperty(e.id)&&e.validate(t)?(this.gameData.voucherUnlocks[e.id]=new Date().getTime(),this.ui.achvBar.showAchv(e),this.gameData.voucherCounts[e.voucherType]++,!0):!1}updateGameInfo(){var t,i,n;const e={playTime:this.sessionPlayTime??0,gameMode:this.currentBattle?this.gameMode.getName():"Title",biome:this.currentBattle?ha(this.arena.biomeType):"",wave:((t=this.currentBattle)==null?void 0:t.waveIndex)??0,party:((i=this.party)==null?void 0:i.map(a=>{var r;return{name:a.name,form:a.getFormKey(),types:a.getTypes().map(o=>ve[o]),teraType:ve[a.getTeraType()],isTerastallized:a.isTerastallized,level:a.level,currentHP:a.hp,maxHP:a.getMaxHp(),status:(r=a.status)!=null&&r.effect?Ht[a.status.effect]:""}}))??[],modeChain:((n=this.ui)==null?void 0:n.getModeChain())??[]};window.gameInfo=e}getActiveKeys(){const e=[];let t=this.getPlayerParty();t=t.concat(this.getEnemyParty());for(const i of t)e.push(i.getSpriteKey(!0)),i.isPlayer()&&e.push(i.getBattleSpriteKey(!0,!0)),e.push(i.species.getCryKey(i.formIndex)),i.fusionSpecies&&e.push(i.fusionSpecies.getCryKey(i.fusionFormIndex));return e}initFinalBossPhaseTwo(e){if(e.isEnemy()&&e.isBoss()&&!e.formIndex&&e.bossSegmentIndex<1){this.fadeOutBgm(de(2e3),!1),this.ui.showDialogue(Uf[Ft.FINAL_BOSS].firstStageWin,e.species.name,void 0,()=>{const t=Vf($e.MINI_BLACK_HOLE).newModifier(e);t.setTransferrableFalse(),this.addEnemyModifier(t,!1,!0),e.generateAndPopulateMoveset(1),this.setFieldScale(.75),this.triggerPokemonFormChange(e,fT,!1),this.currentBattle.double=!0;const i=this.getPlayerParty().filter(n=>n.isAllowedInBattle());i.length>1&&(this.phaseManager.pushNew("ToggleDoublePositionPhase",!0),i[1].isOnField()||this.phaseManager.pushNew("SummonPhase",1)),this.phaseManager.shiftPhase()});return}this.phaseManager.shiftPhase()}applyPartyExp(e,t,i,n){var p;const a=n??this.currentBattle.playerParticipantIds,r=this.getPlayerParty(),o=this.findModifier(T=>T instanceof gT),l=this.findModifier(T=>T instanceof mT),h=this.findModifier(T=>T instanceof yT),c=r.filter(T=>T.hp),d=c.filter(T=>T.level<this.getMaxExpLevel()),f=[];if(i&&(e=Math.floor(e*this.currentBattle.waveIndex/5+1)),a.size>0){this.currentBattle.battleType===Ce.TRAINER||((p=this.currentBattle.mysteryEncounter)==null?void 0:p.encounterMode)===ns.TRAINER_BATTLE?e=Math.floor(e*1.5):this.currentBattle.isBattleMysteryEncounter()&&this.currentBattle.mysteryEncounter&&(e=Math.floor(e*this.currentBattle.mysteryEncounter.expMultiplier));for(const T of c){const m=T.id,C=a.has(m);if(C&&t){T.addFriendship(TT);const x=T.getHeldItems().find(A=>A instanceof CT);x&&x.stackCount<x.getMaxStackCount()&&(x.stackCount++,this.updateModifiers(!0,!0),T.updateInfo())}if(!d.includes(T))continue;if(!C&&!o){f.push(0);continue}let b=0;C?(b+=1/a.size,a.size>1&&h&&(b+=h.getStackCount()*.2)):o&&(b+=o.getStackCount()*.2/a.size),T.pokerus&&(b*=1.5),ne.XP_MULTIPLIER_OVERRIDE!==null&&(b=ne.XP_MULTIPLIER_OVERRIDE);const S=new rt(e*b);this.applyModifiers(ST,!0,T,S),f.push(Math.floor(S.value))}if(l){let T=0,m=0;d.forEach((x,A)=>{m+=f[A],T+=x.level});const C=Math.floor(T/d.length),b=[];d.forEach((x,A)=>{x.level<=C&&b.push(A)});const S=Math.floor(m/b.length);d.forEach((x,A)=>{f[A]=is.Math.Linear(f[A],b.indexOf(A)>-1?S:0,.2*l.getStackCount())})}for(let T=0;T<d.length;T++){const m=f[T];if(m){const C=r.indexOf(d[T]);this.phaseManager.unshiftPhase(d[T].isOnField()?this.phaseManager.create("ExpPhase",C,m):this.phaseManager.create("ShowPartyExpBarPhase",C,m))}}}}isMysteryEncounterValidForWave(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();return this.gameMode.hasMysteryEncounters&&e===Ce.WILD&&!this.gameMode.isBoss(t)&&t<n&&t>i}isWaveMysteryEncounter(e,t){const[i,n]=this.gameMode.getMysteryEncounterLegalWaves();if(this.isMysteryEncounterValidForWave(e,t)){const a=this.mysteryEncounterSaveData.encounterSpawnChance,r=this.mysteryEncounterSaveData.encounteredEvents,l=_g/(n-i)*(t-i)-r.length,h=a+Math.min(l*Ag,Za/2),c=Ee(ne.MYSTERY_ENCOUNTER_RATE_OVERRIDE)?h:ne.MYSTERY_ENCOUNTER_RATE_OVERRIDE;if(r.length===0||t-r[r.length-1].waveIndex>3||!Ee(ne.MYSTERY_ENCOUNTER_RATE_OVERRIDE)){let f=Za;return this.executeWithSeedOffset(()=>{f=Be(Za)},t*3*1e3),f<c}}return!1}getMysteryEncounter(e,t){var m,C;let i;if(!Ee(ne.MYSTERY_ENCOUNTER_OVERRIDE)&&_s.hasOwnProperty(ne.MYSTERY_ENCOUNTER_OVERRIDE)){if(i=_s[ne.MYSTERY_ENCOUNTER_OVERRIDE],t)return i}else{if(t)return i=_s[e??-1],i;i=Ee(e)?null:_s[e]}if(!i&&((m=this.mysteryEncounterSaveData)!=null&&m.queuedEncounters)&&this.mysteryEncounterSaveData.queuedEncounters.length>0){let b=0;for(;b<this.mysteryEncounterSaveData.queuedEncounters.length&&i;){const S=this.mysteryEncounterSaveData.queuedEncounters[b],x=S.spawnPercent;Be(100)<x&&(i=_s[S.type]),b++}}if(i)return i=new Np(i),i.populateDialogueTokensFromRequirements(),i;const n=[ct.COMMON,ct.GREAT,ct.ULTRA,ct.ROGUE];for(const b of this.mysteryEncounterSaveData.encounteredEvents)b.tier===ct.COMMON?n[0]=n[0]-6:b.tier===ct.GREAT&&(n[1]=n[1]-4);const a=n.reduce((b,S)=>b+S),r=Be(a),o=a-n[0],l=a-n[0]-n[1],h=a-n[0]-n[1]-n[2];let c=r>o?ct.COMMON:r>l?ct.GREAT:r>h?ct.ULTRA:ct.ROGUE;Ee(ne.MYSTERY_ENCOUNTER_TIER_OVERRIDE)||(c=ne.MYSTERY_ENCOUNTER_TIER_OVERRIDE);let d=[];const f=this.mysteryEncounterSaveData.encounteredEvents.length>0?this.mysteryEncounterSaveData.encounteredEvents[this.mysteryEncounterSaveData.encounteredEvents.length-1].type:null,p=this.eventManager.getEventMysteryEncountersDisabled(),T=((C=bT.get(this.arena.biomeType))==null?void 0:C.filter(b=>!p.includes(b)))??[];for(;d.length===0&&c!==null;)d=T.filter(b=>{const S=_s[b];if(!S||this.eventManager.getMysteryEncounterTierForEvent(b,S.encounterTier)!==c)return!1;const x=S.disallowedGameModes;if(x&&x.length>0&&x.includes(this.gameMode.modeId))return!1;if(this.gameMode.modeId===fe.CHALLENGE){const A=S.disallowedChallenges;if(A&&A.length>0&&this.gameMode.challenges.some(w=>A.includes(w.id)))return!1}return!S.meetsRequirements()||f!==null&&b===f?!1:!(this.mysteryEncounterSaveData.encounteredEvents.length>0&&S.maxAllowedEncounters&&S.maxAllowedEncounters>0&&this.mysteryEncounterSaveData.encounteredEvents.filter(A=>A.type===b).length>=S.maxAllowedEncounters)}).map(b=>_s[b]),c===ct.ROGUE?c=ct.ULTRA:c===ct.ULTRA?c=ct.GREAT:c===ct.GREAT?c=ct.COMMON:c=null;return d.length===0?_s[ET.MYSTERIOUS_CHALLENGERS]:(i=d[Be(d.length)],i=new Np(i),i.populateDialogueTokensFromRequirements(),i)}};u(np,"BattleScene");let af=np;export{af as default};
